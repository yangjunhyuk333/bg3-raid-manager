import{r as g,H as Z,M as q,C as U,F as ee,S as te,a as L,j as e,b as se,X as ne,L as J,i as re,g as ae,c as B,d as k,q as T,l as X,o as V,e as A,A as ie,f as oe,B as le,h as de,k as Q,s as $,m as ce,U as H,n as M,p as D,t as W,u as pe,v as xe,D as ge,w as ue,x as he,T as me,y as fe,z as ye,E as be,G as je,I as ve,J as Se,K as _,N as we,O as ke,P as Ce,Q as De,R as Ie,V as ze,W as Te,Z as Ae,Y as Re,_ as Be,$ as Ee}from"./vendor-7DhSiz9k.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const Ne=({activeTab:r,setActiveTab:p,isMobile:i,onlineCount:l,user:o})=>{const[a,u]=g.useState(!1),s=[{id:"home",icon:Z,label:"í™ˆ"},{id:"chat",icon:q,label:"íŒŒí‹° ì±„íŒ…"},{id:"calendar",icon:U,label:"ë ˆì´ë“œ ì¼ì •"},{id:"save",icon:ee,label:"ì„¸ì´ë¸Œ ë¶„ì„"},{id:"settings",icon:te,label:"í™˜ê²½ ì„¤ì •"},...o?.isAdmin?[{id:"admin",icon:L,label:"ë‚˜ì˜ ì˜ì§€ (ê´€ë¦¬)"}]:[]],m=c=>{p(c),i&&u(!1)},d=()=>{confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í”„ë¡œí•„ ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤.")&&(localStorage.removeItem("bg3_user_profile"),window.location.reload())};return e.jsxs(e.Fragment,{children:[i&&!a&&e.jsx("button",{onClick:()=>u(!0),style:{position:"fixed",top:"20px",left:"20px",zIndex:100,background:"rgba(0,0,0,0.5)",border:"none",color:"white",padding:"10px",borderRadius:"8px",backdropFilter:"blur(5px)"},children:e.jsx(se,{})}),e.jsxs("div",{className:`glass-panel sidebar ${i&&!a?"closed":""}`,style:{width:"260px",height:i?"100%":"calc(100vh - 40px)",position:i?"fixed":"sticky",top:i?"0":"20px",left:i?a?"0":"-100%":"20px",margin:i?"0":"20px 0 20px 20px",display:"flex",flexDirection:"column",transition:"all 0.3s ease",zIndex:90,background:i?"rgba(10, 10, 15, 0.95)":void 0,boxShadow:i?"5px 0 15px rgba(0,0,0,0.5)":void 0},children:[e.jsxs("div",{style:{padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.1)",position:"relative"},children:[i&&e.jsx("button",{onClick:()=>u(!1),style:{position:"absolute",top:"20px",right:"15px",background:"transparent",border:"none",color:"white"},children:e.jsx(ne,{})}),e.jsx("h1",{style:{fontSize:"1.5rem",margin:0,background:"linear-gradient(to right, #fff, #aaa)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",paddingRight:"40px"},children:"BG3 Manager"}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",marginTop:"10px",padding:"4px 10px",background:"rgba(16, 185, 129, 0.2)",borderRadius:"20px",border:"1px solid rgba(16, 185, 129, 0.4)",color:"#6ee7b7",fontSize:"0.8rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",background:"#34d399",borderRadius:"50%",boxShadow:"0 0 5px #34d399"}}),e.jsxs("span",{children:[l,"ëª… ì ‘ì† ì¤‘"]})]})]}),e.jsx("nav",{style:{flex:1,padding:"20px 10px"},children:s.map(c=>{const b=c.icon,j=r===c.id;return e.jsxs("button",{onClick:()=>m(c.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"15px",padding:"12px 15px",marginBottom:"8px",background:j?"var(--accent-color)":"transparent",border:"none",borderRadius:"12px",color:"white",fontSize:"1rem",cursor:"pointer",transition:"all 0.2s",textAlign:"left"},children:[e.jsx(b,{size:20,style:{opacity:j?1:.7}}),c.label]},c.id)})}),o&&e.jsxs("div",{style:{padding:"20px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"10px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"1.2rem"},children:"ðŸ§™â€â™‚ï¸"}),e.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:o.nickname}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.6},children:o.className})]})]}),e.jsxs("button",{onClick:d,style:{width:"100%",padding:"8px",background:"rgba(255,255,255,0.05)",border:"none",borderRadius:"6px",color:"rgba(255,255,255,0.6)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"0.8rem"},children:[e.jsx(J,{size:14})," ë¡œê·¸ì•„ì›ƒ"]})]})]})]})},_e={apiKey:"AIzaSyAsbaWbo3DoSTrRFhkaf9XujWPpmeGSjAE",authDomain:"bg3-raid-manager.firebaseapp.com",projectId:"bg3-raid-manager",storageBucket:"bg3-raid-manager.firebasestorage.app",messagingSenderId:"773826713403",appId:"1:773826713403:web:c15fdfca708d47f4fcc91e"},Le=re(_e),S=ae(Le);console.log("ðŸ”¥ Firebase Connected (Real DB Mode)");const F=({setActiveTab:r})=>{const[p,i]=g.useState({userCount:0,recentChats:[],upcomingRaid:null}),[l,o]=g.useState(!0);g.useEffect(()=>{B(k(S,"users_v2")).then(c=>{i(b=>({...b,userCount:c.size}))});const u=T(k(S,"chats_v2"),V("timestamp","desc"),X(3)),s=A(u,c=>{const b=c.docs.map(j=>j.data());i(j=>({...j,recentChats:b}))}),m=T(k(S,"schedules_v2")),d=A(m,c=>{const b=c.docs.map(n=>n.data()),j=new Date().toISOString().split("T")[0],f=b.filter(n=>n.date>=j).sort((n,x)=>n.date.localeCompare(x.date));let t="ì˜ˆì •ëœ ì›ì •ì´ ì—†ìŠµë‹ˆë‹¤.";if(f.length>0){const n=f[0].date,x=new Set(f.filter(y=>y.date===n).map(y=>y.nickname)).size;t=`${n} (ì›ì •ëŒ€ì› ${x}ëª… ëŒ€ê¸° ì¤‘)`}i(n=>({...n,upcomingRaid:t}))});return o(!1),()=>{s(),d()}},[]);const a=({title:u,icon:s,color:m,children:d,onClick:c})=>e.jsxs("div",{className:"glass-panel",onClick:c,style:{padding:"25px",display:"flex",flexDirection:"column",gap:"15px",cursor:c?"pointer":"default",transition:"transform 0.2s",minHeight:"180px",position:"relative",overflow:"hidden"},onMouseEnter:b=>c&&(b.currentTarget.style.transform="translateY(-5px)"),onMouseLeave:b=>c&&(b.currentTarget.style.transform="translateY(0)"),children:[e.jsx("div",{style:{position:"absolute",top:-10,right:-10,width:"80px",height:"80px",background:m,opacity:.1,borderRadius:"50%",filter:"blur(20px)"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"1.2rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(s,{color:m,size:24})," ",u]}),c&&e.jsx(oe,{size:20,style:{opacity:.5}})]}),e.jsx("div",{style:{flex:1},children:d})]});return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"30px",textAlign:"center"},children:[e.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"10px",background:"linear-gradient(to right, #4ade80, #3b82f6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Baldur's Gate 3 Raid Manager"}),e.jsx("p",{style:{opacity:.7},children:"í™˜ì˜í•©ë‹ˆë‹¤, ëª¨í—˜ê°€ë‹˜. ì˜¤ëŠ˜ì˜ ì˜ì§€ í˜„í™© ë³´ê³ ì„œìž…ë‹ˆë‹¤."})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px"},children:[e.jsx(a,{title:"ì˜ì§€ í˜„í™©",icon:ie,color:"#f472b6",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",height:"100%",justifyContent:"center"},children:[e.jsxs("div",{style:{fontSize:"3rem",fontWeight:"bold"},children:[p.userCount,e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"normal",opacity:.6},children:"/4 ëª…"})]}),e.jsx("div",{style:{fontSize:"0.9rem",opacity:.7},children:"í˜„ìž¬ ì •ì˜ˆ ë©¤ë²„ê°€ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤."})]})}),e.jsx(a,{title:"ë‹¤ìŒ ì›ì •",icon:U,color:"#facc15",onClick:()=>r("calendar"),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",height:"100%",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#facc15"},children:p.upcomingRaid||"ì¼ì • ë¡œë”© ì¤‘..."}),e.jsx("div",{style:{fontSize:"0.9rem",opacity:.7},children:"ì¼ì •ì„ ì¡°ìœ¨í•˜ë ¤ë©´ í´ë¦­í•˜ì„¸ìš”."})]})}),e.jsx(a,{title:"ìµœê·¼ ì†Œì‹",icon:q,color:"#60a5fa",onClick:()=>r("chat"),children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:p.recentChats.length>0?p.recentChats.map((u,s)=>e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"8px",fontSize:"0.9rem",borderLeft:"3px solid #60a5fa"},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:"6px"},children:[u.sender,":"]}),e.jsxs("span",{style:{opacity:.8},children:[u.text.substring(0,20),u.text.length>20&&"..."]})]},s)):e.jsx("div",{style:{opacity:.5},children:"ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤."})})})]}),e.jsxs("div",{onClick:()=>r("save"),className:"glass-panel",style:{marginTop:"30px",padding:"30px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(0,0,0,0) 100%)",cursor:"pointer"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 5px 0",color:"#4ade80"},children:"ì„¸ì´ë¸Œ íŒŒì¼ ì •ë°€ ë¶„ì„"}),e.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.9rem"},children:"ë‚´ ì„¸ì´ë¸Œ íŒŒì¼ì˜ ì§„ì§œ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. (HEX Dump / Hidden Stats)"})]}),e.jsx("div",{style:{padding:"10px 20px",borderRadius:"20px",background:"rgba(74, 222, 128, 0.2)",color:"#4ade80",fontWeight:"bold"},children:"ë¶„ì„ì‹¤ ì´ë™ â†’"})]})]})},We=({user:r})=>{const[p,i]=g.useState([]),[l,o]=g.useState(""),[a,u]=g.useState(!0),s=g.useRef(null);g.useEffect(()=>{const d=T(k(S,"chats_v2"),X(100)),c=A(d,b=>{const j=b.docs.map(f=>({id:f.id,...f.data(),timestamp:f.data().timestamp?.toDate().toISOString()||new Date().toISOString()}));j.sort((f,t)=>new Date(f.timestamp)-new Date(t.timestamp)),i(j),u(!1)});return()=>c()},[]),g.useEffect(()=>{s.current?.scrollIntoView({behavior:"smooth"})},[p]);const m=async d=>{if(d.preventDefault(),!l.trim())return;const c=l;o("");try{await Q(k(S,"chats_v2"),{text:c,sender:r?.nickname||"Anonymous",userClass:r?.className||"Unknown",uid:r?.id||"guest",timestamp:$()})}catch(b){console.error("Error sending message: ",b)}};return e.jsxs("div",{className:"glass-panel",style:{height:"calc(100dvh - 80px)",display:"flex",flexDirection:"column",padding:0},children:[e.jsxs("div",{style:{padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(le,{color:"#4fd1c5"})," íŒŒí‹° ìž‘ì „ íšŒì˜ì‹¤"]}),e.jsx("span",{style:{fontSize:"0.8rem",opacity:.7},children:"ë ˆì´ë“œ ì¼ì •ê³¼ ì „ëžµì„ ë…¼ì˜í•˜ì„¸ìš”."})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"15px"},children:[a&&e.jsx("div",{style:{textAlign:"center",opacity:.5},children:"ë¡œë”© ì¤‘..."}),p.map(d=>{const c=d.uid===r?.id;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:c?"flex-end":"flex-start"},children:[e.jsx("div",{style:{fontSize:"0.8rem",marginBottom:"4px",opacity:.7,display:"flex",alignItems:"center",gap:"6px"},children:!c&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["[",d.userClass,"]"]}),d.sender]})}),e.jsx("div",{style:{background:c?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:c?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"75%",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.1)",wordBreak:"break-word"},children:d.text}),e.jsx("span",{style:{fontSize:"0.7rem",opacity:.4,marginTop:"4px"},children:new Date(d.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},d.id)}),e.jsx("div",{ref:s})]}),e.jsxs("form",{onSubmit:m,style:{padding:"20px",background:"rgba(0,0,0,0.2)",display:"flex",gap:"10px",borderRadius:"0 0 16px 16px"},children:[e.jsx("input",{type:"text",value:l,onChange:d=>o(d.target.value),placeholder:"ìž‘ì „ì„ ì „ë‹¬í•˜ì„¸ìš”...",style:{flex:1,padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.05)",color:"white",outline:"none"}}),e.jsx("button",{type:"submit",style:{padding:"12px",borderRadius:"12px",background:"var(--accent-color)",color:"white",border:"none",cursor:"pointer",transition:"all 0.3s"},children:e.jsx(de,{size:20})})]})]})},Oe=({user:r})=>{const p=()=>{const t=[];for(let n=0;n<7;n++){const x=new Date;x.setDate(x.getDate()+n),t.push(x.toISOString().split("T")[0])}return t},i=()=>[18,19,20,21,22,23,0,1,2],[l,o]=g.useState(new Date().toISOString().split("T")[0]),[a,u]=g.useState([]),[s,m]=g.useState([]),[d,c]=g.useState(p()),b=i();g.useEffect(()=>{const t=T(k(S,"schedules_v2")),n=A(t,x=>{const y=x.docs.map(w=>({id:w.id,...w.data()}));m(y);const v=y.filter(w=>w.userId===r.id);u(v)});return()=>n()},[r]);const j=async(t,n)=>{const x=`${t}_${r.id}`,y=a.find(w=>w.id===x);let v=y?y.times:[];v.includes(n)?v=v.filter(w=>w!==n):v=[...v,n],v.length===0?y&&await M(D(S,"schedules_v2",x)):await W(D(S,"schedules_v2",x),{userId:r.id,nickname:r.nickname,date:t,times:v,updatedAt:new Date().toISOString()})},f=(t,n)=>{const x=s.filter(y=>y.date===t&&y.times.includes(n)).map(y=>y.nickname);return{count:x.length,names:x}};return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx("div",{className:"glass-panel",style:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(U,{})," ë ˆì´ë“œ ì‹œê°„í‘œ ì¡°ì •"]}),e.jsx("p",{style:{margin:"5px 0 0 0",opacity:.7},children:"ê°€ëŠ¥í•œ ì‹œê°„ì„ ì²´í¬í•˜ë©´, ëª¨ë“  íŒŒí‹°ì›ì´ ê²¹ì¹˜ëŠ” 'Golden Time'ì„ ì°¾ì•„ì¤ë‹ˆë‹¤."})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"20px"},children:[e.jsx("h3",{style:{marginTop:0},children:"ðŸ“… ë‚ ì§œ ì„ íƒ"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"5px",marginBottom:"20px"},children:d.map(t=>e.jsxs("button",{onClick:()=>o(t),style:{padding:"12px",borderRadius:"8px",border:"none",background:l===t?"var(--accent-color)":"rgba(255,255,255,0.05)",color:"white",cursor:"pointer",textAlign:"left",fontWeight:l===t?"bold":"normal",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:t}),a.find(n=>n.date===t)&&e.jsx(ce,{size:16})]},t))}),e.jsxs("h3",{style:{marginTop:0},children:["â±ï¸ ",l," ê°€ëŠ¥ ì‹œê°„"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},children:b.map(t=>{const n=a.find(x=>x.date===l)?.times.includes(t);return e.jsx("button",{onClick:()=>j(l,t),style:{padding:"10px",borderRadius:"6px",border:"1px solid "+(n?"var(--accent-color)":"rgba(255,255,255,0.2)"),background:n?"rgba(99, 102, 241, 0.3)":"transparent",color:n?"white":"rgba(255,255,255,0.6)",cursor:"pointer"},children:t<10?`0${t}:00`:`${t}:00`},t)})})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"20px"},children:[e.jsxs("h3",{style:{marginTop:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(H,{})," íŒŒí‹° í•©ë¥˜ í˜„í™©",e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",opacity:.6},children:"(ì´ˆë¡ìƒ‰ì´ ë² ìŠ¤íŠ¸ íƒ€ìž„!)"})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:"ì‹œê°„"}),d.map(t=>e.jsx("th",{style:{padding:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:t.slice(5)},t))]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid rgba(255,255,255,0.05)",fontWeight:"bold",color:"rgba(255,255,255,0.7)"},children:t<10?`0${t}:00`:`${t}:00`}),d.map(n=>{const{count:x,names:y}=f(n,t);let v="transparent";return x===4?v="rgba(74, 222, 128, 0.6)":x===3?v="rgba(251, 191, 36, 0.4)":x>0&&(v="rgba(239, 68, 68, 0.2)"),e.jsx("td",{style:{background:v,borderBottom:"1px solid rgba(255,255,255,0.05)",textAlign:"center",cursor:"grab"},title:x>0?`${y.join(", ")} ê°€ëŠ¥`:"",children:x>0&&x},n+t)})]},t))})]})}),e.jsx("div",{style:{marginTop:"20px",fontSize:"0.8rem",opacity:.6,textAlign:"center"},children:"ê° ì¹¸ì˜ ìˆ«ìžëŠ” í•´ë‹¹ ì‹œê°„ì— ì°¸ì—¬ ê°€ëŠ¥í•œ ì¸ì› ìˆ˜ìž…ë‹ˆë‹¤. ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ëˆ„êµ¬ì¸ì§€ ë³´ìž…ë‹ˆë‹¤."})]})]})]})},K=new TextDecoder("utf-8"),Pe=async r=>new Promise(p=>{const i=new FileReader;i.onload=async l=>{const o=l.target.result,a=new DataView(o),u=o.byteLength,s=[];try{let m="";for(let f=0;f<Math.min(32,u);f++)m+=a.getUint8(f).toString(16).padStart(2,"0").toUpperCase()+" ";s.push(`Header Hex: ${m}`);const d=String.fromCharCode(a.getUint8(0),a.getUint8(1),a.getUint8(2),a.getUint8(3));if(s.push(`Magic String: "${d}"`),d!=="LSPK")s.push("WARNING: Magic mismatch. Proceeding with Raw Scan (Legacy/Console Save?).");else{const f=a.getUint32(4,!0);s.push(`LSPK Version: ${f}`)}const c=Math.min(u,20*1024*1024),b=new Uint8Array(o,0,c);let j="";try{j=K.decode(b)}catch{s.push("UTF-8 Decode Failed, using ASCII fallback."),j=Array.from(b).map(t=>String.fromCharCode(t)).join("")}if(u>c){const f=Math.min(1048576,u-c),t=new Uint8Array(o,u-f,f);let n="";try{n=K.decode(t)}catch{n=Array.from(t).map(y=>String.fromCharCode(y)).join("")}j+=n,s.push(`Scanned Footer (${f} bytes).`)}s.push(`Total Scanned Text Length: ${j.length}`),p({success:!0,rawText:j,fileSize:u,debugInfo:s})}catch(m){p({success:!1,error:m.message,debugInfo:s})}},i.onerror=()=>p({success:!1,error:"Read Error",debugInfo:[]}),i.readAsArrayBuffer(r)}),Fe=(r,p)=>{let i="Unknown";r.includes("Honour")?i="Honour (ëª…ì˜ˆ)":r.includes("Tactician")?i="Tactician (ì „ìˆ ê°€)":r.includes("Story")?i="Explorer (íƒí—˜ê°€)":(r.includes("Balanced")||r.includes("Balancer"))&&(i="Balanced (ê· í˜•)");const l=[];return[{key:"Shadowheart",name:"ì„€ë„í•˜íŠ¸",img:"ðŸ–¤"},{key:"Astarion",name:"ì•„ìŠ¤íƒ€ë¦¬ì˜¨",img:"ðŸ§›"},{key:"Gale",name:"ê²Œì¼",img:"ðŸ§™â€â™‚ï¸"},{key:"Lae'zel",name:"ë ˆì´ì ¤",img:"ðŸ‘½"},{key:"Wyll",name:"ìœŒ",img:"ðŸ˜ˆ"},{key:"Karlach",name:"ì¹´ë¥¼ë¼í¬",img:"â¤ï¸â€ðŸ”¥"},{key:"Halsin",name:"í• ì‹ ",img:"ðŸ»"},{key:"Minthara",name:"ë¯¼íƒ€ë¼",img:"ðŸ§â€â™€ï¸"},{key:"Jaheira",name:"ìží—¤ì´ë¼",img:"ðŸŒ¿"},{key:"Minsc",name:"ë¯¼ìŠ¤í¬",img:"ðŸ¹"}].forEach(a=>{r.includes(a.key)&&l.push({...a,status:"Detected"})}),{meta:{mode:i,size:p.toFixed(2)+" MB"},companions:l,economy:{gold:"Encrypted (LSF)",supplies:"Encrypted (LSF)"}}},Ue=({user:r})=>{const[p,i]=g.useState(null),[l,o]=g.useState(!1),[a,u]=g.useState(null),[s,m]=g.useState([]),[d,c]=g.useState([]);g.useEffect(()=>{const t=T(k(S,"save_reports_v2"),V("createdAt","desc")),n=A(t,x=>{c(x.docs.map(y=>({id:y.id,...y.data()})))});return()=>n()},[]);const b=t=>{t.preventDefault();const n=t.dataTransfer?t.dataTransfer.files:t.target.files;n&&n.length>0&&j(n[0])},j=async t=>{if(!t.name.endsWith(".lsv")&&!t.name.endsWith(".save")){alert("í™•ìž¥ìžê°€ .lsv ë˜ëŠ” .saveì¸ íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.");return}o(!0),u(null),i(null),m([]);try{const{success:n,rawText:x,fileSize:y,error:v,debugInfo:w}=await Pe(t);if(m(w||[]),!n)throw new Error(v||"íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");const R={...Fe(x,y/(1024*1024)),filename:t.name};i(R),r&&R&&Q(k(S,"save_reports"),{...R,uploader:r.nickname,createdAt:$()}).catch(O=>console.error("DB ì €ìž¥ ì‹¤íŒ¨:",O))}catch(n){console.error(n),u(n.message)}finally{o(!1)}},f=async t=>{window.confirm("ì´ ë¶„ì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await M(D(S,"save_reports",t))};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",fontFamily:"monospace"},children:[e.jsxs("div",{className:"glass-panel",onDragOver:t=>t.preventDefault(),onDrop:b,style:{padding:"40px",textAlign:"center",border:"2px dashed rgba(255,255,255,0.2)",cursor:"pointer",marginBottom:"30px"},children:[e.jsx("input",{type:"file",id:"f",style:{display:"none"},onChange:b,accept:".lsv,.save"}),e.jsxs("label",{htmlFor:"f",style:{cursor:"pointer"},children:[e.jsx(pe,{size:48,style:{opacity:.5,marginBottom:"10px"}}),e.jsx("h2",{children:"DEEP SAVE SCANNER V.5"}),e.jsx("p",{style:{opacity:.6},children:"ë¶„ì„í•  .lsv íŒŒì¼ì„ ë“œëž˜ê·¸í•˜ì„¸ìš”"})]})]}),l&&e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx("div",{className:"spinner",style:{width:"50px",height:"50px",border:"5px solid #333",borderTop:"5px solid #4ade80",borderRadius:"50%",margin:"0 auto 20px"}}),e.jsx("h3",{children:"HEX DUMP ANALYSIS..."})]}),a&&e.jsxs("div",{style:{background:"rgba(239,68,68,0.2)",padding:"20px",borderRadius:"10px",color:"#fca5a5",marginBottom:"20px"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:0},children:[e.jsx(xe,{})," SCAN FAILED"]}),e.jsx("p",{children:a}),e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",padding:"10px",marginTop:"10px",fontSize:"0.8rem",maxHeight:"150px",overflowY:"auto"},children:s.map((t,n)=>e.jsx("div",{children:t},n))})]}),p&&e.jsxs("div",{className:"glass-panel",style:{padding:"30px",textAlign:"left",marginBottom:"30px"},children:[e.jsxs("div",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"20px",marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,color:"#4ade80"},children:p.filename}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.7},children:["SIZE: ",p.meta.size," | MODE: ",p.meta.mode]})]}),e.jsx(ge,{size:24,color:"#4ade80"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"20px",borderRadius:"10px"},children:[e.jsxs("h3",{style:{marginTop:0,borderBottom:"1px solid #4ade80",paddingBottom:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(H,{size:18})," DETECTED ENTITIES"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"15px"},children:p.companions.length>0?p.companions.map((t,n)=>e.jsxs("div",{style:{background:"rgba(255,255,255,0.1)",padding:"5px 10px",borderRadius:"5px"},children:[t.img," ",t.name]},n)):e.jsx("span",{style:{opacity:.5},children:"No companion signatures found."})})]}),e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"20px",borderRadius:"10px"},children:[e.jsxs("h3",{style:{marginTop:0,borderBottom:"1px solid #f87171",paddingBottom:"5px",display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[e.jsx(ue,{size:18})," ECONOMY DATA (ENCRYPTED)"]}),e.jsxs("div",{style:{marginTop:"15px",fontSize:"0.85rem",color:"rgba(255,255,255,0.7)"},children:[e.jsx(he,{size:16,style:{float:"left",marginRight:"10px"}}),"Secure Binary Blob Detected. ",e.jsx("br",{}),"Gold/XP values are encrypted."]})]})]}),e.jsxs("div",{style:{marginTop:"20px",borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"10px"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",opacity:.7},children:"DEBUG LOG"}),e.jsx("div",{style:{background:"black",padding:"10px",fontFamily:"monospace",fontSize:"0.7rem",color:"#4ade80",maxHeight:"100px",overflowY:"auto"},children:s.map((t,n)=>e.jsx("div",{children:t},n))})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"30px"},children:[e.jsx("h3",{style:{marginTop:0,borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"15px"},children:"ðŸ—„ï¸ ANALYSIS HISTORY (DB)"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[d.map(t=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"8px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:t.filename}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:[t.meta.mode," / ",t.meta.size," / by ",t.uploader]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:t.createdAt?.toDate().toLocaleString()}),e.jsx("button",{onClick:()=>f(t.id),style:{background:"rgba(239,68,68,0.2)",border:"none",color:"#fca5a5",padding:"8px",borderRadius:"6px",cursor:"pointer"},children:e.jsx(me,{size:16})})]})]},t.id)),d.length===0&&e.jsx("div",{style:{opacity:.5,textAlign:"center"},children:"ê¸°ë¡ëœ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."})]})]})]})},$e=({user:r})=>{const[p,i]=g.useState(0),[l,o]=g.useState(!1),a=()=>{confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ê¸°ì˜ í”„ë¡œí•„ ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤.")&&(localStorage.removeItem("bg3_user_profile"),window.location.reload())},u=async()=>{o(!0);try{const s=je(S);(await B(k(S,"chats_v2"))).forEach(c=>{s.delete(c.ref)}),(await B(k(S,"schedules_v2"))).forEach(c=>{s.delete(c.ref)}),await s.commit(),i(2)}catch(s){console.error(s),alert("ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: "+s.message),i(0)}finally{o(!1)}};return e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[e.jsx("h1",{style:{marginBottom:"30px"},children:"âš™ï¸ í™˜ê²½ ì„¤ì •"}),e.jsxs("div",{className:"glass-panel",style:{padding:"30px",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"1.2rem",margin:"0 0 20px 0"},children:"ë‚´ ëª¨í—˜ê°€ ì¹´ë“œ"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem"},children:"ðŸ‘¤"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:r.nickname}),e.jsxs("div",{style:{opacity:.7},children:["Level 1 â€¢ ",r.className]}),r.isAdmin&&e.jsx("div",{style:{color:"#fbbf24",fontSize:"0.9rem",marginTop:"5px"},children:"ðŸ‘‘ Party Leader (Admin)"})]})]})]}),r.isAdmin&&e.jsxs("div",{className:"glass-panel",style:{padding:"30px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:"0 0 20px 0",color:"#f87171",borderBottom:"1px solid rgba(239, 68, 68, 0.2)",paddingBottom:"10px"},children:[e.jsx(fe,{size:20,style:{verticalAlign:"middle",marginRight:"8px"}}),"ì„œë²„ ë°ì´í„° ê´€ë¦¬ (ìœ„í—˜)"]}),e.jsxs("p",{style:{opacity:.8,marginBottom:"20px"},children:["ì„œë²„ì— ì €ìž¥ëœ ",e.jsx("strong",{children:"ëª¨ë“  ì±„íŒ… ë‚´ì—­ê³¼ ë ˆì´ë“œ ì¼ì •"}),"ì„ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.",e.jsx("br",{}),"ì´ ìž‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë‹ˆ íŒŒí‹°ì›ë“¤ê³¼ ìƒì˜ í›„ ì§„í–‰í•˜ì„¸ìš”."]}),p===0&&e.jsxs("button",{onClick:()=>i(1),style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",border:"1px solid rgba(239, 68, 68, 0.4)",padding:"12px 20px",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(ye,{size:18})," ì›”ë“œ ë°ì´í„° ì´ˆê¸°í™”"]}),p===1&&e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"20px",borderRadius:"8px",border:"1px solid #f87171"},children:[e.jsx("div",{style:{color:"#fca5a5",fontWeight:"bold",marginBottom:"15px"},children:"ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>i(0),disabled:l,style:{flex:1,padding:"10px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",borderRadius:"6px",cursor:"pointer"},children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:u,disabled:l,style:{flex:1,padding:"10px",background:"#ef4444",border:"none",color:"white",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:l?"ì‚­ì œ ì¤‘...":"ë„¤, ì‚­ì œí•©ë‹ˆë‹¤"})]})]}),p===2&&e.jsxs("div",{style:{textAlign:"center",padding:"20px",color:"#4ade80"},children:[e.jsx(be,{size:40,style:{marginBottom:"10px"}}),e.jsx("div",{children:"ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."}),e.jsx("button",{onClick:()=>i(0),style:{marginTop:"15px",padding:"8px 16px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:"ëŒì•„ê°€ê¸°"})]})]}),e.jsxs("button",{onClick:a,style:{width:"100%",padding:"20px",borderRadius:"12px",marginTop:"20px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer"},children:[e.jsx(J,{size:20})," ë¡œê·¸ì•„ì›ƒ (í”„ë¡œí•„ ìž¬ì„¤ì •)"]})]})},He=({user:r})=>{const[p,i]=g.useState([]),[l,o]=g.useState(!0);if(!r.isAdmin)return e.jsx("div",{style:{padding:"50px",textAlign:"center"},children:"ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."});const a=async()=>{o(!0);try{const s=await B(k(S,"users"));i(s.docs.map(m=>m.data()))}catch(s){console.error(s)}finally{o(!1)}};g.useEffect(()=>{a()},[]);const u=async s=>{if(s.nickname==="ì¤€í˜"){alert("ê´€ë¦¬ìž ìžì‹ ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(confirm(`ì •ë§ë¡œ '${s.nickname}'ë‹˜ì„ íŒŒí‹°ì—ì„œ ì¶”ë°©í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.`))try{await M(D(S,"users",s.nickname)),alert("ì¶”ë°©ë˜ì—ˆìŠµë‹ˆë‹¤."),a()}catch(m){alert("ì˜¤ë¥˜ ë°œìƒ: "+m.message)}};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"20px",marginBottom:"20px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(L,{size:24,color:"#fca5a5"}),e.jsx("h2",{style:{margin:0},children:"ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ"})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"30px"},children:[e.jsxs("h3",{style:{margin:"0 0 20px 0"},children:["ë“±ë¡ëœ íŒŒí‹°ì› ê´€ë¦¬ (",p.length,"/4)"]}),l?e.jsx("div",{children:"ë¡œë”© ì¤‘..."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:p.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem"},children:s.isAdmin?"ðŸ‘‘":"ðŸ‘¤"}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[s.nickname," ",s.isAdmin&&e.jsx("span",{style:{color:"#fbbf24",fontSize:"0.8rem"},children:"(Admin)"})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:["Class: ",s.className]})]})]}),!s.isAdmin&&e.jsxs("button",{onClick:()=>u(s),style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",border:"1px solid rgba(239, 68, 68, 0.4)",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(ve,{size:16})," ì¶”ë°©"]})]},s.id))})]})]})},Me=[{id:"barbarian",name:"ë°”ë°”ë¦¬ì•ˆ",icon:we,color:"#fca5a5"},{id:"bard",name:"ë°”ë“œ",icon:ke,color:"#f9a8d4"},{id:"cleric",name:"í´ë ˆë¦­",icon:Ce,color:"#d1d5db"},{id:"druid",name:"ë“œë£¨ì´ë“œ",icon:De,color:"#bef264"},{id:"fighter",name:"íŒŒì´í„°",icon:L,color:"#93c5fd"},{id:"monk",name:"ëª½í¬",icon:Ie,color:"#7dd3fc"},{id:"paladin",name:"íŒ”ë¼ë”˜",icon:L,color:"#fbbf24"},{id:"ranger",name:"ë ˆì¸ì €",icon:ze,color:"#86efac"},{id:"rogue",name:"ë¡œê·¸",icon:Te,color:"#cbd5e1"},{id:"sorcerer",name:"ì†Œì„œëŸ¬",icon:Ae,color:"#c084fc"},{id:"warlock",name:"ì›Œë½",icon:Re,color:"#e879f9"},{id:"wizard",name:"ìœ„ìžë“œ",icon:Be,color:"#818cf8"}],Ye=({onComplete:r})=>{const[p,i]=g.useState("landing"),[l,o]=g.useState(""),[a,u]=g.useState(""),[s,m]=g.useState(null),[d,c]=g.useState(""),[b,j]=g.useState(""),[f,t]=g.useState(""),[n,x]=g.useState(!1),[y,v]=g.useState(""),w=()=>{o(""),u(""),m(null),c(""),j(""),t(""),v("")},Y=async h=>{h.preventDefault(),x(!0),v("");try{const C=await _(D(S,"users_v2",l));if(!C.exists())v("ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ë‹‰ë„¤ìž„ìž…ë‹ˆë‹¤.");else{const N=C.data();N.password===a?(sessionStorage.setItem("bg3_user_profile",JSON.stringify(N)),r(N)):v("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜.")}}catch(C){v(C.message)}finally{x(!1)}},R=async()=>{if(!l||!a||!s||!d||!f){v("ëª¨ë“  ì •ë³´ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}if(d!=="bg3admin"){v("ê´€ë¦¬ìž í‚¤ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");return}x(!0);try{if((await _(D(S,"users_v2",l))).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ë‹‰ë„¤ìž„ìž…ë‹ˆë‹¤.");const C={id:l,nickname:l,password:a,partyPassword:f,className:s.name,classId:s.id,isAdmin:!0,createdAt:new Date().toISOString()};await W(D(S,"users_v2",l),C),sessionStorage.setItem("bg3_user_profile",JSON.stringify(C)),r(C)}catch(h){v(h.message)}finally{x(!1)}},O=async()=>{if(!l||!a||!s||!b||!f){v("ëª¨ë“  ì •ë³´ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}x(!0);try{if((await _(D(S,"users_v2",l))).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ë‹‰ë„¤ìž„ìž…ë‹ˆë‹¤. (ë¡œê·¸ì¸ í•˜ì„¸ìš”)");const C=await _(D(S,"users_v2",b));if(!C.exists())throw new Error("ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ì˜ì£¼ìž…ë‹ˆë‹¤.");if(!C.data().isAdmin)throw new Error("í•´ë‹¹ ìœ ì €ëŠ” ì˜ì£¼ê°€ ì•„ë‹™ë‹ˆë‹¤.");if(C.data().partyPassword!==f)throw new Error("ì˜ì§€ ìž…ìž¥ ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");if((await B(k(S,"users_v2"))).size>=4)throw new Error("ì •ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.");const P={id:l,nickname:l,password:a,className:s.name,classId:s.id,isAdmin:!1,leader:b,createdAt:new Date().toISOString()};await W(D(S,"users_v2",l),P),sessionStorage.setItem("bg3_user_profile",JSON.stringify(P)),r(P)}catch(h){v(h.message)}finally{x(!1)}},G=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px",maxHeight:"200px",overflowY:"auto",margin:"10px 0"},children:Me.map(h=>e.jsxs("button",{onClick:()=>m(h),style:{padding:"8px",borderRadius:"8px",border:s?.id===h.id?`2px solid ${h.color}`:"1px solid rgba(255,255,255,0.1)",background:s?.id===h.id?"rgba(255,255,255,0.1)":"transparent",color:"white",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px"},children:[e.jsx(h.icon,{size:18,color:h.color}),e.jsx("span",{style:{fontSize:"0.6rem"},children:h.name})]},h.id))}),E={maxWidth:"400px",margin:"40px auto",padding:"30px",textAlign:"center"},I={width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.2)",color:"white",marginBottom:"10px"},z={width:"100%",padding:"12px",background:"var(--accent-color)",color:"white",borderRadius:"8px",fontWeight:"bold",marginTop:"10px"};return p==="landing"?e.jsxs("div",{className:"glass-panel",style:E,children:[e.jsxs("h1",{style:{marginBottom:"30px"},children:["Baldur's Gate 3",e.jsx("br",{}),"Party Manager"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsx("button",{onClick:()=>{w(),i("login")},style:{...z,background:"rgba(255,255,255,0.1)"},children:"ê¸°ì¡´ ëª¨í—˜ê°€ ë¡œê·¸ì¸"}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),e.jsxs("button",{onClick:()=>{w(),i("join_party")},style:z,children:[e.jsx(H,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),"ì˜ì§€ ê°€ìž…í•˜ê¸° (ì¼ë°˜)"]}),e.jsxs("button",{onClick:()=>{w(),i("create_admin")},style:{...z,background:"#f87171"},children:[e.jsx(Se,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),"ìƒˆ ì˜ì§€ ê±´ì„¤ (ê´€ë¦¬ìž)"]})]})]}):p==="login"?e.jsxs("div",{className:"glass-panel",style:E,children:[e.jsx("h2",{children:"ë¡œê·¸ì¸"}),e.jsxs("form",{onSubmit:Y,children:[e.jsx("input",{type:"text",placeholder:"ë‹‰ë„¤ìž„",style:I,value:l,onChange:h=>o(h.target.value)}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",style:I,value:a,onChange:h=>u(h.target.value)}),e.jsx("button",{type:"submit",style:z,children:n?"...":"ìž…ìž¥"}),y&&e.jsx("p",{style:{color:"#f87171",marginTop:"10px"},children:y}),e.jsx("button",{type:"button",onClick:()=>i("landing"),style:{marginTop:"10px",background:"none",color:"rgba(255,255,255,0.5)"},children:"ì·¨ì†Œ"})]})]}):p==="create_admin"?e.jsxs("div",{className:"glass-panel",style:E,children:[e.jsx("h2",{style:{color:"#fca5a5"},children:"ìƒˆ ì˜ì§€ ê±´ì„¤"}),e.jsx("p",{style:{fontSize:"0.8rem",opacity:.7,marginBottom:"20px"},children:"ê´€ë¦¬ìž(ì˜ì£¼) ì„¤ì •"}),e.jsx("input",{type:"text",placeholder:"ì˜ì£¼ ë‹‰ë„¤ìž„",style:I,value:l,onChange:h=>o(h.target.value)}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",style:I,value:a,onChange:h=>u(h.target.value)}),e.jsx("input",{type:"password",placeholder:"ê´€ë¦¬ìž í‚¤ (Admin Key)",style:{...I,borderColor:"#f87171"},value:d,onChange:h=>c(h.target.value)}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ìž…ìž¥ ì½”ë“œ ì„¤ì • (íŒ€ì› ê³µìœ ìš©)",style:{...I,borderColor:"#818cf8"},value:f,onChange:h=>t(h.target.value)}),e.jsx("p",{style:{textAlign:"left",opacity:.7,margin:"10px 0 5px"},children:"ì§ì—… ì„ íƒ:"}),e.jsx(G,{}),e.jsx("button",{onClick:R,style:z,children:n?"ê±´ì„¤ ì¤‘...":"ì˜ì§€ ìƒì„± ì™„ë£Œ"}),y&&e.jsx("p",{style:{color:"#f87171",marginTop:"10px"},children:y}),e.jsx("button",{onClick:()=>i("landing"),style:{marginTop:"10px",background:"none",color:"rgba(255,255,255,0.5)"},children:"ì·¨ì†Œ"})]}):p==="join_party"?e.jsxs("div",{className:"glass-panel",style:E,children:[e.jsx("h2",{children:"ì˜ì§€ ê°€ìž…"}),e.jsx("p",{style:{fontSize:"0.8rem",opacity:.7,marginBottom:"20px"},children:"ì˜ì£¼ ë‹‰ë„¤ìž„ê³¼ ì½”ë“œë¥¼ ìž…ë ¥í•˜ì„¸ìš”."}),e.jsx("input",{type:"text",placeholder:"ì˜ì£¼(ê´€ë¦¬ìž) ë‹‰ë„¤ìž„",style:{...I,borderColor:"var(--accent-color)"},value:b,onChange:h=>j(h.target.value)}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ìž…ìž¥ ì½”ë“œ (Password)",style:{...I,borderColor:"#818cf8"},value:f,onChange:h=>t(h.target.value)}),e.jsx("div",{style:{height:"10px"}}),e.jsx("input",{type:"text",placeholder:"ë‚´ ë‹‰ë„¤ìž„",style:I,value:l,onChange:h=>o(h.target.value)}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",style:I,value:a,onChange:h=>u(h.target.value)}),e.jsx("p",{style:{textAlign:"left",opacity:.7,margin:"10px 0 5px"},children:"ì§ì—… ì„ íƒ:"}),e.jsx(G,{}),e.jsx("button",{onClick:O,style:z,children:n?"ê°€ìž… ì¤‘...":"í•©ë¥˜í•˜ê¸°"}),y&&e.jsx("p",{style:{color:"#f87171",marginTop:"10px"},children:y}),e.jsx("button",{onClick:()=>i("landing"),style:{marginTop:"10px",background:"none",color:"rgba(255,255,255,0.5)"},children:"ì·¨ì†Œ"})]}):null},Ge=()=>{const[r,p]=g.useState(null),[i,l]=g.useState(1),[o,a]=g.useState(0);g.useEffect(()=>{try{const d=sessionStorage.getItem("bg3_user_profile");d&&p(JSON.parse(d))}catch(d){console.error("Profile parse failed:",d),sessionStorage.removeItem("bg3_user_profile")}getDocs(k(S,"users_v2")).then(d=>a(d.size)).catch(d=>console.error("User count fail:",d));const m=()=>setIsMobile(window.innerWidth<768);return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]),g.useEffect(()=>{if(!r)return;const m=async()=>{try{await W(D(S,"online_users",r.id),{nickname:r.nickname,classId:r.classId||"unknown",lastSeen:$()},{merge:!0})}catch(j){console.error("Heartbeat fail:",j)}};m();const d=setInterval(m,1e4),c=T(k(S,"online_users")),b=A(c,j=>{const f=Date.now(),t=j.docs.filter(n=>{const x=n.data();if(!x.lastSeen)return!1;const y=x.lastSeen.toDate?x.lastSeen.toDate().getTime():0;return f-y<3e4});l(t.length)});return()=>{clearInterval(d),b()}},[r]);const u=m=>{p(m),sessionStorage.setItem("bg3_user_profile",JSON.stringify(m))},s=()=>{switch(activeTab){case"home":return e.jsx(F,{user:r,setActiveTab});case"chat":return e.jsx(We,{user:r});case"calendar":return e.jsx(Oe,{user:r});case"save":return e.jsx(Ue,{user:r});case"settings":return e.jsx($e,{user:r});case"admin":return r.isAdmin?e.jsx(He,{user:r}):e.jsx(F,{user:r,setActiveTab});default:return e.jsx(F,{user:r,setActiveTab})}};return r?e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:"var(--bg-color)"},children:[e.jsx(Ne,{activeTab,setActiveTab,isMobile,onlineCount:`${i}/${o}`,user:r}),e.jsx("main",{style:{flex:1,padding:isMobile?"80px 20px 20px":"20px",overflowY:"auto",position:"relative"},children:s()})]}):e.jsx(Ye,{onComplete:u})};function Ke(){return e.jsx(Ge,{})}Ee.createRoot(document.getElementById("root")).render(e.jsx(g.StrictMode,{children:e.jsx(Ke,{})}));
