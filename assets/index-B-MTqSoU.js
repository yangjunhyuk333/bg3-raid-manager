import{r as x,H as X,M,C as U,F as Q,S as Z,a as L,j as e,b as ae,X as ie,L as ee,i as oe,g as le,c as E,d as D,q as _,l as te,o as se,w as F,e as N,A as de,f as ce,B as pe,h as xe,k as ne,s as Y,m as ge,U as G,n as q,p as T,t as P,u as me,v as he,D as ue,x as ye,y as fe,T as be,z as je,E as ve,G as Se,I as we,J as ke,K,R as Ce,N as O,O as Ie,P as De,Q as ze,V as Ae,W as Te,Y as Re,Z as Be,_ as Ee,$ as _e,a0 as Ne,a1 as Le,a2 as We}from"./vendor-k6Dy1LZX.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();const re="/bg3-raid-manager/assets/logo-C374szML.png",Oe=({activeTab:t,setActiveTab:l,isMobile:r,onlineCount:c,user:a})=>{const[o,f]=x.useState(!1),s=[{id:"home",icon:X,label:"í™ˆ"},{id:"chat",icon:M,label:"íŒŒí‹° ì±„íŒ…"},{id:"calendar",icon:U,label:"ë ˆì´ë“œ ì¼ì •"},{id:"save",icon:Q,label:"ì„¸ì´ë¸Œ ë¶„ì„"},{id:"settings",icon:Z,label:"í™˜ê²½ ì„¤ì •"},...a?.isAdmin?[{id:"admin",icon:L,label:"ë‚˜ì˜ ì˜ì§€ (ê´€ë¦¬)"}]:[]],v=b=>{l(b),r&&f(!1)},p=()=>{confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í”„ë¡œí•„ ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤.")&&(sessionStorage.removeItem("bg3_user_profile"),window.location.reload())};return e.jsxs(e.Fragment,{children:[r&&!o&&e.jsx("button",{onClick:()=>f(!0),style:{position:"fixed",top:"20px",left:"20px",zIndex:100,background:"rgba(0,0,0,0.5)",border:"none",color:"white",padding:"10px",borderRadius:"8px",backdropFilter:"blur(5px)"},children:e.jsx(ae,{})}),e.jsxs("div",{className:`glass-panel sidebar ${r&&!o?"closed":""}`,style:{width:"260px",height:r?"100%":"calc(100vh - 40px)",position:r?"fixed":"sticky",top:r?"0":"20px",left:r?o?"0":"-100%":"20px",margin:r?"0":"20px 0 20px 20px",display:"flex",flexDirection:"column",transition:"all 0.3s ease",zIndex:90,background:r?"rgba(10, 10, 15, 0.95)":void 0,boxShadow:r?"5px 0 15px rgba(0,0,0,0.5)":void 0},children:[e.jsxs("div",{style:{padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.1)",position:"relative"},children:[r&&e.jsx("button",{onClick:()=>f(!1),style:{position:"absolute",top:"20px",right:"15px",background:"transparent",border:"none",color:"white"},children:e.jsx(ie,{})}),e.jsx("img",{src:re,alt:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ ì›ì •ëŒ€",style:{height:"50px",objectFit:"contain"}}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",marginTop:"10px",padding:"4px 10px",background:"rgba(16, 185, 129, 0.2)",borderRadius:"20px",border:"1px solid rgba(16, 185, 129, 0.4)",color:"#6ee7b7",fontSize:"0.8rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",background:"#34d399",borderRadius:"50%",boxShadow:"0 0 5px #34d399"}}),e.jsxs("span",{children:[c,"ëª… ì ‘ì† ì¤‘"]})]})]}),e.jsx("nav",{style:{flex:1,padding:"20px 10px"},children:s.map(b=>{const j=b.icon,y=t===b.id;return e.jsxs("button",{onClick:()=>v(b.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"15px",padding:"12px 15px",marginBottom:"8px",background:y?"var(--accent-color)":"transparent",border:"none",borderRadius:"12px",color:"white",fontSize:"1rem",cursor:"pointer",transition:"all 0.2s",textAlign:"left"},children:[e.jsx(j,{size:20,style:{opacity:y?1:.7}}),b.label]},b.id)})}),a&&e.jsxs("div",{style:{padding:"20px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"10px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"1.2rem"},children:"ğŸ§™â€â™‚ï¸"}),e.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:a.nickname}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.6},children:a.className})]})]}),e.jsxs("button",{onClick:p,style:{width:"100%",padding:"8px",background:"rgba(255,255,255,0.05)",border:"none",borderRadius:"6px",color:"rgba(255,255,255,0.6)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"0.8rem"},children:[e.jsx(ee,{size:14})," ë¡œê·¸ì•„ì›ƒ"]})]})]})]})},Fe=({activeTab:t,setActiveTab:l,user:r})=>{const c=[{id:"home",icon:X,label:"í™ˆ"},{id:"chat",icon:M,label:"ì±„íŒ…"},{id:"calendar",icon:U,label:"ì¼ì •"},{id:"save",icon:Q,label:"ì„¸ì´ë¸Œ"},{id:"settings",icon:Z,label:"ì„¤ì •"}];return r?.isAdmin&&c.push({id:"admin",icon:L,label:"ê´€ë¦¬"}),e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,height:"65px",background:"rgba(20, 20, 25, 0.95)",backdropFilter:"blur(10px)",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-around",alignItems:"center",zIndex:1e3,paddingBottom:"safe-area-inset-bottom"},children:c.map(a=>{const o=a.icon,f=t===a.id;return e.jsxs("button",{onClick:()=>l(a.id),style:{background:"transparent",border:"none",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",color:f?"var(--accent-color)":"rgba(255,255,255,0.5)",padding:"10px",width:"100%"},children:[e.jsx(o,{size:20}),e.jsx("span",{style:{fontSize:"0.7rem"},children:a.label})]},a.id)})})},Pe={apiKey:"AIzaSyAsbaWbo3DoSTrRFhkaf9XujWPpmeGSjAE",authDomain:"bg3-raid-manager.firebaseapp.com",projectId:"bg3-raid-manager",storageBucket:"bg3-raid-manager.firebasestorage.app",messagingSenderId:"773826713403",appId:"1:773826713403:web:c15fdfca708d47f4fcc91e"},Ue=oe(Pe),S=le(Ue);console.log("ğŸ”¥ Firebase Connected (Real DB Mode)");const H=({setActiveTab:t,user:l})=>{const[r,c]=x.useState({userCount:0,recentChats:[],upcomingRaid:null}),[a,o]=x.useState(!0);x.useEffect(()=>{if(!l)return;const s=l.isAdmin?l.nickname:l.leader;E(D(S,"users_v2")).then(y=>{const m=y.docs.filter(n=>{const h=n.data();return h.isAdmin&&h.nickname===s||h.leader===s});c(n=>({...n,userCount:m.length}))});const v=_(D(S,"chats_v2"),F("partyId","==",s),se("timestamp","desc"),te(3)),p=N(v,y=>{const m=y.docs.map(n=>n.data());c(n=>({...n,recentChats:m}))}),b=_(D(S,"schedules_v2"),F("partyId","==",s)),j=N(b,y=>{const m=y.docs.map(d=>d.data()),n=new Date().toISOString().split("T")[0],h=m.filter(d=>d.date>=n).sort((d,g)=>d.date.localeCompare(g.date));let i="ì˜ˆì •ëœ ì›ì •ì´ ì—†ìŠµë‹ˆë‹¤.";if(h.length>0){const d=h[0].date,g=new Set(h.filter(w=>w.date===d).map(w=>w.nickname)).size;i=`${d} (ì›ì •ëŒ€ì› ${g}ëª… ëŒ€ê¸° ì¤‘)`}c(d=>({...d,upcomingRaid:i}))});return o(!1),()=>{p(),j()}},[l]);const f=({title:s,icon:v,color:p,children:b,onClick:j})=>e.jsxs("div",{className:"glass-panel",onClick:j,style:{padding:"25px",display:"flex",flexDirection:"column",gap:"15px",cursor:j?"pointer":"default",transition:"transform 0.2s",minHeight:"180px",position:"relative",overflow:"hidden"},onMouseEnter:y=>j&&(y.currentTarget.style.transform="translateY(-5px)"),onMouseLeave:y=>j&&(y.currentTarget.style.transform="translateY(0)"),children:[e.jsx("div",{style:{position:"absolute",top:-10,right:-10,width:"80px",height:"80px",background:p,opacity:.1,borderRadius:"50%",filter:"blur(20px)"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"1.2rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(v,{color:p,size:24})," ",s]}),j&&e.jsx(ce,{size:20,style:{opacity:.5}})]}),e.jsx("div",{style:{flex:1},children:b})]});return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"30px",textAlign:"center"},children:[e.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"10px",background:"linear-gradient(to right, #4ade80, #3b82f6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Baldur's Gate 3 Raid Manager"}),e.jsx("p",{style:{opacity:.7},children:"í™˜ì˜í•©ë‹ˆë‹¤, ëª¨í—˜ê°€ë‹˜. ì˜¤ëŠ˜ì˜ ì˜ì§€ í˜„í™© ë³´ê³ ì„œì…ë‹ˆë‹¤."})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px"},children:[e.jsx(f,{title:"ì˜ì§€ í˜„í™©",icon:de,color:"#f472b6",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",height:"100%",justifyContent:"center"},children:[e.jsxs("div",{style:{fontSize:"3rem",fontWeight:"bold"},children:[r.userCount,e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"normal",opacity:.6},children:"/4 ëª…"})]}),e.jsx("div",{style:{fontSize:"0.9rem",opacity:.7},children:"í˜„ì¬ ì •ì˜ˆ ë©¤ë²„ê°€ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤."})]})}),e.jsx(f,{title:"ë‹¤ìŒ ì›ì •",icon:U,color:"#facc15",onClick:()=>t("calendar"),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",height:"100%",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#facc15"},children:r.upcomingRaid||"ì¼ì • ë¡œë”© ì¤‘..."}),e.jsx("div",{style:{fontSize:"0.9rem",opacity:.7},children:"ì¼ì •ì„ ì¡°ìœ¨í•˜ë ¤ë©´ í´ë¦­í•˜ì„¸ìš”."})]})}),e.jsx(f,{title:"ìµœê·¼ ì†Œì‹",icon:M,color:"#60a5fa",onClick:()=>t("chat"),children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:r.recentChats.length>0?r.recentChats.map((s,v)=>e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"8px",fontSize:"0.9rem",borderLeft:"3px solid #60a5fa"},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:"6px"},children:[s.sender,":"]}),e.jsxs("span",{style:{opacity:.8},children:[s.text.substring(0,20),s.text.length>20&&"..."]})]},v)):e.jsx("div",{style:{opacity:.5},children:"ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤."})})})]}),e.jsxs("div",{onClick:()=>t("save"),className:"glass-panel",style:{marginTop:"30px",padding:"30px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(0,0,0,0) 100%)",cursor:"pointer"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 5px 0",color:"#4ade80"},children:"ì„¸ì´ë¸Œ íŒŒì¼ ì •ë°€ ë¶„ì„"}),e.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.9rem"},children:"ë‚´ ì„¸ì´ë¸Œ íŒŒì¼ì˜ ì§„ì§œ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. (HEX Dump / Hidden Stats)"})]}),e.jsx("div",{style:{padding:"10px 20px",borderRadius:"20px",background:"rgba(74, 222, 128, 0.2)",color:"#4ade80",fontWeight:"bold"},children:"ë¶„ì„ì‹¤ ì´ë™ â†’"})]})]})},$e=({user:t})=>{const[l,r]=x.useState([]),[c,a]=x.useState(""),[o,f]=x.useState(!0),s=x.useRef(null);x.useEffect(()=>{if(!t)return;const p=t.isAdmin?t.nickname:t.leader,b=_(D(S,"chats_v2"),F("partyId","==",p),te(100)),j=N(b,y=>{const m=y.docs.map(n=>({id:n.id,...n.data(),timestamp:n.data().timestamp?.toDate().toISOString()||new Date().toISOString()}));m.sort((n,h)=>new Date(n.timestamp)-new Date(h.timestamp)),r(m),f(!1)});return()=>j()},[t]),x.useEffect(()=>{s.current?.scrollIntoView({behavior:"smooth"})},[l]);const v=async p=>{if(p.preventDefault(),!c.trim())return;const b=c;a("");const j=t.isAdmin?t.nickname:t.leader;try{await ne(D(S,"chats_v2"),{text:b,sender:t?.nickname||"Anonymous",userClass:t?.className||"Unknown",uid:t?.id||"guest",partyId:j,timestamp:Y()})}catch(y){console.error("Error sending message: ",y)}};return e.jsxs("div",{className:"glass-panel",style:{height:"calc(100dvh - 80px)",display:"flex",flexDirection:"column",padding:0},children:[e.jsxs("div",{style:{padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(pe,{color:"#4fd1c5"})," íŒŒí‹° ì‘ì „ íšŒì˜ì‹¤"]}),e.jsx("span",{style:{fontSize:"0.8rem",opacity:.7},children:"ë ˆì´ë“œ ì¼ì •ê³¼ ì „ëµì„ ë…¼ì˜í•˜ì„¸ìš”."})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"15px"},children:[o&&e.jsx("div",{style:{textAlign:"center",opacity:.5},children:"ë¡œë”© ì¤‘..."}),l.map(p=>{const b=p.uid===t?.id;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:b?"flex-end":"flex-start"},children:[e.jsx("div",{style:{fontSize:"0.8rem",marginBottom:"4px",opacity:.7,display:"flex",alignItems:"center",gap:"6px"},children:!b&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["[",p.userClass,"]"]}),p.sender]})}),e.jsx("div",{style:{background:b?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:b?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"75%",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.1)",wordBreak:"break-word"},children:p.text}),e.jsx("span",{style:{fontSize:"0.7rem",opacity:.4,marginTop:"4px"},children:new Date(p.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},p.id)}),e.jsx("div",{ref:s})]}),e.jsxs("form",{onSubmit:v,style:{padding:"20px",background:"rgba(0,0,0,0.2)",display:"flex",gap:"10px",borderRadius:"0 0 16px 16px"},children:[e.jsx("input",{type:"text",value:c,onChange:p=>a(p.target.value),placeholder:"ì‘ì „ì„ ì „ë‹¬í•˜ì„¸ìš”...",style:{flex:1,padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.05)",color:"white",outline:"none"}}),e.jsx("button",{type:"submit",style:{padding:"12px",borderRadius:"12px",background:"var(--accent-color)",color:"white",border:"none",cursor:"pointer",transition:"all 0.3s"},children:e.jsx(xe,{size:20})})]})]})},He=({user:t})=>{const l=()=>{const i=[];for(let d=0;d<7;d++){const g=new Date;g.setDate(g.getDate()+d),i.push(g.toISOString().split("T")[0])}return i},r=()=>[18,19,20,21,22,23,0,1,2],[c,a]=x.useState(new Date().toISOString().split("T")[0]),[o,f]=x.useState([]),[s,v]=x.useState([]),[p,b]=x.useState(l()),j=r(),[y,m]=x.useState(null);x.useEffect(()=>{if(!t)return;const i=t.isAdmin?t.nickname:t.leader,d=_(D(S,"schedules_v2"),F("partyId","==",i)),g=N(d,w=>{const k=w.docs.map(I=>({id:I.id,...I.data()}));v(k);const C=k.filter(I=>I.userId===t.id);f(C)});return()=>g()},[t]);const n=async(i,d)=>{const g=`${i}_${t.id}`,w=t.isAdmin?t.nickname:t.leader,k=o.find(I=>I.id===g);let C=k?k.times:[];C.includes(d)?C=C.filter(I=>I!==d):C=[...C,d],C.length===0?k&&await q(T(S,"schedules_v2",g)):await P(T(S,"schedules_v2",g),{userId:t.id,nickname:t.nickname,partyId:w,date:i,times:C,updatedAt:new Date().toISOString()})},h=(i,d)=>{const g=s.filter(w=>w.date===i&&w.times.includes(d)).map(w=>w.nickname);return{count:g.length,names:g}};return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx("div",{className:"glass-panel",style:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(U,{})," ë ˆì´ë“œ ì‹œê°„í‘œ ì¡°ì •"]}),e.jsx("p",{style:{margin:"5px 0 0 0",opacity:.7},children:"ê°€ëŠ¥í•œ ì‹œê°„ì„ ì²´í¬í•˜ë©´, ëª¨ë“  íŒŒí‹°ì›ì´ ê²¹ì¹˜ëŠ” 'Golden Time'ì„ ì°¾ì•„ì¤ë‹ˆë‹¤."})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"20px"},children:[e.jsx("h3",{style:{marginTop:0},children:"ğŸ“… ë‚ ì§œ ì„ íƒ"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"5px",marginBottom:"20px"},children:p.map(i=>e.jsxs("button",{onClick:()=>a(i),style:{padding:"12px",borderRadius:"8px",border:"none",background:c===i?"var(--accent-color)":"rgba(255,255,255,0.05)",color:"white",cursor:"pointer",textAlign:"left",fontWeight:c===i?"bold":"normal",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:i}),o.find(d=>d.date===i)&&e.jsx(ge,{size:16})]},i))}),e.jsxs("h3",{style:{marginTop:0},children:["â±ï¸ ",c," ê°€ëŠ¥ ì‹œê°„"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},children:j.map(i=>{const d=o.find(g=>g.date===c)?.times.includes(i);return e.jsx("button",{onClick:()=>n(c,i),style:{padding:"10px",borderRadius:"6px",border:"1px solid "+(d?"var(--accent-color)":"rgba(255,255,255,0.2)"),background:d?"rgba(99, 102, 241, 0.3)":"transparent",color:d?"white":"rgba(255,255,255,0.6)",cursor:"pointer"},children:i<10?`0${i}:00`:`${i}:00`},i)})})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"20px"},children:[e.jsxs("h3",{style:{marginTop:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(G,{})," íŒŒí‹° í•©ë¥˜ í˜„í™©",e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",opacity:.6},children:"(ì´ˆë¡ìƒ‰ì´ ë² ìŠ¤íŠ¸ íƒ€ì„!)"})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:"ì‹œê°„"}),p.map(i=>e.jsx("th",{style:{padding:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:i.slice(5)},i))]})}),e.jsx("tbody",{children:j.map(i=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid rgba(255,255,255,0.05)",fontWeight:"bold",color:"rgba(255,255,255,0.7)"},children:i<10?`0${i}:00`:`${i}:00`}),p.map(d=>{const{count:g,names:w}=h(d,i);let k="transparent";return g===4?k="rgba(74, 222, 128, 0.6)":g===3?k="rgba(251, 191, 36, 0.4)":g>0&&(k="rgba(239, 68, 68, 0.2)"),e.jsx("td",{onClick:()=>m({date:d,time:i,names:w}),style:{background:k,borderBottom:"1px solid rgba(255,255,255,0.05)",textAlign:"center",cursor:"pointer",border:y?.date===d&&y?.time===i?"2px solid white":"none"},title:`${w.join(", ")} ê°€ëŠ¥`,children:g>0&&g},d+i)})]},i))})]})}),e.jsx("div",{style:{marginTop:"20px",fontSize:"0.8rem",opacity:.6,textAlign:"center"},children:"* ì¹¸ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì°¸ì—¬ ì¸ì›ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}),y&&e.jsxs("div",{style:{marginTop:"20px",padding:"15px",borderRadius:"8px",background:"rgba(0,0,0,0.3)",border:"1px solid var(--accent-color)",animation:"fadeIn 0.3s"},children:[e.jsxs("h4",{style:{margin:"0 0 10px 0",color:"var(--accent-color)"},children:["ğŸ” ",y.date," ",y.time<10?`0${y.time}:00`:`${y.time}:00`," ì°¸ì—¬ ê°€ëŠ¥ ë©¤ë²„"]}),y.names.length>0?e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:y.names.map((i,d)=>e.jsxs("span",{style:{padding:"6px 12px",background:"rgba(255,255,255,0.1)",borderRadius:"20px",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"5px"},children:["ğŸ‘¤ ",i]},d))}):e.jsx("p",{style:{opacity:.5,margin:0},children:"ì°¸ì—¬ ê°€ëŠ¥í•œ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤."})]})]})]})]})},V=new TextDecoder("utf-8"),Me=async t=>new Promise(l=>{const r=new FileReader;r.onload=async c=>{const a=c.target.result,o=new DataView(a),f=a.byteLength,s=[];try{let v="";for(let m=0;m<Math.min(32,f);m++)v+=o.getUint8(m).toString(16).padStart(2,"0").toUpperCase()+" ";s.push(`Header Hex: ${v}`);const p=String.fromCharCode(o.getUint8(0),o.getUint8(1),o.getUint8(2),o.getUint8(3));if(s.push(`Magic String: "${p}"`),p!=="LSPK")s.push("WARNING: Magic mismatch. Proceeding with Raw Scan (Legacy/Console Save?).");else{const m=o.getUint32(4,!0);s.push(`LSPK Version: ${m}`)}const b=Math.min(f,20*1024*1024),j=new Uint8Array(a,0,b);let y="";try{y=V.decode(j)}catch{s.push("UTF-8 Decode Failed, using ASCII fallback."),y=Array.from(j).map(n=>String.fromCharCode(n)).join("")}if(f>b){const m=Math.min(1048576,f-b),n=new Uint8Array(a,f-m,m);let h="";try{h=V.decode(n)}catch{h=Array.from(n).map(d=>String.fromCharCode(d)).join("")}y+=h,s.push(`Scanned Footer (${m} bytes).`)}s.push(`Total Scanned Text Length: ${y.length}`),l({success:!0,rawText:y,fileSize:f,debugInfo:s})}catch(v){l({success:!1,error:v.message,debugInfo:s})}},r.onerror=()=>l({success:!1,error:"Read Error",debugInfo:[]}),r.readAsArrayBuffer(t)}),Ye=(t,l)=>{let r="Unknown";t.includes("Honour")?r="Honour (ëª…ì˜ˆ)":t.includes("Tactician")?r="Tactician (ì „ìˆ ê°€)":t.includes("Story")?r="Explorer (íƒí—˜ê°€)":(t.includes("Balanced")||t.includes("Balancer"))&&(r="Balanced (ê· í˜•)");const c=[];return[{key:"Shadowheart",name:"ì„€ë„í•˜íŠ¸",img:"ğŸ–¤"},{key:"Astarion",name:"ì•„ìŠ¤íƒ€ë¦¬ì˜¨",img:"ğŸ§›"},{key:"Gale",name:"ê²Œì¼",img:"ğŸ§™â€â™‚ï¸"},{key:"Lae'zel",name:"ë ˆì´ì ¤",img:"ğŸ‘½"},{key:"Wyll",name:"ìœŒ",img:"ğŸ˜ˆ"},{key:"Karlach",name:"ì¹´ë¥¼ë¼í¬",img:"â¤ï¸â€ğŸ”¥"},{key:"Halsin",name:"í• ì‹ ",img:"ğŸ»"},{key:"Minthara",name:"ë¯¼íƒ€ë¼",img:"ğŸ§â€â™€ï¸"},{key:"Jaheira",name:"ìí—¤ì´ë¼",img:"ğŸŒ¿"},{key:"Minsc",name:"ë¯¼ìŠ¤í¬",img:"ğŸ¹"}].forEach(o=>{t.includes(o.key)&&c.push({...o,status:"Detected"})}),{meta:{mode:r,size:l.toFixed(2)+" MB"},companions:c,economy:{gold:"Encrypted (LSF)",supplies:"Encrypted (LSF)"}}},Ge=({user:t})=>{const[l,r]=x.useState(null),[c,a]=x.useState(!1),[o,f]=x.useState(null),[s,v]=x.useState([]),[p,b]=x.useState([]);x.useEffect(()=>{const n=_(D(S,"save_reports_v2"),se("createdAt","desc")),h=N(n,i=>{b(i.docs.map(d=>({id:d.id,...d.data()})))});return()=>h()},[]);const j=n=>{n.preventDefault();const h=n.dataTransfer?n.dataTransfer.files:n.target.files;h&&h.length>0&&y(h[0])},y=async n=>{if(!n.name.endsWith(".lsv")&&!n.name.endsWith(".save")){alert("í™•ì¥ìê°€ .lsv ë˜ëŠ” .saveì¸ íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.");return}a(!0),f(null),r(null),v([]);try{const{success:h,rawText:i,fileSize:d,error:g,debugInfo:w}=await Me(n);if(v(w||[]),!h)throw new Error(g||"íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");const C={...Ye(i,d/(1024*1024)),filename:n.name};r(C),t&&C&&ne(D(S,"save_reports_v2"),{...C,uploader:t.nickname,createdAt:Y()}).catch(I=>console.error("DB ì €ì¥ ì‹¤íŒ¨:",I))}catch(h){console.error(h),f(h.message)}finally{a(!1)}},m=async n=>{window.confirm("ì´ ë¶„ì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await q(T(S,"save_reports_v2",n))};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",fontFamily:"monospace"},children:[e.jsxs("div",{className:"glass-panel",onDragOver:n=>n.preventDefault(),onDrop:j,style:{padding:"40px",textAlign:"center",border:"2px dashed rgba(255,255,255,0.2)",cursor:"pointer",marginBottom:"30px"},children:[e.jsx("input",{type:"file",id:"f",style:{display:"none"},onChange:j,accept:".lsv,.save"}),e.jsxs("label",{htmlFor:"f",style:{cursor:"pointer"},children:[e.jsx(me,{size:48,style:{opacity:.5,marginBottom:"10px"}}),e.jsx("h2",{children:"DEEP SAVE SCANNER V.5"}),e.jsx("p",{style:{opacity:.6},children:"ë¶„ì„í•  .lsv íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”"})]})]}),c&&e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx("div",{className:"spinner",style:{width:"50px",height:"50px",border:"5px solid #333",borderTop:"5px solid #4ade80",borderRadius:"50%",margin:"0 auto 20px"}}),e.jsx("h3",{style:{animation:"pulse 1s infinite"},children:"MAPPING ENTITY IDs..."}),e.jsxs("p",{style:{fontSize:"0.8rem",opacity:.6,fontFamily:"monospace"},children:["> Decrypting headers...",e.jsx("br",{}),"> Parsing binary tree...",e.jsx("br",{}),"> Linking game objects..."]})]}),o&&e.jsxs("div",{style:{background:"rgba(239,68,68,0.2)",padding:"20px",borderRadius:"10px",color:"#fca5a5",marginBottom:"20px"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:0},children:[e.jsx(he,{})," SCAN FAILED"]}),e.jsx("p",{children:o}),e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",padding:"10px",marginTop:"10px",fontSize:"0.8rem",maxHeight:"150px",overflowY:"auto"},children:s.map((n,h)=>e.jsx("div",{children:n},h))})]}),l&&e.jsxs("div",{className:"glass-panel",style:{padding:"30px",textAlign:"left",marginBottom:"30px"},children:[e.jsxs("div",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"20px",marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,color:"#4ade80"},children:l.filename}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.7},children:["SIZE: ",l.meta.size," | MODE: ",l.meta.mode]})]}),e.jsx(ue,{size:24,color:"#4ade80"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"20px",borderRadius:"10px"},children:[e.jsxs("h3",{style:{marginTop:0,borderBottom:"1px solid #4ade80",paddingBottom:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(G,{size:18})," DETECTED ENTITIES"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"15px"},children:l.companions.length>0?l.companions.map((n,h)=>e.jsxs("div",{style:{background:"rgba(255,255,255,0.1)",padding:"5px 10px",borderRadius:"5px"},children:[n.img," ",n.name]},h)):e.jsx("span",{style:{opacity:.5},children:"No companion signatures found."})})]}),e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"20px",borderRadius:"10px"},children:[e.jsxs("h3",{style:{marginTop:0,borderBottom:"1px solid #f87171",paddingBottom:"5px",display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[e.jsx(ye,{size:18})," ECONOMY DATA (ENCRYPTED)"]}),e.jsxs("div",{style:{marginTop:"15px",fontSize:"0.85rem",color:"rgba(255,255,255,0.7)"},children:[e.jsx(fe,{size:16,style:{float:"left",marginRight:"10px"}}),"Secure Binary Blob Detected. ",e.jsx("br",{}),"Gold/XP values are encrypted."]})]})]}),e.jsxs("div",{style:{marginTop:"20px",borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"10px"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",opacity:.7},children:"DEBUG LOG"}),e.jsx("div",{style:{background:"black",padding:"10px",fontFamily:"monospace",fontSize:"0.7rem",color:"#4ade80",maxHeight:"100px",overflowY:"auto"},children:s.map((n,h)=>e.jsx("div",{children:n},h))})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"30px"},children:[e.jsx("h3",{style:{marginTop:0,borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"15px"},children:"ğŸ—„ï¸ ANALYSIS HISTORY (DB)"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[p.map(n=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"8px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:n.filename}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:[n.meta.mode," / ",n.meta.size," / by ",n.uploader]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:n.createdAt?.toDate().toLocaleString()}),e.jsx("button",{onClick:()=>m(n.id),style:{background:"rgba(239,68,68,0.2)",border:"none",color:"#fca5a5",padding:"8px",borderRadius:"6px",cursor:"pointer"},children:e.jsx(be,{size:16})})]})]},n.id)),p.length===0&&e.jsx("div",{style:{opacity:.5,textAlign:"center"},children:"ê¸°ë¡ëœ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."})]})]})]})},qe=({user:t})=>{const[l,r]=x.useState(0),[c,a]=x.useState(!1),o=()=>{confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ê¸°ì˜ í”„ë¡œí•„ ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤.")&&(sessionStorage.removeItem("bg3_user_profile"),window.location.reload())},f=async()=>{a(!0);try{const s=we(S);(await E(D(S,"chats_v2"))).forEach(b=>{s.delete(b.ref)}),(await E(D(S,"schedules_v2"))).forEach(b=>{s.delete(b.ref)}),await s.commit(),r(2)}catch(s){console.error(s),alert("ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: "+s.message),r(0)}finally{a(!1)}};return e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[e.jsx("h1",{style:{marginBottom:"30px"},children:"âš™ï¸ í™˜ê²½ ì„¤ì •"}),e.jsxs("div",{className:"glass-panel",style:{padding:"30px",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"1.2rem",margin:"0 0 20px 0"},children:"ë‚´ ëª¨í—˜ê°€ ì¹´ë“œ"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem"},children:"ğŸ‘¤"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:t.nickname}),e.jsxs("div",{style:{opacity:.7},children:["Level 1 â€¢ ",t.className]}),t.isAdmin&&e.jsx("div",{style:{color:"#fbbf24",fontSize:"0.9rem",marginTop:"5px"},children:"ğŸ‘‘ Party Leader (Admin)"})]})]})]}),t.isAdmin&&e.jsxs("div",{className:"glass-panel",style:{padding:"30px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:"0 0 20px 0",color:"#f87171",borderBottom:"1px solid rgba(239, 68, 68, 0.2)",paddingBottom:"10px"},children:[e.jsx(je,{size:20,style:{verticalAlign:"middle",marginRight:"8px"}}),"ì„œë²„ ë°ì´í„° ê´€ë¦¬ (ìœ„í—˜)"]}),e.jsxs("p",{style:{opacity:.8,marginBottom:"20px"},children:["ì„œë²„ì— ì €ì¥ëœ ",e.jsx("strong",{children:"ëª¨ë“  ì±„íŒ… ë‚´ì—­ê³¼ ë ˆì´ë“œ ì¼ì •"}),"ì„ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.",e.jsx("br",{}),"ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë‹ˆ íŒŒí‹°ì›ë“¤ê³¼ ìƒì˜ í›„ ì§„í–‰í•˜ì„¸ìš”."]}),l===0&&e.jsxs("button",{onClick:()=>r(1),style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",border:"1px solid rgba(239, 68, 68, 0.4)",padding:"12px 20px",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(ve,{size:18})," ì›”ë“œ ë°ì´í„° ì´ˆê¸°í™”"]}),l===1&&e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"20px",borderRadius:"8px",border:"1px solid #f87171"},children:[e.jsx("div",{style:{color:"#fca5a5",fontWeight:"bold",marginBottom:"15px"},children:"ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>r(0),disabled:c,style:{flex:1,padding:"10px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",borderRadius:"6px",cursor:"pointer"},children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:f,disabled:c,style:{flex:1,padding:"10px",background:"#ef4444",border:"none",color:"white",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:c?"ì‚­ì œ ì¤‘...":"ë„¤, ì‚­ì œí•©ë‹ˆë‹¤"})]})]}),l===2&&e.jsxs("div",{style:{textAlign:"center",padding:"20px",color:"#4ade80"},children:[e.jsx(Se,{size:40,style:{marginBottom:"10px"}}),e.jsx("div",{children:"ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."}),e.jsx("button",{onClick:()=>r(0),style:{marginTop:"15px",padding:"8px 16px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:"ëŒì•„ê°€ê¸°"})]})]}),e.jsxs("button",{onClick:o,style:{width:"100%",padding:"20px",borderRadius:"12px",marginTop:"20px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer"},children:[e.jsx(ee,{size:20})," ë¡œê·¸ì•„ì›ƒ (í”„ë¡œí•„ ì¬ì„¤ì •)"]})]})},Je=({user:t})=>{const[l,r]=x.useState([]),[c,a]=x.useState(!0);if(!t.isAdmin)return e.jsx("div",{style:{padding:"50px",textAlign:"center"},children:"ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."});const o=async()=>{a(!0);try{const v=(await E(D(S,"users_v2"))).docs.map(p=>p.data()).filter(p=>p.nickname===t.nickname||p.leader===t.nickname);r(v)}catch(s){console.error(s)}finally{a(!1)}};x.useEffect(()=>{o()},[]);const f=async s=>{if(s.nickname===t.nickname){alert("ê´€ë¦¬ì ìì‹ ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(confirm(`ì •ë§ë¡œ '${s.nickname}'ë‹˜ì„ íŒŒí‹°ì—ì„œ ì¶”ë°©í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.`))try{await q(T(S,"users_v2",s.nickname)),alert("ì¶”ë°©ë˜ì—ˆìŠµë‹ˆë‹¤."),o()}catch(v){alert("ì˜¤ë¥˜ ë°œìƒ: "+v.message)}};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"20px",marginBottom:"20px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(L,{size:24,color:"#fca5a5"}),e.jsx("h2",{style:{margin:0},children:"ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ"})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"30px"},children:[e.jsxs("h3",{style:{margin:"0 0 20px 0"},children:["ë“±ë¡ëœ íŒŒí‹°ì› ê´€ë¦¬ (",l.length,"/4)"]}),c?e.jsx("div",{children:"ë¡œë”© ì¤‘..."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:l.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem"},children:s.isAdmin?"ğŸ‘‘":"ğŸ‘¤"}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[s.nickname," ",s.isAdmin&&e.jsx("span",{style:{color:"#fbbf24",fontSize:"0.8rem"},children:"(Admin)"})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:["Class: ",s.className]})]})]}),!s.isAdmin&&e.jsxs("button",{onClick:()=>f(s),style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",border:"1px solid rgba(239, 68, 68, 0.4)",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(ke,{size:16})," ì¶”ë°©"]})]},s.id))})]})]})},Ke=[{id:"barbarian",name:"ë°”ë°”ë¦¬ì•ˆ",icon:Ie,color:"#fca5a5"},{id:"bard",name:"ë°”ë“œ",icon:De,color:"#f9a8d4"},{id:"cleric",name:"í´ë ˆë¦­",icon:ze,color:"#d1d5db"},{id:"druid",name:"ë“œë£¨ì´ë“œ",icon:Ae,color:"#bef264"},{id:"fighter",name:"íŒŒì´í„°",icon:L,color:"#93c5fd"},{id:"monk",name:"ëª½í¬",icon:Te,color:"#7dd3fc"},{id:"paladin",name:"íŒ”ë¼ë”˜",icon:L,color:"#fbbf24"},{id:"ranger",name:"ë ˆì¸ì €",icon:Re,color:"#86efac"},{id:"rogue",name:"ë¡œê·¸",icon:Be,color:"#cbd5e1"},{id:"sorcerer",name:"ì†Œì„œëŸ¬",icon:Ee,color:"#c084fc"},{id:"warlock",name:"ì›Œë½",icon:_e,color:"#e879f9"},{id:"wizard",name:"ìœ„ìë“œ",icon:Ne,color:"#818cf8"}],Ve=({onComplete:t})=>{const[l,r]=x.useState("landing"),[c,a]=x.useState(""),[o,f]=x.useState(""),[s,v]=x.useState(null),[p,b]=x.useState(""),[j,y]=x.useState(""),[m,n]=x.useState([]),[h,i]=x.useState(!1),[d,g]=x.useState(""),w=()=>{a(""),f(""),v(null),b(""),y(""),g(""),n([])};x.useEffect(()=>{l==="join_party"&&k()},[l]);const k=async()=>{i(!0);try{const z=(await E(D(S,"users_v2"))).docs.map(A=>A.data()).filter(A=>A.isAdmin===!0);n(z)}catch(u){console.error(u)}finally{i(!1)}},C=async u=>{u.preventDefault(),i(!0),g("");try{const z=await O(T(S,"users_v2",c));if(!z.exists())g("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");else{const A=z.data();A.password===o?(sessionStorage.setItem("bg3_user_profile",JSON.stringify(A)),t(A)):g("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜.")}}catch(z){g(z.message)}finally{i(!1)}},I=async()=>{if(!c||!o||!s||!j){g("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}i(!0);try{if((await O(T(S,"users_v2",c))).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");const z={id:c,nickname:c,password:o,partyPassword:j,className:s.name,classId:s.id,isAdmin:!0,createdAt:new Date().toISOString()};await P(T(S,"users_v2",c),z),sessionStorage.setItem("bg3_user_profile",JSON.stringify(z)),t(z)}catch(u){g(u.message)}finally{i(!1)}},$=async()=>{if(!c||!o||!s||!p||!j){g("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}i(!0);try{if((await O(T(S,"users_v2",c))).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. (ë¡œê·¸ì¸ í•˜ì„¸ìš”)");const z=await O(T(S,"users_v2",p));if(!z.exists())throw new Error("ì„ íƒí•œ ì˜ì£¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");if(z.data().partyPassword!==j)throw new Error("ì˜ì§€ ì…ì¥ ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");const A={id:c,nickname:c,password:o,className:s.name,classId:s.id,isAdmin:!1,leader:p,createdAt:new Date().toISOString()};await P(T(S,"users_v2",c),A),sessionStorage.setItem("bg3_user_profile",JSON.stringify(A)),t(A)}catch(u){g(u.message)}finally{i(!1)}},J=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px",maxHeight:"200px",overflowY:"auto",margin:"10px 0"},children:Ke.map(u=>e.jsxs("button",{onClick:()=>v(u),style:{padding:"8px",borderRadius:"8px",border:s?.id===u.id?`2px solid ${u.color}`:"1px solid rgba(255,255,255,0.1)",background:s?.id===u.id?"rgba(255,255,255,0.1)":"transparent",color:"white",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px"},children:[e.jsx(u.icon,{size:18,color:u.color}),e.jsx("span",{style:{fontSize:"0.6rem"},children:u.name})]},u.id))}),W={maxWidth:"400px",margin:"40px auto",padding:"30px",textAlign:"center"},R={width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.2)",color:"white",marginBottom:"10px"},B={width:"100%",padding:"12px",background:"var(--accent-color)",color:"white",borderRadius:"8px",fontWeight:"bold",marginTop:"10px"};return l==="landing"?e.jsxs("div",{className:"glass-panel",style:W,children:[e.jsx("img",{src:re,alt:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ ì›ì •ëŒ€",style:{width:"100%",maxWidth:"280px",marginBottom:"20px",filter:"drop-shadow(0 0 10px rgba(0,0,0,0.5))"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsx("button",{onClick:()=>{w(),r("login")},style:{...B,background:"rgba(255,255,255,0.1)"},children:"ê¸°ì¡´ ëª¨í—˜ê°€ ë¡œê·¸ì¸"}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),e.jsxs("button",{onClick:()=>{w(),r("join_party")},style:B,children:[e.jsx(G,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),"ì˜ì§€ ê°€ì…í•˜ê¸° (ì¼ë°˜)"]}),e.jsxs("button",{onClick:()=>{w(),r("create_admin")},style:{...B,background:"#f87171"},children:[e.jsx(K,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),"ìƒˆ ì˜ì§€ ê±´ì„¤ (ê´€ë¦¬ì)"]})]})]}):l==="login"?e.jsxs("div",{className:"glass-panel",style:W,children:[e.jsx("h2",{children:"ë¡œê·¸ì¸"}),e.jsxs("form",{onSubmit:C,children:[e.jsx("input",{type:"text",placeholder:"ë‹‰ë„¤ì„",style:R,value:c,onChange:u=>a(u.target.value)}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",style:R,value:o,onChange:u=>f(u.target.value)}),e.jsx("button",{type:"submit",style:B,children:h?"...":"ì…ì¥"}),d&&e.jsx("p",{style:{color:"#f87171",marginTop:"10px"},children:d}),e.jsx("button",{type:"button",onClick:()=>r("landing"),style:{marginTop:"10px",background:"none",color:"rgba(255,255,255,0.5)"},children:"ì·¨ì†Œ"})]})]}):l==="create_admin"?e.jsxs("div",{className:"glass-panel",style:W,children:[e.jsx("h2",{style:{color:"#fca5a5"},children:"ìƒˆ ì˜ì§€ ê±´ì„¤"}),e.jsx("p",{style:{fontSize:"0.8rem",opacity:.7,marginBottom:"20px"},children:"ê´€ë¦¬ì(ì˜ì£¼) ì„¤ì •"}),e.jsx("input",{type:"text",placeholder:"ì˜ì£¼ ë‹‰ë„¤ì„",style:R,value:c,onChange:u=>a(u.target.value)}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",style:R,value:o,onChange:u=>f(u.target.value)}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ì…ì¥ ì½”ë“œ ì„¤ì • (íŒ€ì› ê³µìœ ìš©)",style:{...R,borderColor:"#818cf8"},value:j,onChange:u=>y(u.target.value)}),e.jsx("p",{style:{textAlign:"left",opacity:.7,margin:"10px 0 5px"},children:"ì§ì—… ì„ íƒ:"}),e.jsx(J,{}),e.jsx("button",{onClick:I,style:B,children:h?"ê±´ì„¤ ì¤‘...":"ì˜ì§€ ìƒì„± ì™„ë£Œ"}),d&&e.jsx("p",{style:{color:"#f87171",marginTop:"10px"},children:d}),e.jsx("button",{onClick:()=>r("landing"),style:{marginTop:"10px",background:"none",color:"rgba(255,255,255,0.5)"},children:"ì·¨ì†Œ"})]}):l==="join_party"?e.jsxs("div",{className:"glass-panel",style:W,children:[e.jsx("h2",{children:"ì˜ì§€ ê°€ì…"}),e.jsx("p",{style:{fontSize:"0.8rem",opacity:.7,marginBottom:"20px"},children:"í•©ë¥˜í•  ì˜ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”."}),e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"8px",marginBottom:"10px"},children:h&&m.length===0?e.jsx("p",{children:"ë¡œë”© ì¤‘..."}):m.length===0?e.jsx("p",{children:"ìƒì„±ëœ ì˜ì§€ê°€ ì—†ìŠµë‹ˆë‹¤."}):m.map(u=>e.jsxs("div",{onClick:()=>b(u.nickname),style:{padding:"10px",marginBottom:"5px",borderRadius:"6px",cursor:"pointer",background:p===u.nickname?"var(--accent-color)":"rgba(255,255,255,0.05)",color:"white",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{fontWeight:"bold"},children:["ğŸ° ",u.nickname,"ì˜ ì˜ì§€"]}),p===u.nickname&&e.jsx(K,{size:14})]},u.nickname))}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginBottom:"10px"},children:e.jsxs("button",{onClick:k,style:{background:"none",border:"none",color:"rgba(255,255,255,0.5)",cursor:"pointer",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(Ce,{size:12})," ëª©ë¡ ìƒˆë¡œê³ ì¹¨"]})}),p&&e.jsxs("div",{style:{animation:"fadeIn 0.3s"},children:[e.jsxs("p",{style:{textAlign:"left",fontSize:"0.8rem",color:"var(--accent-color)",marginBottom:"5px"},children:[p," ì˜ì£¼ë‹˜ì˜ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”."]}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ì…ì¥ ì½”ë“œ (Password)",style:{...R,borderColor:"#818cf8"},value:j,onChange:u=>y(u.target.value)}),e.jsx("div",{style:{height:"10px"}}),e.jsx("input",{type:"text",placeholder:"ë‚´ ë‹‰ë„¤ì„",style:R,value:c,onChange:u=>a(u.target.value)}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",style:R,value:o,onChange:u=>f(u.target.value)}),e.jsx("p",{style:{textAlign:"left",opacity:.7,margin:"10px 0 5px"},children:"ì§ì—… ì„ íƒ:"}),e.jsx(J,{})]}),e.jsx("button",{onClick:$,style:{...B,opacity:p?1:.5},disabled:!p,children:h?"ê°€ì… ì¤‘...":"í•©ë¥˜í•˜ê¸°"}),d&&e.jsx("p",{style:{color:"#f87171",marginTop:"10px"},children:d}),e.jsx("button",{onClick:()=>r("landing"),style:{marginTop:"10px",background:"none",color:"rgba(255,255,255,0.5)"},children:"ì·¨ì†Œ"})]}):null},Xe=()=>{const[t,l]=x.useState(()=>{try{const m=sessionStorage.getItem("bg3_user_profile");return m?JSON.parse(m):null}catch{return null}}),[r,c]=x.useState(()=>sessionStorage.getItem("bg3_active_tab")||"home"),a=m=>{c(m),sessionStorage.setItem("bg3_active_tab",m)},[o,f]=x.useState(1),[s,v]=x.useState(0),[p,b]=x.useState(window.innerWidth<768);x.useEffect(()=>{if(t){const n=t.isAdmin?t.nickname:t.leader;E(D(S,"users_v2")).then(h=>{const i=h.docs.filter(d=>{const g=d.data();return g.isAdmin&&g.nickname===n||g.leader===n});v(i.length)}).catch(h=>console.error("User count fail:",h))}const m=()=>b(window.innerWidth<768);return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[t]),x.useEffect(()=>{if(!t)return;const m=t.isAdmin?t.nickname:t.leader,n=async()=>{try{await P(T(S,"online_users",t.id),{nickname:t.nickname,classId:t.classId||"unknown",leader:m,lastSeen:Y()},{merge:!0})}catch(g){console.error("Heartbeat fail:",g)}};n();const h=setInterval(n,1e4),i=_(D(S,"online_users")),d=N(i,g=>{const w=Date.now(),k=g.docs.filter(C=>{const I=C.data();if(!I.lastSeen)return!1;const $=I.lastSeen.toDate?I.lastSeen.toDate().getTime():0;return w-$>=3e4?!1:I.leader===m});f(k.length)});return()=>{clearInterval(h),d()}},[t]);const j=m=>{l(m),sessionStorage.setItem("bg3_user_profile",JSON.stringify(m))},y=()=>{switch(r){case"home":return e.jsx(H,{user:t,setActiveTab:a});case"chat":return e.jsx($e,{user:t});case"calendar":return e.jsx(He,{user:t});case"save":return e.jsx(Ge,{user:t});case"settings":return e.jsx(qe,{user:t});case"admin":return t.isAdmin?e.jsx(Je,{user:t}):e.jsx(H,{user:t,setActiveTab:a});default:return e.jsx(H,{user:t,setActiveTab:a})}};return t?e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:"var(--bg-color)"},children:[!p&&e.jsx(Oe,{activeTab:r,setActiveTab:a,isMobile:p,onlineCount:`${o}/${s}`,user:t}),e.jsx("main",{style:{flex:1,padding:p?"20px 20px 80px":"20px",overflowY:"auto",position:"relative"},children:y()}),p&&e.jsx(Fe,{activeTab:r,setActiveTab:a,user:t})]}):e.jsx(Ve,{onComplete:j})};function Qe(){return e.jsx(Xe,{})}class Ze extends Le.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0,error:l}}componentDidCatch(l,r){console.error("Uncaught error:",l,r),this.setState({errorInfo:r})}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",color:"white",background:"#333",height:"100vh",overflow:"auto"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}We.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(Ze,{children:e.jsx(Qe,{})})}));
