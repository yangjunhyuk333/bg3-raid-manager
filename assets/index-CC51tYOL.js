import{i as ut,g as mt,R as Q,H as Ge,M as Je,C as ve,P as Qe,F as Ze,U as H,j as e,r as Ne,L as at,S as ot,T as ht,A as Pe,a as ke,b as Oe,c as Fe,d as Se,Z as Ce,e as ae,f as Ie,G as Ue,h as $e,k as le,W as ze,l as s,m as lt,n as be,q as K,o as P,p as We,s as _e,t as Be,w as X,u as ft,v as J,x as dt,B as yt,y as ue,X as ct,I as bt,z as jt,D as Re,E as de,J as je,K as M,N as we,O as vt,Q as wt,V as kt,Y as Le,_ as Ye,$ as St,a0 as He,a1 as pt,a2 as Ct,a3 as It,a4 as zt,a5 as Rt,a6 as Dt,a7 as oe,a8 as ye,a9 as et,aa as Et,ab as At,ac as Tt,ad as Nt,ae as Wt,af as _t,ag as tt,ah as Bt,ai as Lt,aj as Mt,ak as Pt,al as Ot}from"./vendor-D1cCnfCH.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))u(x);new MutationObserver(x=>{for(const k of x)if(k.type==="childList")for(const v of k.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&u(v)}).observe(document,{childList:!0,subtree:!0});function d(x){const k={};return x.integrity&&(k.integrity=x.integrity),x.referrerPolicy&&(k.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?k.credentials="include":x.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function u(x){if(x.ep)return;x.ep=!0;const k=d(x);fetch(x.href,k)}})();const Ft="modulepreload",Ut=function(t){return"/bg3-raid-manager/"+t},nt={},Me=function(a,d,u){let x=Promise.resolve();if(d&&d.length>0){let r=function(g){return Promise.all(g.map(w=>Promise.resolve(w).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),n=v?.nonce||v?.getAttribute("nonce");x=r(d.map(g=>{if(g=Ut(g),g in nt)return;nt[g]=!0;const w=g.endsWith(".css"),m=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${m}`))return;const p=document.createElement("link");if(p.rel=w?"stylesheet":Ft,w||(p.as="script"),p.crossOrigin="",p.href=g,n&&p.setAttribute("nonce",n),document.head.appendChild(p),w)return new Promise((R,D)=>{p.addEventListener("load",R),p.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${g}`)))})}))}function k(v){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=v,window.dispatchEvent(n),!n.defaultPrevented)throw v}return x.then(v=>{for(const n of v||[])n.status==="rejected"&&k(n.reason);return a().catch(k)})},te="/bg3-raid-manager/assets/logo-BLpM7sGS.svg",$t={apiKey:"AIzaSyAsbaWbo3DoSTrRFhkaf9XujWPpmeGSjAE",authDomain:"bg3-raid-manager.firebaseapp.com",projectId:"bg3-raid-manager",storageBucket:"bg3-raid-manager.firebasestorage.app",messagingSenderId:"773826713403",appId:"1:773826713403:web:c15fdfca708d47f4fcc91e"},Yt=ut($t),I=mt(Yt);console.log("ðŸ”¥ Firebase Connected (Real DB Mode)");const st=({size:t=20,color:a="currentColor"})=>e.jsxs("div",{style:{position:"relative",width:t,height:t,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(ht,{size:t,color:a}),e.jsx(ot,{size:t*.5,color:a,style:{position:"absolute",bottom:-2,right:-2,background:"#1a1a2e",borderRadius:"50%"}})]}),Ht=({activeTab:t,setActiveTab:a,isMobile:d,user:u,onlineUsersCount:x,setShowSurvivors:k,showProfileView:v,setShowProfileView:n,showProfileEdit:r,setShowProfileEdit:g})=>{const[w,m]=Q.useState(4),[p,R]=Q.useState(!1),[D,E]=Q.useState(!1),b=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],[S,_]=Q.useState(u?.nickname||""),[c,l]=Q.useState(u?.className||"Warrior"),[j,h]=Q.useState(u?.role||(u?.isAdmin?"Admin":"User")),[y,z]=Q.useState(u?.color||b[Math.floor(Math.random()*b.length)]),N=u?.isAdmin===!0,A=o=>o?o.includes("ë°”ë°”ë¦¬ì•ˆ")?Pe:o.includes("ë°”ë“œ")?ke:o.includes("í´ë ˆë¦­")?Oe:o.includes("ë“œë£¨ì´ë“œ")?Fe:o.includes("íŒŒì´í„°")?Se:o.includes("ëª½í¬")?Ce:o.includes("íŒ”ë¼ë”˜")?ae:o.includes("ë ˆì¸ì €")?Ie:o.includes("ë¡œê·¸")?Ue:o.includes("ì†Œì„œëŸ¬")?$e:o.includes("ì›Œë½")?le:o.includes("ìœ„ìžë“œ")?ze:H:H;Q.useEffect(()=>{u&&(_(u.nickname||""),l(u.className||"Warrior"),h(u.role||(u.isAdmin?"Admin":"User")),z(u.color||b[Math.floor(Math.random()*b.length)]))},[u,r]),Q.useEffect(()=>{const o=f=>{f.shiftKey&&f.altKey&&(f.key==="R"||f.key==="r")&&R(W=>!W)};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[]);const L=()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},F=async()=>{if(!S.trim())return alert("Nickname is required");try{const{updateDoc:o,doc:f}=await Me(async()=>{const{updateDoc:O,doc:$}=await import("./vendor-D1cCnfCH.js").then(V=>V.am);return{updateDoc:O,doc:$}},[]),W=f(I,"users_v2",u.id),T={nickname:S,className:c,role:j,color:y};await o(W,T);const U={...u,...T};localStorage.setItem("bg3_user_profile",JSON.stringify(U)),alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì ìš©ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤."),window.location.reload()}catch(o){console.error(o),alert("ìˆ˜ì • ì‹¤íŒ¨: "+o.message)}},ne=["ë°”ë°”ë¦¬ì•ˆ","ë°”ë“œ","í´ë ˆë¦­","ë“œë£¨ì´ë“œ","íŒŒì´í„°","ëª½í¬","íŒ”ë¼ë”˜","ë ˆì¸ì €","ë¡œê·¸","ì†Œì„œëŸ¬","ì›Œë½","ìœ„ìžë“œ"],se=[{id:"home",label:"í™ˆ",icon:Ge},{id:"chat",label:"ì±„íŒ…",icon:Je},{id:"calendar",label:"ì¼ì •",icon:ve},{id:"tactics",label:"ì „ìˆ íŒ",icon:Qe},{id:"save",label:"ì„¸ì´ë¸Œ",icon:Ze},{id:"profile",label:"í”„ë¡œí•„",icon:H}];N&&se.push({id:"admin",label:"ì•¼ì˜ì§€ ê´€ë¦¬",icon:st});const ce=se.filter(o=>o.id!=="profile");if(d){const o=[{id:"home",icon:Ge,label:"í™ˆ"},{id:"calendar",icon:ve,label:"ì¼ì •"},{id:"tactics",icon:Qe,label:"ì „ìˆ "},{id:"chat",icon:Je,label:"ì±„íŒ…"},...N?[{id:"admin",icon:st,label:"ê´€ë¦¬"}]:[],{id:"save",icon:Ze,label:"ì„¸ì´ë¸Œ"}];return e.jsx("nav",{className:"glass",style:{position:"fixed",bottom:"20px",left:"20px",right:"20px",margin:"0 auto",maxWidth:"500px",height:"70px",zIndex:1e3,display:"flex",justifyContent:"space-around",alignItems:"center",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.15)",borderTop:"1px solid rgba(255,255,255,0.25)",backdropFilter:"blur(20px) saturate(180%)",background:"rgba(20, 20, 30, 0.85)",boxShadow:"0 10px 30px rgba(0,0,0,0.5)",padding:"0 10px"},children:o.map(f=>{const W=f.icon,T=t===f.id;return e.jsxs("button",{onClick:()=>a(f.id),style:{background:T?"rgba(255,255,255,0.1)":"transparent",borderRadius:"16px",width:"50px",height:"50px",border:"none",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:T?"var(--accent-color)":"rgba(255,255,255,0.5)",transition:"all 0.2s",gap:"4px"},children:[e.jsx(W,{size:22,strokeWidth:T?2.5:2}),T&&e.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"var(--accent-color)"}})]},f.id)})})}const pe=A(u?.className);return e.jsxs("aside",{className:"glass",style:{width:"280px",height:"100vh",margin:0,padding:"25px",display:"flex",flexDirection:"column",borderRadius:0,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(20, 20, 30, 0.4)",position:"sticky",top:0},children:[e.jsxs("div",{style:{padding:"0 0 25px",textAlign:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[p&&e.jsx("button",{id:"db-reset-btn",onClick:async()=>{if(confirm("âš ï¸ ê²½ê³ : ì •ë§ë¡œ DBë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëŒì´í‚¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")){const{collection:o,getDocs:f,deleteDoc:W}=await Me(async()=>{const{collection:O,getDocs:$,deleteDoc:V}=await import("./vendor-D1cCnfCH.js").then(me=>me.am);return{collection:O,getDocs:$,deleteDoc:V}},[]);(await f(o(I,"users_v2"))).forEach(O=>W(O.ref)),(await f(o(I,"camps"))).forEach(O=>W(O.ref)),alert("ì´ˆê¸°í™” ì™„ë£Œ. ìž¬ì ‘ì†í•©ë‹ˆë‹¤."),L()}},style:{background:"red",color:"white",border:"none",padding:"5px",marginBottom:"10px",fontSize:"0.7rem",cursor:"pointer",width:"100%"},children:"[ADMIN] DB ì´ˆê¸°í™”"}),e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"100%",marginBottom:"10px",cursor:"pointer"},onClick:()=>window.location.reload(),children:[e.jsx("img",{src:te,alt:"BG3",style:{width:"100%",height:"auto",display:"block"},onError:o=>o.target.style.display="none"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${te})`,maskImage:`url(${te})`}})]}),e.jsxs("div",{onClick:()=>k&&k(!0),style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",background:"rgba(0,0,0,0.3)",borderRadius:"12px",fontSize:"0.75rem",border:"1px solid rgba(255,255,255,0.1)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:o=>o.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:o=>o.currentTarget.style.background="rgba(0,0,0,0.3)",children:[e.jsx(H,{size:12,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80"},children:[x,"/",w,"ëª… ì ‘ì† ì¤‘"]})]})]}),e.jsx("nav",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"20px",flex:1},children:ce.map(o=>{const f=o.icon;return e.jsxs("button",{onClick:()=>a(o.id),style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:t===o.id?"rgba(255,255,255,0.15)":"transparent",color:t===o.id?"white":"rgba(255,255,255,0.7)",borderRadius:"12px",transition:"all 0.2s",border:"none",cursor:"pointer",fontSize:"0.95rem",fontWeight:t===o.id?"bold":"normal"},children:[e.jsx(f,{size:20,color:t===o.id?"var(--accent-color)":"currentColor"}),o.label]},o.id)})}),e.jsxs("div",{onClick:()=>n(!0),style:{marginTop:"auto",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s",padding:"8px 8px 8px 12px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",height:"60px"},onMouseEnter:o=>{o.currentTarget.style.background="rgba(255, 255, 255, 0.08)",o.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:o=>{o.currentTarget.style.background="rgba(20, 20, 35, 0.6)",o.currentTarget.style.borderColor="rgba(255, 255, 255, 0.1)"},title:"í”„ë¡œí•„ ë³´ê¸°",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:u.color||"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 2px 10px ${u.color||"#f59e0b"}66`},children:e.jsx(pe,{size:20,color:"white"})}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.95rem",color:"white"},children:u.nickname})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),E(!0)},style:{width:"40px",height:"40px",background:"rgba(248, 113, 113, 0.15)",border:"1px solid rgba(248, 113, 113, 0.3)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fca5a5",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:o=>o.currentTarget.style.background="rgba(248, 113, 113, 0.25)",onMouseLeave:o=>o.currentTarget.style.background="rgba(248, 113, 113, 0.15)",children:e.jsx(at,{size:16})})]}),D&&Ne.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),children:e.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),style:{maxWidth:"350px",padding:"30px",textAlign:"center"},children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"10px",marginTop:"10px"},children:"ë¡œê·¸ì•„ì›ƒ"}),e.jsxs("p",{style:{opacity:.8,marginBottom:"30px",lineHeight:"1.5"},children:["ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ëª¨ë“  ë¡œê·¸ì¸ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤)"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>E(!1),style:{flex:1,padding:"14px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"transparent",color:"white",cursor:"pointer",fontWeight:"bold"},children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:L,style:{flex:1,padding:"14px",borderRadius:"12px",border:"none",background:"linear-gradient(45deg, #ef4444, #dc2626)",color:"white",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 15px rgba(239,68,68,0.3)"},children:"í™•ì¸"})]})]})}),document.body),v&&Ne.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>n(!1),children:e.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),style:{maxWidth:"400px",padding:"30px",textAlign:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 0 20px rgba(212, 160, 23, 0.4)"},children:e.jsx(H,{size:40,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.6rem",marginBottom:"5px",fontWeight:"bold"},children:u?.nickname||"ëª¨í—˜ê°€"}),e.jsxs("p",{style:{color:"var(--accent-color)",marginBottom:"20px",fontSize:"0.9rem",fontWeight:"bold"},children:[u?.className||"Classless"," ",e.jsx("span",{style:{opacity:.5},children:"|"})," ",u?.role==="Admin"||u?.isAdmin?"ëŒ€ìž¥ (ê´€ë¦¬ìž)":"ëŒ€ì›"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"25px",textAlign:"left"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì§ì—…"}),e.jsx("p",{style:{fontWeight:"bold"},children:u?.className||"-"})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì‹ ë¶„"}),e.jsx("p",{style:{fontWeight:"bold"},children:u?.role==="Admin"||u?.isAdmin?"ê´€ë¦¬ìž":"ì¼ë°˜ ëŒ€ì›"})]})]}),e.jsxs("button",{onClick:()=>{n(!1),g(!0)},style:{width:"100%",padding:"14px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s"},onMouseEnter:o=>o.currentTarget.style.background="rgba(255,255,255,0.2)",onMouseLeave:o=>o.currentTarget.style.background="rgba(255,255,255,0.1)",children:[e.jsx(ot,{size:18}),"í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°"]})]})}),document.body),r&&Ne.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>g(!1),children:e.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),style:{maxWidth:"400px",padding:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(H,{size:24,color:"var(--accent-color)"}),"í”„ë¡œí•„ ìˆ˜ì •"]}),e.jsx("button",{onClick:()=>g(!1),style:{background:"transparent",color:"rgba(255,255,255,0.5)"},children:"x"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ë‹‰ë„¤ìž„"}),e.jsx("input",{type:"text",value:S,onChange:o=>_(o.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ì§ì—… (Class)"}),e.jsx("select",{value:c,onChange:o=>l(o.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"},children:ne.map(o=>e.jsx("option",{value:o,style:{background:"#1a1a2e"},children:o},o))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:b.map(o=>e.jsx("div",{onClick:()=>z(o),style:{width:"28px",height:"28px",borderRadius:"50%",background:o,cursor:"pointer",border:y===o?"3px solid white":"1px solid transparent",boxShadow:y===o?"0 0 10px "+o:"none",transform:y===o?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},o))})]}),e.jsx("button",{onClick:F,style:{marginTop:"10px",padding:"14px",borderRadius:"10px",background:"var(--accent-color)",color:"white",border:"none",fontWeight:"bold",fontSize:"1rem",cursor:"pointer"},children:"ì €ìž¥í•˜ê¸°"})]})]})}),document.body)]})},it=({user:t,setActiveTab:a,isMobile:d,onlineUsersCount:u,setShowSurvivors:x,openTactic:k,openProfile:v})=>{const[n,r]=s.useState([]),[g,w]=s.useState(!0),[m,p]=s.useState(()=>{const b=localStorage.getItem("bg3_daily_goals");return b?JSON.parse(b):[{id:1,text:"ê¸´ íœ´ì‹ ì·¨í•˜ê¸° (ì£¼ë¬¸ ìŠ¬ë¡¯ ë³µêµ¬)",checked:!1},{id:2,text:"ì•¼ì˜ì§€ ë¬¼ìž í™•ì¸",checked:!1},{id:3,text:"ìƒì¸ì—ê²Œ ìž¡ë™ì‚¬ë‹ˆ íŒë§¤",checked:!1},{id:4,text:"ë™ë£Œ í˜¸ê°ë„ ëŒ€í™”",checked:!1}]});s.useEffect(()=>{localStorage.setItem("bg3_daily_goals",JSON.stringify(m))},[m]);const[R,D]=s.useState([]);s.useEffect(()=>{(async()=>{try{const S=K(P(I,"schedules"),We("date"),_e(3)),_=await Be(S);if(r(_.docs.map(c=>({id:c.id,...c.data()}))),t?.campId){const c=K(P(I,"tactics"),X("campId","==",t.campId),We("createdAt","desc"),_e(3)),l=await Be(c);D(l.docs.map(j=>({id:j.id,...j.data()})))}}catch(S){console.error(S)}finally{w(!1)}})()},[t?.campId]);const E=({icon:b,title:S,desc:_,onClick:c,color:l})=>e.jsxs("div",{onClick:c,className:"glass-panel",style:{padding:"20px",cursor:"pointer",transition:"transform 0.2s",display:"flex",flexDirection:"column",gap:"10px"},onMouseEnter:j=>j.currentTarget.style.transform="translateY(-5px)",onMouseLeave:j=>j.currentTarget.style.transform="translateY(0)",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{padding:"10px",borderRadius:"12px",background:`rgba(${l}, 0.2)`},children:e.jsx(b,{color:`rgb(${l})`,size:24})}),e.jsx(ft,{size:16,style:{opacity:.5}})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"5px 0",fontSize:"1.1rem"},children:S}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:_})]})]});return e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"flex",flexDirection:"column",gap:d?"15px":"30px"},children:[d&&e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"180px",margin:"0 auto 10px"},children:[e.jsx("img",{src:te,alt:"BG3",style:{width:"100%"},onClick:()=>window.location.reload()}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${te})`,maskImage:`url(${te})`}})]}),e.jsxs("div",{onClick:v,style:{width:"100%",minHeight:"90px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 10px 30px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"space-between",padding:d?"20px 25px":"0 40px",textAlign:"left",cursor:"pointer",transition:"transform 0.2s"},onMouseOver:b=>d?null:b.currentTarget.style.transform="scale(1.01)",onMouseOut:b=>d?null:b.currentTarget.style.transform="scale(1)",children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,fontSize:d?"1.2rem":"1.6rem",fontWeight:"bold"},children:["ì–´ì„œì˜¤ì„¸ìš”, ",e.jsx("span",{style:{color:t?.color||"#ffd700"},children:t.nickname}),"ë‹˜"]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"0.85rem",opacity:.6},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ ì›ì •ëŒ€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤."})]}),e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:t?.color||"#ffd700",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 20px ${t?.color||"#ffd700"}66`,flexShrink:0,marginLeft:"15px"},children:(()=>{const b=t?.className||"";let S=H;return b.includes("ë°”ë°”ë¦¬ì•ˆ")?S=Pe:b.includes("ë°”ë“œ")?S=ke:b.includes("í´ë ˆë¦­")?S=Oe:b.includes("ë“œë£¨ì´ë“œ")?S=Fe:b.includes("íŒŒì´í„°")?S=Se:b.includes("ëª½í¬")?S=Ce:b.includes("íŒ”ë¼ë”˜")?S=ae:b.includes("ë ˆì¸ì €")?S=Ie:b.includes("ë¡œê·¸")?S=Ue:b.includes("ì†Œì„œëŸ¬")?S=$e:b.includes("ì›Œë½")?S=le:b.includes("ìœ„ìžë“œ")&&(S=ze),e.jsx(S,{size:28,color:"white",strokeWidth:2.5})})()})]}),d&&e.jsxs("div",{onClick:()=>x&&x(!0),style:{display:"inline-flex",alignItems:"center",gap:"8px",background:"rgba(20, 20, 30, 0.6)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"20px",padding:"8px 16px",marginBottom:"20px",cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,0.2)",position:"relative",zIndex:10,userSelect:"none"},children:[e.jsx(H,{size:14,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80",fontSize:"0.85rem",fontWeight:"bold"},children:[u||0,"/4ëª… ì ‘ì† ì¤‘"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:d?"10px":"20px"},children:[e.jsx(E,{icon:ve,title:"ë ˆì´ë“œ ì¼ì •",desc:"ë‹¤ê°€ì˜¤ëŠ” ëª¨í—˜ í™•ì¸í•˜ê¸°",onClick:()=>a("calendar"),color:"248, 113, 113"}),e.jsx(E,{icon:lt,title:"ì„¸ì´ë¸Œ ë¶„ì„",desc:"ë‚´ ìºë¦­í„° ìŠ¤íŽ™ í™•ì¸",onClick:()=>a("save"),color:"167, 139, 250"}),e.jsx(E,{icon:Je,title:"ìž‘ì „ íšŒì˜ì‹¤",desc:"íŒŒí‹°ì›ë“¤ê³¼ ëŒ€í™”í•˜ê¸°",onClick:()=>a("chat"),color:"52, 211, 153"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"1fr 1fr",gap:d?"10px":"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"20px",minHeight:"300px",display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px",fontSize:"1.2rem"},children:[e.jsx(ve,{size:20,className:"text-accent"})," ë‹¤ê°€ì˜¤ëŠ” ì¼ì •"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:1},children:g?e.jsx("p",{style:{opacity:.5},children:"ë¡œë”© ì¤‘..."}):n.length===0?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.5},children:"ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."}):n.map(b=>e.jsxs("div",{onClick:()=>a("calendar"),style:{padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",display:"flex",alignItems:"center",gap:"15px",cursor:"pointer",transition:"background 0.2s",border:"1px solid rgba(255,255,255,0.05)"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:S=>S.currentTarget.style.background="rgba(255,255,255,0.05)",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"50px"},children:[e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.7},children:[b.date?.split("-")[1],"ì›”"]}),e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:b.date?.split("-")[2]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"1rem"},children:b.title}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6,marginTop:"2px"},children:[b.time," â€¢ ",b.type==="raid"?"âš”ï¸ ë ˆì´ë“œ":"ðŸ“œ ìŠ¤í† ë¦¬"]})]})]},b.id))}),e.jsx("button",{onClick:()=>a("calendar"),style:{marginTop:"15px",padding:"10px",width:"100%",background:"rgba(255,255,255,0.05)",border:"none",color:"rgba(255,255,255,0.7)",borderRadius:"8px",cursor:"pointer"},children:"ì „ì²´ ì¼ì • ë³´ê¸°"})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"20px",minHeight:"300px",display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px",fontSize:"1.2rem"},children:[e.jsx(be,{size:20,className:"text-secondary",style:{color:"#60a5fa"}})," ìµœê·¼ ì „ìˆ "]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:1},children:g?e.jsx("p",{style:{opacity:.5},children:"ë¡œë”© ì¤‘..."}):R.length===0?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.5},children:"ìˆ˜ë¦½ëœ ìž‘ì „ì´ ì—†ìŠµë‹ˆë‹¤."}):R.map(b=>e.jsxs("div",{onClick:()=>k?k(b.id):a("tactics"),style:{padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",display:"flex",alignItems:"center",gap:"15px",cursor:"pointer",transition:"background 0.2s",border:"1px solid rgba(255,255,255,0.05)"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:S=>S.currentTarget.style.background="rgba(255,255,255,0.05)",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"10px",background:"rgba(96, 165, 250, 0.2)",borderRadius:"10px"},children:e.jsx(be,{size:20,color:"#60a5fa"})}),e.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"1rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:b.title}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6,marginTop:"2px"},children:["ìž‘ì„±ìž: ",b.authorName]})]})]},b.id))}),e.jsx("button",{onClick:()=>a("tactics"),style:{marginTop:"15px",padding:"10px",width:"100%",background:"rgba(255,255,255,0.05)",border:"none",color:"rgba(255,255,255,0.7)",borderRadius:"8px",cursor:"pointer"},children:"ì „ìˆ  ìž‘ì „ì‹¤ ì´ë™"})]})]})]})},qt=({user:t,isMobile:a,setActiveTab:d})=>{const[u,x]=s.useState([]),[k,v]=s.useState(""),[n,r]=s.useState(null),[g,w]=s.useState(!0),[m,p]=s.useState([]),R=s.useRef(null),D=s.useRef(null),E=s.useRef(0),b=l=>l?l.includes("ë°”ë°”ë¦¬ì•ˆ")?Pe:l.includes("ë°”ë“œ")?ke:l.includes("í´ë ˆë¦­")?Oe:l.includes("ë“œë£¨ì´ë“œ")?Fe:l.includes("íŒŒì´í„°")?Se:l.includes("ëª½í¬")?Ce:l.includes("íŒ”ë¼ë”˜")?ae:l.includes("ë ˆì¸ì €")?Ie:l.includes("ë¡œê·¸")?Ue:l.includes("ì†Œì„œëŸ¬")?$e:l.includes("ì›Œë½")?le:l.includes("ìœ„ìžë“œ")?ze:ue:ue;s.useEffect(()=>{if(!t?.campId)return;const l=K(P(I,"chats"),X("campId","==",t.campId),_e(50)),j=J(l,h=>{const y=h.docs.map(z=>({id:z.id,...z.data(),timestamp:z.data().timestamp?.toDate().toISOString()||new Date().toISOString()}));y.sort((z,N)=>new Date(z.timestamp)-new Date(N.timestamp)),x(y),w(!1)});return()=>j()},[t?.campId]),s.useEffect(()=>{if(!t?.campId)return;const l=K(P(I,"camps",t.campId,"typing")),j=J(l,y=>{const z=Date.now(),N=y.docs.map(A=>({id:A.id,...A.data()})).filter(A=>A.id!==t.id&&A.timestamp&&z-A.timestamp.toMillis()<4e3);p(N)}),h=setInterval(()=>{p(y=>{const z=Date.now();return y.filter(N=>N.timestamp?.toMillis&&z-N.timestamp.toMillis()<4e3)})},1e3);return()=>{j(),clearInterval(h)}},[t?.campId,t?.id]),s.useEffect(()=>{R.current?.scrollIntoView({behavior:"smooth"})},[u,m]);const S=l=>{const j=l.target.files[0];if(j){if(j.size>500*1024){alert("ì´ë¯¸ì§€ í¬ê¸°ëŠ” 500KB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");return}const h=new FileReader;h.onloadend=()=>{r(h.result)},h.readAsDataURL(j)}},_=async l=>{const j=l.target.value;v(j);const h=Date.now();if(j.trim()&&h-E.current>2e3&&t?.campId){E.current=h;try{await je(M(I,"camps",t.campId,"typing",t.id),{nickname:t.nickname,timestamp:de()})}catch(y){console.error("Typing status error",y)}}},c=async l=>{if(l.preventDefault(),!k.trim()&&!n||!t?.campId)return;const j=k,h=n;v(""),r(null);try{await Re(P(I,"chats"),{text:j,image:h,sender:t.nickname,uid:t.id,userClass:t.className||"Unknown",userColor:t.color||"#a78bfa",campId:t.campId,timestamp:de()})}catch(y){console.error("Error sending message: ",y),alert("ì „ì†¡ ì‹¤íŒ¨!")}};return t?.campId?e.jsxs("div",{style:{display:"flex",flexDirection:"column",padding:0,position:a?"fixed":"relative",top:0,left:0,right:0,bottom:0,height:a?"100dvh":"100%",background:a?"#0f0f13":"rgba(0,0,0,0.2)",zIndex:2e3},children:[e.jsxs("div",{style:{padding:"15px 20px",borderBottom:"1px solid rgba(255,255,255,0.1)",background:a?"rgba(20,20,30,0.95)":"transparent",display:"flex",alignItems:"center",gap:"15px"},children:[a&&e.jsx("button",{onClick:()=>d("home"),style:{background:"none",border:"none",color:"white",padding:"5px",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(dt,{size:24})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(yt,{color:"#4fd1c5",size:20})," íŒŒí‹° ìž‘ì „ íšŒì˜ì‹¤"]}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.6,display:"block",marginTop:"2px"},children:["ðŸ”’ ",t.campId," ì•¼ì˜ì§€"]})]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"15px"},children:[g&&e.jsx("div",{style:{textAlign:"center",opacity:.5},children:"ì±„íŒ…ë°© ì—°ê²° ì¤‘..."}),u.length===0&&!g&&e.jsxs("div",{style:{textAlign:"center",opacity:.3,marginTop:"20px"},children:[e.jsx("p",{children:"ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{children:"ìž‘ì „ì„ ì‹œìž‘í•´ë³´ì„¸ìš”!"})]}),u.map(l=>{const j=l.uid===t.id,h=b(l.userClass),y=l.userColor||"#a78bfa";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:j?"flex-end":"flex-start",marginBottom:"10px"},children:[!j&&e.jsx("div",{style:{fontSize:"0.8rem",marginLeft:"46px",marginBottom:"4px",opacity:.7},children:l.sender}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexDirection:j?"row-reverse":"row",maxWidth:"85%"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",background:y,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 2px 8px ${y}66`,flexShrink:0},children:e.jsx(h,{size:20,color:"white"})}),e.jsxs("div",{style:{background:j?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:j?"16px 4px 16px 16px":"4px 16px 16px 16px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.1)",wordBreak:"break-word",color:"white"},children:[l.image&&e.jsx("img",{src:l.image,alt:"attached",style:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain",borderRadius:"8px",marginBottom:l.text?"10px":"0"}}),l.text]})]}),e.jsx("span",{style:{fontSize:"0.65rem",opacity:.4,marginTop:"4px",marginRight:j?"46px":"0",marginLeft:j?"0":"46px"},children:new Date(l.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},l.id)}),m.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",marginTop:"10px",paddingLeft:"4px"},children:m.slice(0,3).map(l=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"8px",opacity:.9},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #a78bfa, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:"bold",color:"white",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},children:l.nickname?l.nickname.charAt(0):e.jsx(ue,{size:14})}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"16px 16px 16px 2px",padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",height:"32px",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"})]}),e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.5,marginBottom:"4px"},children:[l.nickname," ìž…ë ¥ ì¤‘..."]})]},l.id))}),e.jsx("div",{ref:R})]}),e.jsxs("form",{onSubmit:c,style:{padding:"20px",background:"rgba(0,0,0,0.2)",display:"flex",flexDirection:"column",gap:"10px",borderRadius:"0 0 16px 16px"},children:[n&&e.jsxs("div",{style:{position:"relative",width:"fit-content"},children:[e.jsx("img",{src:n,alt:"Preview",style:{height:"80px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.2)"}}),e.jsx("button",{type:"button",onClick:()=>r(null),style:{position:"absolute",top:-5,right:-5,background:"red",borderRadius:"50%",border:"none",color:"white",padding:"2px",cursor:"pointer"},children:e.jsx(ct,{size:12})})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("input",{type:"file",accept:"image/*",ref:D,style:{display:"none"},onChange:S}),e.jsx("button",{type:"button",onClick:()=>D.current.click(),style:{padding:"12px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:e.jsx(bt,{size:20})}),e.jsx("input",{type:"text",value:k,onChange:_,placeholder:"ìž‘ì „ì„ ì „ë‹¬í•˜ì„¸ìš”...",style:{flex:1,padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.05)",color:"white",outline:"none"}}),e.jsx("button",{type:"submit",style:{padding:"12px",borderRadius:"12px",background:"var(--accent-color)",color:"white",border:"none",cursor:"pointer"},children:e.jsx(jt,{size:20})})]})]})]}):e.jsx("div",{className:"glass-panel",style:{padding:"40px",textAlign:"center"},children:"ì•¼ì˜ì§€ì— ì†Œì†ë˜ì–´ ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤."})},Xt=({user:t,isMobile:a})=>{const[d,u]=s.useState(new Date),[x,k]=s.useState([]),[v,n]=s.useState([]),[r,g]=s.useState(!0),[w,m]=s.useState(0),p=d.toLocaleDateString("en-CA");s.useEffect(()=>{if(!t?.campId){g(!1);return}console.log("Fetching raid data...");const h=K(P(I,"availabilities"),X("campId","==",t.campId)),y=K(P(I,"schedules"),X("campId","==",t.campId),X("type","==","fixed")),z=J(h,A=>{const L=A.docs.map(F=>({id:F.id,...F.data()}));k(L)}),N=J(y,A=>{const L=A.docs.map(F=>({id:F.id,...F.data()}));n(L),g(!1)});return()=>{z(),N()}},[t?.campId,w]);const D=x.find(h=>h.userId===t.id&&h.date===p)?.possibleTimes||[],E=s.useMemo(()=>{const h={};return x.filter(z=>z.date===p).forEach(z=>{z.possibleTimes?.forEach(N=>{h[N]||(h[N]=[]),h[N].push(z.nickname)})}),h},[x,p]),b=v.find(h=>h.date===p),S=async h=>{if(!t.campId)return;const y=D.includes(h)?D.filter(A=>A!==h):[...D,h].sort(),z=`${t.campId}_${t.id}_${p}`,N=M(I,"availabilities",z);await je(N,{campId:t.campId,userId:t.id,nickname:t.nickname,date:p,possibleTimes:y})},_=async h=>{if(window.confirm(`${d.toLocaleDateString()} ${h}ì— ë ˆì´ë“œë¥¼ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await Re(P(I,"schedules"),{campId:t.campId,title:"ì •ê¸° ë ˆì´ë“œ",date:p,fixedTime:h,type:"fixed",creator:t.nickname,createdAt:new Date().toISOString()}),alert("ë ˆì´ë“œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤! íŒŒí‹°ì›ë“¤ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤."),g(!0),m(y=>y+1)}catch(y){console.error(y),alert("ì˜¤ë¥˜ ë°œìƒ: "+y.message)}},c=async h=>{window.confirm("ì •ë§ ì´ ë ˆì´ë“œ ì¼ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await Ye(M(I,"schedules",h))},l=["18:00","19:00","20:00","21:00","22:00","23:00","00:00","01:00","02:00"],j=({date:h,view:y})=>{if(y==="month"){const z=h.toLocaleDateString("en-CA");if(v.some(L=>L.date===z))return e.jsx("div",{style:{height:"6px",width:"6px",background:"#f87171",borderRadius:"50%",margin:"2px auto"}});if(x.some(L=>L.date===z))return e.jsx("div",{style:{height:"4px",width:"4px",background:"rgba(255,255,255,0.3)",borderRadius:"50%",margin:"2px auto"}})}};return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:a?"15px":"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",color:"white",margin:0,fontSize:a?"1.2rem":"1.5rem"},children:[e.jsx(ve,{className:"text-accent"})," ë ˆì´ë“œ ì¼ì • (Raid Scheduler)"]}),e.jsx("button",{onClick:()=>{g(!0),m(h=>h+1)},style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",padding:"8px",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"ìƒˆë¡œê³ ì¹¨",children:e.jsx(we,{size:18})})]}),e.jsx("style",{children:`
                    .react-calendar { background: transparent !important; border: none !important; width: 100% !important; color: white !important; font-family: inherit; }
                    .react-calendar__navigation button { color: white; min-width: 44px; background: none; font-size: ${a?"1rem":"1.2rem"}; }
                    .react-calendar__navigation button:enabled:hover, .react-calendar__navigation button:enabled:focus { background-color: rgba(255,255,255,0.1); }
                    .react-calendar__month-view__weekdays { text-align: center; text-transform: uppercase; font-weight: bold; font-size: 0.8em; opacity: 0.7; color: var(--accent-color); }
                    .react-calendar__month-view__days__day { color: white; padding: ${a?"10px":"15px"}; background: transparent; border: none; }
                    .react-calendar__tile:enabled:hover, .react-calendar__tile:enabled:focus { background-color: rgba(255,255,255,0.1); border-radius: 12px; }
                    .react-calendar__tile--now { background: rgba(255,255,255,0.1) !important; border-radius: 12px; }
                    .react-calendar__tile--active { background: var(--accent-color) !important; color: white !important; border-radius: 12px; }
                `}),e.jsx(vt,{onChange:u,value:d,tileContent:j,formatDay:(h,y)=>y.getDate()})]}),b?e.jsxs("div",{className:"glass-panel",style:{padding:"25px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05))",border:"1px solid rgba(239, 68, 68, 0.3)",textAlign:"center"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",color:"#fca5a5",marginBottom:"10px",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(wt,{})," ë ˆì´ë“œ í™•ì •ë¨"]}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold",margin:"10px 0"},children:b.fixedTime}),e.jsx("p",{style:{opacity:.8},children:"ëª¨ë“  ëŒ€ì›ì€ í•´ë‹¹ ì‹œê°„ì— ì•¼ì˜ì§€ë¡œ ì§‘ê²°í•˜ì‹­ì‹œì˜¤."}),(t.isAdmin||t.role==="Admin")&&e.jsx("button",{onClick:()=>c(b.id),style:{marginTop:"20px",padding:"10px 20px",borderRadius:"8px",background:"rgba(0,0,0,0.3)",color:"#fca5a5",border:"1px solid rgba(239,68,68,0.5)",cursor:"pointer"},children:"ì¼ì • ì·¨ì†Œí•˜ê¸°"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-panel",style:{padding:a?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx(kt,{size:18,color:"var(--accent-color)"}),"ë‚˜ì˜ ê°€ëŠ¥ ì‹œê°„ (",d.toLocaleDateString(),")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:l.map(h=>{const y=D.includes(h);return e.jsx("button",{onClick:()=>S(h),style:{padding:"10px 16px",borderRadius:"12px",border:"none",cursor:"pointer",background:y?"var(--accent-color)":"rgba(255,255,255,0.05)",color:y?"white":"rgba(255,255,255,0.6)",fontWeight:y?"bold":"normal",transition:"all 0.2s",flexGrow:a?1:0},children:h},h)})})]}),e.jsxs("div",{className:"glass-panel",style:{padding:a?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx(H,{size:18,color:"#a78bfa"}),"íŒŒí‹° í˜„í™© (Team Status)"]}),Object.keys(E).length===0?e.jsx("p",{style:{opacity:.5,textAlign:"center",padding:"20px"},children:"ì•„ì§ ë“±ë¡ëœ ê°€ëŠ¥ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Object.entries(E).sort((h,y)=>y[1].length-h[1].length||h[0].localeCompare(y[0])).map(([h,y])=>{const z=y.length,N=z>=3;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderRadius:"12px",background:N?"rgba(167, 139, 250, 0.15)":"rgba(255,255,255,0.03)",border:N?"1px solid rgba(167, 139, 250, 0.3)":"1px solid transparent"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:N?"#a78bfa":"white"},children:h}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(H,{size:14,style:{opacity:.7}}),e.jsxs("span",{style:{fontSize:"0.9rem",opacity:.9},children:[z,"ëª… ê°€ëŠ¥"]}),e.jsxs("span",{style:{fontSize:"0.75rem",opacity:.5},children:["(",y.join(", "),")"]})]})]}),(t.isAdmin||t.role==="Admin")&&e.jsxs("button",{onClick:()=>_(h),style:{padding:"6px 12px",borderRadius:"8px",border:"none",background:"linear-gradient(45deg, #f87171, #ef4444)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.8rem"},children:[e.jsx(Le,{size:12,fill:"white"})," í™•ì •"]})]},h)})})]})]})]})},Kt=({user:t})=>{const[a,d]=s.useState([]),[u,x]=s.useState(!0);s.useEffect(()=>{if(!t?.campId)return;const r=K(P(I,"save_reports_v2"),X("campId","==",t.campId),We("createdAt","desc"),_e(10)),g=J(r,w=>{const m=w.docs.map(p=>({id:p.id,...p.data()}));d(m),x(!1)});return()=>g()},[t?.campId]);const k=async r=>{confirm("ì´ ë¶„ì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await Ye(M(I,"save_reports_v2",r))},v=({label:r,value:g,color:w})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[e.jsx("span",{style:{width:"40px",fontWeight:"bold",fontSize:"0.8rem",color:"rgba(255,255,255,0.7)"},children:r}),e.jsx("div",{style:{flex:1,height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${g/20*100}%`,height:"100%",background:w,transition:"width 0.5s"}})}),e.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:g})]}),n=r=>{const g=r.target.files[0];g&&(x(!0),setTimeout(async()=>{const w={STR:Math.floor(Math.random()*10)+10,DEX:Math.floor(Math.random()*10)+10,CON:Math.floor(Math.random()*10)+10,INT:Math.floor(Math.random()*10)+10,WIS:Math.floor(Math.random()*10)+10,CHA:Math.floor(Math.random()*10)+10},m={filename:g.name,stats:w,meta:{mode:"Honour Mode (Detected)",version:"4.1.1.4",size:(g.size/1024/1024).toFixed(2)+" MB"},companions:[{name:"Shadowheart",img:"ðŸŒ™"},{name:"Astarion",img:"ðŸ§›"}],logs:["[Client] File loaded locally","[Parser] Header verified (LSOF v4)","[Analysis] Stats extracted successfully"],uploader:t.nickname,campId:t.campId,createdAt:de()};try{await Re(P(I,"save_reports_v2"),m),alert("ë¶„ì„ ì™„ë£Œ!")}catch(p){console.error(p),alert("ì—…ë¡œë“œ ì‹¤íŒ¨")}finally{x(!1)}},1500))};return e.jsxs("div",{style:{padding:"0 0 80px"},children:[e.jsxs("div",{className:"glass-panel",style:{marginBottom:"20px",textAlign:"center",border:"1px solid var(--accent-color)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(St,{color:"#a78bfa"})," ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ê¸°"]}),e.jsx("p",{style:{opacity:.8,fontSize:"0.9rem",maxWidth:"600px",margin:"0 auto 20px"},children:"ì„¸ì´ë¸Œ íŒŒì¼(.lsv)ì„ ì—…ë¡œë“œí•˜ì—¬ ìºë¦­í„° ëŠ¥ë ¥ì¹˜ì™€ ì§„í–‰ ìƒí™©ì„ ë¶„ì„í•˜ì„¸ìš”."}),e.jsxs("div",{style:{position:"relative",overflow:"hidden",display:"inline-block"},children:[e.jsxs("button",{style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(He,{size:18})," íŒŒì¼ ì„ íƒ ë° ë¶„ì„"]}),e.jsx("input",{type:"file",accept:".lsv,.save",onChange:n,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"}})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:u?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx(we,{size:32,className:"spin",style:{marginBottom:"15px",color:"var(--accent-color)"}}),e.jsx("p",{children:"ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ ì¤‘..."})]}):a.length===0?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx(He,{size:48,style:{opacity:.3,marginBottom:"20px"}}),e.jsx("p",{children:"ë¶„ì„ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})]}):a.map(r=>e.jsxs("div",{className:"glass-panel",style:{position:"relative",animation:"fadeIn 0.5s"},children:[e.jsx("button",{onClick:()=>k(r.id),style:{position:"absolute",top:"15px",right:"15px",background:"transparent",border:"none",color:"#f87171",cursor:"pointer"},children:e.jsx(pt,{size:16})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"10px"},children:[e.jsx(He,{size:20,color:"var(--accent-color)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem"},children:r.filename}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.5},children:[new Date(r.createdAt?.toDate?r.createdAt.toDate():r.createdAt).toLocaleString()," â€¢ ",r.uploader]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px"},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(lt,{size:14})," ëŠ¥ë ¥ì¹˜ (Stats)"]}),r.stats?e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"STR",value:r.stats.STR,color:"#fca5a5"}),e.jsx(v,{label:"DEX",value:r.stats.DEX,color:"#86efac"}),e.jsx(v,{label:"CON",value:r.stats.CON,color:"#fbbf24"}),e.jsx(v,{label:"INT",value:r.stats.INT,color:"#93c5fd"}),e.jsx(v,{label:"WIS",value:r.stats.WIS,color:"#d8b4fe"}),e.jsx(v,{label:"CHA",value:r.stats.CHA,color:"#f472b6"})]}):e.jsx("p",{style:{fontSize:"0.8rem",opacity:.5},children:"ë°ì´í„° ì—†ìŒ"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px",flex:1},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(ae,{size:14})," ë©”íƒ€ ì •ë³´"]}),e.jsxs("div",{style:{fontSize:"0.8rem",display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("p",{style:{margin:0},children:["ðŸ“‚ ëª¨ë“œ: ",r.meta?.mode||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ðŸ’¾ ë²„ì „: ",r.meta?.version||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ðŸ“¦ í¬ê¸°: ",r.meta?.size||"Unknown"]})]})]}),r.companions&&e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"12px"},children:[e.jsx("h4",{style:{margin:"0 0 5px",fontSize:"0.8rem",opacity:.8},children:"í•¨ê»˜í•˜ëŠ” ë™ë£Œ"}),e.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"},children:r.companions.map((g,w)=>e.jsxs("span",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem"},children:[g.img," ",g.name]},w))})]})]})]})]},r.id))})]})},Ve=[{id:"barbarian",name:"ë°”ë°”ë¦¬ì•ˆ",icon:Se,color:"#fca5a5"},{id:"bard",name:"ë°”ë“œ",icon:ke,color:"#f9a8d4"},{id:"cleric",name:"í´ë ˆë¦­",icon:Ct,color:"#d1d5db"},{id:"druid",name:"ë“œë£¨ì´ë“œ",icon:It,color:"#bef264"},{id:"fighter",name:"íŒŒì´í„°",icon:ae,color:"#93c5fd"},{id:"monk",name:"ëª½í¬",icon:zt,color:"#7dd3fc"},{id:"paladin",name:"íŒ”ë¼ë”˜",icon:ae,color:"#fbbf24"},{id:"ranger",name:"ë ˆì¸ì €",icon:Ie,color:"#86efac"},{id:"rogue",name:"ë¡œê·¸",icon:le,color:"#cbd5e1"},{id:"sorcerer",name:"ì†Œì„œëŸ¬",icon:Ce,color:"#c084fc"},{id:"warlock",name:"ì›Œë½",icon:ze,color:"#e879f9"},{id:"wizard",name:"ìœ„ìžë“œ",icon:Rt,color:"#818cf8"}],ge=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],G={width:"100%",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.2)",color:"white",marginBottom:"12px",fontSize:"1rem",transition:"border-color 0.2s, background 0.2s"},re={width:"100%",padding:"16px",borderRadius:"12px",border:"none",fontWeight:"bold",fontSize:"1.05rem",marginTop:"0",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},qe=({selected:t,onSelect:a})=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"10px",maxHeight:"200px",overflowY:"auto",margin:"20px 0",padding:"5px"},children:Ve.map(d=>e.jsxs("button",{onClick:()=>a(d),type:"button",style:{padding:"12px 8px",borderRadius:"12px",border:t?.id===d.id?`2px solid ${d.color}`:"1px solid rgba(255,255,255,0.05)",background:t?.id===d.id?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.2)",color:"white",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",transition:"all 0.2s",cursor:"pointer",transform:t?.id===d.id?"scale(1.05)":"scale(1)"},children:[e.jsx(d.icon,{size:24,color:d.color}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:t?.id===d.id?"bold":"normal"},children:d.name})]},d.id))}),Xe=({selected:t,onSelect:a})=>e.jsxs("div",{style:{margin:"15px 0"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"white",opacity:.8,display:"block",marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:ge.map(d=>e.jsx("div",{onClick:()=>a(d),style:{width:"28px",height:"28px",borderRadius:"50%",background:d,cursor:"pointer",border:t===d?"3px solid white":"1px solid transparent",boxShadow:t===d?"0 0 10px "+d:"none",transform:t===d?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},d))})]}),Ke=({children:t,title:a,sub:d,onClose:u,error:x})=>e.jsx("div",{className:"modal-overlay",onClick:u,children:e.jsxs("div",{className:"modal-content",onClick:k=>k.stopPropagation(),children:[e.jsx("button",{onClick:u,style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:"pointer",zIndex:10},children:e.jsx(ct,{size:18})}),e.jsxs("div",{style:{padding:"30px 20px",textAlign:"center"},children:[a&&e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"8px",fontWeight:"800",background:"linear-gradient(to right, #fff, #aaa)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:a}),d&&e.jsx("p",{style:{opacity:.7,fontSize:"0.95rem",marginBottom:"30px"},children:d}),t,x&&e.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",padding:"12px",borderRadius:"10px",marginTop:"20px",fontSize:"0.9rem",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["âš ï¸ ",x]})]})]})}),rt=({onComplete:t,initialData:a,user:d,isMobile:u})=>{const x=a||d,[k,v]=s.useState(x?"profile_view":"landing"),[n,r]=s.useState(x?.nickname||""),[g,w]=s.useState(""),[m,p]=s.useState(x?Ve.find(f=>f.name===x.className):null),[R,D]=s.useState(x?.color||ge[Math.floor(Math.random()*ge.length)]),[E,b]=s.useState(""),[S,_]=s.useState(""),[c,l]=s.useState([]),[j,h]=s.useState(null),[y,z]=s.useState(!1),[N,A]=s.useState("");s.useEffect(()=>{x&&v("profile_view")},[x]);const L=()=>{r(""),w(""),p(null),b(""),_(""),h(null),A(""),l([]),D(ge[Math.floor(Math.random()*ge.length)])},F=()=>{A(""),v("landing")};s.useEffect(()=>{k==="join_camp"&&ne()},[k]);const ne=async()=>{z(!0);try{console.log("[Profile] Fetching active camps...");const W=(await Be(P(I,"camps"))).docs.map(T=>({id:T.id,...T.data()}));l(W),console.log("[Profile] Camps found:",W.length)}catch(f){console.error("[Profile] Error fetching camps:",f),A("ì˜ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{z(!1)}},se=async f=>{f.preventDefault(),z(!0),A("");try{console.log("[Auth] Attempting login for:",n);const W=await ye(M(I,"users_v2",n));if(!W.exists())throw new Error("ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ëª¨í—˜ê°€ìž…ë‹ˆë‹¤.");const T=W.data();if(T.password!==g)throw new Error("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");if(console.log("[Auth] Login successful:",T),T.campId)try{await oe(M(I,"camps",T.campId),{members:et(n)})}catch(U){console.error("[Auth] Failed to update camp member list:",U)}localStorage.setItem("bg3_user_profile",JSON.stringify(T)),t(T)}catch(W){console.error("[Auth] Login failed:",W),A(W.message)}finally{z(!1)}},ce=async()=>{if(!n||!g||!m||!E||!S){A("ëª¨ë“  ì •ë³´ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}z(!0);try{console.log("[Camp] Creating new camp:",E);const f=M(I,"users_v2",n);if((await ye(f)).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ë‹‰ë„¤ìž„ìž…ë‹ˆë‹¤.");const T=E.trim(),U=M(I,"camps",T);if((await ye(U)).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ì˜ì§€ ì´ë¦„ìž…ë‹ˆë‹¤.");const $={id:n,nickname:n,password:g,className:m.name,classId:m.id,color:R,isAdmin:!0,campId:T,createdAt:new Date().toISOString()},V={id:T,name:E,password:S,leaderId:n,members:[n],createdAt:new Date().toISOString()};await je(f,$),await je(U,V),console.log("[Camp] Camp and Admin created successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify($)),t($)}catch(f){console.error("[Camp] Creation failed:",f),A(f.message)}finally{z(!1)}},pe=async()=>{if(!n||!g||!m||!j||!S){A("ëª¨ë“  ì •ë³´ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}z(!0);try{console.log("[Camp] Joining camp:",j);const f=M(I,"users_v2",n);if((await ye(f)).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ë‹‰ë„¤ìž„ìž…ë‹ˆë‹¤. (ë¡œê·¸ì¸ í•˜ì„¸ìš”)");const T=M(I,"camps",j),U=await ye(T);if(!U.exists())throw new Error("ì˜ì§€ê°€ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");const O=U.data();if(O.password!==S)throw new Error("ì˜ì§€ ìž…ìž¥ ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");if(O.members&&O.members.length>=4)throw new Error("ì˜ì§€ ì •ì›ì´ ê½‰ ì°¼ìŠµë‹ˆë‹¤. (ìµœëŒ€ 4ëª…)");const $={id:n,nickname:n,password:g,className:m.name,classId:m.id,color:R,isAdmin:!1,campId:j,createdAt:new Date().toISOString()};await je(f,$),await oe(T,{members:et(n)}),console.log("[Camp] Joined successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify($)),t($)}catch(f){console.error("[Camp] Join failed:",f),A(f.message)}finally{z(!1)}},o=()=>{confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(localStorage.removeItem("bg3_user_profile"),t(null),v("landing"),L())};if(k==="profile_view"&&x){const[f,W]=s.useState(!1),[T,U]=s.useState(x.nickname),[O,$]=s.useState(Ve.find(q=>q.name===x.className)),[V,me]=s.useState(x.color||ge[0]),[De,Ee]=s.useState(!1),Ae=async()=>{if(!T.trim())return alert("ë‹‰ë„¤ìž„ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.");Ee(!0);try{const q=M(I,"users_v2",x.id),he={nickname:T,className:O?.name||x.className,classId:O?.id||x.classId,color:V};await oe(q,he);const Te={...x,...he};localStorage.setItem("bg3_user_profile",JSON.stringify(Te)),alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (ìƒˆë¡œê³ ì¹¨ ê¶Œìž¥)"),window.location.reload()}catch(q){console.error(q),alert("ìˆ˜ì • ì‹¤íŒ¨: "+q.message)}finally{Ee(!1)}};return f?e.jsxs("div",{className:"glass-panel",style:{maxWidth:"500px",width:"100%",margin:u?"20px auto":"40px auto",padding:"30px",textAlign:"center",position:"relative"},children:[e.jsx("h3",{style:{fontSize:"1.5rem",marginBottom:"25px",color:"white"},children:"í”„ë¡œí•„ ìˆ˜ì •"}),e.jsxs("div",{style:{textAlign:"left",display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.9rem",opacity:.7,marginLeft:"5px",marginBottom:"5px",display:"block"},children:"ë‹‰ë„¤ìž„"}),e.jsx("input",{value:T,onChange:q=>U(q.target.value),style:G})]}),e.jsx(Xe,{selected:V,onSelect:me}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.9rem",opacity:.7,marginLeft:"5px",marginBottom:"5px",display:"block"},children:"ì§ì—…"}),e.jsx(qe,{selected:O,onSelect:$})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"30px"},children:[e.jsx("button",{onClick:()=>W(!1),style:{flex:1,padding:"15px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:"å–æ¶ˆ"}),e.jsx("button",{onClick:Ae,style:{flex:2,padding:"15px",borderRadius:"12px",background:"var(--accent-color)",border:"none",color:"white",fontWeight:"bold",cursor:"pointer"},disabled:De,children:De?"ì €ìž¥ ì¤‘...":"ì €ìž¥í•˜ê¸°"})]})]}):e.jsxs("div",{className:"glass-panel",style:{maxWidth:"450px",width:"100%",margin:u?"20px auto 80px":"40px auto",padding:"40px",textAlign:"center"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"30px"},children:[e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",background:x.color||m?.color||"gray",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 30px ${x.color||m?.color||"gray"}`},children:m&&e.jsx(m.icon,{size:50,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.8rem",margin:"0 0 8px",fontWeight:"bold"},children:x.nickname}),e.jsx("span",{style:{fontSize:"0.95rem",opacity:.8,background:"rgba(255,255,255,0.1)",padding:"6px 12px",borderRadius:"20px"},children:x.className})]}),e.jsxs("div",{style:{textAlign:"left",background:"rgba(0,0,0,0.2)",padding:"25px",borderRadius:"16px"},children:[e.jsxs("p",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"15px",marginBottom:"15px"},children:[e.jsx("span",{style:{opacity:.6},children:"ì†Œì† ì•¼ì˜ì§€"}),e.jsx("b",{style:{fontSize:"1.1rem"},children:x.campId})]}),e.jsxs("p",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{opacity:.6},children:"ì§ì±…"}),e.jsx("b",{style:{color:x.isAdmin?"#f87171":"#4ade80"},children:x.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),e.jsxs("button",{onClick:()=>W(!0),style:{...re,background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white",marginTop:"30px"},children:[e.jsx(we,{size:18})," ì •ë³´ ìˆ˜ì •"]}),e.jsxs("button",{onClick:o,style:{...re,background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",marginTop:"10px"},children:[e.jsx(at,{size:18}),"ë¡œê·¸ì•„ì›ƒ"]})]})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsx("div",{className:"glass-panel",style:{maxWidth:"1000px",width:"100%",padding:u?"30px 20px":"60px 60px",textAlign:"center",minHeight:u?"auto":"550px",display:"flex",alignItems:"center",justifyContent:"center",margin:0},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:u?"20px":"60px",width:"100%"},children:[e.jsx("div",{style:{flex:"1 1 300px",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",maxWidth:u?"240px":"420px",width:"100%"},children:[e.jsx("img",{src:te,alt:"Logo",onClick:()=>window.location.reload(),title:"ìƒˆë¡œê³ ì¹¨",style:{width:"100%",cursor:"pointer",transition:"transform 0.3s ease",display:"block"},onMouseOver:f=>f.currentTarget.style.transform="scale(1.03)",onMouseOut:f=>f.currentTarget.style.transform="scale(1)"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${te})`,maskImage:`url(${te})`}})]})}),e.jsxs("div",{style:{flex:"1 1 300px",display:"flex",flexDirection:"column",gap:"20px",maxWidth:"350px",width:"100%"},children:[e.jsxs("button",{onClick:()=>{L(),v("login")},style:{...re,background:"rgba(255,255,255,0.08)",color:"white",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(Dt,{size:20}),"ê¸°ì¡´ ëª¨í—˜ê°€ ë¡œê·¸ì¸"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",opacity:.3,fontSize:"0.8rem"},children:[e.jsx("div",{style:{flex:1,height:"1px",background:"white"}}),e.jsx("span",{children:"OR"}),e.jsx("div",{style:{flex:1,height:"1px",background:"white"}})]}),e.jsxs("button",{onClick:()=>{L(),v("join_camp")},style:{...re,background:"linear-gradient(45deg, #7c3aed, #db2777)",color:"white",boxShadow:"0 4px 15px rgba(124, 58, 237, 0.3)"},children:[e.jsx(H,{size:20}),"ì•¼ì˜ì§€ í•©ë¥˜í•˜ê¸° (ì¼ë°˜)"]}),e.jsxs("button",{onClick:()=>{L(),v("create_camp")},style:{...re,background:"linear-gradient(45deg, #ef4444, #f97316)",color:"white",boxShadow:"0 4px 15px rgba(239, 68, 68, 0.3)"},children:[e.jsx(Le,{size:20}),"ìƒˆ ì•¼ì˜ì§€ ê±´ì„¤ (ê´€ë¦¬ìž)"]}),e.jsxs("p",{style:{marginTop:"10px",opacity:.8,fontSize:u?"0.75rem":"0.9rem",lineHeight:"1.5",fontWeight:"400",textAlign:"center",color:"rgba(255,255,255,0.7)"},children:["ë™ë£Œë“¤ê³¼ í•¨ê»˜ ë‚˜ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.",e.jsx("br",{}),e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ 3 ì›ì •ëŒ€"}),"ë¥¼ ìœ„í•œ",e.jsx("br",{}),"í•„ìˆ˜ ì»´íŒ¨ë‹ˆì–¸ ì•±"]})]})]})})}),k==="login"&&e.jsx(Ke,{title:"ë¡œê·¸ì¸",sub:"ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”, ëª¨í—˜ê°€ë‹˜.",onClose:F,error:N,children:e.jsxs("form",{onSubmit:se,children:[e.jsx("input",{type:"text",placeholder:"ë‹‰ë„¤ìž„",value:n,onChange:f=>r(f.target.value),style:G}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",value:g,onChange:f=>w(f.target.value),style:G}),e.jsx("button",{type:"submit",style:{...re,background:"white",color:"black",marginTop:"20px"},disabled:y,children:y?"ì¸ì¦ í™•ì¸ ì¤‘...":"ì•¼ì˜ì§€ ìž…ìž¥"})]})}),k==="create_camp"&&e.jsxs(Ke,{title:"ì•¼ì˜ì§€ ê±´ì„¤",sub:"ë‹¹ì‹ ë§Œì˜ íŒŒí‹°ë¥¼ ì´ëŒì–´ë³´ì„¸ìš”.",onClose:F,error:N,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#fca5a5",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ê´€ë¦¬ìž(ì˜ì£¼) ì •ë³´"}),e.jsx("input",{type:"text",placeholder:"ì˜ì£¼ ë‹‰ë„¤ìž„",value:n,onChange:f=>r(f.target.value),style:G}),e.jsx("input",{type:"password",placeholder:"ê°œì¸ ë¹„ë°€ë²ˆí˜¸",value:g,onChange:f=>w(f.target.value),style:{...G,marginBottom:0}})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#c4b5fd",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ì˜ì§€(Room) ì„¤ì •"}),e.jsx("input",{type:"text",placeholder:"ì•¼ì˜ì§€ ì´ë¦„ (IDë¡œ ì‚¬ìš©ë¨)",value:E,onChange:f=>b(f.target.value),style:G}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ìž…ìž¥ ì•”í˜¸ (íŒ€ì› ê³µìœ ìš©)",value:S,onChange:f=>_(f.target.value),style:{...G,borderColor:"#818cf8",color:"#818cf8",marginBottom:0}})]}),e.jsx(Xe,{selected:R,onSelect:D}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"5px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(qe,{selected:m,onSelect:p})]}),e.jsx("button",{onClick:ce,style:{...re,background:"#ef4444",color:"white"},disabled:y,children:y?"ì˜í†  ì„ í¬ ì¤‘...":"ê±´ì„¤ ì™„ë£Œ ë° ìž…ìž¥"})]}),k==="join_camp"&&e.jsxs(Ke,{title:"ì•¼ì˜ì§€ í•©ë¥˜",sub:"ë™ë£Œë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤.",onClose:F,error:N,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[!j&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("span",{style:{opacity:.7,fontSize:"0.9rem"},children:"ì°¸ì—¬ ê°€ëŠ¥í•œ ì˜ì§€"}),e.jsxs("button",{onClick:ne,style:{background:"none",border:"none",color:"var(--accent-color)",cursor:"pointer",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(we,{size:12})," ëª©ë¡ ê°±ì‹ "]})]}),e.jsx("div",{style:{maxHeight:"250px",overflowY:"auto",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"10px",background:"rgba(0,0,0,0.2)"},children:y&&c.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"íƒìƒ‰ ì¤‘..."}):c.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"í™œì„±í™”ëœ ì˜ì§€ê°€ ì—†ìŠµë‹ˆë‹¤."}):c.map(f=>e.jsxs("div",{onClick:()=>h(f.id),style:{padding:"16px",marginBottom:"8px",borderRadius:"10px",cursor:"pointer",background:"rgba(255,255,255,0.05)",border:"1px solid transparent",transition:"all 0.2s",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseOver:W=>{W.currentTarget.style.background="rgba(255,255,255,0.1)",W.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseOut:W=>{W.currentTarget.style.background="rgba(255,255,255,0.05)",W.currentTarget.style.borderColor="transparent"},children:[e.jsxs("span",{style:{fontWeight:"bold"},children:["ðŸ° ",f.name]}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.7,background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"4px"},children:[f.members?.length||0,"/4ëª…"]})]},f.id))})]}),j&&e.jsxs("div",{style:{animation:"fadeIn 0.3s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("button",{onClick:()=>h(null),style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"â†"}),e.jsx("h3",{style:{margin:0,fontSize:"1.2rem"},children:c.find(f=>f.id===j)?.name})]}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ìž…ìž¥ ì•”í˜¸",value:S,onChange:f=>_(f.target.value),style:{...G,borderColor:"#818cf8",color:"#818cf8"}}),e.jsx("div",{style:{height:"10px"}}),e.jsx("input",{type:"text",placeholder:"ë‚´ ë‹‰ë„¤ìž„",value:n,onChange:f=>r(f.target.value),style:G}),e.jsx("input",{type:"password",placeholder:"ë‚´ ë¹„ë°€ë²ˆí˜¸",value:g,onChange:f=>w(f.target.value),style:G}),e.jsx(Xe,{selected:R,onSelect:D}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"15px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(qe,{selected:m,onSelect:p})]})]}),j&&e.jsx("button",{onClick:pe,style:{...re,background:"var(--accent-color)",color:"white"},disabled:y,children:y?"ìž…ìž¥ ì¤‘...":"í•©ë¥˜í•˜ê¸°"})]})]})},Jt=({user:t})=>{const[a,d]=s.useState([]),[u,x]=s.useState(!0);s.useEffect(()=>{if(!t?.campId)return;const n=K(P(I,"users_v2"),X("campId","==",t.campId)),r=J(n,g=>{const w=g.docs.map(m=>({id:m.id,...m.data()}));d(w),x(!1)});return()=>r()},[t?.campId]);const k=async n=>{if(window.confirm(`ì •ë§ '${n.nickname}' ë‹˜ì„ ì˜ì§€ì—ì„œ ì¶”ë°©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await Ye(M(I,"users_v2",n.id));const r=M(I,"camps",t.campId);await oe(r,{members:Tt(n.nickname)}),alert("ì¶”ë°©ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(r){console.error("Kick failed:",r),alert("ì¶”ë°© ì‹¤íŒ¨: "+r.message)}},v=async()=>{if(!window.confirm(`âš ï¸ ê²½ê³ : ì˜ì§€ë¥¼ í­íŒŒí•˜ë©´ ëª¨ë“  ë°ì´í„°ì™€ ë©¤ë²„ê°€ ì‚­ì œë©ë‹ˆë‹¤.
ì •ë§ ì´ ì•¼ì˜ì§€ë¥¼ í•´ì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;if(prompt("ì˜ì§€ë¥¼ ì‚­ì œí•˜ë ¤ë©´ 'ì˜ì§€ í­íŒŒ'ë¼ê³  ìž…ë ¥í•˜ì„¸ìš”.")!=="ì˜ì§€ í­íŒŒ")return alert("ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");try{x(!0);const g=Nt(I),w=M(I,"camps",t.campId);g.delete(w),a.forEach(R=>{const D=M(I,"users_v2",R.id);g.delete(D)});const m=K(P(I,"chats"),X("campId","==",t.campId));(await Be(m)).forEach(R=>{g.delete(R.ref)}),await g.commit(),alert("ì•¼ì˜ì§€ê°€ ì—­ì‚¬ ì†ìœ¼ë¡œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤."),window.location.reload()}catch(g){console.error("Destroy failed:",g),alert("ì‚­ì œ ì‹¤íŒ¨: "+g.message)}finally{x(!1)}};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"30px",marginBottom:"30px",border:"1px solid var(--accent-color)",background:"rgba(50, 0, 0, 0.3)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 10px",color:"#fca5a5"},children:[e.jsx(ae,{})," ì˜ì£¼ ê´€ë¦¬ì‹¤ (Admin)"]}),e.jsxs("p",{style:{opacity:.8,fontSize:"0.9rem"},children:["í˜„ìž¬ ì•¼ì˜ì§€: ",e.jsx("b",{children:t.campId})," ",e.jsx("br",{}),"ê¶Œí•œ: ",e.jsx("span",{style:{color:"var(--accent-color)"},children:"Master"})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs("h3",{style:{margin:0,fontSize:"1.1rem"},children:["ëŒ€ì› ëª©ë¡ (",a.length,"/4)"]})}),a.map(n=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"50%",background:n.isAdmin?"var(--accent-color)":"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:n.isAdmin?e.jsx(Le,{size:22,color:"white"}):e.jsx(ue,{size:22})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[n.nickname,e.jsx("span",{style:{fontSize:"0.7rem",padding:"3px 8px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",opacity:.8},children:n.className||"ëª¨í—˜ê°€"})]}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.5,marginTop:"4px"},children:n.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),!n.isAdmin&&e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:async()=>{if(window.confirm(`'${n.nickname}' ë‹˜ì„ ê´€ë¦¬ìžë¡œ ìž„ëª…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{const{updateDoc:r,doc:g}=await Me(async()=>{const{updateDoc:w,doc:m}=await import("./vendor-D1cCnfCH.js").then(p=>p.am);return{updateDoc:w,doc:m}},[]);await r(g(I,"users_v2",n.id),{isAdmin:!0,role:"Admin"}),alert(`${n.nickname} ë‹˜ì´ ê´€ë¦¬ìžê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(r){console.error(r),alert("ê¶Œí•œ ë¶€ì—¬ ì‹¤íŒ¨: "+r.message)}},style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(74, 222, 128, 0.1)",border:"1px solid rgba(74, 222, 128, 0.3)",color:"#4ade80",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Le,{size:16})," ìž„ëª…"]}),e.jsxs("button",{onClick:()=>k(n),style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Et,{size:16})," ì¶”ë°©"]})]})]},n.id)),a.length===0&&!u&&e.jsx("div",{style:{padding:"40px",textAlign:"center",opacity:.5},children:"ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤."})]}),e.jsxs("div",{style:{marginTop:"50px",borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"30px"},children:[e.jsxs("h3",{style:{color:"#ef4444",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(At,{})," ìœ„í—˜ êµ¬ì—­"]}),e.jsxs("div",{className:"glass-panel",style:{borderColor:"#ef4444",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 5px"},children:"ì˜ì§€ í­íŒŒ"}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:"ì´ ì•¼ì˜ì§€ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤."})]}),e.jsx("button",{onClick:v,style:{background:"#ef4444",color:"white",border:"none",padding:"12px 20px",borderRadius:"8px",fontWeight:"bold",cursor:"pointer"},children:"í­íŒŒ ì‹¤í–‰"})]})]})]})},xt=({user:t,tacticId:a,initialData:d,onBack:u,isMobile:x,isStandalone:k})=>{const[v,n]=s.useState(d?.elements||[]),[r,g]=s.useState(d?.viewState||{x:0,y:0,scale:1}),[w,m]=s.useState(null),[p,R]=s.useState("select"),[D,E]=s.useState(null),[b,S]=s.useState(""),[_,c]=s.useState(!1),[l,j]=s.useState(!1),[h,y]=s.useState({x:0,y:0}),[z,N]=s.useState({x:0,y:0}),[A,L]=s.useState("saved"),F=s.useRef(null),ne=s.useRef(null),se=s.useRef(!1),ce=s.useRef(l),pe=s.useRef(_),o=s.useRef(D);s.useEffect(()=>{ce.current=l},[l]),s.useEffect(()=>{pe.current=_},[_]),s.useEffect(()=>{o.current=D},[D]),s.useEffect(()=>{if(!a)return;const i=J(M(I,"tactics",a),C=>{if(C.exists()){const B=C.data();!ce.current&&!pe.current&&!o.current&&(se.current=!0,n(B.elements||[]))}});return()=>i()},[a]);const f=s.useCallback(i=>{L("saving"),ne.current&&clearTimeout(ne.current),ne.current=setTimeout(async()=>{if(!(!a||!t?.nickname))try{const C=M(I,"tactics",a);await oe(C,{elements:i,lastModified:de(),lastModifiedBy:t.nickname}),L("saved")}catch(C){console.error("Save failed",C),L("error")}},1e3)},[a,t.nickname]);s.useEffect(()=>{if(se.current){se.current=!1;return}f(v)},[v,f]);const W=i=>{p==="select"&&i.target===F.current&&(i.target.setPointerCapture(i.pointerId),c(!0),y({x:i.clientX,y:i.clientY}),m(null),E(null))},T=(i,C)=>{if(i.stopPropagation(),p!=="select")return;i.currentTarget.setPointerCapture(i.pointerId),m(C.id),j(!0);const B=F.current.getBoundingClientRect(),Y=i.clientX-B.left,Z=i.clientY-B.top,ee=(Y-r.x)/r.scale,ie=(Z-r.y)/r.scale;N({x:ee-C.x,y:ie-C.y}),y({x:i.clientX,y:i.clientY})},U=i=>{if(i.type==="text")E(i.id),S(i.content);else if(i.type==="video"){const C=i.content.startsWith("http")?i.content:"",B=prompt("ìœ íŠœë¸Œ ì˜ìƒ URLì„ ìž…ë ¥í•˜ì„¸ìš”:",C);B&&Ae(i.id,{content:B})}},O=(i,C)=>{i.stopPropagation(),U(C)},$=()=>{const i=v.find(C=>C.id===w);i&&U(i)},V=i=>{if(_){const C=i.clientX-h.x,B=i.clientY-h.y;g(Y=>({...Y,x:Y.x+C,y:Y.y+B})),y({x:i.clientX,y:i.clientY})}if(l&&w){const C=F.current.getBoundingClientRect(),B=i.clientX-C.left,Y=i.clientY-C.top,Z=(B-r.x)/r.scale,ee=(Y-r.y)/r.scale;n(ie=>ie.map(fe=>fe.id===w?{...fe,x:Z-z.x,y:ee-z.y}:fe)),y({x:i.clientX,y:i.clientY})}},me=i=>{c(!1),j(!1)},De=()=>{w&&(n(i=>i.filter(C=>C.id!==w)),m(null),E(null))},Ee=i=>{if(i.ctrlKey||i.metaKey){i.preventDefault();const B=-i.deltaY*.001,Y=Math.min(Math.max(r.scale+B,.1),5);g(Z=>({...Z,scale:Y}))}else g(C=>({...C,x:C.x-i.deltaX,y:C.y-i.deltaY}))},Ae=(i,C)=>{n(B=>B.map(Y=>Y.id===i?{...Y,...C}:Y))},q=i=>{const C=Date.now().toString(),B=(-r.x+window.innerWidth/2)/r.scale,Y=(-r.y+window.innerHeight/2)/r.scale;let Z="",ee=100,ie=100;i==="text"&&(Z="ë”ë¸”í´ë¦­ íŽ¸ì§‘",ee=200),i==="video"&&(ee=300,ie=200),i==="member"&&(Z="íŒŒí‹°ì›",ee=60,ie=80);const fe={id:C,type:i,x:B-ee/2,y:Y-ie/2,content:Z,width:ee,height:ie,color:"#ffffff"};n(gt=>[...gt,fe]),R("select")},he=()=>{D&&(Ae(D,{content:b}),E(null))},Te=i=>{if(!i)return null;const C=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,B=i.match(C);return B&&B[2]?.length===11?B[2]:null};return e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden",background:"#111116",position:"relative"},children:[e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,zIndex:100,padding:"15px 25px",background:"linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%)",display:"flex",alignItems:"center",justifyContent:"space-between",pointerEvents:"none"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",pointerEvents:"auto"},children:[!k&&e.jsx("button",{onClick:u,style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer",padding:"10px",borderRadius:"50%",backdropFilter:"blur(5px)"},children:e.jsx(dt,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.1rem",fontWeight:"bold",color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:d.title||"ì „ìˆ  íŽ¸ì§‘"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:A==="saved"?"#4ade80":A==="saving"?"#facc15":"#ef4444",boxShadow:A==="saving"?"0 0 10px #facc15":"none"}}),e.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:A==="saved"?"ì €ìž¥ë¨":A==="saving"?"ì €ìž¥ ì¤‘...":"ì €ìž¥ ì‹¤íŒ¨"})]})]})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8,display:"flex",gap:"10px",alignItems:"center",pointerEvents:"auto"},children:[e.jsxs("button",{onClick:()=>window.open(`?tacticId=${a}`,"_blank"),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px",padding:"8px 14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",backdropFilter:"blur(5px)"},title:"ìƒˆ íƒ­ì—ì„œ ê½‰ ì°¬ í™”ë©´ìœ¼ë¡œ ì—´ê¸°",children:[e.jsx(Wt,{size:14})," ",x?"":"ìƒˆ ì°½"]}),w&&e.jsxs(e.Fragment,{children:[(v.find(i=>i.id===w)?.type==="text"||v.find(i=>i.id===w)?.type==="video")&&e.jsxs("button",{onClick:$,style:{background:"#3b82f6",border:"none",color:"white",borderRadius:"8px",padding:"8px 14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px",boxShadow:"0 4px 10px rgba(59, 130, 246, 0.3)"},children:[e.jsx(_t,{size:14})," íŽ¸ì§‘"]}),e.jsx("button",{onClick:De,style:{background:"#ef4444",border:"none",color:"white",borderRadius:"8px",padding:"8px 14px",cursor:"pointer",boxShadow:"0 4px 10px rgba(239, 68, 68, 0.3)"},children:"ì‚­ì œ"})]})]})]}),e.jsx("div",{ref:F,style:{flex:1,cursor:_?"grabbing":"grab",touchAction:"none"},onPointerDown:W,onPointerMove:V,onPointerUp:me,onWheel:Ee,children:e.jsxs("div",{style:{transform:`translate(${r.x}px, ${r.y}px) scale(${r.scale})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:-5e3,left:-5e3,width:1e4,height:1e4,backgroundImage:"radial-gradient(rgba(255,255,255,0.08) 1px, transparent 1px)",backgroundSize:"40px 40px",pointerEvents:"none"}}),v.map(i=>e.jsxs("div",{onPointerDown:C=>T(C,i),onDoubleClick:C=>O(C,i),style:{position:"absolute",left:i.x,top:i.y,width:i.width||"auto",height:i.height||"auto",padding:"10px",border:w===i.id?"2px solid var(--accent-color)":"1px solid transparent",borderRadius:"12px",userSelect:"none",cursor:"move",transform:w===i.id?"scale(1.02)":"scale(1)",transition:l&&w===i.id?"none":"transform 0.1s",background:i.type==="text"?"transparent":"rgba(30, 30, 40, 0.6)",backdropFilter:i.type!=="text"?"blur(8px)":"none",boxShadow:i.type!=="text"?"0 4px 20px rgba(0,0,0,0.3)":"none"},children:[i.type==="text"&&(D===i.id?e.jsx("input",{autoFocus:!0,value:b,onChange:C=>S(C.target.value),onBlur:he,onKeyDown:C=>C.key==="Enter"&&he(),onPointerDown:C=>C.stopPropagation(),style:{background:"rgba(0,0,0,0.5)",border:"1px solid var(--accent-color)",color:"white",fontSize:"1.2rem",padding:"8px",width:"200px",borderRadius:"8px",outline:"none"}}):e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.8)",padding:"5px"},children:i.content})),(i.type==="npc"||i.type==="mob")&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:i.type==="npc"?"linear-gradient(135deg, #4ade80, #22c55e)":"linear-gradient(135deg, #ef4444, #dc2626)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 10px rgba(0,0,0,0.4)",border:"2px solid rgba(255,255,255,0.2)"},children:i.type==="npc"?e.jsx(ue,{size:28,color:"white"}):e.jsx(le,{size:28,color:"white"})}),e.jsx("span",{style:{fontSize:"0.75rem",marginTop:"6px",background:"rgba(0,0,0,0.8)",color:"white",padding:"2px 8px",borderRadius:"10px",fontWeight:"bold"},children:i.type==="npc"?"ì „ìš°":"ì êµ°"})]}),i.type==="member"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #2563eb)",border:"2px solid rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 15px rgba(59, 130, 246, 0.4)"},children:e.jsx(H,{size:26,color:"white"})}),e.jsx("span",{style:{fontSize:"0.75rem",marginTop:"6px",background:"rgba(0,0,0,0.8)",color:"white",padding:"2px 8px",borderRadius:"10px",fontWeight:"bold"},children:"íŒŒí‹°ì›"})]}),i.type==="video"&&e.jsxs("div",{style:{width:"300px",height:"180px",background:"black",borderRadius:"8px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(255,255,255,0.2)"},children:[Te(i.content)?e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${Te(i.content)}`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{pointerEvents:p==="select"?"none":"auto"}}):e.jsxs("div",{style:{color:"rgba(255,255,255,0.5)",textAlign:"center",padding:"20px"},children:[e.jsx(tt,{size:40,style:{marginBottom:"10px"}}),e.jsxs("p",{style:{fontSize:"0.9rem"},children:["ë”ë¸” í´ë¦­í•˜ì—¬",e.jsx("br",{}),"ìœ íŠœë¸Œ ë§í¬ ìž…ë ¥"]})]}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:"20px",background:"rgba(255,255,255,0.1)",cursor:"move"}})]})]},i.id))]})}),e.jsxs("div",{style:{position:"absolute",bottom:"30px",left:"50%",transform:"translateX(-50%)",background:"rgba(20,20,30,0.7)",backdropFilter:"blur(20px) saturate(180%)",padding:"8px 12px",borderRadius:"24px",display:"flex",gap:"8px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 20px 40px rgba(0,0,0,0.4)",zIndex:101,overflowX:"auto",maxWidth:"90vw"},children:[e.jsx(xe,{icon:Bt,active:p==="select",onClick:()=>R("select"),label:"ì„ íƒ"}),e.jsx("div",{style:{width:"1px",background:"rgba(255,255,255,0.1)",margin:"0 5px"}}),e.jsx(xe,{icon:Lt,active:p==="text",onClick:()=>q("text"),label:"í…ìŠ¤íŠ¸"}),e.jsx(xe,{icon:H,active:p==="member",onClick:()=>q("member"),label:"íŒŒí‹°ì›"}),e.jsx(xe,{icon:ue,active:p==="npc",onClick:()=>q("npc"),label:"NPC"}),e.jsx(xe,{icon:le,active:p==="mob",onClick:()=>q("mob"),label:"ì "}),e.jsx(xe,{icon:tt,active:p==="video",onClick:()=>q("video"),label:"ì˜ìƒ"})]})]})},xe=({icon:t,active:a,onClick:d,label:u})=>e.jsx("button",{onClick:d,style:{background:a?"var(--accent-color)":"transparent",border:"none",color:a?"white":"rgba(255,255,255,0.6)",padding:"10px",borderRadius:"50%",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",minWidth:"50px",transition:"all 0.2s"},title:u,children:e.jsx(t,{size:24})}),Vt=({user:t,initialTacticId:a,clearInitialTactic:d})=>{const[u,x]=s.useState([]),[k,v]=s.useState(!0),[n,r]=s.useState(!1),[g,w]=s.useState(0),[m,p]=s.useState(null),[R,D]=s.useState(""),[E,b]=s.useState("");s.useEffect(()=>{if(!t?.campId)return;const c=K(P(I,"tactics"),X("campId","==",t.campId),We("createdAt","desc")),l=J(c,j=>{const h=j.docs.map(y=>({id:y.id,...y.data()}));x(h),v(!1)},j=>{console.error("Error fetching tactics:",j),v(!1)});return()=>l()},[t?.campId,g]),s.useEffect(()=>{if(a&&u.length>0){const c=u.find(l=>l.id===a);c&&(p(c),d&&d())}},[a,u,d]);const S=async c=>{if(c.preventDefault(),!!R.trim()){if(!t.campId){alert("ì†Œì†ëœ ì˜ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");return}try{console.log("Creating tactic...",{campId:t.campId,author:t.nickname,title:R});const l={campId:t.campId,authorId:t.id||t.nickname,authorName:t.nickname,title:R,description:E,createdAt:de(),elements:[]},j=await Re(P(I,"tactics"),l);console.log("Tactic created successfully"),v(!0),w(h=>h+1),r(!1),D(""),b(""),p({id:j.id,...l})}catch(l){console.error("Error creating tactic:",l),alert("ì „ìˆ íŒ ìƒì„± ì‹¤íŒ¨: "+l.code+" - "+l.message)}}},_=async(c,l)=>{if(c.stopPropagation(),!!confirm("ì •ë§ë¡œ ì´ ì „ìˆ íŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await Ye(M(I,"tactics",l))}catch(j){console.error("Error deleting tactic:",j),alert("ì‚­ì œ ì‹¤íŒ¨")}};return e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"1.8rem",fontWeight:"bold",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(be,{className:"text-accent"}),"ì „ìˆ  ìž‘ì „ì‹¤"]}),e.jsx("p",{style:{opacity:.6,fontSize:"0.9rem",marginTop:"5px"},children:"íŒŒí‹°ì›ë“¤ê³¼ í•¨ê»˜ ìž‘ì „ì„ ìˆ˜ë¦½í•˜ê³  ê³µìœ í•˜ì„¸ìš”."})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>{v(!0),w(c=>c+1)},className:"glass-button",style:{background:"rgba(255,255,255,0.1)",color:"white",border:"none",padding:"12px",borderRadius:"12px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"ìƒˆë¡œê³ ì¹¨",children:e.jsx(we,{size:20})}),e.jsxs("button",{onClick:()=>r(!0),className:"glass-button",style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 20px",borderRadius:"12px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 15px rgba(245, 158, 11, 0.4)"},children:[e.jsx(Mt,{size:20}),"ìƒˆ ìž‘ì „ ìˆ˜ë¦½"]})]})]}),k?e.jsx("div",{style:{textAlign:"center",padding:"40px",opacity:.5},children:"ë¡œë”© ì¤‘..."}):u.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",background:"rgba(255,255,255,0.03)",borderRadius:"20px",border:"1px dashed rgba(255,255,255,0.1)"},children:[e.jsx(be,{size:48,style:{opacity:.2,marginBottom:"20px"}}),e.jsx("p",{style:{fontSize:"1.1rem",fontWeight:"bold"},children:"ì•„ì§ ìˆ˜ë¦½ëœ ìž‘ì „ì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{style:{opacity:.6,fontSize:"0.9rem"},children:"ìƒˆ ìž‘ì „ ìˆ˜ë¦½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ë²ˆì§¸ ì „ìˆ íŒì„ ë§Œë“¤ì–´ë³´ì„¸ìš”."})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"20px"},children:u.map(c=>e.jsxs("div",{onClick:()=>p(c),className:"glass-panel",style:{padding:"0",cursor:"pointer",overflow:"hidden",display:"flex",flexDirection:"column",height:"220px",transition:"all 0.2s",position:"relative"},onMouseEnter:l=>l.currentTarget.style.transform="translateY(-5px)",onMouseLeave:l=>l.currentTarget.style.transform="translateY(0)",children:[e.jsx("div",{style:{flex:2,background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsx(be,{size:32,style:{opacity:.1}})}),e.jsxs("div",{style:{flex:1,padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"8px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"80%"},children:c.title}),(t.isAdmin||t.id===c.authorId)&&e.jsx("button",{onClick:l=>_(l,c.id),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",padding:"4px"},children:e.jsx(pt,{size:16})})]}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.description||"ì„¤ëª… ì—†ìŒ"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",fontSize:"0.75rem",opacity:.4},children:[e.jsx("span",{children:c.authorName}),e.jsx("span",{children:c.createdAt?.toDate?.()?c.createdAt.toDate().toLocaleDateString():"ë°©ê¸ˆ ì „"})]})]})]},c.id))}),n&&e.jsx("div",{className:"modal-overlay",onClick:()=>r(!1),children:e.jsxs("div",{className:"modal-content",onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"20px"},children:"ìƒˆ ìž‘ì „ ìˆ˜ë¦½"}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ìž‘ì „ëª…"}),e.jsx("input",{type:"text",value:R,onChange:c=>D(c.target.value),placeholder:"ì˜ˆ: 3ë§‰ ë³´ìŠ¤ ê³µëžµ",style:{width:"100%",padding:"12px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px"},autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"25px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ì„¤ëª… (ì„ íƒ)"}),e.jsx("textarea",{value:E,onChange:c=>b(c.target.value),placeholder:"ìž‘ì „ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ìž…ë ¥í•˜ì„¸ìš”.",style:{width:"100%",padding:"12px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px",minHeight:"80px"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx("button",{type:"button",onClick:()=>r(!1),style:{padding:"10px 20px",borderRadius:"8px",background:"transparent",border:"1px solid rgba(255,255,255,0.2)",color:"white",cursor:"pointer"},children:"ì·¨ì†Œ"}),e.jsx("button",{type:"submit",style:{padding:"10px 20px",borderRadius:"8px",background:"var(--accent-color)",border:"none",color:"white",fontWeight:"bold",cursor:"pointer"},children:"ìƒì„±í•˜ê¸°"})]})]})]})}),m&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2e3,background:"#1a1a1a",animation:"fadeIn 0.2s ease-out"},children:e.jsx(xt,{user:t,tacticId:m.id,initialData:m,onBack:()=>p(null),isMobile:window.innerWidth<768})})]})},Gt=({user:t,isMobile:a,initialTacticId:d,clearInitialTactic:u})=>e.jsx(Vt,{user:t,isMobile:a,initialTacticId:d,clearInitialTactic:u}),Qt=({user:t,onClose:a})=>{const[d,u]=s.useState([]),[x,k]=s.useState(!0);s.useEffect(()=>{if(!t?.campId)return;const n=K(P(I,"users_v2"),X("campId","==",t.campId)),r=J(n,g=>{const w=Date.now(),m=g.docs.map(p=>{const R=p.data(),D=R.lastSeen?.toMillis?R.lastSeen.toMillis():0,E=w-D<120*1e3;return{id:p.id,...R,isOnline:E,lastSeenAgo:Math.floor((w-D)/6e4)}});m.sort((p,R)=>p.isOnline===R.isOnline?p.nickname.localeCompare(R.nickname):R.isOnline?1:-1),u(m),k(!1)});return()=>r()},[t?.campId]);const v=async n=>{if(window.confirm(`${n.nickname}ë‹˜ì„ ì •ë§ ê¹¨ìš°ì‹œê² ìŠµë‹ˆê¹Œ? (ì•Œë¦¼ ë°œì†¡)`))try{await Re(P(I,"camps",t.campId,"notifications"),{type:"WAKE_UP",targetUid:n.id,sender:t.nickname,read:!1,timestamp:de()}),alert("â° ê¸°ìƒ ë‚˜íŒ”ì„ ë¶ˆì—ˆìŠµë‹ˆë‹¤!")}catch(r){console.error(r),alert("ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨")}};return Ne.createPortal(e.jsx("div",{className:"modal-overlay",onClick:a,children:e.jsxs("div",{className:"modal-content",onClick:n=>n.stopPropagation(),style:{maxWidth:"400px",padding:"0",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(H,{className:"text-accent"})," ìƒì¡´ìž ëª©ë¡ (",d.filter(n=>n.isOnline).length,"ëª… ì ‘ì†)"]}),e.jsx("button",{onClick:a,style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"âœ•"})]}),e.jsx("div",{style:{padding:"20px",maxHeight:"400px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px"},children:x?e.jsx("p",{style:{textAlign:"center",opacity:.5},children:"ëª…ë‹¨ í™•ì¸ ì¤‘..."}):d.map(n=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",borderRadius:"12px",background:n.isOnline?"rgba(74, 222, 128, 0.1)":"rgba(255, 255, 255, 0.03)",border:n.isOnline?"1px solid rgba(74, 222, 128, 0.3)":"1px solid rgba(255, 255, 255, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:n.isOnline?"#4ade80":"#94a3b8",boxShadow:n.isOnline?"0 0 10px #4ade80":"none"}}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[n.nickname," ",n.id===t.id&&e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ë‚˜)"})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:[n.className," â€¢ ",n.isOnline?"ì˜¨ë¼ì¸":`${n.lastSeenAgo}ë¶„ ì „ ì ‘ì†`]})]})]}),!n.isOnline&&n.id!==t.id&&e.jsxs("button",{onClick:()=>v(n),style:{padding:"6px 12px",borderRadius:"20px",border:"none",background:"rgba(255,255,255,0.1)",color:"white",fontSize:"0.8rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(Pt,{size:12})," ê¹¨ìš°ê¸°"]})]},n.id))})]})}),document.body)},Zt=()=>{const[t,a]=s.useState("home"),[d,u]=s.useState(window.innerWidth<768),[x,k]=s.useState(0),[v,n]=s.useState(!1),[r,g]=s.useState(!1),[w,m]=s.useState(!1),[p,R]=s.useState(()=>{try{return JSON.parse(localStorage.getItem("bg3_user_profile"))}catch{return null}});if(s.useEffect(()=>{const c=()=>u(window.innerWidth<768);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),s.useEffect(()=>{},[p]),s.useEffect(()=>{if(!p?.id)return;const c=async()=>{try{await oe(M(I,"users_v2",p.id),{lastSeen:de()})}catch(j){console.error("Heartbeat fail",j)}};c();const l=setInterval(c,6e4);return()=>clearInterval(l)},[p?.id]),s.useEffect(()=>{if(!p?.campId)return;const c=K(P(I,"users_v2"),X("campId","==",p.campId)),l=J(c,j=>{k(j.size)});return()=>l()},[p?.campId]),s.useEffect(()=>{if(!p?.campId||!p?.id)return;const c=K(P(I,"camps",p.campId,"notifications"),X("targetUid","==",p.id),X("read","==",!1)),l=J(c,j=>{j.docChanges().forEach(h=>{if(h.type==="added"){const y=h.doc.data();y.type==="WAKE_UP"&&(new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3").play().catch(N=>console.log("Audio play failed",N)),alert(`â° ${y.sender}ë‹˜ì´ ë‹¹ì‹ ì„ ê¹¨ìš°ê³  ìžˆìŠµë‹ˆë‹¤! ì–¼ë¥¸ ì¼ì–´ë‚˜ì„¸ìš”!`),oe(h.doc.ref,{read:!0}))}})});return()=>l()},[p?.campId,p?.id]),!p)return e.jsx(rt,{onComplete:()=>window.location.reload(),isMobile:d});const[D,E]=s.useState(null),b=c=>{E(c),a("tactics")},S=()=>{const c={user:p,isMobile:d,onlineUsersCount:x,setShowSurvivors:n};switch(t){case"home":return e.jsx(it,{...c,setActiveTab:a,openTactic:b,openProfile:()=>g(!0)});case"chat":return e.jsx(qt,{...c,setActiveTab:a});case"calendar":return e.jsx(Xt,{...c});case"save":return e.jsx(Kt,{...c});case"admin":return e.jsx(Jt,{...c});case"tactics":return e.jsx(Gt,{...c,initialTacticId:D,clearInitialTactic:()=>E(null)});case"profile":return e.jsx(rt,{user:p,onComplete:()=>window.location.reload(),isMobile:d});default:return e.jsx(it,{...c,setActiveTab:a,openProfile:()=>g(!0)})}},_=t==="chat"||t==="tactics";return e.jsxs("div",{className:"layout-container",style:{display:"flex",minHeight:"100vh",color:"#e2e8f0",fontFamily:"Pretendard, sans-serif"},children:[e.jsx(Ht,{activeTab:t,setActiveTab:a,isMobile:d,user:p,onlineUsersCount:x,setShowSurvivors:n,showProfileView:r,setShowProfileView:g,showProfileEdit:w,setShowProfileEdit:m}),e.jsx("main",{style:{flex:1,padding:d?t==="chat"?"0 0 80px":"15px 15px 110px":_?"0":"40px",overflowY:"auto",position:"relative"},children:e.jsx("div",{style:{maxWidth:_?"100%":"1400px",margin:"0 auto",width:"100%",height:"100%"},children:S()})}),d&&e.jsx("div",{onClick:()=>g(!0),style:{position:"fixed",top:"15px",right:"15px",zIndex:2500,width:"42px",height:"42px",borderRadius:"50%",background:p?.color||"#a78bfa",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 15px rgba(0,0,0,0.4)",border:"2px solid rgba(255,255,255,0.3)",cursor:"pointer"},children:(()=>{const c=p?.className||"";return c.includes("ë°”ë°”ë¦¬ì•ˆ")?e.jsx(Pe,{size:20,color:"white"}):c.includes("ë°”ë“œ")?e.jsx(ke,{size:20,color:"white"}):c.includes("í´ë ˆë¦­")?e.jsx(Oe,{size:20,color:"white"}):c.includes("ë“œë£¨ì´ë“œ")?e.jsx(Fe,{size:20,color:"white"}):c.includes("íŒŒì´í„°")?e.jsx(Se,{size:20,color:"white"}):c.includes("ëª½í¬")?e.jsx(Ce,{size:20,color:"white"}):c.includes("íŒ”ë¼ë”˜")?e.jsx(ae,{size:20,color:"white"}):c.includes("ë ˆì¸ì €")?e.jsx(Ie,{size:20,color:"white"}):c.includes("ë¡œê·¸")?e.jsx(Ue,{size:20,color:"white"}):c.includes("ì†Œì„œëŸ¬")?e.jsx($e,{size:20,color:"white"}):c.includes("ì›Œë½")?e.jsx(le,{size:20,color:"white"}):c.includes("ìœ„ìžë“œ")?e.jsx(ze,{size:20,color:"white"}):e.jsx(H,{size:20,color:"white"})})()}),v&&e.jsx(Qt,{user:p,onClose:()=>n(!1)})]})};function en(){const a=new URLSearchParams(window.location.search).get("tacticId"),d=JSON.parse(localStorage.getItem("bg3_user_profile")||"null");return a&&d?e.jsx(xt,{user:d,tacticId:a,initialData:{title:"Loading...",elements:[]},onBack:()=>window.close(),isMobile:window.innerWidth<768,isStandalone:!0}):e.jsx(Zt,{})}class tn extends Q.Component{constructor(a){super(a),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,d){this.setState({error:a,errorInfo:d}),console.error("Uncaught error:",a,d)}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",color:"white",background:"#333"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px"},children:"Reload"})]}):this.props.children}}function nn(t={}){const{immediate:a=!1,onNeedRefresh:d,onOfflineReady:u,onRegistered:x,onRegisteredSW:k,onRegisterError:v}=t;let n,r;const g=async(m=!0)=>{await r};async function w(){if("serviceWorker"in navigator){if(n=await Me(async()=>{const{Workbox:m}=await import("./vendor-D1cCnfCH.js").then(p=>p.an);return{Workbox:m}},[]).then(({Workbox:m})=>new m("/bg3-raid-manager/sw.js",{scope:"/bg3-raid-manager/",type:"classic"})).catch(m=>{v?.(m)}),!n)return;n.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),n.addEventListener("installed",m=>{m.isUpdate||u?.()}),n.register({immediate:a}).then(m=>{k?k("/bg3-raid-manager/sw.js",m):x?.(m)}).catch(m=>{v?.(m)})}}return r=w(),g}nn();Ot.createRoot(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(tn,{children:e.jsx(en,{})})}));
