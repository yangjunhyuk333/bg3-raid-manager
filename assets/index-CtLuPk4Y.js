import{i as st,g as at,R as V,H as We,M as Ne,C as he,P as Me,F as it,U as q,j as e,r as ve,L as Ye,S as He,T as rt,a as i,A as qe,b as me,q as K,c as L,o as we,l as ke,d as Se,w as X,e as ot,f as lt,h as Xe,k as dt,m as ct,n as Ke,Z as Je,p as fe,s as Ve,G as pt,t as xt,u as Ce,W as Ge,v as Q,x as Qe,B as gt,y as Ie,X as Ze,I as mt,z as ut,D as be,E as oe,J as ue,K as P,N as ye,O as ht,Q as ft,V as yt,Y as ze,_ as Re,$ as bt,a0 as De,a1 as et,a2 as jt,a3 as vt,a4 as wt,a5 as kt,a6 as St,a7 as re,a8 as ge,a9 as Pe,aa as Ct,ab as It,ac as zt,ad as Rt,ae as Dt,af as Et,ag as Le,ah as At,ai as Tt,aj as Nt,ak as Bt,al as _t}from"./vendor-BbMG-YK6.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))p(l);new MutationObserver(l=>{for(const S of l)if(S.type==="childList")for(const j of S.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&p(j)}).observe(document,{childList:!0,subtree:!0});function o(l){const S={};return l.integrity&&(S.integrity=l.integrity),l.referrerPolicy&&(S.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?S.credentials="include":l.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function p(l){if(l.ep)return;l.ep=!0;const S=o(l);fetch(l.href,S)}})();const Wt="modulepreload",Mt=function(t){return"/bg3-raid-manager/"+t},Oe={},Be=function(r,o,p){let l=Promise.resolve();if(o&&o.length>0){let n=function(x){return Promise.all(x.map(y=>Promise.resolve(y).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const j=document.querySelector("meta[property=csp-nonce]"),s=j?.nonce||j?.getAttribute("nonce");l=n(o.map(x=>{if(x=Mt(x),x in Oe)return;Oe[x]=!0;const y=x.endsWith(".css"),b=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${b}`))return;const h=document.createElement("link");if(h.rel=y?"stylesheet":Wt,y||(h.as="script"),h.crossOrigin="",h.href=x,s&&h.setAttribute("nonce",s),document.head.appendChild(h),y)return new Promise((z,v)=>{h.addEventListener("load",z),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${x}`)))})}))}function S(j){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=j,window.dispatchEvent(s),!s.defaultPrevented)throw j}return l.then(j=>{for(const s of j||[])s.status==="rejected"&&S(s.reason);return r().catch(S)})},ne="/bg3-raid-manager/assets/logo-BLpM7sGS.svg",Pt={apiKey:"AIzaSyAsbaWbo3DoSTrRFhkaf9XujWPpmeGSjAE",authDomain:"bg3-raid-manager.firebaseapp.com",projectId:"bg3-raid-manager",storageBucket:"bg3-raid-manager.firebasestorage.app",messagingSenderId:"773826713403",appId:"1:773826713403:web:c15fdfca708d47f4fcc91e"},Lt=st(Pt),I=at(Lt);console.log("ğŸ”¥ Firebase Connected (Real DB Mode)");const Fe=({size:t=20,color:r="currentColor"})=>e.jsxs("div",{style:{position:"relative",width:t,height:t,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(rt,{size:t,color:r}),e.jsx(He,{size:t*.5,color:r,style:{position:"absolute",bottom:-2,right:-2,background:"#1a1a2e",borderRadius:"50%"}})]}),Ot=({activeTab:t,setActiveTab:r,isMobile:o,user:p,onlineUsersCount:l,setShowSurvivors:S})=>{const[j,s]=V.useState(4),[n,x]=V.useState(!1),[y,b]=V.useState(!1),[h,z]=V.useState(!1),[v,g]=V.useState(!1),w=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],[N,B]=V.useState(p?.nickname||""),[c,f]=V.useState(p?.className||"Warrior"),[R,m]=V.useState(p?.role||(p?.isAdmin?"Admin":"User")),[k,D]=V.useState(p?.color||w[Math.floor(Math.random()*w.length)]),T=p?.isAdmin===!0;V.useEffect(()=>{p&&(B(p.nickname||""),f(p.className||"Warrior"),m(p.role||(p.isAdmin?"Admin":"User")),D(p.color||w[Math.floor(Math.random()*w.length)]))},[p,y]),V.useEffect(()=>{const d=M=>{M.shiftKey&&M.altKey&&(M.key==="R"||M.key==="r")&&z(J=>!J)};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[]);const _=()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},O=async()=>{if(!N.trim())return alert("Nickname is required");try{const{updateDoc:d,doc:M}=await Be(async()=>{const{updateDoc:E,doc:U}=await import("./vendor-BbMG-YK6.js").then(Y=>Y.am);return{updateDoc:E,doc:U}},[]),J=M(I,"users_v2",p.id),u={nickname:N,className:c,role:R,color:k};await d(J,u);const W={...p,...u};localStorage.setItem("bg3_user_profile",JSON.stringify(W)),alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì ìš©ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤."),window.location.reload()}catch(d){console.error(d),alert("ìˆ˜ì • ì‹¤íŒ¨: "+d.message)}},$=["ë°”ë°”ë¦¬ì•ˆ","ë°”ë“œ","í´ë ˆë¦­","ë“œë£¨ì´ë“œ","íŒŒì´í„°","ëª½í¬","íŒ”ë¼ë”˜","ë ˆì¸ì €","ë¡œê·¸","ì†Œì„œëŸ¬","ì›Œë½","ìœ„ìë“œ"],se=[{id:"home",label:"í™ˆ",icon:We},{id:"chat",label:"ì±„íŒ…",icon:Ne},{id:"calendar",label:"ì¼ì •",icon:he},{id:"tactics",label:"ì „ìˆ íŒ",icon:Me},{id:"save",label:"ì„¸ì´ë¸Œ",icon:it},{id:"profile",label:"í”„ë¡œí•„",icon:q}];T&&se.push({id:"admin",label:"ì•¼ì˜ì§€ ê´€ë¦¬",icon:Fe});const ce=se.filter(d=>d.id!=="profile");if(o){const d=[{id:"home",icon:We,label:"í™ˆ"},{id:"calendar",icon:he,label:"ì¼ì •"},{id:"tactics",icon:Me,label:"ì „ìˆ "},{id:"chat",icon:Ne,label:"ì±„íŒ…"},...T?[{id:"admin",icon:Fe,label:"ê´€ë¦¬"}]:[],{id:"profile",icon:q,label:"í”„ë¡œí•„"}];return e.jsx("nav",{className:"glass",style:{position:"fixed",bottom:"20px",left:"20px",right:"20px",margin:"0 auto",maxWidth:"500px",height:"70px",zIndex:1e3,display:"flex",justifyContent:"space-around",alignItems:"center",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.15)",borderTop:"1px solid rgba(255,255,255,0.25)",backdropFilter:"blur(20px) saturate(180%)",background:"rgba(20, 20, 30, 0.85)",boxShadow:"0 10px 30px rgba(0,0,0,0.5)",padding:"0 10px"},children:d.map(M=>{const J=M.icon,u=t===M.id;return e.jsxs("button",{onClick:()=>r(M.id),style:{background:u?"rgba(255,255,255,0.1)":"transparent",borderRadius:"16px",width:"50px",height:"50px",border:"none",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:u?"var(--accent-color)":"rgba(255,255,255,0.5)",transition:"all 0.2s",gap:"4px"},children:[e.jsx(J,{size:22,strokeWidth:u?2.5:2}),u&&e.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"var(--accent-color)"}})]},M.id)})})}return e.jsxs("aside",{className:"glass",style:{width:"280px",height:"100vh",margin:0,padding:"25px",display:"flex",flexDirection:"column",borderRadius:0,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(20, 20, 30, 0.4)",position:"sticky",top:0},children:[e.jsxs("div",{style:{padding:"0 0 25px",textAlign:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[h&&e.jsx("button",{id:"db-reset-btn",onClick:async()=>{if(confirm("âš ï¸ ê²½ê³ : ì •ë§ë¡œ DBë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëŒì´í‚¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")){const{collection:d,getDocs:M,deleteDoc:J}=await Be(async()=>{const{collection:E,getDocs:U,deleteDoc:Y}=await import("./vendor-BbMG-YK6.js").then(H=>H.am);return{collection:E,getDocs:U,deleteDoc:Y}},[]);(await M(d(I,"users_v2"))).forEach(E=>J(E.ref)),(await M(d(I,"camps"))).forEach(E=>J(E.ref)),alert("ì´ˆê¸°í™” ì™„ë£Œ. ì¬ì ‘ì†í•©ë‹ˆë‹¤."),_()}},style:{background:"red",color:"white",border:"none",padding:"5px",marginBottom:"10px",fontSize:"0.7rem",cursor:"pointer",width:"100%"},children:"[ADMIN] DB ì´ˆê¸°í™”"}),e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"100%",marginBottom:"10px",cursor:"pointer"},onClick:()=>window.location.reload(),children:[e.jsx("img",{src:ne,alt:"BG3",style:{width:"100%",height:"auto",display:"block"},onError:d=>d.target.style.display="none"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${ne})`,maskImage:`url(${ne})`}})]}),e.jsxs("div",{onClick:()=>S&&S(!0),style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",background:"rgba(0,0,0,0.3)",borderRadius:"12px",fontSize:"0.75rem",border:"1px solid rgba(255,255,255,0.1)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:d=>d.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:d=>d.currentTarget.style.background="rgba(0,0,0,0.3)",children:[e.jsx(q,{size:12,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80"},children:[l,"/",j,"ëª… ì ‘ì† ì¤‘"]})]})]}),e.jsx("nav",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"20px",flex:1},children:ce.map(d=>{const M=d.icon;return e.jsxs("button",{onClick:()=>r(d.id),style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:t===d.id?"rgba(255,255,255,0.15)":"transparent",color:t===d.id?"white":"rgba(255,255,255,0.7)",borderRadius:"12px",transition:"all 0.2s",border:"none",cursor:"pointer",fontSize:"0.95rem",fontWeight:t===d.id?"bold":"normal"},children:[e.jsx(M,{size:20,color:t===d.id?"var(--accent-color)":"currentColor"}),d.label]},d.id)})}),e.jsxs("div",{onClick:()=>x(!0),style:{marginTop:"auto",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s",padding:"8px 8px 8px 12px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",height:"60px"},onMouseEnter:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.08)",d.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:d=>{d.currentTarget.style.background="rgba(20, 20, 35, 0.6)",d.currentTarget.style.borderColor="rgba(255, 255, 255, 0.1)"},title:"í”„ë¡œí•„ ë³´ê¸°",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:p.color||"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 2px 10px ${p.color||"#f59e0b"}66`},children:e.jsx(q,{size:20,color:"white"})}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.95rem",color:"white"},children:p.nickname})]}),e.jsx("button",{onClick:d=>{d.stopPropagation(),g(!0)},style:{width:"40px",height:"40px",background:"rgba(248, 113, 113, 0.15)",border:"1px solid rgba(248, 113, 113, 0.3)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fca5a5",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:d=>d.currentTarget.style.background="rgba(248, 113, 113, 0.25)",onMouseLeave:d=>d.currentTarget.style.background="rgba(248, 113, 113, 0.15)",children:e.jsx(Ye,{size:16})})]}),v&&ve.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>g(!1),children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),style:{maxWidth:"350px",padding:"30px",textAlign:"center"},children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"10px",marginTop:"10px"},children:"ë¡œê·¸ì•„ì›ƒ"}),e.jsxs("p",{style:{opacity:.8,marginBottom:"30px",lineHeight:"1.5"},children:["ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ëª¨ë“  ë¡œê·¸ì¸ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤)"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>g(!1),style:{flex:1,padding:"14px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"transparent",color:"white",cursor:"pointer",fontWeight:"bold"},children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:_,style:{flex:1,padding:"14px",borderRadius:"12px",border:"none",background:"linear-gradient(45deg, #ef4444, #dc2626)",color:"white",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 15px rgba(239,68,68,0.3)"},children:"í™•ì¸"})]})]})}),document.body),n&&ve.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),style:{maxWidth:"400px",padding:"30px",textAlign:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 0 20px rgba(212, 160, 23, 0.4)"},children:e.jsx(q,{size:40,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.6rem",marginBottom:"5px",fontWeight:"bold"},children:p?.nickname||"ëª¨í—˜ê°€"}),e.jsxs("p",{style:{color:"var(--accent-color)",marginBottom:"20px",fontSize:"0.9rem",fontWeight:"bold"},children:[p?.className||"Classless"," ",e.jsx("span",{style:{opacity:.5},children:"|"})," ",p?.role==="Admin"||p?.isAdmin?"ëŒ€ì¥ (ê´€ë¦¬ì)":"ëŒ€ì›"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"25px",textAlign:"left"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì§ì—…"}),e.jsx("p",{style:{fontWeight:"bold"},children:p?.className||"-"})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì‹ ë¶„"}),e.jsx("p",{style:{fontWeight:"bold"},children:p?.role==="Admin"||p?.isAdmin?"ê´€ë¦¬ì":"ì¼ë°˜ ëŒ€ì›"})]})]}),e.jsxs("button",{onClick:()=>{x(!1),b(!0)},style:{width:"100%",padding:"14px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s"},onMouseEnter:d=>d.currentTarget.style.background="rgba(255,255,255,0.2)",onMouseLeave:d=>d.currentTarget.style.background="rgba(255,255,255,0.1)",children:[e.jsx(He,{size:18}),"í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°"]})]})}),document.body),y&&ve.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>b(!1),children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),style:{maxWidth:"400px",padding:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(q,{size:24,color:"var(--accent-color)"}),"í”„ë¡œí•„ ìˆ˜ì •"]}),e.jsx("button",{onClick:()=>b(!1),style:{background:"transparent",color:"rgba(255,255,255,0.5)"},children:"x"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ë‹‰ë„¤ì„"}),e.jsx("input",{type:"text",value:N,onChange:d=>B(d.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ì§ì—… (Class)"}),e.jsx("select",{value:c,onChange:d=>f(d.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"},children:$.map(d=>e.jsx("option",{value:d,style:{background:"#1a1a2e"},children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:w.map(d=>e.jsx("div",{onClick:()=>D(d),style:{width:"28px",height:"28px",borderRadius:"50%",background:d,cursor:"pointer",border:k===d?"3px solid white":"1px solid transparent",boxShadow:k===d?"0 0 10px "+d:"none",transform:k===d?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},d))})]}),e.jsx("button",{onClick:O,style:{marginTop:"10px",padding:"14px",borderRadius:"10px",background:"var(--accent-color)",color:"white",border:"none",fontWeight:"bold",fontSize:"1rem",cursor:"pointer"},children:"ì €ì¥í•˜ê¸°"})]})]})}),document.body)]})},$e=({user:t,setActiveTab:r,isMobile:o,onlineUsersCount:p,setShowSurvivors:l,openTactic:S})=>{const[j,s]=i.useState([]),[n,x]=i.useState(!0),[y,b]=i.useState(()=>{const g=localStorage.getItem("bg3_daily_goals");return g?JSON.parse(g):[{id:1,text:"ê¸´ íœ´ì‹ ì·¨í•˜ê¸° (ì£¼ë¬¸ ìŠ¬ë¡¯ ë³µêµ¬)",checked:!1},{id:2,text:"ì•¼ì˜ì§€ ë¬¼ì í™•ì¸",checked:!1},{id:3,text:"ìƒì¸ì—ê²Œ ì¡ë™ì‚¬ë‹ˆ íŒë§¤",checked:!1},{id:4,text:"ë™ë£Œ í˜¸ê°ë„ ëŒ€í™”",checked:!1}]});i.useEffect(()=>{localStorage.setItem("bg3_daily_goals",JSON.stringify(y))},[y]);const[h,z]=i.useState([]);i.useEffect(()=>{(async()=>{try{const w=K(L(I,"schedules"),we("date"),ke(3)),N=await Se(w);if(s(N.docs.map(B=>({id:B.id,...B.data()}))),t?.campId){const B=K(L(I,"tactics"),X("campId","==",t.campId),we("createdAt","desc"),ke(3)),c=await Se(B);z(c.docs.map(f=>({id:f.id,...f.data()})))}}catch(w){console.error(w)}finally{x(!1)}})()},[t?.campId]);const v=({icon:g,title:w,desc:N,onClick:B,color:c})=>e.jsxs("div",{onClick:B,className:"glass-panel",style:{padding:"20px",cursor:"pointer",transition:"transform 0.2s",display:"flex",flexDirection:"column",gap:"10px"},onMouseEnter:f=>f.currentTarget.style.transform="translateY(-5px)",onMouseLeave:f=>f.currentTarget.style.transform="translateY(0)",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{padding:"10px",borderRadius:"12px",background:`rgba(${c}, 0.2)`},children:e.jsx(g,{color:`rgb(${c})`,size:24})}),e.jsx(ot,{size:16,style:{opacity:.5}})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"5px 0",fontSize:"1.1rem"},children:w}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:N})]})]});return e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"flex",flexDirection:"column",gap:o?"15px":"30px"},children:[o&&e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"180px",margin:"0 auto 10px"},children:[e.jsx("img",{src:ne,alt:"BG3",style:{width:"100%"},onClick:()=>window.location.reload()}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${ne})`,maskImage:`url(${ne})`}})]}),e.jsxs("div",{style:{width:"100%",minHeight:"90px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 10px 30px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"space-between",padding:o?"20px 25px":"0 40px",textAlign:"left"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,fontSize:o?"1.2rem":"1.6rem",fontWeight:"bold"},children:["ì–´ì„œì˜¤ì„¸ìš”, ",e.jsx("span",{style:{color:t?.color||"#ffd700"},children:t.nickname}),"ë‹˜"]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"0.85rem",opacity:.6},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ ì›ì •ëŒ€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤."})]}),e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:t?.color||"#ffd700",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 20px ${t?.color||"#ffd700"}66`,flexShrink:0,marginLeft:"15px"},children:(()=>{const g=t?.className||"";let w=q;return g.includes("ë°”ë°”ë¦¬ì•ˆ")?w=lt:g.includes("ë°”ë“œ")?w=Xe:g.includes("í´ë ˆë¦­")?w=dt:g.includes("ë“œë£¨ì´ë“œ")?w=ct:g.includes("íŒŒì´í„°")?w=Ke:g.includes("ëª½í¬")?w=Je:g.includes("íŒ”ë¼ë”˜")?w=fe:g.includes("ë ˆì¸ì €")?w=Ve:g.includes("ë¡œê·¸")?w=pt:g.includes("ì†Œì„œëŸ¬")?w=xt:g.includes("ì›Œë½")?w=Ce:g.includes("ìœ„ìë“œ")&&(w=Ge),e.jsx(w,{size:28,color:"white",strokeWidth:2.5})})()})]}),o&&e.jsxs("div",{onClick:()=>l&&l(!0),style:{display:"inline-flex",alignItems:"center",gap:"8px",background:"rgba(20, 20, 30, 0.6)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"20px",padding:"8px 16px",marginBottom:"20px",cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,0.2)",position:"relative",zIndex:10,userSelect:"none"},children:[e.jsx(q,{size:14,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80",fontSize:"0.85rem",fontWeight:"bold"},children:[p||0,"/4ëª… ì ‘ì† ì¤‘"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:o?"10px":"20px"},children:[e.jsx(v,{icon:he,title:"ë ˆì´ë“œ ì¼ì •",desc:"ë‹¤ê°€ì˜¤ëŠ” ëª¨í—˜ í™•ì¸í•˜ê¸°",onClick:()=>r("calendar"),color:"248, 113, 113"}),e.jsx(v,{icon:qe,title:"ì„¸ì´ë¸Œ ë¶„ì„",desc:"ë‚´ ìºë¦­í„° ìŠ¤í™ í™•ì¸",onClick:()=>r("save"),color:"167, 139, 250"}),e.jsx(v,{icon:Ne,title:"ì‘ì „ íšŒì˜ì‹¤",desc:"íŒŒí‹°ì›ë“¤ê³¼ ëŒ€í™”í•˜ê¸°",onClick:()=>r("chat"),color:"52, 211, 153"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:o?"1fr":"1fr 1fr",gap:o?"10px":"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"20px",minHeight:"300px",display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px",fontSize:"1.2rem"},children:[e.jsx(he,{size:20,className:"text-accent"})," ë‹¤ê°€ì˜¤ëŠ” ì¼ì •"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:1},children:n?e.jsx("p",{style:{opacity:.5},children:"ë¡œë”© ì¤‘..."}):j.length===0?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.5},children:"ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."}):j.map(g=>e.jsxs("div",{onClick:()=>r("calendar"),style:{padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",display:"flex",alignItems:"center",gap:"15px",cursor:"pointer",transition:"background 0.2s",border:"1px solid rgba(255,255,255,0.05)"},onMouseEnter:w=>w.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:w=>w.currentTarget.style.background="rgba(255,255,255,0.05)",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"50px"},children:[e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.7},children:[g.date?.split("-")[1],"ì›”"]}),e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:g.date?.split("-")[2]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"1rem"},children:g.title}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6,marginTop:"2px"},children:[g.time," â€¢ ",g.type==="raid"?"âš”ï¸ ë ˆì´ë“œ":"ğŸ“œ ìŠ¤í† ë¦¬"]})]})]},g.id))}),e.jsx("button",{onClick:()=>r("calendar"),style:{marginTop:"15px",padding:"10px",width:"100%",background:"rgba(255,255,255,0.05)",border:"none",color:"rgba(255,255,255,0.7)",borderRadius:"8px",cursor:"pointer"},children:"ì „ì²´ ì¼ì • ë³´ê¸°"})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"20px",minHeight:"300px",display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px",fontSize:"1.2rem"},children:[e.jsx(me,{size:20,className:"text-secondary",style:{color:"#60a5fa"}})," ìµœê·¼ ì „ìˆ "]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:1},children:n?e.jsx("p",{style:{opacity:.5},children:"ë¡œë”© ì¤‘..."}):h.length===0?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.5},children:"ìˆ˜ë¦½ëœ ì‘ì „ì´ ì—†ìŠµë‹ˆë‹¤."}):h.map(g=>e.jsxs("div",{onClick:()=>S?S(g.id):r("tactics"),style:{padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",display:"flex",alignItems:"center",gap:"15px",cursor:"pointer",transition:"background 0.2s",border:"1px solid rgba(255,255,255,0.05)"},onMouseEnter:w=>w.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:w=>w.currentTarget.style.background="rgba(255,255,255,0.05)",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"10px",background:"rgba(96, 165, 250, 0.2)",borderRadius:"10px"},children:e.jsx(me,{size:20,color:"#60a5fa"})}),e.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"1rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:g.title}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6,marginTop:"2px"},children:["ì‘ì„±ì: ",g.authorName]})]})]},g.id))}),e.jsx("button",{onClick:()=>r("tactics"),style:{marginTop:"15px",padding:"10px",width:"100%",background:"rgba(255,255,255,0.05)",border:"none",color:"rgba(255,255,255,0.7)",borderRadius:"8px",cursor:"pointer"},children:"ì „ìˆ  ì‘ì „ì‹¤ ì´ë™"})]})]})]})},Ft=({user:t,isMobile:r,setActiveTab:o})=>{const[p,l]=i.useState([]),[S,j]=i.useState(""),[s,n]=i.useState(null),[x,y]=i.useState(!0),[b,h]=i.useState([]),z=i.useRef(null),v=i.useRef(null),g=i.useRef(0);i.useEffect(()=>{if(!t?.campId)return;const c=K(L(I,"chats"),X("campId","==",t.campId),ke(50)),f=Q(c,R=>{const m=R.docs.map(k=>({id:k.id,...k.data(),timestamp:k.data().timestamp?.toDate().toISOString()||new Date().toISOString()}));m.sort((k,D)=>new Date(k.timestamp)-new Date(D.timestamp)),l(m),y(!1)});return()=>f()},[t?.campId]),i.useEffect(()=>{if(!t?.campId)return;const c=K(L(I,"camps",t.campId,"typing")),f=Q(c,m=>{const k=Date.now(),D=m.docs.map(T=>({id:T.id,...T.data()})).filter(T=>T.id!==t.id&&T.timestamp&&k-T.timestamp.toMillis()<4e3);h(D)}),R=setInterval(()=>{h(m=>{const k=Date.now();return m.filter(D=>D.timestamp?.toMillis&&k-D.timestamp.toMillis()<4e3)})},1e3);return()=>{f(),clearInterval(R)}},[t?.campId,t?.id]),i.useEffect(()=>{z.current?.scrollIntoView({behavior:"smooth"})},[p,b]);const w=c=>{const f=c.target.files[0];if(f){if(f.size>500*1024){alert("ì´ë¯¸ì§€ í¬ê¸°ëŠ” 500KB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");return}const R=new FileReader;R.onloadend=()=>{n(R.result)},R.readAsDataURL(f)}},N=async c=>{const f=c.target.value;j(f);const R=Date.now();if(f.trim()&&R-g.current>2e3&&t?.campId){g.current=R;try{await ue(P(I,"camps",t.campId,"typing",t.id),{nickname:t.nickname,timestamp:oe()})}catch(m){console.error("Typing status error",m)}}},B=async c=>{if(c.preventDefault(),!S.trim()&&!s||!t?.campId)return;const f=S,R=s;j(""),n(null);try{await be(L(I,"chats"),{text:f,image:R,sender:t.nickname,uid:t.id,userClass:t.className||"Unknown",campId:t.campId,timestamp:oe()})}catch(m){console.error("Error sending message: ",m),alert("ì „ì†¡ ì‹¤íŒ¨!")}};return t?.campId?e.jsxs("div",{style:{display:"flex",flexDirection:"column",padding:0,position:r?"fixed":"relative",top:0,left:0,right:0,bottom:0,height:r?"100dvh":"100%",background:r?"#0f0f13":"rgba(0,0,0,0.2)",zIndex:2e3},children:[e.jsxs("div",{style:{padding:"15px 20px",borderBottom:"1px solid rgba(255,255,255,0.1)",background:r?"rgba(20,20,30,0.95)":"transparent",display:"flex",alignItems:"center",gap:"15px"},children:[r&&e.jsx("button",{onClick:()=>o("home"),style:{background:"none",border:"none",color:"white",padding:"5px",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(Qe,{size:24})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(gt,{color:"#4fd1c5",size:20})," íŒŒí‹° ì‘ì „ íšŒì˜ì‹¤"]}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.6,display:"block",marginTop:"2px"},children:["ğŸ”’ ",t.campId," ì•¼ì˜ì§€"]})]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"15px"},children:[x&&e.jsx("div",{style:{textAlign:"center",opacity:.5},children:"ì±„íŒ…ë°© ì—°ê²° ì¤‘..."}),p.length===0&&!x&&e.jsxs("div",{style:{textAlign:"center",opacity:.3,marginTop:"20px"},children:[e.jsx("p",{children:"ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{children:"ì‘ì „ì„ ì‹œì‘í•´ë³´ì„¸ìš”!"})]}),p.map(c=>{const f=c.uid===t.id;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:f?"flex-end":"flex-start"},children:[e.jsx("div",{style:{fontSize:"0.8rem",marginBottom:"4px",opacity:.7,display:"flex",alignItems:"center",gap:"4px"},children:!f&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["[",c.userClass,"]"]}),c.sender]})}),e.jsxs("div",{style:{background:f?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:f?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"70%",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.1)",wordBreak:"break-word"},children:[c.image&&e.jsx("img",{src:c.image,alt:"attached",style:{maxWidth:"100%",borderRadius:"8px",marginBottom:c.text?"10px":"0"}}),c.text]}),e.jsx("span",{style:{fontSize:"0.7rem",opacity:.4,marginTop:"4px"},children:new Date(c.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},c.id)}),b.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",marginTop:"10px",paddingLeft:"4px"},children:b.slice(0,3).map(c=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"8px",opacity:.9},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #a78bfa, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:"bold",color:"white",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},children:c.nickname?c.nickname.charAt(0):e.jsx(Ie,{size:14})}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"16px 16px 16px 2px",padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",height:"32px",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"})]}),e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.5,marginBottom:"4px"},children:[c.nickname," ì…ë ¥ ì¤‘..."]})]},c.id))}),e.jsx("div",{ref:z})]}),e.jsxs("form",{onSubmit:B,style:{padding:"20px",background:"rgba(0,0,0,0.2)",display:"flex",flexDirection:"column",gap:"10px",borderRadius:"0 0 16px 16px"},children:[s&&e.jsxs("div",{style:{position:"relative",width:"fit-content"},children:[e.jsx("img",{src:s,alt:"Preview",style:{height:"80px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.2)"}}),e.jsx("button",{type:"button",onClick:()=>n(null),style:{position:"absolute",top:-5,right:-5,background:"red",borderRadius:"50%",border:"none",color:"white",padding:"2px",cursor:"pointer"},children:e.jsx(Ze,{size:12})})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("input",{type:"file",accept:"image/*",ref:v,style:{display:"none"},onChange:w}),e.jsx("button",{type:"button",onClick:()=>v.current.click(),style:{padding:"12px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:e.jsx(mt,{size:20})}),e.jsx("input",{type:"text",value:S,onChange:N,placeholder:"ì‘ì „ì„ ì „ë‹¬í•˜ì„¸ìš”...",style:{flex:1,padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.05)",color:"white",outline:"none"}}),e.jsx("button",{type:"submit",style:{padding:"12px",borderRadius:"12px",background:"var(--accent-color)",color:"white",border:"none",cursor:"pointer"},children:e.jsx(ut,{size:20})})]})]})]}):e.jsx("div",{className:"glass-panel",style:{padding:"40px",textAlign:"center"},children:"ì•¼ì˜ì§€ì— ì†Œì†ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."})},$t=({user:t,isMobile:r})=>{const[o,p]=i.useState(new Date),[l,S]=i.useState([]),[j,s]=i.useState([]),[n,x]=i.useState(!0),[y,b]=i.useState(0),h=o.toLocaleDateString("en-CA");i.useEffect(()=>{if(!t?.campId){x(!1);return}console.log("Fetching raid data...");const m=K(L(I,"availabilities"),X("campId","==",t.campId)),k=K(L(I,"schedules"),X("campId","==",t.campId),X("type","==","fixed")),D=Q(m,_=>{const O=_.docs.map($=>({id:$.id,...$.data()}));S(O)}),T=Q(k,_=>{const O=_.docs.map($=>({id:$.id,...$.data()}));s(O),x(!1)});return()=>{D(),T()}},[t?.campId,y]);const v=l.find(m=>m.userId===t.id&&m.date===h)?.possibleTimes||[],g=i.useMemo(()=>{const m={};return l.filter(D=>D.date===h).forEach(D=>{D.possibleTimes?.forEach(T=>{m[T]||(m[T]=[]),m[T].push(D.nickname)})}),m},[l,h]),w=j.find(m=>m.date===h),N=async m=>{if(!t.campId)return;const k=v.includes(m)?v.filter(_=>_!==m):[...v,m].sort(),D=`${t.campId}_${t.id}_${h}`,T=P(I,"availabilities",D);await ue(T,{campId:t.campId,userId:t.id,nickname:t.nickname,date:h,possibleTimes:k})},B=async m=>{if(window.confirm(`${o.toLocaleDateString()} ${m}ì— ë ˆì´ë“œë¥¼ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await be(L(I,"schedules"),{campId:t.campId,title:"ì •ê¸° ë ˆì´ë“œ",date:h,fixedTime:m,type:"fixed",creator:t.nickname,createdAt:new Date().toISOString()}),alert("ë ˆì´ë“œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤! íŒŒí‹°ì›ë“¤ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤."),x(!0),b(k=>k+1)}catch(k){console.error(k),alert("ì˜¤ë¥˜ ë°œìƒ: "+k.message)}},c=async m=>{window.confirm("ì •ë§ ì´ ë ˆì´ë“œ ì¼ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await Re(P(I,"schedules",m))},f=["18:00","19:00","20:00","21:00","22:00","23:00","00:00","01:00","02:00"],R=({date:m,view:k})=>{if(k==="month"){const D=m.toLocaleDateString("en-CA");if(j.some(O=>O.date===D))return e.jsx("div",{style:{height:"6px",width:"6px",background:"#f87171",borderRadius:"50%",margin:"2px auto"}});if(l.some(O=>O.date===D))return e.jsx("div",{style:{height:"4px",width:"4px",background:"rgba(255,255,255,0.3)",borderRadius:"50%",margin:"2px auto"}})}};return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:r?"15px":"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",color:"white",margin:0,fontSize:r?"1.2rem":"1.5rem"},children:[e.jsx(he,{className:"text-accent"})," ë ˆì´ë“œ ì¼ì • (Raid Scheduler)"]}),e.jsx("button",{onClick:()=>{x(!0),b(m=>m+1)},style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",padding:"8px",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"ìƒˆë¡œê³ ì¹¨",children:e.jsx(ye,{size:18})})]}),e.jsx("style",{children:`
                    .react-calendar { background: transparent !important; border: none !important; width: 100% !important; color: white !important; font-family: inherit; }
                    .react-calendar__navigation button { color: white; min-width: 44px; background: none; font-size: ${r?"1rem":"1.2rem"}; }
                    .react-calendar__navigation button:enabled:hover, .react-calendar__navigation button:enabled:focus { background-color: rgba(255,255,255,0.1); }
                    .react-calendar__month-view__weekdays { text-align: center; text-transform: uppercase; font-weight: bold; font-size: 0.8em; opacity: 0.7; color: var(--accent-color); }
                    .react-calendar__month-view__days__day { color: white; padding: ${r?"10px":"15px"}; background: transparent; border: none; }
                    .react-calendar__tile:enabled:hover, .react-calendar__tile:enabled:focus { background-color: rgba(255,255,255,0.1); border-radius: 12px; }
                    .react-calendar__tile--now { background: rgba(255,255,255,0.1) !important; border-radius: 12px; }
                    .react-calendar__tile--active { background: var(--accent-color) !important; color: white !important; border-radius: 12px; }
                `}),e.jsx(ht,{onChange:p,value:o,tileContent:R,formatDay:(m,k)=>k.getDate()})]}),w?e.jsxs("div",{className:"glass-panel",style:{padding:"25px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05))",border:"1px solid rgba(239, 68, 68, 0.3)",textAlign:"center"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",color:"#fca5a5",marginBottom:"10px",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(ft,{})," ë ˆì´ë“œ í™•ì •ë¨"]}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold",margin:"10px 0"},children:w.fixedTime}),e.jsx("p",{style:{opacity:.8},children:"ëª¨ë“  ëŒ€ì›ì€ í•´ë‹¹ ì‹œê°„ì— ì•¼ì˜ì§€ë¡œ ì§‘ê²°í•˜ì‹­ì‹œì˜¤."}),(t.isAdmin||t.role==="Admin")&&e.jsx("button",{onClick:()=>c(w.id),style:{marginTop:"20px",padding:"10px 20px",borderRadius:"8px",background:"rgba(0,0,0,0.3)",color:"#fca5a5",border:"1px solid rgba(239,68,68,0.5)",cursor:"pointer"},children:"ì¼ì • ì·¨ì†Œí•˜ê¸°"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-panel",style:{padding:r?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx(yt,{size:18,color:"var(--accent-color)"}),"ë‚˜ì˜ ê°€ëŠ¥ ì‹œê°„ (",o.toLocaleDateString(),")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:f.map(m=>{const k=v.includes(m);return e.jsx("button",{onClick:()=>N(m),style:{padding:"10px 16px",borderRadius:"12px",border:"none",cursor:"pointer",background:k?"var(--accent-color)":"rgba(255,255,255,0.05)",color:k?"white":"rgba(255,255,255,0.6)",fontWeight:k?"bold":"normal",transition:"all 0.2s",flexGrow:r?1:0},children:m},m)})})]}),e.jsxs("div",{className:"glass-panel",style:{padding:r?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx(q,{size:18,color:"#a78bfa"}),"íŒŒí‹° í˜„í™© (Team Status)"]}),Object.keys(g).length===0?e.jsx("p",{style:{opacity:.5,textAlign:"center",padding:"20px"},children:"ì•„ì§ ë“±ë¡ëœ ê°€ëŠ¥ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Object.entries(g).sort((m,k)=>k[1].length-m[1].length||m[0].localeCompare(k[0])).map(([m,k])=>{const D=k.length,T=D>=3;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderRadius:"12px",background:T?"rgba(167, 139, 250, 0.15)":"rgba(255,255,255,0.03)",border:T?"1px solid rgba(167, 139, 250, 0.3)":"1px solid transparent"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:T?"#a78bfa":"white"},children:m}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(q,{size:14,style:{opacity:.7}}),e.jsxs("span",{style:{fontSize:"0.9rem",opacity:.9},children:[D,"ëª… ê°€ëŠ¥"]}),e.jsxs("span",{style:{fontSize:"0.75rem",opacity:.5},children:["(",k.join(", "),")"]})]})]}),(t.isAdmin||t.role==="Admin")&&e.jsxs("button",{onClick:()=>B(m),style:{padding:"6px 12px",borderRadius:"8px",border:"none",background:"linear-gradient(45deg, #f87171, #ef4444)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.8rem"},children:[e.jsx(ze,{size:12,fill:"white"})," í™•ì •"]})]},m)})})]})]})]})},Ut=({user:t})=>{const[r,o]=i.useState([]),[p,l]=i.useState(!0);i.useEffect(()=>{if(!t?.campId)return;const n=K(L(I,"save_reports_v2"),X("campId","==",t.campId),we("createdAt","desc"),ke(10)),x=Q(n,y=>{const b=y.docs.map(h=>({id:h.id,...h.data()}));o(b),l(!1)});return()=>x()},[t?.campId]);const S=async n=>{confirm("ì´ ë¶„ì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await Re(P(I,"save_reports_v2",n))},j=({label:n,value:x,color:y})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[e.jsx("span",{style:{width:"40px",fontWeight:"bold",fontSize:"0.8rem",color:"rgba(255,255,255,0.7)"},children:n}),e.jsx("div",{style:{flex:1,height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${x/20*100}%`,height:"100%",background:y,transition:"width 0.5s"}})}),e.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:x})]}),s=n=>{const x=n.target.files[0];x&&(l(!0),setTimeout(async()=>{const y={STR:Math.floor(Math.random()*10)+10,DEX:Math.floor(Math.random()*10)+10,CON:Math.floor(Math.random()*10)+10,INT:Math.floor(Math.random()*10)+10,WIS:Math.floor(Math.random()*10)+10,CHA:Math.floor(Math.random()*10)+10},b={filename:x.name,stats:y,meta:{mode:"Honour Mode (Detected)",version:"4.1.1.4",size:(x.size/1024/1024).toFixed(2)+" MB"},companions:[{name:"Shadowheart",img:"ğŸŒ™"},{name:"Astarion",img:"ğŸ§›"}],logs:["[Client] File loaded locally","[Parser] Header verified (LSOF v4)","[Analysis] Stats extracted successfully"],uploader:t.nickname,campId:t.campId,createdAt:oe()};try{await be(L(I,"save_reports_v2"),b),alert("ë¶„ì„ ì™„ë£Œ!")}catch(h){console.error(h),alert("ì—…ë¡œë“œ ì‹¤íŒ¨")}finally{l(!1)}},1500))};return e.jsxs("div",{style:{padding:"0 0 80px"},children:[e.jsxs("div",{className:"glass-panel",style:{marginBottom:"20px",textAlign:"center",border:"1px solid var(--accent-color)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(bt,{color:"#a78bfa"})," ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ê¸°"]}),e.jsx("p",{style:{opacity:.8,fontSize:"0.9rem",maxWidth:"600px",margin:"0 auto 20px"},children:"ì„¸ì´ë¸Œ íŒŒì¼(.lsv)ì„ ì—…ë¡œë“œí•˜ì—¬ ìºë¦­í„° ëŠ¥ë ¥ì¹˜ì™€ ì§„í–‰ ìƒí™©ì„ ë¶„ì„í•˜ì„¸ìš”."}),e.jsxs("div",{style:{position:"relative",overflow:"hidden",display:"inline-block"},children:[e.jsxs("button",{style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(De,{size:18})," íŒŒì¼ ì„ íƒ ë° ë¶„ì„"]}),e.jsx("input",{type:"file",accept:".lsv,.save",onChange:s,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"}})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:p?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx(ye,{size:32,className:"spin",style:{marginBottom:"15px",color:"var(--accent-color)"}}),e.jsx("p",{children:"ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ ì¤‘..."})]}):r.length===0?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx(De,{size:48,style:{opacity:.3,marginBottom:"20px"}}),e.jsx("p",{children:"ë¶„ì„ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})]}):r.map(n=>e.jsxs("div",{className:"glass-panel",style:{position:"relative",animation:"fadeIn 0.5s"},children:[e.jsx("button",{onClick:()=>S(n.id),style:{position:"absolute",top:"15px",right:"15px",background:"transparent",border:"none",color:"#f87171",cursor:"pointer"},children:e.jsx(et,{size:16})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"10px"},children:[e.jsx(De,{size:20,color:"var(--accent-color)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem"},children:n.filename}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.5},children:[new Date(n.createdAt?.toDate?n.createdAt.toDate():n.createdAt).toLocaleString()," â€¢ ",n.uploader]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px"},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(qe,{size:14})," ëŠ¥ë ¥ì¹˜ (Stats)"]}),n.stats?e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"STR",value:n.stats.STR,color:"#fca5a5"}),e.jsx(j,{label:"DEX",value:n.stats.DEX,color:"#86efac"}),e.jsx(j,{label:"CON",value:n.stats.CON,color:"#fbbf24"}),e.jsx(j,{label:"INT",value:n.stats.INT,color:"#93c5fd"}),e.jsx(j,{label:"WIS",value:n.stats.WIS,color:"#d8b4fe"}),e.jsx(j,{label:"CHA",value:n.stats.CHA,color:"#f472b6"})]}):e.jsx("p",{style:{fontSize:"0.8rem",opacity:.5},children:"ë°ì´í„° ì—†ìŒ"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px",flex:1},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(fe,{size:14})," ë©”íƒ€ ì •ë³´"]}),e.jsxs("div",{style:{fontSize:"0.8rem",display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("p",{style:{margin:0},children:["ğŸ“‚ ëª¨ë“œ: ",n.meta?.mode||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ğŸ’¾ ë²„ì „: ",n.meta?.version||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ğŸ“¦ í¬ê¸°: ",n.meta?.size||"Unknown"]})]})]}),n.companions&&e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"12px"},children:[e.jsx("h4",{style:{margin:"0 0 5px",fontSize:"0.8rem",opacity:.8},children:"í•¨ê»˜í•˜ëŠ” ë™ë£Œ"}),e.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"},children:n.companions.map((x,y)=>e.jsxs("span",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem"},children:[x.img," ",x.name]},y))})]})]})]})]},n.id))})]})},_e=[{id:"barbarian",name:"ë°”ë°”ë¦¬ì•ˆ",icon:Ke,color:"#fca5a5"},{id:"bard",name:"ë°”ë“œ",icon:Xe,color:"#f9a8d4"},{id:"cleric",name:"í´ë ˆë¦­",icon:jt,color:"#d1d5db"},{id:"druid",name:"ë“œë£¨ì´ë“œ",icon:vt,color:"#bef264"},{id:"fighter",name:"íŒŒì´í„°",icon:fe,color:"#93c5fd"},{id:"monk",name:"ëª½í¬",icon:wt,color:"#7dd3fc"},{id:"paladin",name:"íŒ”ë¼ë”˜",icon:fe,color:"#fbbf24"},{id:"ranger",name:"ë ˆì¸ì €",icon:Ve,color:"#86efac"},{id:"rogue",name:"ë¡œê·¸",icon:Ce,color:"#cbd5e1"},{id:"sorcerer",name:"ì†Œì„œëŸ¬",icon:Je,color:"#c084fc"},{id:"warlock",name:"ì›Œë½",icon:Ge,color:"#e879f9"},{id:"wizard",name:"ìœ„ìë“œ",icon:kt,color:"#818cf8"}],de=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],ee={width:"100%",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.2)",color:"white",marginBottom:"12px",fontSize:"1rem",transition:"border-color 0.2s, background 0.2s"},ie={width:"100%",padding:"16px",borderRadius:"12px",border:"none",fontWeight:"bold",fontSize:"1.05rem",marginTop:"0",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},Ee=({selected:t,onSelect:r})=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"10px",maxHeight:"200px",overflowY:"auto",margin:"20px 0",padding:"5px"},children:_e.map(o=>e.jsxs("button",{onClick:()=>r(o),type:"button",style:{padding:"12px 8px",borderRadius:"12px",border:t?.id===o.id?`2px solid ${o.color}`:"1px solid rgba(255,255,255,0.05)",background:t?.id===o.id?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.2)",color:"white",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",transition:"all 0.2s",cursor:"pointer",transform:t?.id===o.id?"scale(1.05)":"scale(1)"},children:[e.jsx(o.icon,{size:24,color:o.color}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:t?.id===o.id?"bold":"normal"},children:o.name})]},o.id))}),Ae=({selected:t,onSelect:r})=>e.jsxs("div",{style:{margin:"15px 0"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"white",opacity:.8,display:"block",marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:de.map(o=>e.jsx("div",{onClick:()=>r(o),style:{width:"28px",height:"28px",borderRadius:"50%",background:o,cursor:"pointer",border:t===o?"3px solid white":"1px solid transparent",boxShadow:t===o?"0 0 10px "+o:"none",transform:t===o?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},o))})]}),Te=({children:t,title:r,sub:o,onClose:p,error:l})=>e.jsx("div",{className:"modal-overlay",onClick:p,children:e.jsxs("div",{className:"modal-content",onClick:S=>S.stopPropagation(),children:[e.jsx("button",{onClick:p,style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:"pointer",zIndex:10},children:e.jsx(Ze,{size:18})}),e.jsxs("div",{style:{padding:"30px 20px",textAlign:"center"},children:[r&&e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"8px",fontWeight:"800",background:"linear-gradient(to right, #fff, #aaa)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:r}),o&&e.jsx("p",{style:{opacity:.7,fontSize:"0.95rem",marginBottom:"30px"},children:o}),t,l&&e.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",padding:"12px",borderRadius:"10px",marginTop:"20px",fontSize:"0.9rem",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["âš ï¸ ",l]})]})]})}),Ue=({onComplete:t,initialData:r,user:o,isMobile:p})=>{const l=r||o,[S,j]=i.useState(l?"profile_view":"landing"),[s,n]=i.useState(l?.nickname||""),[x,y]=i.useState(""),[b,h]=i.useState(l?_e.find(u=>u.name===l.className):null),[z,v]=i.useState(l?.color||de[Math.floor(Math.random()*de.length)]),[g,w]=i.useState(""),[N,B]=i.useState(""),[c,f]=i.useState([]),[R,m]=i.useState(null),[k,D]=i.useState(!1),[T,_]=i.useState("");i.useEffect(()=>{l&&j("profile_view")},[l]);const O=()=>{n(""),y(""),h(null),w(""),B(""),m(null),_(""),f([]),v(de[Math.floor(Math.random()*de.length)])},$=()=>{_(""),j("landing")};i.useEffect(()=>{S==="join_camp"&&se()},[S]);const se=async()=>{D(!0);try{console.log("[Profile] Fetching active camps...");const W=(await Se(L(I,"camps"))).docs.map(E=>({id:E.id,...E.data()}));f(W),console.log("[Profile] Camps found:",W.length)}catch(u){console.error("[Profile] Error fetching camps:",u),_("ì˜ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{D(!1)}},ce=async u=>{u.preventDefault(),D(!0),_("");try{console.log("[Auth] Attempting login for:",s);const W=await ge(P(I,"users_v2",s));if(!W.exists())throw new Error("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ëª¨í—˜ê°€ì…ë‹ˆë‹¤.");const E=W.data();if(E.password!==x)throw new Error("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");if(console.log("[Auth] Login successful:",E),E.campId)try{await re(P(I,"camps",E.campId),{members:Pe(s)})}catch(U){console.error("[Auth] Failed to update camp member list:",U)}localStorage.setItem("bg3_user_profile",JSON.stringify(E)),t(E)}catch(W){console.error("[Auth] Login failed:",W),_(W.message)}finally{D(!1)}},d=async()=>{if(!s||!x||!b||!g||!N){_("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}D(!0);try{console.log("[Camp] Creating new camp:",g);const u=P(I,"users_v2",s);if((await ge(u)).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");const E=g.trim(),U=P(I,"camps",E);if((await ge(U)).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì˜ì§€ ì´ë¦„ì…ë‹ˆë‹¤.");const H={id:s,nickname:s,password:x,className:b.name,classId:b.id,color:z,isAdmin:!0,campId:E,createdAt:new Date().toISOString()},Z={id:E,name:g,password:N,leaderId:s,members:[s],createdAt:new Date().toISOString()};await ue(u,H),await ue(U,Z),console.log("[Camp] Camp and Admin created successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify(H)),t(H)}catch(u){console.error("[Camp] Creation failed:",u),_(u.message)}finally{D(!1)}},M=async()=>{if(!s||!x||!b||!R||!N){_("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}D(!0);try{console.log("[Camp] Joining camp:",R);const u=P(I,"users_v2",s);if((await ge(u)).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. (ë¡œê·¸ì¸ í•˜ì„¸ìš”)");const E=P(I,"camps",R),U=await ge(E);if(!U.exists())throw new Error("ì˜ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");const Y=U.data();if(Y.password!==N)throw new Error("ì˜ì§€ ì…ì¥ ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");if(Y.members&&Y.members.length>=4)throw new Error("ì˜ì§€ ì •ì›ì´ ê½‰ ì°¼ìŠµë‹ˆë‹¤. (ìµœëŒ€ 4ëª…)");const H={id:s,nickname:s,password:x,className:b.name,classId:b.id,color:z,isAdmin:!1,campId:R,createdAt:new Date().toISOString()};await ue(u,H),await re(E,{members:Pe(s)}),console.log("[Camp] Joined successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify(H)),t(H)}catch(u){console.error("[Camp] Join failed:",u),_(u.message)}finally{D(!1)}},J=()=>{confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(localStorage.removeItem("bg3_user_profile"),t(null),j("landing"),O())};if(S==="profile_view"&&l){const[u,W]=i.useState(!1),[E,U]=i.useState(l.nickname),[Y,H]=i.useState(_e.find(A=>A.name===l.className)),[Z,je]=i.useState(l.color||de[0]),[pe,a]=i.useState(!1),C=async()=>{if(!E.trim())return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");a(!0);try{const A=P(I,"users_v2",l.id),F={nickname:E,className:Y?.name||l.className,classId:Y?.id||l.classId,color:Z};await re(A,F);const G={...l,...F};localStorage.setItem("bg3_user_profile",JSON.stringify(G)),alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (ìƒˆë¡œê³ ì¹¨ ê¶Œì¥)"),window.location.reload()}catch(A){console.error(A),alert("ìˆ˜ì • ì‹¤íŒ¨: "+A.message)}finally{a(!1)}};return u?e.jsxs("div",{className:"glass-panel",style:{maxWidth:"500px",width:"100%",margin:p?"20px auto":"40px auto",padding:"30px",textAlign:"center",position:"relative"},children:[e.jsx("h3",{style:{fontSize:"1.5rem",marginBottom:"25px",color:"white"},children:"í”„ë¡œí•„ ìˆ˜ì •"}),e.jsxs("div",{style:{textAlign:"left",display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.9rem",opacity:.7,marginLeft:"5px",marginBottom:"5px",display:"block"},children:"ë‹‰ë„¤ì„"}),e.jsx("input",{value:E,onChange:A=>U(A.target.value),style:ee})]}),e.jsx(Ae,{selected:Z,onSelect:je}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.9rem",opacity:.7,marginLeft:"5px",marginBottom:"5px",display:"block"},children:"ì§ì—…"}),e.jsx(Ee,{selected:Y,onSelect:H})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"30px"},children:[e.jsx("button",{onClick:()=>W(!1),style:{flex:1,padding:"15px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:"å–æ¶ˆ"}),e.jsx("button",{onClick:C,style:{flex:2,padding:"15px",borderRadius:"12px",background:"var(--accent-color)",border:"none",color:"white",fontWeight:"bold",cursor:"pointer"},disabled:pe,children:pe?"ì €ì¥ ì¤‘...":"ì €ì¥í•˜ê¸°"})]})]}):e.jsxs("div",{className:"glass-panel",style:{maxWidth:"450px",width:"100%",margin:p?"20px auto 80px":"40px auto",padding:"40px",textAlign:"center"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"30px"},children:[e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",background:l.color||b?.color||"gray",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 30px ${l.color||b?.color||"gray"}`},children:b&&e.jsx(b.icon,{size:50,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.8rem",margin:"0 0 8px",fontWeight:"bold"},children:l.nickname}),e.jsx("span",{style:{fontSize:"0.95rem",opacity:.8,background:"rgba(255,255,255,0.1)",padding:"6px 12px",borderRadius:"20px"},children:l.className})]}),e.jsxs("div",{style:{textAlign:"left",background:"rgba(0,0,0,0.2)",padding:"25px",borderRadius:"16px"},children:[e.jsxs("p",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"15px",marginBottom:"15px"},children:[e.jsx("span",{style:{opacity:.6},children:"ì†Œì† ì•¼ì˜ì§€"}),e.jsx("b",{style:{fontSize:"1.1rem"},children:l.campId})]}),e.jsxs("p",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{opacity:.6},children:"ì§ì±…"}),e.jsx("b",{style:{color:l.isAdmin?"#f87171":"#4ade80"},children:l.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),e.jsxs("button",{onClick:()=>W(!0),style:{...ie,background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white",marginTop:"30px"},children:[e.jsx(ye,{size:18})," ì •ë³´ ìˆ˜ì •"]}),e.jsxs("button",{onClick:J,style:{...ie,background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",marginTop:"10px"},children:[e.jsx(Ye,{size:18}),"ë¡œê·¸ì•„ì›ƒ"]})]})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsx("div",{className:"glass-panel",style:{maxWidth:"1000px",width:"100%",padding:p?"30px 20px":"60px 60px",textAlign:"center",minHeight:p?"auto":"550px",display:"flex",alignItems:"center",justifyContent:"center",margin:0},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:p?"20px":"60px",width:"100%"},children:[e.jsx("div",{style:{flex:"1 1 300px",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",maxWidth:p?"240px":"420px",width:"100%"},children:[e.jsx("img",{src:ne,alt:"Logo",onClick:()=>window.location.reload(),title:"ìƒˆë¡œê³ ì¹¨",style:{width:"100%",cursor:"pointer",transition:"transform 0.3s ease",display:"block"},onMouseOver:u=>u.currentTarget.style.transform="scale(1.03)",onMouseOut:u=>u.currentTarget.style.transform="scale(1)"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${ne})`,maskImage:`url(${ne})`}})]})}),e.jsxs("div",{style:{flex:"1 1 300px",display:"flex",flexDirection:"column",gap:"20px",maxWidth:"350px",width:"100%"},children:[e.jsxs("button",{onClick:()=>{O(),j("login")},style:{...ie,background:"rgba(255,255,255,0.08)",color:"white",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(St,{size:20}),"ê¸°ì¡´ ëª¨í—˜ê°€ ë¡œê·¸ì¸"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",opacity:.3,fontSize:"0.8rem"},children:[e.jsx("div",{style:{flex:1,height:"1px",background:"white"}}),e.jsx("span",{children:"OR"}),e.jsx("div",{style:{flex:1,height:"1px",background:"white"}})]}),e.jsxs("button",{onClick:()=>{O(),j("join_camp")},style:{...ie,background:"linear-gradient(45deg, #7c3aed, #db2777)",color:"white",boxShadow:"0 4px 15px rgba(124, 58, 237, 0.3)"},children:[e.jsx(q,{size:20}),"ì•¼ì˜ì§€ í•©ë¥˜í•˜ê¸° (ì¼ë°˜)"]}),e.jsxs("button",{onClick:()=>{O(),j("create_camp")},style:{...ie,background:"linear-gradient(45deg, #ef4444, #f97316)",color:"white",boxShadow:"0 4px 15px rgba(239, 68, 68, 0.3)"},children:[e.jsx(ze,{size:20}),"ìƒˆ ì•¼ì˜ì§€ ê±´ì„¤ (ê´€ë¦¬ì)"]}),e.jsxs("p",{style:{marginTop:"10px",opacity:.8,fontSize:p?"0.75rem":"0.9rem",lineHeight:"1.5",fontWeight:"400",textAlign:"center",color:"rgba(255,255,255,0.7)"},children:["ë™ë£Œë“¤ê³¼ í•¨ê»˜ ë‚˜ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.",e.jsx("br",{}),e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ 3 ì›ì •ëŒ€"}),"ë¥¼ ìœ„í•œ",e.jsx("br",{}),"í•„ìˆ˜ ì»´íŒ¨ë‹ˆì–¸ ì•±"]})]})]})})}),S==="login"&&e.jsx(Te,{title:"ë¡œê·¸ì¸",sub:"ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”, ëª¨í—˜ê°€ë‹˜.",onClose:$,error:T,children:e.jsxs("form",{onSubmit:ce,children:[e.jsx("input",{type:"text",placeholder:"ë‹‰ë„¤ì„",value:s,onChange:u=>n(u.target.value),style:ee}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",value:x,onChange:u=>y(u.target.value),style:ee}),e.jsx("button",{type:"submit",style:{...ie,background:"white",color:"black",marginTop:"20px"},disabled:k,children:k?"ì¸ì¦ í™•ì¸ ì¤‘...":"ì•¼ì˜ì§€ ì…ì¥"})]})}),S==="create_camp"&&e.jsxs(Te,{title:"ì•¼ì˜ì§€ ê±´ì„¤",sub:"ë‹¹ì‹ ë§Œì˜ íŒŒí‹°ë¥¼ ì´ëŒì–´ë³´ì„¸ìš”.",onClose:$,error:T,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#fca5a5",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ê´€ë¦¬ì(ì˜ì£¼) ì •ë³´"}),e.jsx("input",{type:"text",placeholder:"ì˜ì£¼ ë‹‰ë„¤ì„",value:s,onChange:u=>n(u.target.value),style:ee}),e.jsx("input",{type:"password",placeholder:"ê°œì¸ ë¹„ë°€ë²ˆí˜¸",value:x,onChange:u=>y(u.target.value),style:{...ee,marginBottom:0}})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#c4b5fd",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ì˜ì§€(Room) ì„¤ì •"}),e.jsx("input",{type:"text",placeholder:"ì•¼ì˜ì§€ ì´ë¦„ (IDë¡œ ì‚¬ìš©ë¨)",value:g,onChange:u=>w(u.target.value),style:ee}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ì…ì¥ ì•”í˜¸ (íŒ€ì› ê³µìœ ìš©)",value:N,onChange:u=>B(u.target.value),style:{...ee,borderColor:"#818cf8",color:"#818cf8",marginBottom:0}})]}),e.jsx(Ae,{selected:z,onSelect:v}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"5px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(Ee,{selected:b,onSelect:h})]}),e.jsx("button",{onClick:d,style:{...ie,background:"#ef4444",color:"white"},disabled:k,children:k?"ì˜í†  ì„ í¬ ì¤‘...":"ê±´ì„¤ ì™„ë£Œ ë° ì…ì¥"})]}),S==="join_camp"&&e.jsxs(Te,{title:"ì•¼ì˜ì§€ í•©ë¥˜",sub:"ë™ë£Œë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.",onClose:$,error:T,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[!R&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("span",{style:{opacity:.7,fontSize:"0.9rem"},children:"ì°¸ì—¬ ê°€ëŠ¥í•œ ì˜ì§€"}),e.jsxs("button",{onClick:se,style:{background:"none",border:"none",color:"var(--accent-color)",cursor:"pointer",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(ye,{size:12})," ëª©ë¡ ê°±ì‹ "]})]}),e.jsx("div",{style:{maxHeight:"250px",overflowY:"auto",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"10px",background:"rgba(0,0,0,0.2)"},children:k&&c.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"íƒìƒ‰ ì¤‘..."}):c.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"í™œì„±í™”ëœ ì˜ì§€ê°€ ì—†ìŠµë‹ˆë‹¤."}):c.map(u=>e.jsxs("div",{onClick:()=>m(u.id),style:{padding:"16px",marginBottom:"8px",borderRadius:"10px",cursor:"pointer",background:"rgba(255,255,255,0.05)",border:"1px solid transparent",transition:"all 0.2s",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseOver:W=>{W.currentTarget.style.background="rgba(255,255,255,0.1)",W.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseOut:W=>{W.currentTarget.style.background="rgba(255,255,255,0.05)",W.currentTarget.style.borderColor="transparent"},children:[e.jsxs("span",{style:{fontWeight:"bold"},children:["ğŸ° ",u.name]}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.7,background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"4px"},children:[u.members?.length||0,"/4ëª…"]})]},u.id))})]}),R&&e.jsxs("div",{style:{animation:"fadeIn 0.3s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("button",{onClick:()=>m(null),style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"â†"}),e.jsx("h3",{style:{margin:0,fontSize:"1.2rem"},children:c.find(u=>u.id===R)?.name})]}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ì…ì¥ ì•”í˜¸",value:N,onChange:u=>B(u.target.value),style:{...ee,borderColor:"#818cf8",color:"#818cf8"}}),e.jsx("div",{style:{height:"10px"}}),e.jsx("input",{type:"text",placeholder:"ë‚´ ë‹‰ë„¤ì„",value:s,onChange:u=>n(u.target.value),style:ee}),e.jsx("input",{type:"password",placeholder:"ë‚´ ë¹„ë°€ë²ˆí˜¸",value:x,onChange:u=>y(u.target.value),style:ee}),e.jsx(Ae,{selected:z,onSelect:v}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"15px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(Ee,{selected:b,onSelect:h})]})]}),R&&e.jsx("button",{onClick:M,style:{...ie,background:"var(--accent-color)",color:"white"},disabled:k,children:k?"ì…ì¥ ì¤‘...":"í•©ë¥˜í•˜ê¸°"})]})]})},Yt=({user:t})=>{const[r,o]=i.useState([]),[p,l]=i.useState(!0);i.useEffect(()=>{if(!t?.campId)return;const s=K(L(I,"users_v2"),X("campId","==",t.campId)),n=Q(s,x=>{const y=x.docs.map(b=>({id:b.id,...b.data()}));o(y),l(!1)});return()=>n()},[t?.campId]);const S=async s=>{if(window.confirm(`ì •ë§ '${s.nickname}' ë‹˜ì„ ì˜ì§€ì—ì„œ ì¶”ë°©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await Re(P(I,"users_v2",s.id));const n=P(I,"camps",t.campId);await re(n,{members:zt(s.nickname)}),alert("ì¶”ë°©ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(n){console.error("Kick failed:",n),alert("ì¶”ë°© ì‹¤íŒ¨: "+n.message)}},j=async()=>{if(!window.confirm(`âš ï¸ ê²½ê³ : ì˜ì§€ë¥¼ í­íŒŒí•˜ë©´ ëª¨ë“  ë°ì´í„°ì™€ ë©¤ë²„ê°€ ì‚­ì œë©ë‹ˆë‹¤.
ì •ë§ ì´ ì•¼ì˜ì§€ë¥¼ í•´ì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;if(prompt("ì˜ì§€ë¥¼ ì‚­ì œí•˜ë ¤ë©´ 'ì˜ì§€ í­íŒŒ'ë¼ê³  ì…ë ¥í•˜ì„¸ìš”.")!=="ì˜ì§€ í­íŒŒ")return alert("ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");try{l(!0);const x=Rt(I),y=P(I,"camps",t.campId);x.delete(y),r.forEach(z=>{const v=P(I,"users_v2",z.id);x.delete(v)});const b=K(L(I,"chats"),X("campId","==",t.campId));(await Se(b)).forEach(z=>{x.delete(z.ref)}),await x.commit(),alert("ì•¼ì˜ì§€ê°€ ì—­ì‚¬ ì†ìœ¼ë¡œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤."),window.location.reload()}catch(x){console.error("Destroy failed:",x),alert("ì‚­ì œ ì‹¤íŒ¨: "+x.message)}finally{l(!1)}};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"30px",marginBottom:"30px",border:"1px solid var(--accent-color)",background:"rgba(50, 0, 0, 0.3)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 10px",color:"#fca5a5"},children:[e.jsx(fe,{})," ì˜ì£¼ ê´€ë¦¬ì‹¤ (Admin)"]}),e.jsxs("p",{style:{opacity:.8,fontSize:"0.9rem"},children:["í˜„ì¬ ì•¼ì˜ì§€: ",e.jsx("b",{children:t.campId})," ",e.jsx("br",{}),"ê¶Œí•œ: ",e.jsx("span",{style:{color:"var(--accent-color)"},children:"Master"})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs("h3",{style:{margin:0,fontSize:"1.1rem"},children:["ëŒ€ì› ëª©ë¡ (",r.length,"/4)"]})}),r.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"50%",background:s.isAdmin?"var(--accent-color)":"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.isAdmin?e.jsx(ze,{size:22,color:"white"}):e.jsx(Ie,{size:22})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[s.nickname,e.jsx("span",{style:{fontSize:"0.7rem",padding:"3px 8px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",opacity:.8},children:s.className||"ëª¨í—˜ê°€"})]}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.5,marginTop:"4px"},children:s.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),!s.isAdmin&&e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:async()=>{if(window.confirm(`'${s.nickname}' ë‹˜ì„ ê´€ë¦¬ìë¡œ ì„ëª…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{const{updateDoc:n,doc:x}=await Be(async()=>{const{updateDoc:y,doc:b}=await import("./vendor-BbMG-YK6.js").then(h=>h.am);return{updateDoc:y,doc:b}},[]);await n(x(I,"users_v2",s.id),{isAdmin:!0,role:"Admin"}),alert(`${s.nickname} ë‹˜ì´ ê´€ë¦¬ìê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(n){console.error(n),alert("ê¶Œí•œ ë¶€ì—¬ ì‹¤íŒ¨: "+n.message)}},style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(74, 222, 128, 0.1)",border:"1px solid rgba(74, 222, 128, 0.3)",color:"#4ade80",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(ze,{size:16})," ì„ëª…"]}),e.jsxs("button",{onClick:()=>S(s),style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ct,{size:16})," ì¶”ë°©"]})]})]},s.id)),r.length===0&&!p&&e.jsx("div",{style:{padding:"40px",textAlign:"center",opacity:.5},children:"ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤."})]}),e.jsxs("div",{style:{marginTop:"50px",borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"30px"},children:[e.jsxs("h3",{style:{color:"#ef4444",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(It,{})," ìœ„í—˜ êµ¬ì—­"]}),e.jsxs("div",{className:"glass-panel",style:{borderColor:"#ef4444",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 5px"},children:"ì˜ì§€ í­íŒŒ"}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:"ì´ ì•¼ì˜ì§€ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤."})]}),e.jsx("button",{onClick:j,style:{background:"#ef4444",color:"white",border:"none",padding:"12px 20px",borderRadius:"8px",fontWeight:"bold",cursor:"pointer"},children:"í­íŒŒ ì‹¤í–‰"})]})]})]})},tt=({user:t,tacticId:r,initialData:o,onBack:p,isMobile:l,isStandalone:S})=>{const[j,s]=i.useState(o?.elements||[]),[n,x]=i.useState(o?.viewState||{x:0,y:0,scale:1}),[y,b]=i.useState(null),[h,z]=i.useState("select"),[v,g]=i.useState(null),[w,N]=i.useState(""),[B,c]=i.useState(!1),[f,R]=i.useState(!1),[m,k]=i.useState({x:0,y:0}),[D,T]=i.useState({x:0,y:0}),_=i.useRef(null),O=i.useRef(null),$=i.useRef(!1);i.useEffect(()=>{if(!r)return;const a=Q(P(I,"tactics",r),C=>{if(C.exists()){const A=C.data();!f&&!B&&!v&&($.current=!0,s(A.elements||[]))}});return()=>a()},[r,f,B,v]);const se=i.useCallback(a=>{O.current&&clearTimeout(O.current),O.current=setTimeout(async()=>{if(!(!r||!t?.nickname))try{const C=P(I,"tactics",r);await re(C,{elements:a,lastModified:oe(),lastModifiedBy:t.nickname})}catch(C){console.error("Save failed",C)}},1e3)},[r,t.nickname]);i.useEffect(()=>{if($.current){$.current=!1;return}se(j)},[j,se]);const ce=a=>{h==="select"&&a.target===_.current&&(a.target.setPointerCapture(a.pointerId),c(!0),k({x:a.clientX,y:a.clientY}),b(null),g(null))},d=(a,C)=>{if(a.stopPropagation(),h!=="select")return;a.currentTarget.setPointerCapture(a.pointerId),b(C.id),R(!0);const A=_.current.getBoundingClientRect(),F=a.clientX-A.left,G=a.clientY-A.top,te=(F-n.x)/n.scale,ae=(G-n.y)/n.scale;T({x:te-C.x,y:ae-C.y}),k({x:a.clientX,y:a.clientY})},M=a=>{if(a.type==="text")g(a.id),N(a.content);else if(a.type==="video"){const C=a.content.startsWith("http")?a.content:"",A=prompt("ìœ íŠœë¸Œ ì˜ìƒ URLì„ ì…ë ¥í•˜ì„¸ìš”:",C);A&&H(a.id,{content:A})}},J=(a,C)=>{a.stopPropagation(),M(C)},u=()=>{const a=j.find(C=>C.id===y);a&&M(a)},W=a=>{if(B){const C=a.clientX-m.x,A=a.clientY-m.y;x(F=>({...F,x:F.x+C,y:F.y+A})),k({x:a.clientX,y:a.clientY})}if(f&&y){const C=_.current.getBoundingClientRect(),A=a.clientX-C.left,F=a.clientY-C.top,G=(A-n.x)/n.scale,te=(F-n.y)/n.scale;s(ae=>ae.map(xe=>xe.id===y?{...xe,x:G-D.x,y:te-D.y}:xe)),k({x:a.clientX,y:a.clientY})}},E=a=>{c(!1),R(!1)},U=()=>{y&&(s(a=>a.filter(C=>C.id!==y)),b(null),g(null))},Y=a=>{if(a.ctrlKey||a.metaKey){a.preventDefault();const A=-a.deltaY*.001,F=Math.min(Math.max(n.scale+A,.1),5);x(G=>({...G,scale:F}))}else x(C=>({...C,x:C.x-a.deltaX,y:C.y-a.deltaY}))},H=(a,C)=>{s(A=>A.map(F=>F.id===a?{...F,...C}:F))},Z=a=>{const C=Date.now().toString(),A=(-n.x+window.innerWidth/2)/n.scale,F=(-n.y+window.innerHeight/2)/n.scale;let G="",te=100,ae=100;a==="text"&&(G="ë”ë¸”í´ë¦­ í¸ì§‘",te=200),a==="video"&&(te=300,ae=200),a==="member"&&(G="íŒŒí‹°ì›",te=60,ae=80);const xe={id:C,type:a,x:A-te/2,y:F-ae/2,content:G,width:te,height:ae,color:"#ffffff"};s(nt=>[...nt,xe]),z("select")},je=()=>{v&&(H(v,{content:w}),g(null))},pe=a=>{if(!a)return null;const C=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,A=a.match(C);return A&&A[2]?.length===11?A[2]:null};return e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden",background:"#1a1a1a",position:"relative"},children:[e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,zIndex:100,padding:"15px 20px",background:"rgba(20,20,30,0.8)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[!S&&e.jsx("button",{onClick:p,style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer",padding:"8px",borderRadius:"50%"},children:e.jsx(Qe,{size:20})}),e.jsx("h2",{style:{margin:0,fontSize:"1rem",opacity:.8,color:"white"},children:o.title||"ì „ìˆ  í¸ì§‘"})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8,display:"flex",gap:"10px",alignItems:"center"},children:[e.jsxs("button",{onClick:()=>window.open(`?tacticId=${r}`,"_blank"),style:{background:"var(--accent-color)",border:"none",color:"white",borderRadius:"8px",padding:"6px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},title:"ìƒˆ íƒ­ì—ì„œ ê½‰ ì°¬ í™”ë©´ìœ¼ë¡œ ì—´ê¸°",children:[e.jsx(Dt,{size:14})," ",l?"":"ìƒˆ íƒ­ ì—´ê¸°"]}),y&&e.jsxs(e.Fragment,{children:[(j.find(a=>a.id===y)?.type==="text"||j.find(a=>a.id===y)?.type==="video")&&e.jsxs("button",{onClick:u,style:{background:"#3b82f6",border:"none",color:"white",borderRadius:"8px",padding:"6px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(Et,{size:14})," í¸ì§‘"]}),e.jsx("button",{onClick:U,style:{background:"#ef4444",border:"none",color:"white",borderRadius:"8px",padding:"6px 12px",cursor:"pointer"},children:"ì‚­ì œ"})]})]})]}),e.jsx("div",{ref:_,style:{flex:1,cursor:B?"grabbing":"grab",touchAction:"none"},onPointerDown:ce,onPointerMove:W,onPointerUp:E,onWheel:Y,children:e.jsxs("div",{style:{transform:`translate(${n.x}px, ${n.y}px) scale(${n.scale})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:-5e3,left:-5e3,width:1e4,height:1e4,backgroundImage:"radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"40px 40px",pointerEvents:"none"}}),j.map(a=>e.jsxs("div",{onPointerDown:C=>d(C,a),onDoubleClick:C=>J(C,a),style:{position:"absolute",left:a.x,top:a.y,width:a.width||"auto",height:a.height||"auto",padding:"10px",border:y===a.id?"2px solid var(--accent-color)":"1px solid transparent",borderRadius:"8px",userSelect:"none",cursor:"move",transform:y===a.id?"scale(1.02)":"scale(1)",transition:f&&y===a.id?"none":"transform 0.1s",background:a.type==="text"?"transparent":"rgba(0,0,0,0.2)"},children:[a.type==="text"&&(v===a.id?e.jsx("input",{autoFocus:!0,value:w,onChange:C=>N(C.target.value),onBlur:je,onKeyDown:C=>C.key==="Enter"&&je(),onPointerDown:C=>C.stopPropagation(),style:{background:"rgba(0,0,0,0.5)",border:"1px solid var(--accent-color)",color:"white",fontSize:"1.2rem",padding:"4px",width:"200px",borderRadius:"4px"}}):e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:a.content})),(a.type==="npc"||a.type==="mob")&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:a.type==="npc"?"#4ade80":"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 10px rgba(0,0,0,0.3)"},children:a.type==="npc"?e.jsx(Ie,{size:30,color:"#1a1a1a"}):e.jsx(Ce,{size:30,color:"white"})}),e.jsx("span",{style:{fontSize:"0.8rem",marginTop:"4px",background:"rgba(0,0,0,0.6)",color:"white",padding:"2px 6px",borderRadius:"4px"},children:a.type==="npc"?"NPC":"ENEMY"})]}),a.type==="member"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#3b82f6",border:"2px solid white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 15px rgba(59, 130, 246, 0.5)"},children:e.jsx(q,{size:28,color:"white"})}),e.jsx("span",{style:{fontSize:"0.8rem",marginTop:"4px",background:"rgba(0,0,0,0.6)",color:"white",padding:"2px 6px",borderRadius:"4px"},children:"íŒŒí‹°ì›"})]}),a.type==="video"&&e.jsxs("div",{style:{width:"300px",height:"180px",background:"black",borderRadius:"8px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(255,255,255,0.2)"},children:[pe(a.content)?e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${pe(a.content)}`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{pointerEvents:h==="select"?"none":"auto"}}):e.jsxs("div",{style:{color:"rgba(255,255,255,0.5)",textAlign:"center",padding:"20px"},children:[e.jsx(Le,{size:40,style:{marginBottom:"10px"}}),e.jsxs("p",{style:{fontSize:"0.9rem"},children:["ë”ë¸” í´ë¦­í•˜ì—¬",e.jsx("br",{}),"ìœ íŠœë¸Œ ë§í¬ ì…ë ¥"]})]}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:"20px",background:"rgba(255,255,255,0.1)",cursor:"move"}})]})]},a.id))]})}),e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(30,30,40,0.9)",backdropFilter:"blur(15px)",padding:"10px 20px",borderRadius:"50px",display:"flex",gap:"15px",border:"1px solid rgba(255,255,255,0.2)",boxShadow:"0 10px 30px rgba(0,0,0,0.5)",zIndex:101,overflowX:"auto",maxWidth:"95vw"},children:[e.jsx(le,{icon:At,active:h==="select",onClick:()=>z("select"),label:"ì„ íƒ"}),e.jsx(le,{icon:Tt,active:h==="text",onClick:()=>Z("text"),label:"í…ìŠ¤íŠ¸"}),e.jsx(le,{icon:q,active:h==="member",onClick:()=>Z("member"),label:"íŒŒí‹°ì›"}),e.jsx(le,{icon:Ie,active:h==="npc",onClick:()=>Z("npc"),label:"NPC"}),e.jsx(le,{icon:Ce,active:h==="mob",onClick:()=>Z("mob"),label:"ì "}),e.jsx(le,{icon:Le,active:h==="video",onClick:()=>Z("video"),label:"ì˜ìƒ"})]})]})},le=({icon:t,active:r,onClick:o,label:p})=>e.jsx("button",{onClick:o,style:{background:r?"var(--accent-color)":"transparent",border:"none",color:r?"white":"rgba(255,255,255,0.6)",padding:"10px",borderRadius:"50%",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",minWidth:"50px",transition:"all 0.2s"},title:p,children:e.jsx(t,{size:24})}),Ht=({user:t,initialTacticId:r,clearInitialTactic:o})=>{const[p,l]=i.useState([]),[S,j]=i.useState(!0),[s,n]=i.useState(!1),[x,y]=i.useState(0),[b,h]=i.useState(null),[z,v]=i.useState(""),[g,w]=i.useState("");i.useEffect(()=>{if(!t?.campId)return;const c=K(L(I,"tactics"),X("campId","==",t.campId),we("createdAt","desc")),f=Q(c,R=>{const m=R.docs.map(k=>({id:k.id,...k.data()}));l(m),j(!1)},R=>{console.error("Error fetching tactics:",R),j(!1)});return()=>f()},[t?.campId,x]),i.useEffect(()=>{if(r&&p.length>0){const c=p.find(f=>f.id===r);c&&(h(c),o&&o())}},[r,p,o]);const N=async c=>{if(c.preventDefault(),!!z.trim()){if(!t.campId){alert("ì†Œì†ëœ ì˜ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");return}try{console.log("Creating tactic...",{campId:t.campId,author:t.nickname,title:z});const f={campId:t.campId,authorId:t.id||t.nickname,authorName:t.nickname,title:z,description:g,createdAt:oe(),elements:[]},R=await be(L(I,"tactics"),f);console.log("Tactic created successfully"),j(!0),y(m=>m+1),n(!1),v(""),w(""),h({id:R.id,...f})}catch(f){console.error("Error creating tactic:",f),alert("ì „ìˆ íŒ ìƒì„± ì‹¤íŒ¨: "+f.code+" - "+f.message)}}},B=async(c,f)=>{if(c.stopPropagation(),!!confirm("ì •ë§ë¡œ ì´ ì „ìˆ íŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await Re(P(I,"tactics",f))}catch(R){console.error("Error deleting tactic:",R),alert("ì‚­ì œ ì‹¤íŒ¨")}};return e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"1.8rem",fontWeight:"bold",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(me,{className:"text-accent"}),"ì „ìˆ  ì‘ì „ì‹¤"]}),e.jsx("p",{style:{opacity:.6,fontSize:"0.9rem",marginTop:"5px"},children:"íŒŒí‹°ì›ë“¤ê³¼ í•¨ê»˜ ì‘ì „ì„ ìˆ˜ë¦½í•˜ê³  ê³µìœ í•˜ì„¸ìš”."})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>{j(!0),y(c=>c+1)},className:"glass-button",style:{background:"rgba(255,255,255,0.1)",color:"white",border:"none",padding:"12px",borderRadius:"12px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"ìƒˆë¡œê³ ì¹¨",children:e.jsx(ye,{size:20})}),e.jsxs("button",{onClick:()=>n(!0),className:"glass-button",style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 20px",borderRadius:"12px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 15px rgba(245, 158, 11, 0.4)"},children:[e.jsx(Nt,{size:20}),"ìƒˆ ì‘ì „ ìˆ˜ë¦½"]})]})]}),S?e.jsx("div",{style:{textAlign:"center",padding:"40px",opacity:.5},children:"ë¡œë”© ì¤‘..."}):p.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",background:"rgba(255,255,255,0.03)",borderRadius:"20px",border:"1px dashed rgba(255,255,255,0.1)"},children:[e.jsx(me,{size:48,style:{opacity:.2,marginBottom:"20px"}}),e.jsx("p",{style:{fontSize:"1.1rem",fontWeight:"bold"},children:"ì•„ì§ ìˆ˜ë¦½ëœ ì‘ì „ì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{style:{opacity:.6,fontSize:"0.9rem"},children:"ìƒˆ ì‘ì „ ìˆ˜ë¦½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ë²ˆì§¸ ì „ìˆ íŒì„ ë§Œë“¤ì–´ë³´ì„¸ìš”."})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"20px"},children:p.map(c=>e.jsxs("div",{onClick:()=>h(c),className:"glass-panel",style:{padding:"0",cursor:"pointer",overflow:"hidden",display:"flex",flexDirection:"column",height:"220px",transition:"all 0.2s",position:"relative"},onMouseEnter:f=>f.currentTarget.style.transform="translateY(-5px)",onMouseLeave:f=>f.currentTarget.style.transform="translateY(0)",children:[e.jsx("div",{style:{flex:2,background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsx(me,{size:32,style:{opacity:.1}})}),e.jsxs("div",{style:{flex:1,padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"8px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"80%"},children:c.title}),(t.isAdmin||t.id===c.authorId)&&e.jsx("button",{onClick:f=>B(f,c.id),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",padding:"4px"},children:e.jsx(et,{size:16})})]}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.description||"ì„¤ëª… ì—†ìŒ"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",fontSize:"0.75rem",opacity:.4},children:[e.jsx("span",{children:c.authorName}),e.jsx("span",{children:c.createdAt?.toDate?.()?c.createdAt.toDate().toLocaleDateString():"ë°©ê¸ˆ ì „"})]})]})]},c.id))}),s&&e.jsx("div",{className:"modal-overlay",onClick:()=>n(!1),children:e.jsxs("div",{className:"modal-content",onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"20px"},children:"ìƒˆ ì‘ì „ ìˆ˜ë¦½"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ì‘ì „ëª…"}),e.jsx("input",{type:"text",value:z,onChange:c=>v(c.target.value),placeholder:"ì˜ˆ: 3ë§‰ ë³´ìŠ¤ ê³µëµ",style:{width:"100%",padding:"12px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px"},autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"25px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ì„¤ëª… (ì„ íƒ)"}),e.jsx("textarea",{value:g,onChange:c=>w(c.target.value),placeholder:"ì‘ì „ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.",style:{width:"100%",padding:"12px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px",minHeight:"80px"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx("button",{type:"button",onClick:()=>n(!1),style:{padding:"10px 20px",borderRadius:"8px",background:"transparent",border:"1px solid rgba(255,255,255,0.2)",color:"white",cursor:"pointer"},children:"ì·¨ì†Œ"}),e.jsx("button",{type:"submit",style:{padding:"10px 20px",borderRadius:"8px",background:"var(--accent-color)",border:"none",color:"white",fontWeight:"bold",cursor:"pointer"},children:"ìƒì„±í•˜ê¸°"})]})]})]})}),b&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2e3,background:"#1a1a1a",animation:"fadeIn 0.2s ease-out"},children:e.jsx(tt,{user:t,tacticId:b.id,initialData:b,onBack:()=>h(null),isMobile:window.innerWidth<768})})]})},qt=({user:t,isMobile:r,initialTacticId:o,clearInitialTactic:p})=>e.jsx(Ht,{user:t,isMobile:r,initialTacticId:o,clearInitialTactic:p}),Xt=({user:t,onClose:r})=>{const[o,p]=i.useState([]),[l,S]=i.useState(!0);i.useEffect(()=>{if(!t?.campId)return;const s=K(L(I,"users_v2"),X("campId","==",t.campId)),n=Q(s,x=>{const y=Date.now(),b=x.docs.map(h=>{const z=h.data(),v=z.lastSeen?.toMillis?z.lastSeen.toMillis():0,g=y-v<120*1e3;return{id:h.id,...z,isOnline:g,lastSeenAgo:Math.floor((y-v)/6e4)}});b.sort((h,z)=>h.isOnline===z.isOnline?h.nickname.localeCompare(z.nickname):z.isOnline?1:-1),p(b),S(!1)});return()=>n()},[t?.campId]);const j=async s=>{if(window.confirm(`${s.nickname}ë‹˜ì„ ì •ë§ ê¹¨ìš°ì‹œê² ìŠµë‹ˆê¹Œ? (ì•Œë¦¼ ë°œì†¡)`))try{await be(L(I,"camps",t.campId,"notifications"),{type:"WAKE_UP",targetUid:s.id,sender:t.nickname,read:!1,timestamp:oe()}),alert("â° ê¸°ìƒ ë‚˜íŒ”ì„ ë¶ˆì—ˆìŠµë‹ˆë‹¤!")}catch(n){console.error(n),alert("ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨")}};return ve.createPortal(e.jsx("div",{className:"modal-overlay",onClick:r,children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),style:{maxWidth:"400px",padding:"0",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(q,{className:"text-accent"})," ìƒì¡´ì ëª©ë¡ (",o.filter(s=>s.isOnline).length,"ëª… ì ‘ì†)"]}),e.jsx("button",{onClick:r,style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"âœ•"})]}),e.jsx("div",{style:{padding:"20px",maxHeight:"400px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px"},children:l?e.jsx("p",{style:{textAlign:"center",opacity:.5},children:"ëª…ë‹¨ í™•ì¸ ì¤‘..."}):o.map(s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",borderRadius:"12px",background:s.isOnline?"rgba(74, 222, 128, 0.1)":"rgba(255, 255, 255, 0.03)",border:s.isOnline?"1px solid rgba(74, 222, 128, 0.3)":"1px solid rgba(255, 255, 255, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:s.isOnline?"#4ade80":"#94a3b8",boxShadow:s.isOnline?"0 0 10px #4ade80":"none"}}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[s.nickname," ",s.id===t.id&&e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ë‚˜)"})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:[s.className," â€¢ ",s.isOnline?"ì˜¨ë¼ì¸":`${s.lastSeenAgo}ë¶„ ì „ ì ‘ì†`]})]})]}),!s.isOnline&&s.id!==t.id&&e.jsxs("button",{onClick:()=>j(s),style:{padding:"6px 12px",borderRadius:"20px",border:"none",background:"rgba(255,255,255,0.1)",color:"white",fontSize:"0.8rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(Bt,{size:12})," ê¹¨ìš°ê¸°"]})]},s.id))})]})}),document.body)},Kt=()=>{const[t,r]=i.useState("home"),[o,p]=i.useState(window.innerWidth<768),[l,S]=i.useState(0),[j,s]=i.useState(!1),[n,x]=i.useState(()=>{try{return JSON.parse(localStorage.getItem("bg3_user_profile"))}catch{return null}});if(i.useEffect(()=>{const v=()=>p(window.innerWidth<768);return window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]),i.useEffect(()=>{},[n]),i.useEffect(()=>{if(!n?.id)return;const v=async()=>{try{await re(P(I,"users_v2",n.id),{lastSeen:oe()})}catch(w){console.error("Heartbeat fail",w)}};v();const g=setInterval(v,6e4);return()=>clearInterval(g)},[n?.id]),i.useEffect(()=>{if(!n?.campId)return;const v=K(L(I,"users_v2"),X("campId","==",n.campId)),g=Q(v,w=>{S(w.size)});return()=>g()},[n?.campId]),i.useEffect(()=>{if(!n?.campId||!n?.id)return;const v=K(L(I,"camps",n.campId,"notifications"),X("targetUid","==",n.id),X("read","==",!1)),g=Q(v,w=>{w.docChanges().forEach(N=>{if(N.type==="added"){const B=N.doc.data();B.type==="WAKE_UP"&&(new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3").play().catch(f=>console.log("Audio play failed",f)),alert(`â° ${B.sender}ë‹˜ì´ ë‹¹ì‹ ì„ ê¹¨ìš°ê³  ìˆìŠµë‹ˆë‹¤! ì–¼ë¥¸ ì¼ì–´ë‚˜ì„¸ìš”!`),re(N.doc.ref,{read:!0}))}})});return()=>g()},[n?.campId,n?.id]),!n)return e.jsx(Ue,{onComplete:()=>window.location.reload(),isMobile:o});const[y,b]=i.useState(null),h=v=>{b(v),r("tactics")},z=()=>{const v={user:n,isMobile:o,onlineUsersCount:l,setShowSurvivors:s};switch(t){case"home":return e.jsx($e,{...v,setActiveTab:r,openTactic:h});case"chat":return e.jsx(Ft,{...v,setActiveTab:r});case"calendar":return e.jsx($t,{...v});case"save":return e.jsx(Ut,{...v});case"admin":return e.jsx(Yt,{...v});case"tactics":return e.jsx(qt,{...v,initialTacticId:y,clearInitialTactic:()=>b(null)});case"profile":return e.jsx(Ue,{user:n,onComplete:()=>window.location.reload(),isMobile:o});default:return e.jsx($e,{...v,setActiveTab:r})}};return e.jsxs("div",{className:"layout-container",style:{display:"flex",minHeight:"100vh",color:"#e2e8f0",fontFamily:"Pretendard, sans-serif"},children:[e.jsx(Ot,{activeTab:t,setActiveTab:r,isMobile:o,user:n,onlineUsersCount:l,setShowSurvivors:s}),e.jsx("main",{style:{flex:1,padding:o?"15px 15px 110px":"40px",overflowY:"auto",position:"relative"},children:e.jsx("div",{style:{maxWidth:"1400px",margin:"0 auto",width:"100%"},children:z()})}),j&&e.jsx(Xt,{user:n,onClose:()=>s(!1)})]})};function Jt(){const r=new URLSearchParams(window.location.search).get("tacticId"),o=JSON.parse(localStorage.getItem("bg3_user_profile")||"null");return r&&o?e.jsx(tt,{user:o,tacticId:r,initialData:{title:"Loading...",elements:[]},onBack:()=>window.close(),isMobile:window.innerWidth<768,isStandalone:!0}):e.jsx(Kt,{})}class Vt extends V.Component{constructor(r){super(r),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,o){this.setState({error:r,errorInfo:o}),console.error("Uncaught error:",r,o)}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",color:"white",background:"#333"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px"},children:"Reload"})]}):this.props.children}}_t.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Vt,{children:e.jsx(Jt,{})})}));
