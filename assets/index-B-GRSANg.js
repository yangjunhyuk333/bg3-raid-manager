import{i as Ue,g as Ye,R as $,H as we,M as fe,C as ae,P as He,F as ke,U,j as e,a as Xe,r as le,L as Ee,S as Be,T as qe,b as l,A as Ne,q as H,c as W,o as be,l as je,d as ve,e as Ke,f as Je,h as _e,k as Ge,m as Ve,n as Te,Z as We,p as ie,s as Me,G as Qe,t as Ze,u as de,W as Pe,w as Y,v as X,B as et,x as ce,X as Le,I as tt,y as nt,z as re,D as Z,E as se,J as M,K as xe,N as st,O as at,Q as it,V as pe,Y as ge,_ as rt,$ as me,a0 as Oe,a1 as ot,a2 as lt,a3 as dt,a4 as ct,a5 as pt,a6 as te,a7 as ee,a8 as Se,a9 as xt,aa as gt,ab as mt,ac as ht,ad as he,ae as ut,af as ft,ag as yt,ah as bt,ai as jt,aj as vt}from"./vendor-DcZOgQkA.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))x(g);new MutationObserver(g=>{for(const u of g)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&x(f)}).observe(document,{childList:!0,subtree:!0});function r(g){const u={};return g.integrity&&(u.integrity=g.integrity),g.referrerPolicy&&(u.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?u.credentials="include":g.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function x(g){if(g.ep)return;g.ep=!0;const u=r(g);fetch(g.href,u)}})();const wt="modulepreload",kt=function(t){return"/bg3-raid-manager/"+t},Ce={},ye=function(i,r,x){let g=Promise.resolve();if(r&&r.length>0){let a=function(c){return Promise.all(c.map(y=>Promise.resolve(y).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),s=f?.nonce||f?.getAttribute("nonce");g=a(r.map(c=>{if(c=kt(c),c in Ce)return;Ce[c]=!0;const y=c.endsWith(".css"),d=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const o=document.createElement("link");if(o.rel=y?"stylesheet":wt,y||(o.as="script"),o.crossOrigin="",o.href=c,s&&o.setAttribute("nonce",s),document.head.appendChild(o),y)return new Promise((m,I)=>{o.addEventListener("load",m),o.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${c}`)))})}))}function u(f){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=f,window.dispatchEvent(s),!s.defaultPrevented)throw f}return g.then(f=>{for(const s of f||[])s.status==="rejected"&&u(s.reason);return i().catch(u)})},J="/bg3-raid-manager/assets/logo-BLpM7sGS.svg",St={apiKey:"AIzaSyAsbaWbo3DoSTrRFhkaf9XujWPpmeGSjAE",authDomain:"bg3-raid-manager.firebaseapp.com",projectId:"bg3-raid-manager",storageBucket:"bg3-raid-manager.firebasestorage.app",messagingSenderId:"773826713403",appId:"1:773826713403:web:c15fdfca708d47f4fcc91e"},Ct=Ue(St),k=Ye(Ct);console.log("ğŸ”¥ Firebase Connected (Real DB Mode)");const Ie=({size:t=20,color:i="currentColor"})=>e.jsxs("div",{style:{position:"relative",width:t,height:t,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(qe,{size:t,color:i}),e.jsx(Be,{size:t*.5,color:i,style:{position:"absolute",bottom:-2,right:-2,background:"#1a1a2e",borderRadius:"50%"}})]}),It=({activeTab:t,setActiveTab:i,isMobile:r,user:x,onlineUsersCount:g,setShowSurvivors:u})=>{const[f,s]=$.useState(4),[a,c]=$.useState(!1),[y,d]=$.useState(!1),[o,m]=$.useState(!1),[I,D]=$.useState(!1),b=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],[S,v]=$.useState(x?.nickname||""),[R,B]=$.useState(x?.className||"Warrior"),[A,h]=$.useState(x?.role||(x?.isAdmin?"Admin":"User")),[j,C]=$.useState(x?.color||b[Math.floor(Math.random()*b.length)]),_=x?.isAdmin===!0;$.useEffect(()=>{x&&(v(x.nickname||""),B(x.className||"Warrior"),h(x.role||(x.isAdmin?"Admin":"User")),C(x.color||b[Math.floor(Math.random()*b.length)]))},[x,y]),$.useEffect(()=>{const n=w=>{w.shiftKey&&w.altKey&&(w.key==="R"||w.key==="r")&&m(N=>!N)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[]);const T=()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},P=async()=>{if(!S.trim())return alert("Nickname is required");try{const{updateDoc:n,doc:w}=await ye(async()=>{const{updateDoc:z,doc:L}=await import("./vendor-DcZOgQkA.js").then(F=>F.ak);return{updateDoc:z,doc:L}},[]),N=w(k,"users_v2",x.id),p={nickname:S,className:R,role:A,color:j};await n(N,p);const E={...x,...p};localStorage.setItem("bg3_user_profile",JSON.stringify(E)),alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì ìš©ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤."),window.location.reload()}catch(n){console.error(n),alert("ìˆ˜ì • ì‹¤íŒ¨: "+n.message)}},O=["ë°”ë°”ë¦¬ì•ˆ","ë°”ë“œ","í´ë ˆë¦­","ë“œë£¨ì´ë“œ","íŒŒì´í„°","ëª½í¬","íŒ”ë¼ë”˜","ë ˆì¸ì €","ë¡œê·¸","ì†Œì„œëŸ¬","ì›Œë½","ìœ„ìë“œ"],G=[{id:"home",label:"í™ˆ",icon:we},{id:"chat",label:"ì±„íŒ…",icon:fe},{id:"calendar",label:"ì¼ì •",icon:ae},{id:"tactics",label:"ì „ìˆ íŒ",icon:He},{id:"save",label:"ì„¸ì´ë¸Œ",icon:ke},{id:"profile",label:"í”„ë¡œí•„",icon:U}];_&&G.push({id:"admin",label:"ì•¼ì˜ì§€ ê´€ë¦¬",icon:Ie});const V=G.filter(n=>n.id!=="profile");if(r){const n=[{id:"home",icon:we,label:"í™ˆ"},{id:"calendar",icon:ae,label:"ì¼ì •"},{id:"tactics",icon:Xe,label:"ì „ìˆ "},..._?[{id:"admin",icon:Ie,label:"ê´€ë¦¬"}]:[],{id:"profile",icon:U,label:"í”„ë¡œí•„"}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{position:"fixed",bottom:"calc(100px + env(safe-area-inset-bottom))",right:"20px",zIndex:1001,display:t==="chat"?"none":"flex",flexDirection:"column",gap:"12px"},children:[e.jsx("button",{onClick:()=>i("save"),style:{width:"45px",height:"45px",borderRadius:"50%",background:t==="save"?"var(--accent-color)":"rgba(20, 20, 30, 0.7)",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",transition:"all 0.2s"},children:e.jsx(ke,{size:20})}),e.jsx("button",{onClick:()=>i("chat"),style:{width:"45px",height:"45px",borderRadius:"50%",background:t==="chat"?"var(--accent-color)":"rgba(20, 20, 30, 0.7)",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",transition:"all 0.2s"},children:e.jsx(fe,{size:20})})]}),e.jsx("nav",{className:"glass",style:{position:"fixed",bottom:"calc(25px + env(safe-area-inset-bottom))",left:"20px",right:"20px",height:"70px",zIndex:1e3,display:t==="chat"?"none":"flex",justifyContent:"space-between",alignItems:"center",borderRadius:"40px",border:"1px solid rgba(255,255,255,0.15)",borderTop:"1px solid rgba(255,255,255,0.25)",backdropFilter:"blur(25px) saturate(180%)",background:"linear-gradient(145deg, rgba(30, 30, 45, 0.6), rgba(10, 10, 20, 0.8))",padding:"0 25px",boxShadow:"0 15px 35px rgba(0,0,0,0.5), inset 0 1px 1px rgba(255,255,255,0.1)"},children:n.map(w=>{const N=w.icon,p=t===w.id;return e.jsx("button",{onClick:()=>i(w.id),style:{background:p?"var(--accent-color)":"transparent",borderRadius:"50%",width:"45px",height:"45px",border:"none",display:"flex",alignItems:"center",justifyContent:"center",color:p?"white":"rgba(255,255,255,0.5)",transition:"all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:e.jsx(N,{size:22,strokeWidth:2.5})},w.id)})})]})}return e.jsxs("aside",{className:"glass",style:{width:"280px",height:"100vh",margin:0,padding:"25px",display:"flex",flexDirection:"column",borderRadius:0,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(20, 20, 30, 0.4)",position:"sticky",top:0},children:[e.jsxs("div",{style:{padding:"0 0 25px",textAlign:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[o&&e.jsx("button",{id:"db-reset-btn",onClick:async()=>{if(confirm("âš ï¸ ê²½ê³ : ì •ë§ë¡œ DBë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëŒì´í‚¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")){const{collection:n,getDocs:w,deleteDoc:N}=await ye(async()=>{const{collection:z,getDocs:L,deleteDoc:F}=await import("./vendor-DcZOgQkA.js").then(q=>q.ak);return{collection:z,getDocs:L,deleteDoc:F}},[]);(await w(n(k,"users_v2"))).forEach(z=>N(z.ref)),(await w(n(k,"camps"))).forEach(z=>N(z.ref)),alert("ì´ˆê¸°í™” ì™„ë£Œ. ì¬ì ‘ì†í•©ë‹ˆë‹¤."),T()}},style:{background:"red",color:"white",border:"none",padding:"5px",marginBottom:"10px",fontSize:"0.7rem",cursor:"pointer",width:"100%"},children:"[ADMIN] DB ì´ˆê¸°í™”"}),e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"100%",marginBottom:"10px",cursor:"pointer"},onClick:()=>window.location.reload(),children:[e.jsx("img",{src:J,alt:"BG3",style:{width:"100%",height:"auto",display:"block"},onError:n=>n.target.style.display="none"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${J})`,maskImage:`url(${J})`}})]}),e.jsxs("div",{onClick:()=>u&&u(!0),style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",background:"rgba(0,0,0,0.3)",borderRadius:"12px",fontSize:"0.75rem",border:"1px solid rgba(255,255,255,0.1)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:n=>n.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:n=>n.currentTarget.style.background="rgba(0,0,0,0.3)",children:[e.jsx(U,{size:12,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80"},children:[g,"/",f,"ëª… ì ‘ì† ì¤‘"]})]})]}),e.jsx("nav",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"20px",flex:1},children:V.map(n=>{const w=n.icon;return e.jsxs("button",{onClick:()=>i(n.id),style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:t===n.id?"rgba(255,255,255,0.15)":"transparent",color:t===n.id?"white":"rgba(255,255,255,0.7)",borderRadius:"12px",transition:"all 0.2s",border:"none",cursor:"pointer",fontSize:"0.95rem",fontWeight:t===n.id?"bold":"normal"},children:[e.jsx(w,{size:20,color:t===n.id?"var(--accent-color)":"currentColor"}),n.label]},n.id)})}),e.jsxs("div",{onClick:()=>c(!0),style:{marginTop:"auto",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s",padding:"8px 8px 8px 12px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",height:"60px"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(255, 255, 255, 0.08)",n.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(20, 20, 35, 0.6)",n.currentTarget.style.borderColor="rgba(255, 255, 255, 0.1)"},title:"í”„ë¡œí•„ ë³´ê¸°",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:x.color||"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 2px 10px ${x.color||"#f59e0b"}66`},children:e.jsx(U,{size:20,color:"white"})}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.95rem",color:"white"},children:x.nickname})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),D(!0)},style:{width:"40px",height:"40px",background:"rgba(248, 113, 113, 0.15)",border:"1px solid rgba(248, 113, 113, 0.3)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fca5a5",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:n=>n.currentTarget.style.background="rgba(248, 113, 113, 0.25)",onMouseLeave:n=>n.currentTarget.style.background="rgba(248, 113, 113, 0.15)",children:e.jsx(Ee,{size:16})})]}),I&&le.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>D(!1),children:e.jsxs("div",{className:"modal-content",onClick:n=>n.stopPropagation(),style:{maxWidth:"350px",padding:"30px",textAlign:"center"},children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"10px",marginTop:"10px"},children:"ë¡œê·¸ì•„ì›ƒ"}),e.jsxs("p",{style:{opacity:.8,marginBottom:"30px",lineHeight:"1.5"},children:["ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ëª¨ë“  ë¡œê·¸ì¸ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤)"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>D(!1),style:{flex:1,padding:"14px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"transparent",color:"white",cursor:"pointer",fontWeight:"bold"},children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:T,style:{flex:1,padding:"14px",borderRadius:"12px",border:"none",background:"linear-gradient(45deg, #ef4444, #dc2626)",color:"white",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 15px rgba(239,68,68,0.3)"},children:"í™•ì¸"})]})]})}),document.body),a&&le.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>c(!1),children:e.jsxs("div",{className:"modal-content",onClick:n=>n.stopPropagation(),style:{maxWidth:"400px",padding:"30px",textAlign:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 0 20px rgba(212, 160, 23, 0.4)"},children:e.jsx(U,{size:40,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.6rem",marginBottom:"5px",fontWeight:"bold"},children:x?.nickname||"ëª¨í—˜ê°€"}),e.jsxs("p",{style:{color:"var(--accent-color)",marginBottom:"20px",fontSize:"0.9rem",fontWeight:"bold"},children:[x?.className||"Classless"," ",e.jsx("span",{style:{opacity:.5},children:"|"})," ",x?.role==="Admin"||x?.isAdmin?"ëŒ€ì¥ (ê´€ë¦¬ì)":"ëŒ€ì›"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"25px",textAlign:"left"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì§ì—…"}),e.jsx("p",{style:{fontWeight:"bold"},children:x?.className||"-"})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì‹ ë¶„"}),e.jsx("p",{style:{fontWeight:"bold"},children:x?.role==="Admin"||x?.isAdmin?"ê´€ë¦¬ì":"ì¼ë°˜ ëŒ€ì›"})]})]}),e.jsxs("button",{onClick:()=>{c(!1),d(!0)},style:{width:"100%",padding:"14px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s"},onMouseEnter:n=>n.currentTarget.style.background="rgba(255,255,255,0.2)",onMouseLeave:n=>n.currentTarget.style.background="rgba(255,255,255,0.1)",children:[e.jsx(Be,{size:18}),"í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°"]})]})}),document.body),y&&le.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:e.jsxs("div",{className:"modal-content",onClick:n=>n.stopPropagation(),style:{maxWidth:"400px",padding:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(U,{size:24,color:"var(--accent-color)"}),"í”„ë¡œí•„ ìˆ˜ì •"]}),e.jsx("button",{onClick:()=>d(!1),style:{background:"transparent",color:"rgba(255,255,255,0.5)"},children:"x"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ë‹‰ë„¤ì„"}),e.jsx("input",{type:"text",value:S,onChange:n=>v(n.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ì§ì—… (Class)"}),e.jsx("select",{value:R,onChange:n=>B(n.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"},children:O.map(n=>e.jsx("option",{value:n,style:{background:"#1a1a2e"},children:n},n))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:b.map(n=>e.jsx("div",{onClick:()=>C(n),style:{width:"28px",height:"28px",borderRadius:"50%",background:n,cursor:"pointer",border:j===n?"3px solid white":"1px solid transparent",boxShadow:j===n?"0 0 10px "+n:"none",transform:j===n?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},n))})]}),e.jsx("button",{onClick:P,style:{marginTop:"10px",padding:"14px",borderRadius:"10px",background:"var(--accent-color)",color:"white",border:"none",fontWeight:"bold",fontSize:"1rem",cursor:"pointer"},children:"ì €ì¥í•˜ê¸°"})]})]})}),document.body)]})},Re=({user:t,setActiveTab:i,isMobile:r,onlineUsersCount:x,setShowSurvivors:g})=>{const[u,f]=l.useState([]),[s,a]=l.useState(!0),[c,y]=l.useState(()=>{const o=localStorage.getItem("bg3_daily_goals");return o?JSON.parse(o):[{id:1,text:"ê¸´ íœ´ì‹ ì·¨í•˜ê¸° (ì£¼ë¬¸ ìŠ¬ë¡¯ ë³µêµ¬)",checked:!1},{id:2,text:"ì•¼ì˜ì§€ ë¬¼ì í™•ì¸",checked:!1},{id:3,text:"ìƒì¸ì—ê²Œ ì¡ë™ì‚¬ë‹ˆ íŒë§¤",checked:!1},{id:4,text:"ë™ë£Œ í˜¸ê°ë„ ëŒ€í™”",checked:!1}]});l.useEffect(()=>{localStorage.setItem("bg3_daily_goals",JSON.stringify(c))},[c]),l.useEffect(()=>{(async()=>{try{const m=H(W(k,"schedules"),be("date"),je(2)),D=(await ve(m)).docs.map(b=>({id:b.id,...b.data()}));f(D)}catch(m){console.error(m)}finally{a(!1)}})()},[]);const d=({icon:o,title:m,desc:I,onClick:D,color:b})=>e.jsxs("div",{onClick:D,className:"glass-panel",style:{padding:"20px",cursor:"pointer",transition:"transform 0.2s",display:"flex",flexDirection:"column",gap:"10px"},onMouseEnter:S=>S.currentTarget.style.transform="translateY(-5px)",onMouseLeave:S=>S.currentTarget.style.transform="translateY(0)",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{padding:"10px",borderRadius:"12px",background:`rgba(${b}, 0.2)`},children:e.jsx(o,{color:`rgb(${b})`,size:24})}),e.jsx(Ke,{size:16,style:{opacity:.5}})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"5px 0",fontSize:"1.1rem"},children:m}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:I})]})]});return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",display:"flex",flexDirection:"column",gap:r?"15px":"30px"},children:[r&&e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"180px",margin:"0 auto 10px"},children:[e.jsx("img",{src:J,alt:"BG3",style:{width:"100%"},onClick:()=>window.location.reload()}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${J})`,maskImage:`url(${J})`}})]}),e.jsxs("div",{style:{width:"100%",minHeight:"90px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 10px 30px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"space-between",padding:r?"20px 25px":"0 40px",textAlign:"left"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,fontSize:r?"1.2rem":"1.6rem",fontWeight:"bold"},children:["ì–´ì„œì˜¤ì„¸ìš”, ",e.jsx("span",{style:{color:t?.color||"#ffd700"},children:t.nickname}),"ë‹˜"]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"0.85rem",opacity:.6},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ ì›ì •ëŒ€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤."})]}),e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:t?.color||"#ffd700",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 20px ${t?.color||"#ffd700"}66`,flexShrink:0,marginLeft:"15px"},children:(()=>{const o=t?.className||"";let m=U;return o.includes("ë°”ë°”ë¦¬ì•ˆ")?m=Je:o.includes("ë°”ë“œ")?m=_e:o.includes("í´ë ˆë¦­")?m=Ge:o.includes("ë“œë£¨ì´ë“œ")?m=Ve:o.includes("íŒŒì´í„°")?m=Te:o.includes("ëª½í¬")?m=We:o.includes("íŒ”ë¼ë”˜")?m=ie:o.includes("ë ˆì¸ì €")?m=Me:o.includes("ë¡œê·¸")?m=Qe:o.includes("ì†Œì„œëŸ¬")?m=Ze:o.includes("ì›Œë½")?m=de:o.includes("ìœ„ìë“œ")&&(m=Pe),e.jsx(m,{size:28,color:"white",strokeWidth:2.5})})()})]}),r&&e.jsxs("div",{onClick:()=>g&&g(!0),style:{display:"inline-flex",alignItems:"center",gap:"8px",background:"rgba(20, 20, 30, 0.6)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"20px",padding:"8px 16px",marginBottom:"20px",cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,0.2)",position:"relative",zIndex:10,userSelect:"none"},children:[e.jsx(U,{size:14,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80",fontSize:"0.85rem",fontWeight:"bold"},children:[x||0,"/4ëª… ì ‘ì† ì¤‘"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:r?"10px":"20px"},children:[e.jsx(d,{icon:ae,title:"ë ˆì´ë“œ ì¼ì •",desc:"ë‹¤ê°€ì˜¤ëŠ” ëª¨í—˜ í™•ì¸í•˜ê¸°",onClick:()=>i("calendar"),color:"248, 113, 113"}),e.jsx(d,{icon:Ne,title:"ì„¸ì´ë¸Œ ë¶„ì„",desc:"ë‚´ ìºë¦­í„° ìŠ¤í™ í™•ì¸",onClick:()=>i("save"),color:"167, 139, 250"}),e.jsx(d,{icon:fe,title:"ì‘ì „ íšŒì˜ì‹¤",desc:"íŒŒí‹°ì›ë“¤ê³¼ ëŒ€í™”í•˜ê¸°",onClick:()=>i("chat"),color:"52, 211, 153"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:r?"1fr":"1fr 1fr",gap:r?"10px":"20px"},children:e.jsxs("div",{className:"glass-panel",style:{padding:"20px"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px"},children:[e.jsx(ae,{size:18})," ë‹¤ê°€ì˜¤ëŠ” ì¼ì •"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:s?e.jsx("p",{style:{opacity:.5},children:"ë¡œë”© ì¤‘..."}):u.length===0?e.jsx("p",{style:{opacity:.5},children:"ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."}):u.map(o=>e.jsxs("div",{style:{padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"8px",display:"flex",alignItems:"center",gap:"15px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"5px 10px",background:"rgba(0,0,0,0.3)",borderRadius:"6px"},children:[e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.7},children:[o.date?.split("-")[1],"ì›”"]}),e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:o.date?.split("-")[2]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold"},children:o.title}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:[o.time," â€¢ ",o.type==="raid"?"âš”ï¸ ë ˆì´ë“œ":"ğŸ“œ ìŠ¤í† ë¦¬"]})]})]},o.id))})]})})]})},Rt=({user:t,isMobile:i})=>{const[r,x]=l.useState([]),[g,u]=l.useState(""),[f,s]=l.useState(null),[a,c]=l.useState(!0),[y,d]=l.useState([]),o=l.useRef(null),m=l.useRef(null),I=l.useRef(0);l.useEffect(()=>{if(!t?.campId)return;const v=H(W(k,"chats"),Y("campId","==",t.campId),je(50)),R=X(v,B=>{const A=B.docs.map(h=>({id:h.id,...h.data(),timestamp:h.data().timestamp?.toDate().toISOString()||new Date().toISOString()}));A.sort((h,j)=>new Date(h.timestamp)-new Date(j.timestamp)),x(A),c(!1)});return()=>R()},[t?.campId]),l.useEffect(()=>{if(!t?.campId)return;const v=H(W(k,"camps",t.campId,"typing")),R=X(v,A=>{const h=Date.now(),j=A.docs.map(C=>({id:C.id,...C.data()})).filter(C=>C.id!==t.id&&C.timestamp&&h-C.timestamp.toMillis()<4e3);d(j)}),B=setInterval(()=>{d(A=>{const h=Date.now();return A.filter(j=>j.timestamp?.toMillis&&h-j.timestamp.toMillis()<4e3)})},1e3);return()=>{R(),clearInterval(B)}},[t?.campId,t?.id]),l.useEffect(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[r,y]);const D=v=>{const R=v.target.files[0];if(R){if(R.size>500*1024){alert("ì´ë¯¸ì§€ í¬ê¸°ëŠ” 500KB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");return}const B=new FileReader;B.onloadend=()=>{s(B.result)},B.readAsDataURL(R)}},b=async v=>{const R=v.target.value;u(R);const B=Date.now();if(R.trim()&&B-I.current>2e3&&t?.campId){I.current=B;try{await se(M(k,"camps",t.campId,"typing",t.id),{nickname:t.nickname,timestamp:Z()})}catch(A){console.error("Typing status error",A)}}},S=async v=>{if(v.preventDefault(),!g.trim()&&!f||!t?.campId)return;const R=g,B=f;u(""),s(null);try{await re(W(k,"chats"),{text:R,image:B,sender:t.nickname,uid:t.id,userClass:t.className||"Unknown",campId:t.campId,timestamp:Z()})}catch(A){console.error("Error sending message: ",A),alert("ì „ì†¡ ì‹¤íŒ¨!")}};return t?.campId?e.jsxs("div",{style:{display:"flex",flexDirection:"column",padding:0,position:i?"fixed":"absolute",top:i?"env(safe-area-inset-top)":0,left:0,right:0,bottom:i?"calc(65px + env(safe-area-inset-bottom))":0,background:i?"rgba(20, 20, 30, 0.95)":"transparent",zIndex:50},children:[e.jsxs("div",{style:{padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(et,{color:"#4fd1c5"})," íŒŒí‹° ì‘ì „ íšŒì˜ì‹¤"]}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.7},children:["ğŸ”’ ",t.campId," ì•¼ì˜ì§€ (ë³´ì•ˆ ì—°ê²°ë¨)"]})})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"15px"},children:[a&&e.jsx("div",{style:{textAlign:"center",opacity:.5},children:"ì±„íŒ…ë°© ì—°ê²° ì¤‘..."}),r.length===0&&!a&&e.jsxs("div",{style:{textAlign:"center",opacity:.3,marginTop:"20px"},children:[e.jsx("p",{children:"ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{children:"ì‘ì „ì„ ì‹œì‘í•´ë³´ì„¸ìš”!"})]}),r.map(v=>{const R=v.uid===t.id;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:R?"flex-end":"flex-start"},children:[e.jsx("div",{style:{fontSize:"0.8rem",marginBottom:"4px",opacity:.7,display:"flex",alignItems:"center",gap:"4px"},children:!R&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["[",v.userClass,"]"]}),v.sender]})}),e.jsxs("div",{style:{background:R?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:R?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"70%",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.1)",wordBreak:"break-word"},children:[v.image&&e.jsx("img",{src:v.image,alt:"attached",style:{maxWidth:"100%",borderRadius:"8px",marginBottom:v.text?"10px":"0"}}),v.text]}),e.jsx("span",{style:{fontSize:"0.7rem",opacity:.4,marginTop:"4px"},children:new Date(v.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},v.id)}),y.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",marginTop:"10px",paddingLeft:"4px"},children:y.slice(0,3).map(v=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"8px",opacity:.9},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #a78bfa, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:"bold",color:"white",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},children:v.nickname?v.nickname.charAt(0):e.jsx(ce,{size:14})}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"16px 16px 16px 2px",padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",height:"32px",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"})]}),e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.5,marginBottom:"4px"},children:[v.nickname," ì…ë ¥ ì¤‘..."]})]},v.id))}),e.jsx("div",{ref:o})]}),e.jsxs("form",{onSubmit:S,style:{padding:"20px",background:"rgba(0,0,0,0.2)",display:"flex",flexDirection:"column",gap:"10px",borderRadius:"0 0 16px 16px"},children:[f&&e.jsxs("div",{style:{position:"relative",width:"fit-content"},children:[e.jsx("img",{src:f,alt:"Preview",style:{height:"80px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.2)"}}),e.jsx("button",{type:"button",onClick:()=>s(null),style:{position:"absolute",top:-5,right:-5,background:"red",borderRadius:"50%",border:"none",color:"white",padding:"2px",cursor:"pointer"},children:e.jsx(Le,{size:12})})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("input",{type:"file",accept:"image/*",ref:m,style:{display:"none"},onChange:D}),e.jsx("button",{type:"button",onClick:()=>m.current.click(),style:{padding:"12px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:e.jsx(tt,{size:20})}),e.jsx("input",{type:"text",value:g,onChange:b,placeholder:"ì‘ì „ì„ ì „ë‹¬í•˜ì„¸ìš”...",style:{flex:1,padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.05)",color:"white",outline:"none"}}),e.jsx("button",{type:"submit",style:{padding:"12px",borderRadius:"12px",background:"var(--accent-color)",color:"white",border:"none",cursor:"pointer"},children:e.jsx(nt,{size:20})})]})]})]}):e.jsx("div",{className:"glass-panel",style:{padding:"40px",textAlign:"center"},children:"ì•¼ì˜ì§€ì— ì†Œì†ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."})},zt=({user:t,isMobile:i})=>{const[r,x]=l.useState(new Date),[g,u]=l.useState([]),[f,s]=l.useState([]),[a,c]=l.useState(!0),[y,d]=l.useState(0),o=r.toLocaleDateString("en-CA");l.useEffect(()=>{if(!t?.campId){c(!1);return}console.log("Fetching raid data...");const h=H(W(k,"availabilities"),Y("campId","==",t.campId)),j=H(W(k,"schedules"),Y("campId","==",t.campId),Y("type","==","fixed")),C=X(h,T=>{const P=T.docs.map(O=>({id:O.id,...O.data()}));u(P)}),_=X(j,T=>{const P=T.docs.map(O=>({id:O.id,...O.data()}));s(P),c(!1)});return()=>{C(),_()}},[t?.campId,y]);const I=g.find(h=>h.userId===t.id&&h.date===o)?.possibleTimes||[],D=l.useMemo(()=>{const h={};return g.filter(C=>C.date===o).forEach(C=>{C.possibleTimes?.forEach(_=>{h[_]||(h[_]=[]),h[_].push(C.nickname)})}),h},[g,o]),b=f.find(h=>h.date===o),S=async h=>{if(!t.campId)return;const j=I.includes(h)?I.filter(T=>T!==h):[...I,h].sort(),C=`${t.campId}_${t.id}_${o}`,_=M(k,"availabilities",C);await se(_,{campId:t.campId,userId:t.id,nickname:t.nickname,date:o,possibleTimes:j})},v=async h=>{if(window.confirm(`${r.toLocaleDateString()} ${h}ì— ë ˆì´ë“œë¥¼ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await re(W(k,"schedules"),{campId:t.campId,title:"ì •ê¸° ë ˆì´ë“œ",date:o,fixedTime:h,type:"fixed",creator:t.nickname,createdAt:new Date().toISOString()}),alert("ë ˆì´ë“œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤! íŒŒí‹°ì›ë“¤ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤."),c(!0),d(j=>j+1)}catch(j){console.error(j),alert("ì˜¤ë¥˜ ë°œìƒ: "+j.message)}},R=async h=>{window.confirm("ì •ë§ ì´ ë ˆì´ë“œ ì¼ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await ge(M(k,"schedules",h))},B=["18:00","19:00","20:00","21:00","22:00","23:00","00:00","01:00","02:00"],A=({date:h,view:j})=>{if(j==="month"){const C=h.toLocaleDateString("en-CA");if(f.some(P=>P.date===C))return e.jsx("div",{style:{height:"6px",width:"6px",background:"#f87171",borderRadius:"50%",margin:"2px auto"}});if(g.some(P=>P.date===C))return e.jsx("div",{style:{height:"4px",width:"4px",background:"rgba(255,255,255,0.3)",borderRadius:"50%",margin:"2px auto"}})}};return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:i?"15px":"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",color:"white",margin:0,fontSize:i?"1.2rem":"1.5rem"},children:[e.jsx(ae,{className:"text-accent"})," ë ˆì´ë“œ ì¼ì • (Raid Scheduler)"]}),e.jsx("button",{onClick:()=>{c(!0),d(h=>h+1)},style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",padding:"8px",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"ìƒˆë¡œê³ ì¹¨",children:e.jsx(xe,{size:18})})]}),e.jsx("style",{children:`
                    .react-calendar { background: transparent !important; border: none !important; width: 100% !important; color: white !important; font-family: inherit; }
                    .react-calendar__navigation button { color: white; min-width: 44px; background: none; font-size: ${i?"1rem":"1.2rem"}; }
                    .react-calendar__navigation button:enabled:hover, .react-calendar__navigation button:enabled:focus { background-color: rgba(255,255,255,0.1); }
                    .react-calendar__month-view__weekdays { text-align: center; text-transform: uppercase; font-weight: bold; font-size: 0.8em; opacity: 0.7; color: var(--accent-color); }
                    .react-calendar__month-view__days__day { color: white; padding: ${i?"10px":"15px"}; background: transparent; border: none; }
                    .react-calendar__tile:enabled:hover, .react-calendar__tile:enabled:focus { background-color: rgba(255,255,255,0.1); border-radius: 12px; }
                    .react-calendar__tile--now { background: rgba(255,255,255,0.1) !important; border-radius: 12px; }
                    .react-calendar__tile--active { background: var(--accent-color) !important; color: white !important; border-radius: 12px; }
                `}),e.jsx(st,{onChange:x,value:r,tileContent:A,formatDay:(h,j)=>j.getDate()})]}),b?e.jsxs("div",{className:"glass-panel",style:{padding:"25px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05))",border:"1px solid rgba(239, 68, 68, 0.3)",textAlign:"center"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",color:"#fca5a5",marginBottom:"10px",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(at,{})," ë ˆì´ë“œ í™•ì •ë¨"]}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold",margin:"10px 0"},children:b.fixedTime}),e.jsx("p",{style:{opacity:.8},children:"ëª¨ë“  ëŒ€ì›ì€ í•´ë‹¹ ì‹œê°„ì— ì•¼ì˜ì§€ë¡œ ì§‘ê²°í•˜ì‹­ì‹œì˜¤."}),(t.isAdmin||t.role==="Admin")&&e.jsx("button",{onClick:()=>R(b.id),style:{marginTop:"20px",padding:"10px 20px",borderRadius:"8px",background:"rgba(0,0,0,0.3)",color:"#fca5a5",border:"1px solid rgba(239,68,68,0.5)",cursor:"pointer"},children:"ì¼ì • ì·¨ì†Œí•˜ê¸°"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-panel",style:{padding:i?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx(it,{size:18,color:"var(--accent-color)"}),"ë‚˜ì˜ ê°€ëŠ¥ ì‹œê°„ (",r.toLocaleDateString(),")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:B.map(h=>{const j=I.includes(h);return e.jsx("button",{onClick:()=>S(h),style:{padding:"10px 16px",borderRadius:"12px",border:"none",cursor:"pointer",background:j?"var(--accent-color)":"rgba(255,255,255,0.05)",color:j?"white":"rgba(255,255,255,0.6)",fontWeight:j?"bold":"normal",transition:"all 0.2s",flexGrow:i?1:0},children:h},h)})})]}),e.jsxs("div",{className:"glass-panel",style:{padding:i?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx(U,{size:18,color:"#a78bfa"}),"íŒŒí‹° í˜„í™© (Team Status)"]}),Object.keys(D).length===0?e.jsx("p",{style:{opacity:.5,textAlign:"center",padding:"20px"},children:"ì•„ì§ ë“±ë¡ëœ ê°€ëŠ¥ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Object.entries(D).sort((h,j)=>j[1].length-h[1].length||h[0].localeCompare(j[0])).map(([h,j])=>{const C=j.length,_=C>=3;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderRadius:"12px",background:_?"rgba(167, 139, 250, 0.15)":"rgba(255,255,255,0.03)",border:_?"1px solid rgba(167, 139, 250, 0.3)":"1px solid transparent"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:_?"#a78bfa":"white"},children:h}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(U,{size:14,style:{opacity:.7}}),e.jsxs("span",{style:{fontSize:"0.9rem",opacity:.9},children:[C,"ëª… ê°€ëŠ¥"]}),e.jsxs("span",{style:{fontSize:"0.75rem",opacity:.5},children:["(",j.join(", "),")"]})]})]}),(t.isAdmin||t.role==="Admin")&&e.jsxs("button",{onClick:()=>v(h),style:{padding:"6px 12px",borderRadius:"8px",border:"none",background:"linear-gradient(45deg, #f87171, #ef4444)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.8rem"},children:[e.jsx(pe,{size:12,fill:"white"})," í™•ì •"]})]},h)})})]})]})]})},Dt=({user:t})=>{const[i,r]=l.useState([]),[x,g]=l.useState(!0);l.useEffect(()=>{if(!t?.campId)return;const a=H(W(k,"save_reports_v2"),Y("campId","==",t.campId),be("createdAt","desc"),je(10)),c=X(a,y=>{const d=y.docs.map(o=>({id:o.id,...o.data()}));r(d),g(!1)});return()=>c()},[t?.campId]);const u=async a=>{confirm("ì´ ë¶„ì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await ge(M(k,"save_reports_v2",a))},f=({label:a,value:c,color:y})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[e.jsx("span",{style:{width:"40px",fontWeight:"bold",fontSize:"0.8rem",color:"rgba(255,255,255,0.7)"},children:a}),e.jsx("div",{style:{flex:1,height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${c/20*100}%`,height:"100%",background:y,transition:"width 0.5s"}})}),e.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:c})]}),s=a=>{const c=a.target.files[0];c&&(g(!0),setTimeout(async()=>{const y={STR:Math.floor(Math.random()*10)+10,DEX:Math.floor(Math.random()*10)+10,CON:Math.floor(Math.random()*10)+10,INT:Math.floor(Math.random()*10)+10,WIS:Math.floor(Math.random()*10)+10,CHA:Math.floor(Math.random()*10)+10},d={filename:c.name,stats:y,meta:{mode:"Honour Mode (Detected)",version:"4.1.1.4",size:(c.size/1024/1024).toFixed(2)+" MB"},companions:[{name:"Shadowheart",img:"ğŸŒ™"},{name:"Astarion",img:"ğŸ§›"}],logs:["[Client] File loaded locally","[Parser] Header verified (LSOF v4)","[Analysis] Stats extracted successfully"],uploader:t.nickname,campId:t.campId,createdAt:Z()};try{await re(W(k,"save_reports_v2"),d),alert("ë¶„ì„ ì™„ë£Œ!")}catch(o){console.error(o),alert("ì—…ë¡œë“œ ì‹¤íŒ¨")}finally{g(!1)}},1500))};return e.jsxs("div",{style:{padding:"0 0 80px"},children:[e.jsxs("div",{className:"glass-panel",style:{marginBottom:"20px",textAlign:"center",border:"1px solid var(--accent-color)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(rt,{color:"#a78bfa"})," ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ê¸°"]}),e.jsx("p",{style:{opacity:.8,fontSize:"0.9rem",maxWidth:"600px",margin:"0 auto 20px"},children:"ì„¸ì´ë¸Œ íŒŒì¼(.lsv)ì„ ì—…ë¡œë“œí•˜ì—¬ ìºë¦­í„° ëŠ¥ë ¥ì¹˜ì™€ ì§„í–‰ ìƒí™©ì„ ë¶„ì„í•˜ì„¸ìš”."}),e.jsxs("div",{style:{position:"relative",overflow:"hidden",display:"inline-block"},children:[e.jsxs("button",{style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(me,{size:18})," íŒŒì¼ ì„ íƒ ë° ë¶„ì„"]}),e.jsx("input",{type:"file",accept:".lsv,.save",onChange:s,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"}})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:x?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx(xe,{size:32,className:"spin",style:{marginBottom:"15px",color:"var(--accent-color)"}}),e.jsx("p",{children:"ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ ì¤‘..."})]}):i.length===0?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx(me,{size:48,style:{opacity:.3,marginBottom:"20px"}}),e.jsx("p",{children:"ë¶„ì„ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})]}):i.map(a=>e.jsxs("div",{className:"glass-panel",style:{position:"relative",animation:"fadeIn 0.5s"},children:[e.jsx("button",{onClick:()=>u(a.id),style:{position:"absolute",top:"15px",right:"15px",background:"transparent",border:"none",color:"#f87171",cursor:"pointer"},children:e.jsx(Oe,{size:16})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"10px"},children:[e.jsx(me,{size:20,color:"var(--accent-color)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem"},children:a.filename}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.5},children:[new Date(a.createdAt?.toDate?a.createdAt.toDate():a.createdAt).toLocaleString()," â€¢ ",a.uploader]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px"},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(Ne,{size:14})," ëŠ¥ë ¥ì¹˜ (Stats)"]}),a.stats?e.jsxs(e.Fragment,{children:[e.jsx(f,{label:"STR",value:a.stats.STR,color:"#fca5a5"}),e.jsx(f,{label:"DEX",value:a.stats.DEX,color:"#86efac"}),e.jsx(f,{label:"CON",value:a.stats.CON,color:"#fbbf24"}),e.jsx(f,{label:"INT",value:a.stats.INT,color:"#93c5fd"}),e.jsx(f,{label:"WIS",value:a.stats.WIS,color:"#d8b4fe"}),e.jsx(f,{label:"CHA",value:a.stats.CHA,color:"#f472b6"})]}):e.jsx("p",{style:{fontSize:"0.8rem",opacity:.5},children:"ë°ì´í„° ì—†ìŒ"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px",flex:1},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(ie,{size:14})," ë©”íƒ€ ì •ë³´"]}),e.jsxs("div",{style:{fontSize:"0.8rem",display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("p",{style:{margin:0},children:["ğŸ“‚ ëª¨ë“œ: ",a.meta?.mode||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ğŸ’¾ ë²„ì „: ",a.meta?.version||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ğŸ“¦ í¬ê¸°: ",a.meta?.size||"Unknown"]})]})]}),a.companions&&e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"12px"},children:[e.jsx("h4",{style:{margin:"0 0 5px",fontSize:"0.8rem",opacity:.8},children:"í•¨ê»˜í•˜ëŠ” ë™ë£Œ"}),e.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"},children:a.companions.map((c,y)=>e.jsxs("span",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem"},children:[c.img," ",c.name]},y))})]})]})]})]},a.id))})]})},Fe=[{id:"barbarian",name:"ë°”ë°”ë¦¬ì•ˆ",icon:Te,color:"#fca5a5"},{id:"bard",name:"ë°”ë“œ",icon:_e,color:"#f9a8d4"},{id:"cleric",name:"í´ë ˆë¦­",icon:ot,color:"#d1d5db"},{id:"druid",name:"ë“œë£¨ì´ë“œ",icon:lt,color:"#bef264"},{id:"fighter",name:"íŒŒì´í„°",icon:ie,color:"#93c5fd"},{id:"monk",name:"ëª½í¬",icon:dt,color:"#7dd3fc"},{id:"paladin",name:"íŒ”ë¼ë”˜",icon:ie,color:"#fbbf24"},{id:"ranger",name:"ë ˆì¸ì €",icon:Me,color:"#86efac"},{id:"rogue",name:"ë¡œê·¸",icon:de,color:"#cbd5e1"},{id:"sorcerer",name:"ì†Œì„œëŸ¬",icon:We,color:"#c084fc"},{id:"warlock",name:"ì›Œë½",icon:Pe,color:"#e879f9"},{id:"wizard",name:"ìœ„ìë“œ",icon:ct,color:"#818cf8"}],ne=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],K={width:"100%",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.2)",color:"white",marginBottom:"12px",fontSize:"1rem",transition:"border-color 0.2s, background 0.2s"},Q={width:"100%",padding:"16px",borderRadius:"12px",border:"none",fontWeight:"bold",fontSize:"1.05rem",marginTop:"0",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},ze=({selected:t,onSelect:i})=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"10px",maxHeight:"200px",overflowY:"auto",margin:"20px 0",padding:"5px"},children:Fe.map(r=>e.jsxs("button",{onClick:()=>i(r),type:"button",style:{padding:"12px 8px",borderRadius:"12px",border:t?.id===r.id?`2px solid ${r.color}`:"1px solid rgba(255,255,255,0.05)",background:t?.id===r.id?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.2)",color:"white",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",transition:"all 0.2s",cursor:"pointer",transform:t?.id===r.id?"scale(1.05)":"scale(1)"},children:[e.jsx(r.icon,{size:24,color:r.color}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:t?.id===r.id?"bold":"normal"},children:r.name})]},r.id))}),De=({selected:t,onSelect:i})=>e.jsxs("div",{style:{margin:"15px 0"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"white",opacity:.8,display:"block",marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:ne.map(r=>e.jsx("div",{onClick:()=>i(r),style:{width:"28px",height:"28px",borderRadius:"50%",background:r,cursor:"pointer",border:t===r?"3px solid white":"1px solid transparent",boxShadow:t===r?"0 0 10px "+r:"none",transform:t===r?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},r))})]}),ue=({children:t,title:i,sub:r,onClose:x,error:g})=>e.jsx("div",{className:"modal-overlay",onClick:x,children:e.jsxs("div",{className:"modal-content",onClick:u=>u.stopPropagation(),children:[e.jsx("button",{onClick:x,style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:"pointer",zIndex:10},children:e.jsx(Le,{size:18})}),e.jsxs("div",{style:{padding:"30px 20px",textAlign:"center"},children:[i&&e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"8px",fontWeight:"800",background:"linear-gradient(to right, #fff, #aaa)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:i}),r&&e.jsx("p",{style:{opacity:.7,fontSize:"0.95rem",marginBottom:"30px"},children:r}),t,g&&e.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",padding:"12px",borderRadius:"10px",marginTop:"20px",fontSize:"0.9rem",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["âš ï¸ ",g]})]})]})}),Ae=({onComplete:t,initialData:i,user:r,isMobile:x})=>{const g=i||r,[u,f]=l.useState(g?"profile_view":"landing"),[s,a]=l.useState(g?.nickname||""),[c,y]=l.useState(""),[d,o]=l.useState(g?Fe.find(p=>p.name===g.className):null),[m,I]=l.useState(g?.color||ne[Math.floor(Math.random()*ne.length)]),[D,b]=l.useState(""),[S,v]=l.useState(""),[R,B]=l.useState([]),[A,h]=l.useState(null),[j,C]=l.useState(!1),[_,T]=l.useState("");l.useEffect(()=>{i&&f("profile_view")},[i]);const P=()=>{a(""),y(""),o(null),b(""),v(""),h(null),T(""),B([]),I(ne[Math.floor(Math.random()*ne.length)])},O=()=>{T(""),f("landing")};l.useEffect(()=>{u==="join_camp"&&G()},[u]);const G=async()=>{C(!0);try{console.log("[Profile] Fetching active camps...");const E=(await ve(W(k,"camps"))).docs.map(z=>({id:z.id,...z.data()}));B(E),console.log("[Profile] Camps found:",E.length)}catch(p){console.error("[Profile] Error fetching camps:",p),T("ì˜ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{C(!1)}},V=async p=>{p.preventDefault(),C(!0),T("");try{console.log("[Auth] Attempting login for:",s);const E=await te(M(k,"users_v2",s));if(!E.exists())throw new Error("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ëª¨í—˜ê°€ì…ë‹ˆë‹¤.");const z=E.data();if(z.password!==c)throw new Error("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");if(console.log("[Auth] Login successful:",z),z.campId)try{await ee(M(k,"camps",z.campId),{members:Se(s)})}catch(L){console.error("[Auth] Failed to update camp member list:",L)}localStorage.setItem("bg3_user_profile",JSON.stringify(z)),t(z)}catch(E){console.error("[Auth] Login failed:",E),T(E.message)}finally{C(!1)}},n=async()=>{if(!s||!c||!d||!D||!S){T("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}C(!0);try{console.log("[Camp] Creating new camp:",D);const p=M(k,"users_v2",s);if((await te(p)).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");const z=D.trim(),L=M(k,"camps",z);if((await te(L)).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì˜ì§€ ì´ë¦„ì…ë‹ˆë‹¤.");const q={id:s,nickname:s,password:c,className:d.name,classId:d.id,color:m,isAdmin:!0,campId:z,createdAt:new Date().toISOString()},$e={id:z,name:D,password:S,leaderId:s,members:[s],createdAt:new Date().toISOString()};await se(p,q),await se(L,$e),console.log("[Camp] Camp and Admin created successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify(q)),t(q)}catch(p){console.error("[Camp] Creation failed:",p),T(p.message)}finally{C(!1)}},w=async()=>{if(!s||!c||!d||!A||!S){T("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}C(!0);try{console.log("[Camp] Joining camp:",A);const p=M(k,"users_v2",s);if((await te(p)).exists())throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. (ë¡œê·¸ì¸ í•˜ì„¸ìš”)");const z=M(k,"camps",A),L=await te(z);if(!L.exists())throw new Error("ì˜ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");const F=L.data();if(F.password!==S)throw new Error("ì˜ì§€ ì…ì¥ ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");if(F.members&&F.members.length>=4)throw new Error("ì˜ì§€ ì •ì›ì´ ê½‰ ì°¼ìŠµë‹ˆë‹¤. (ìµœëŒ€ 4ëª…)");const q={id:s,nickname:s,password:c,className:d.name,classId:d.id,color:m,isAdmin:!1,campId:A,createdAt:new Date().toISOString()};await se(p,q),await ee(z,{members:Se(s)}),console.log("[Camp] Joined successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify(q)),t(q)}catch(p){console.error("[Camp] Join failed:",p),T(p.message)}finally{C(!1)}},N=()=>{confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(localStorage.removeItem("bg3_user_profile"),t(null),f("landing"),P())};return u==="profile_view"&&i?e.jsxs("div",{className:"glass-panel",style:{maxWidth:"450px",margin:"40px auto",padding:"40px",textAlign:"center"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"30px"},children:[e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",background:d?.color||"gray",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 30px ${d?.color||"gray"}`},children:d&&e.jsx(d.icon,{size:50,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.8rem",margin:"0 0 8px",fontWeight:"bold"},children:i.nickname}),e.jsx("span",{style:{fontSize:"0.95rem",opacity:.8,background:"rgba(255,255,255,0.1)",padding:"6px 12px",borderRadius:"20px"},children:i.className})]}),e.jsxs("div",{style:{textAlign:"left",background:"rgba(0,0,0,0.2)",padding:"25px",borderRadius:"16px"},children:[e.jsxs("p",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"15px",marginBottom:"15px"},children:[e.jsx("span",{style:{opacity:.6},children:"ì†Œì† ì•¼ì˜ì§€"}),e.jsx("b",{style:{fontSize:"1.1rem"},children:i.campId})]}),e.jsxs("p",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{opacity:.6},children:"ì§ì±…"}),e.jsx("b",{style:{color:i.isAdmin?"#f87171":"#4ade80"},children:i.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),e.jsxs("button",{onClick:N,style:{...Q,background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",marginTop:"40px"},children:[e.jsx(Ee,{size:20}),"ë¡œê·¸ì•„ì›ƒ"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsx("div",{className:"glass-panel",style:{maxWidth:"1000px",width:"100%",padding:x?"30px 20px":"60px 60px",textAlign:"center",minHeight:x?"auto":"550px",display:"flex",alignItems:"center",justifyContent:"center",margin:0},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:x?"20px":"60px",width:"100%"},children:[e.jsx("div",{style:{flex:"1 1 300px",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",maxWidth:x?"240px":"420px",width:"100%"},children:[e.jsx("img",{src:J,alt:"Logo",onClick:()=>window.location.reload(),title:"ìƒˆë¡œê³ ì¹¨",style:{width:"100%",cursor:"pointer",transition:"transform 0.3s ease",display:"block"},onMouseOver:p=>p.currentTarget.style.transform="scale(1.03)",onMouseOut:p=>p.currentTarget.style.transform="scale(1)"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${J})`,maskImage:`url(${J})`}})]})}),e.jsxs("div",{style:{flex:"1 1 300px",display:"flex",flexDirection:"column",gap:"20px",maxWidth:"350px",width:"100%"},children:[e.jsxs("button",{onClick:()=>{P(),f("login")},style:{...Q,background:"rgba(255,255,255,0.08)",color:"white",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(pt,{size:20}),"ê¸°ì¡´ ëª¨í—˜ê°€ ë¡œê·¸ì¸"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",opacity:.3,fontSize:"0.8rem"},children:[e.jsx("div",{style:{flex:1,height:"1px",background:"white"}}),e.jsx("span",{children:"OR"}),e.jsx("div",{style:{flex:1,height:"1px",background:"white"}})]}),e.jsxs("button",{onClick:()=>{P(),f("join_camp")},style:{...Q,background:"linear-gradient(45deg, #7c3aed, #db2777)",color:"white",boxShadow:"0 4px 15px rgba(124, 58, 237, 0.3)"},children:[e.jsx(U,{size:20}),"ì•¼ì˜ì§€ í•©ë¥˜í•˜ê¸° (ì¼ë°˜)"]}),e.jsxs("button",{onClick:()=>{P(),f("create_camp")},style:{...Q,background:"linear-gradient(45deg, #ef4444, #f97316)",color:"white",boxShadow:"0 4px 15px rgba(239, 68, 68, 0.3)"},children:[e.jsx(pe,{size:20}),"ìƒˆ ì•¼ì˜ì§€ ê±´ì„¤ (ê´€ë¦¬ì)"]}),e.jsxs("p",{style:{marginTop:"10px",opacity:.8,fontSize:x?"0.75rem":"0.9rem",lineHeight:"1.5",fontWeight:"400",textAlign:"center",color:"rgba(255,255,255,0.7)"},children:["ë™ë£Œë“¤ê³¼ í•¨ê»˜ ë‚˜ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.",e.jsx("br",{}),e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ 3 ì›ì •ëŒ€"}),"ë¥¼ ìœ„í•œ",e.jsx("br",{}),"í•„ìˆ˜ ì»´íŒ¨ë‹ˆì–¸ ì•±"]})]})]})})}),u==="login"&&e.jsx(ue,{title:"ë¡œê·¸ì¸",sub:"ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”, ëª¨í—˜ê°€ë‹˜.",onClose:O,error:_,children:e.jsxs("form",{onSubmit:V,children:[e.jsx("input",{type:"text",placeholder:"ë‹‰ë„¤ì„",value:s,onChange:p=>a(p.target.value),style:K}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",value:c,onChange:p=>y(p.target.value),style:K}),e.jsx("button",{type:"submit",style:{...Q,background:"white",color:"black",marginTop:"20px"},disabled:j,children:j?"ì¸ì¦ í™•ì¸ ì¤‘...":"ì•¼ì˜ì§€ ì…ì¥"})]})}),u==="create_camp"&&e.jsxs(ue,{title:"ì•¼ì˜ì§€ ê±´ì„¤",sub:"ë‹¹ì‹ ë§Œì˜ íŒŒí‹°ë¥¼ ì´ëŒì–´ë³´ì„¸ìš”.",onClose:O,error:_,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#fca5a5",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ê´€ë¦¬ì(ì˜ì£¼) ì •ë³´"}),e.jsx("input",{type:"text",placeholder:"ì˜ì£¼ ë‹‰ë„¤ì„",value:s,onChange:p=>a(p.target.value),style:K}),e.jsx("input",{type:"password",placeholder:"ê°œì¸ ë¹„ë°€ë²ˆí˜¸",value:c,onChange:p=>y(p.target.value),style:{...K,marginBottom:0}})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#c4b5fd",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ì˜ì§€(Room) ì„¤ì •"}),e.jsx("input",{type:"text",placeholder:"ì•¼ì˜ì§€ ì´ë¦„ (IDë¡œ ì‚¬ìš©ë¨)",value:D,onChange:p=>b(p.target.value),style:K}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ì…ì¥ ì•”í˜¸ (íŒ€ì› ê³µìœ ìš©)",value:S,onChange:p=>v(p.target.value),style:{...K,borderColor:"#818cf8",color:"#818cf8",marginBottom:0}})]}),e.jsx(De,{selected:m,onSelect:I}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"5px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(ze,{selected:d,onSelect:o})]}),e.jsx("button",{onClick:n,style:{...Q,background:"#ef4444",color:"white"},disabled:j,children:j?"ì˜í†  ì„ í¬ ì¤‘...":"ê±´ì„¤ ì™„ë£Œ ë° ì…ì¥"})]}),u==="join_camp"&&e.jsxs(ue,{title:"ì•¼ì˜ì§€ í•©ë¥˜",sub:"ë™ë£Œë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.",onClose:O,error:_,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[!A&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("span",{style:{opacity:.7,fontSize:"0.9rem"},children:"ì°¸ì—¬ ê°€ëŠ¥í•œ ì˜ì§€"}),e.jsxs("button",{onClick:G,style:{background:"none",border:"none",color:"var(--accent-color)",cursor:"pointer",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(xe,{size:12})," ëª©ë¡ ê°±ì‹ "]})]}),e.jsx("div",{style:{maxHeight:"250px",overflowY:"auto",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"10px",background:"rgba(0,0,0,0.2)"},children:j&&R.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"íƒìƒ‰ ì¤‘..."}):R.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"í™œì„±í™”ëœ ì˜ì§€ê°€ ì—†ìŠµë‹ˆë‹¤."}):R.map(p=>e.jsxs("div",{onClick:()=>h(p.id),style:{padding:"16px",marginBottom:"8px",borderRadius:"10px",cursor:"pointer",background:"rgba(255,255,255,0.05)",border:"1px solid transparent",transition:"all 0.2s",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseOver:E=>{E.currentTarget.style.background="rgba(255,255,255,0.1)",E.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseOut:E=>{E.currentTarget.style.background="rgba(255,255,255,0.05)",E.currentTarget.style.borderColor="transparent"},children:[e.jsxs("span",{style:{fontWeight:"bold"},children:["ğŸ° ",p.name]}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.7,background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"4px"},children:[p.members?.length||0,"/4ëª…"]})]},p.id))})]}),A&&e.jsxs("div",{style:{animation:"fadeIn 0.3s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("button",{onClick:()=>h(null),style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"â†"}),e.jsx("h3",{style:{margin:0,fontSize:"1.2rem"},children:R.find(p=>p.id===A)?.name})]}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ì…ì¥ ì•”í˜¸",value:S,onChange:p=>v(p.target.value),style:{...K,borderColor:"#818cf8",color:"#818cf8"}}),e.jsx("div",{style:{height:"10px"}}),e.jsx("input",{type:"text",placeholder:"ë‚´ ë‹‰ë„¤ì„",value:s,onChange:p=>a(p.target.value),style:K}),e.jsx("input",{type:"password",placeholder:"ë‚´ ë¹„ë°€ë²ˆí˜¸",value:c,onChange:p=>y(p.target.value),style:K}),e.jsx(De,{selected:m,onSelect:I}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"15px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(ze,{selected:d,onSelect:o})]})]}),A&&e.jsx("button",{onClick:w,style:{...Q,background:"var(--accent-color)",color:"white"},disabled:j,children:j?"ì…ì¥ ì¤‘...":"í•©ë¥˜í•˜ê¸°"})]})]})},At=({user:t})=>{const[i,r]=l.useState([]),[x,g]=l.useState(!0);l.useEffect(()=>{if(!t?.campId)return;const s=H(W(k,"users_v2"),Y("campId","==",t.campId)),a=X(s,c=>{const y=c.docs.map(d=>({id:d.id,...d.data()}));r(y),g(!1)});return()=>a()},[t?.campId]);const u=async s=>{if(window.confirm(`ì •ë§ '${s.nickname}' ë‹˜ì„ ì˜ì§€ì—ì„œ ì¶”ë°©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await ge(M(k,"users_v2",s.id));const a=M(k,"camps",t.campId);await ee(a,{members:mt(s.nickname)}),alert("ì¶”ë°©ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(a){console.error("Kick failed:",a),alert("ì¶”ë°© ì‹¤íŒ¨: "+a.message)}},f=async()=>{if(!window.confirm(`âš ï¸ ê²½ê³ : ì˜ì§€ë¥¼ í­íŒŒí•˜ë©´ ëª¨ë“  ë°ì´í„°ì™€ ë©¤ë²„ê°€ ì‚­ì œë©ë‹ˆë‹¤.
ì •ë§ ì´ ì•¼ì˜ì§€ë¥¼ í•´ì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;if(prompt("ì˜ì§€ë¥¼ ì‚­ì œí•˜ë ¤ë©´ 'ì˜ì§€ í­íŒŒ'ë¼ê³  ì…ë ¥í•˜ì„¸ìš”.")!=="ì˜ì§€ í­íŒŒ")return alert("ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");try{g(!0);const c=ht(k),y=M(k,"camps",t.campId);c.delete(y),i.forEach(m=>{const I=M(k,"users_v2",m.id);c.delete(I)});const d=H(W(k,"chats"),Y("campId","==",t.campId));(await ve(d)).forEach(m=>{c.delete(m.ref)}),await c.commit(),alert("ì•¼ì˜ì§€ê°€ ì—­ì‚¬ ì†ìœ¼ë¡œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤."),window.location.reload()}catch(c){console.error("Destroy failed:",c),alert("ì‚­ì œ ì‹¤íŒ¨: "+c.message)}finally{g(!1)}};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"30px",marginBottom:"30px",border:"1px solid var(--accent-color)",background:"rgba(50, 0, 0, 0.3)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 10px",color:"#fca5a5"},children:[e.jsx(ie,{})," ì˜ì£¼ ê´€ë¦¬ì‹¤ (Admin)"]}),e.jsxs("p",{style:{opacity:.8,fontSize:"0.9rem"},children:["í˜„ì¬ ì•¼ì˜ì§€: ",e.jsx("b",{children:t.campId})," ",e.jsx("br",{}),"ê¶Œí•œ: ",e.jsx("span",{style:{color:"var(--accent-color)"},children:"Master"})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs("h3",{style:{margin:0,fontSize:"1.1rem"},children:["ëŒ€ì› ëª©ë¡ (",i.length,"/4)"]})}),i.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"50%",background:s.isAdmin?"var(--accent-color)":"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.isAdmin?e.jsx(pe,{size:22,color:"white"}):e.jsx(ce,{size:22})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[s.nickname,e.jsx("span",{style:{fontSize:"0.7rem",padding:"3px 8px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",opacity:.8},children:s.className||"ëª¨í—˜ê°€"})]}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.5,marginTop:"4px"},children:s.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),!s.isAdmin&&e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:async()=>{if(window.confirm(`'${s.nickname}' ë‹˜ì„ ê´€ë¦¬ìë¡œ ì„ëª…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{const{updateDoc:a,doc:c}=await ye(async()=>{const{updateDoc:y,doc:d}=await import("./vendor-DcZOgQkA.js").then(o=>o.ak);return{updateDoc:y,doc:d}},[]);await a(c(k,"users_v2",s.id),{isAdmin:!0,role:"Admin"}),alert(`${s.nickname} ë‹˜ì´ ê´€ë¦¬ìê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(a){console.error(a),alert("ê¶Œí•œ ë¶€ì—¬ ì‹¤íŒ¨: "+a.message)}},style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(74, 222, 128, 0.1)",border:"1px solid rgba(74, 222, 128, 0.3)",color:"#4ade80",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(pe,{size:16})," ì„ëª…"]}),e.jsxs("button",{onClick:()=>u(s),style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(xt,{size:16})," ì¶”ë°©"]})]})]},s.id)),i.length===0&&!x&&e.jsx("div",{style:{padding:"40px",textAlign:"center",opacity:.5},children:"ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤."})]}),e.jsxs("div",{style:{marginTop:"50px",borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"30px"},children:[e.jsxs("h3",{style:{color:"#ef4444",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(gt,{})," ìœ„í—˜ êµ¬ì—­"]}),e.jsxs("div",{className:"glass-panel",style:{borderColor:"#ef4444",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 5px"},children:"ì˜ì§€ í­íŒŒ"}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:"ì´ ì•¼ì˜ì§€ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤."})]}),e.jsx("button",{onClick:f,style:{background:"#ef4444",color:"white",border:"none",padding:"12px 20px",borderRadius:"8px",fontWeight:"bold",cursor:"pointer"},children:"í­íŒŒ ì‹¤í–‰"})]})]})]})},Et=({user:t,onSelectTactic:i})=>{const[r,x]=l.useState([]),[g,u]=l.useState(!0),[f,s]=l.useState(!1),[a,c]=l.useState(0),[y,d]=l.useState(""),[o,m]=l.useState("");l.useEffect(()=>{if(!t?.campId)return;const b=H(W(k,"tactics"),Y("campId","==",t.campId),be("createdAt","desc")),S=X(b,v=>{const R=v.docs.map(B=>({id:B.id,...B.data()}));x(R),u(!1)},v=>{console.error("Error fetching tactics:",v),u(!1)});return()=>S()},[t?.campId,a]);const I=async b=>{if(b.preventDefault(),!!y.trim()){if(!t.campId){alert("ì†Œì†ëœ ì˜ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");return}try{console.log("Creating tactic...",{campId:t.campId,author:t.nickname,title:y}),await re(W(k,"tactics"),{campId:t.campId,authorId:t.id||t.nickname,authorName:t.nickname,title:y,description:o,createdAt:Z(),elements:[]}),console.log("Tactic created successfully"),u(!0),c(S=>S+1),s(!1),d(""),m("")}catch(S){console.error("Error creating tactic:",S),alert("ì „ìˆ íŒ ìƒì„± ì‹¤íŒ¨: "+S.code+" - "+S.message)}}},D=async(b,S)=>{if(b.stopPropagation(),!!confirm("ì •ë§ë¡œ ì´ ì „ìˆ íŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await ge(M(k,"tactics",S))}catch(v){console.error("Error deleting tactic:",v),alert("ì‚­ì œ ì‹¤íŒ¨")}};return e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"1.8rem",fontWeight:"bold",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(he,{className:"text-accent"}),"ì „ìˆ  ì‘ì „ì‹¤"]}),e.jsx("p",{style:{opacity:.6,fontSize:"0.9rem",marginTop:"5px"},children:"íŒŒí‹°ì›ë“¤ê³¼ í•¨ê»˜ ì‘ì „ì„ ìˆ˜ë¦½í•˜ê³  ê³µìœ í•˜ì„¸ìš”."})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>{u(!0),c(b=>b+1)},className:"glass-button",style:{background:"rgba(255,255,255,0.1)",color:"white",border:"none",padding:"12px",borderRadius:"12px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"ìƒˆë¡œê³ ì¹¨",children:e.jsx(xe,{size:20})}),e.jsxs("button",{onClick:()=>s(!0),className:"glass-button",style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 20px",borderRadius:"12px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 15px rgba(245, 158, 11, 0.4)"},children:[e.jsx(ut,{size:20}),"ìƒˆ ì‘ì „ ìˆ˜ë¦½"]})]})]}),g?e.jsx("div",{style:{textAlign:"center",padding:"40px",opacity:.5},children:"ë¡œë”© ì¤‘..."}):r.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",background:"rgba(255,255,255,0.03)",borderRadius:"20px",border:"1px dashed rgba(255,255,255,0.1)"},children:[e.jsx(he,{size:48,style:{opacity:.2,marginBottom:"20px"}}),e.jsx("p",{style:{fontSize:"1.1rem",fontWeight:"bold"},children:"ì•„ì§ ìˆ˜ë¦½ëœ ì‘ì „ì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{style:{opacity:.6,fontSize:"0.9rem"},children:"ìƒˆ ì‘ì „ ìˆ˜ë¦½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ë²ˆì§¸ ì „ìˆ íŒì„ ë§Œë“¤ì–´ë³´ì„¸ìš”."})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"20px"},children:r.map(b=>e.jsxs("div",{onClick:()=>i(b),className:"glass-panel",style:{padding:"0",cursor:"pointer",overflow:"hidden",display:"flex",flexDirection:"column",height:"220px",transition:"all 0.2s",position:"relative"},onMouseEnter:S=>S.currentTarget.style.transform="translateY(-5px)",onMouseLeave:S=>S.currentTarget.style.transform="translateY(0)",children:[e.jsx("div",{style:{flex:2,background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsx(he,{size:32,style:{opacity:.1}})}),e.jsxs("div",{style:{flex:1,padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"8px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"80%"},children:b.title}),(t.isAdmin||t.id===b.authorId)&&e.jsx("button",{onClick:S=>D(S,b.id),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",padding:"4px"},children:e.jsx(Oe,{size:16})})]}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:b.description||"ì„¤ëª… ì—†ìŒ"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",fontSize:"0.75rem",opacity:.4},children:[e.jsx("span",{children:b.authorName}),e.jsx("span",{children:b.createdAt?.toDate().toLocaleDateString()||"ë°©ê¸ˆ ì „"})]})]})]},b.id))}),f&&e.jsx("div",{className:"modal-overlay",onClick:()=>s(!1),children:e.jsxs("div",{className:"modal-content",onClick:b=>b.stopPropagation(),children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"20px"},children:"ìƒˆ ì‘ì „ ìˆ˜ë¦½"}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ì‘ì „ëª…"}),e.jsx("input",{type:"text",value:y,onChange:b=>d(b.target.value),placeholder:"ì˜ˆ: 3ë§‰ ë³´ìŠ¤ ê³µëµ",style:{width:"100%",padding:"12px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px"},autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"25px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ì„¤ëª… (ì„ íƒ)"}),e.jsx("textarea",{value:o,onChange:b=>m(b.target.value),placeholder:"ì‘ì „ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.",style:{width:"100%",padding:"12px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px",minHeight:"80px"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx("button",{type:"button",onClick:()=>s(!1),style:{padding:"10px 20px",borderRadius:"8px",background:"transparent",border:"1px solid rgba(255,255,255,0.2)",color:"white",cursor:"pointer"},children:"ì·¨ì†Œ"}),e.jsx("button",{type:"submit",style:{padding:"10px 20px",borderRadius:"8px",background:"var(--accent-color)",border:"none",color:"white",fontWeight:"bold",cursor:"pointer"},children:"ìƒì„±í•˜ê¸°"})]})]})]})})]})},Bt=({user:t,tacticId:i,initialData:r,onBack:x,isMobile:g})=>{const[u,f]=l.useState(r?.elements||[]),[s,a]=l.useState(r?.viewState||{x:0,y:0,scale:1}),[c,y]=l.useState(null),[d,o]=l.useState("select"),[m,I]=l.useState(!1),[D,b]=l.useState(!1),[S,v]=l.useState({x:0,y:0}),[R,B]=l.useState({x:0,y:0}),A=l.useRef(null),h=l.useRef(null),j=l.useCallback((n,w)=>{h.current&&clearTimeout(h.current),h.current=setTimeout(async()=>{try{const N=M(k,"tactics",i);await ee(N,{elements:n,viewState:w,lastModified:Z(),lastModifiedBy:t.nickname}),console.log("Auto-saved tactics")}catch(N){console.error("Save failed",N)}},1e3)},[i,t.nickname]);l.useEffect(()=>{j(u,s)},[u,s,j]);const C=n=>{d==="select"&&n.target===A.current&&(I(!0),v({x:n.clientX,y:n.clientY}),y(null))},_=(n,w)=>{if(n.stopPropagation(),d!=="select")return;y(w.id),b(!0);const N=A.current.getBoundingClientRect(),p=n.clientX-N.left,E=n.clientY-N.top,z=(p-s.x)/s.scale,L=(E-s.y)/s.scale;B({x:z-w.x,y:L-w.y}),v({x:n.clientX,y:n.clientY})},T=n=>{if(m){const w=n.clientX-S.x,N=n.clientY-S.y;a(p=>({...p,x:p.x+w,y:p.y+N})),v({x:n.clientX,y:n.clientY})}if(D&&c){const w=A.current.getBoundingClientRect(),N=n.clientX-w.left,p=n.clientY-w.top,E=(N-s.x)/s.scale,z=(p-s.y)/s.scale;f(L=>L.map(F=>F.id===c?{...F,x:E-R.x,y:z-R.y}:F)),v({x:n.clientX,y:n.clientY})}},P=()=>{I(!1),b(!1)},O=()=>{c&&(f(n=>n.filter(w=>w.id!==c)),y(null))},G=n=>{if(n.ctrlKey||n.metaKey){n.preventDefault();const N=-n.deltaY*.001,p=Math.min(Math.max(s.scale+N,.1),5);a(E=>({...E,scale:p}))}else a(w=>({...w,x:w.x-n.deltaX,y:w.y-n.deltaY}))},V=n=>{const w=Date.now().toString(),N=(-s.x+window.innerWidth/2)/s.scale,p=(-s.y+window.innerHeight/2)/s.scale,E={id:w,type:n,x:N-50,y:p-50,content:n==="text"?"ìƒˆ í…ìŠ¤íŠ¸":"",width:100,height:100,color:"#ffffff"};f(z=>[...z,E]),o("select")};return e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden",background:"#1a1a1a",position:"relative"},children:[e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,zIndex:100,padding:"15px 20px",background:"rgba(20,20,30,0.8)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("button",{onClick:x,style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer",padding:"8px",borderRadius:"50%"},children:e.jsx(ft,{size:20})}),e.jsx("h2",{style:{margin:0,fontSize:"1rem",opacity:.8},children:r.title})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.5,display:"flex",gap:"10px",alignItems:"center"},children:[c&&e.jsx("button",{onClick:O,style:{background:"#ef4444",border:"none",color:"white",borderRadius:"8px",padding:"5px 10px",cursor:"pointer"},children:"ì‚­ì œ"}),e.jsx("span",{children:m?"ì´ë™ ì¤‘...":"ìë™ ì €ì¥ ë¨"})]})]}),e.jsx("div",{ref:A,style:{flex:1,cursor:m?"grabbing":"grab",touchAction:"none"},onPointerDown:C,onPointerMove:T,onPointerUp:P,onWheel:G,children:e.jsxs("div",{style:{transform:`translate(${s.x}px, ${s.y}px) scale(${s.scale})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:-5e3,left:-5e3,width:1e4,height:1e4,backgroundImage:"radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"40px 40px",pointerEvents:"none"}}),u.map(n=>e.jsxs("div",{onPointerDown:w=>_(w,n),style:{position:"absolute",left:n.x,top:n.y,width:n.width||"auto",height:n.height||"auto",padding:"10px",background:n.type==="text"?"transparent":"rgba(255,255,255,0.1)",border:c===n.id?"2px solid var(--accent-color)":"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",color:"white",userSelect:"none",cursor:"move",transform:c===n.id?"scale(1.05)":"scale(1)",transition:D&&c===n.id?"none":"transform 0.1s"},children:[n.type==="text"&&e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:n.content}),n.type==="npc"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#4ade80",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ce,{size:30,color:"#1a1a1a"})}),e.jsx("span",{style:{fontSize:"0.8rem",marginTop:"4px",background:"rgba(0,0,0,0.5)",padding:"2px 6px",borderRadius:"4px"},children:"NPC"})]}),n.type==="mob"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#ef4444",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(de,{size:30,color:"white"})}),e.jsx("span",{style:{fontSize:"0.8rem",marginTop:"4px",background:"rgba(0,0,0,0.5)",padding:"2px 6px",borderRadius:"4px"},children:"ENEMY"})]})]},n.id))]})}),e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(30,30,40,0.9)",backdropFilter:"blur(15px)",padding:"10px 20px",borderRadius:"50px",display:"flex",gap:"15px",border:"1px solid rgba(255,255,255,0.2)",boxShadow:"0 10px 30px rgba(0,0,0,0.5)"},children:[e.jsx(oe,{icon:yt,active:d==="select",onClick:()=>o("select"),label:"ì„ íƒ"}),e.jsx(oe,{icon:bt,active:d==="text",onClick:()=>V("text"),label:"í…ìŠ¤íŠ¸"}),e.jsx(oe,{icon:ce,active:d==="npc",onClick:()=>V("npc"),label:"NPC"}),e.jsx(oe,{icon:de,active:d==="mob",onClick:()=>V("mob"),label:"ì "})]})]})},oe=({icon:t,active:i,onClick:r,label:x})=>e.jsx("button",{onClick:r,style:{background:i?"var(--accent-color)":"transparent",border:"none",color:i?"white":"rgba(255,255,255,0.6)",padding:"10px",borderRadius:"50%",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",transition:"all 0.2s"},children:e.jsx(t,{size:24})}),Nt=({user:t,isMobile:i})=>{const[r,x]=l.useState(null);return r?e.jsx(Bt,{user:t,isMobile:i,tacticId:r.id,initialData:r,onBack:()=>x(null)}):e.jsx(Et,{user:t,isMobile:i,onSelectTactic:x})},_t=({user:t,onClose:i})=>{const[r,x]=l.useState([]),[g,u]=l.useState(!0);l.useEffect(()=>{if(!t?.campId)return;const s=H(W(k,"users_v2"),Y("campId","==",t.campId)),a=X(s,c=>{const y=Date.now(),d=c.docs.map(o=>{const m=o.data(),I=m.lastSeen?.toMillis?m.lastSeen.toMillis():0,D=y-I<120*1e3;return{id:o.id,...m,isOnline:D,lastSeenAgo:Math.floor((y-I)/6e4)}});d.sort((o,m)=>o.isOnline===m.isOnline?o.nickname.localeCompare(m.nickname):m.isOnline?1:-1),x(d),u(!1)});return()=>a()},[t?.campId]);const f=async s=>{if(window.confirm(`${s.nickname}ë‹˜ì„ ì •ë§ ê¹¨ìš°ì‹œê² ìŠµë‹ˆê¹Œ? (ì•Œë¦¼ ë°œì†¡)`))try{await re(W(k,"camps",t.campId,"notifications"),{type:"WAKE_UP",targetUid:s.id,sender:t.nickname,read:!1,timestamp:Z()}),alert("â° ê¸°ìƒ ë‚˜íŒ”ì„ ë¶ˆì—ˆìŠµë‹ˆë‹¤!")}catch(a){console.error(a),alert("ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨")}};return le.createPortal(e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),style:{maxWidth:"400px",padding:"0",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(U,{className:"text-accent"})," ìƒì¡´ì ëª©ë¡ (",r.filter(s=>s.isOnline).length,"ëª… ì ‘ì†)"]}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"âœ•"})]}),e.jsx("div",{style:{padding:"20px",maxHeight:"400px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px"},children:g?e.jsx("p",{style:{textAlign:"center",opacity:.5},children:"ëª…ë‹¨ í™•ì¸ ì¤‘..."}):r.map(s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",borderRadius:"12px",background:s.isOnline?"rgba(74, 222, 128, 0.1)":"rgba(255, 255, 255, 0.03)",border:s.isOnline?"1px solid rgba(74, 222, 128, 0.3)":"1px solid rgba(255, 255, 255, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:s.isOnline?"#4ade80":"#94a3b8",boxShadow:s.isOnline?"0 0 10px #4ade80":"none"}}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[s.nickname," ",s.id===t.id&&e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ë‚˜)"})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:[s.className," â€¢ ",s.isOnline?"ì˜¨ë¼ì¸":`${s.lastSeenAgo}ë¶„ ì „ ì ‘ì†`]})]})]}),!s.isOnline&&s.id!==t.id&&e.jsxs("button",{onClick:()=>f(s),style:{padding:"6px 12px",borderRadius:"20px",border:"none",background:"rgba(255,255,255,0.1)",color:"white",fontSize:"0.8rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(jt,{size:12})," ê¹¨ìš°ê¸°"]})]},s.id))})]})}),document.body)},Tt=()=>{const[t,i]=l.useState("home"),[r,x]=l.useState(window.innerWidth<768),[g,u]=l.useState(0),[f,s]=l.useState(!1),[a,c]=l.useState(()=>{try{return JSON.parse(localStorage.getItem("bg3_user_profile"))}catch{return null}});if(l.useEffect(()=>{const d=()=>x(window.innerWidth<768);return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),l.useEffect(()=>{},[a]),l.useEffect(()=>{if(!a?.id)return;const d=async()=>{try{await ee(M(k,"users_v2",a.id),{lastSeen:Z()})}catch(m){console.error("Heartbeat fail",m)}};d();const o=setInterval(d,6e4);return()=>clearInterval(o)},[a?.id]),l.useEffect(()=>{if(!a?.campId)return;const d=H(W(k,"users_v2"),Y("campId","==",a.campId)),o=X(d,m=>{u(m.size)});return()=>o()},[a?.campId]),l.useEffect(()=>{if(!a?.campId||!a?.id)return;const d=H(W(k,"camps",a.campId,"notifications"),Y("targetUid","==",a.id),Y("read","==",!1)),o=X(d,m=>{m.docChanges().forEach(I=>{if(I.type==="added"){const D=I.doc.data();D.type==="WAKE_UP"&&(new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3").play().catch(S=>console.log("Audio play failed",S)),alert(`â° ${D.sender}ë‹˜ì´ ë‹¹ì‹ ì„ ê¹¨ìš°ê³  ìˆìŠµë‹ˆë‹¤! ì–¼ë¥¸ ì¼ì–´ë‚˜ì„¸ìš”!`),ee(I.doc.ref,{read:!0}))}})});return()=>o()},[a?.campId,a?.id]),!a)return e.jsx(Ae,{onComplete:()=>window.location.reload(),isMobile:r});const y=()=>{const d={user:a,isMobile:r,onlineUsersCount:g,setShowSurvivors:s};switch(t){case"home":return e.jsx(Re,{...d,setActiveTab:i});case"chat":return e.jsx(Rt,{...d});case"calendar":return e.jsx(zt,{...d});case"save":return e.jsx(Dt,{...d});case"admin":return e.jsx(At,{...d});case"tactics":return e.jsx(Nt,{...d});case"profile":return e.jsx(Ae,{user:a,onComplete:()=>window.location.reload(),isMobile:r});default:return e.jsx(Re,{...d,setActiveTab:i})}};return e.jsxs("div",{className:"layout-container",style:{display:"flex",minHeight:"100vh",color:"#e2e8f0",fontFamily:"Pretendard, sans-serif"},children:[e.jsx(It,{activeTab:t,setActiveTab:i,isMobile:r,user:a,onlineUsersCount:g,setShowSurvivors:s}),e.jsx("main",{style:{flex:1,padding:r?"20px 20px 90px":"40px",overflowY:"auto",position:"relative"},children:y()}),f&&e.jsx(_t,{user:a,onClose:()=>s(!1)})]})};function Wt(){return e.jsx(Tt,{})}class Mt extends $.Component{constructor(i){super(i),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(i){return{hasError:!0}}componentDidCatch(i,r){this.setState({error:i,errorInfo:r}),console.error("Uncaught error:",i,r)}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",color:"white",background:"#333"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px"},children:"Reload"})]}):this.props.children}}vt.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(Mt,{children:e.jsx(Wt,{})})}));
