import{i as ht,g as ft,R as G,H as Ze,M as Xe,C as ze,P as et,F as tt,U as $,j as e,L as lt,r as ye,S as dt,T as bt,A as Ee,a as je,b as Te,c as Ae,d as ve,Z as we,e as ne,f as ke,G as We,h as Ne,k as oe,W as Se,l as a,m as ct,n as Le,q,o as O,p as pt,s as Je,t as Me,w as H,u as yt,v as X,x as xt,B as jt,y as se,X as Ve,I as vt,z as wt,D as Be,E as ge,J as Re,K as P,N as De,O as kt,Q as St,V as Ct,Y as Pe,_ as Fe,$ as It,a0 as $e,a1 as gt,a2 as Rt,a3 as zt,a4 as Dt,a5 as Et,a6 as Tt,a7 as xe,a8 as Ie,a9 as nt,aa as At,ab as Wt,ac as Nt,ad as Bt,ae as _t,af as Lt,ag as rt,ah as Mt,ai as Pt,aj as Ot,ak as Ft,al as Ut}from"./vendor-D1cCnfCH.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))m(u);new MutationObserver(u=>{for(const j of u)if(j.type==="childList")for(const v of j.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&m(v)}).observe(document,{childList:!0,subtree:!0});function l(u){const j={};return u.integrity&&(j.integrity=u.integrity),u.referrerPolicy&&(j.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?j.credentials="include":u.crossOrigin==="anonymous"?j.credentials="omit":j.credentials="same-origin",j}function m(u){if(u.ep)return;u.ep=!0;const j=l(u);fetch(u.href,j)}})();const $t="modulepreload",Yt=function(n){return"/bg3-raid-manager/"+n},it={},Oe=function(o,l,m){let u=Promise.resolve();if(l&&l.length>0){let p=function(s){return Promise.all(s.map(w=>Promise.resolve(w).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),i=v?.nonce||v?.getAttribute("nonce");u=p(l.map(s=>{if(s=Yt(s),s in it)return;it[s]=!0;const w=s.endsWith(".css"),x=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${x}`))return;const h=document.createElement("link");if(h.rel=w?"stylesheet":$t,w||(h.as="script"),h.crossOrigin="",h.href=s,i&&h.setAttribute("nonce",i),document.head.appendChild(h),w)return new Promise((R,N)=>{h.addEventListener("load",R),h.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${s}`)))})}))}function j(v){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=v,window.dispatchEvent(i),!i.defaultPrevented)throw v}return u.then(v=>{for(const i of v||[])i.status==="rejected"&&j(i.reason);return o().catch(j)})},te="/bg3-raid-manager/assets/logo-BLpM7sGS.svg",Ht={apiKey:"AIzaSyAsbaWbo3DoSTrRFhkaf9XujWPpmeGSjAE",authDomain:"bg3-raid-manager.firebaseapp.com",projectId:"bg3-raid-manager",storageBucket:"bg3-raid-manager.firebasestorage.app",messagingSenderId:"773826713403",appId:"1:773826713403:web:c15fdfca708d47f4fcc91e"},qt=ht(Ht),C=ft(qt);console.log("ðŸ”¥ Firebase Connected (Real DB Mode)");const at=({size:n=20,color:o="currentColor"})=>e.jsxs("div",{style:{position:"relative",width:n,height:n,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(bt,{size:n,color:o}),e.jsx(dt,{size:n*.5,color:o,style:{position:"absolute",bottom:-2,right:-2,background:"#1a1a2e",borderRadius:"50%"}})]}),Xt=({activeTab:n,setActiveTab:o,isMobile:l,user:m,onlineUsersCount:u,setShowSurvivors:j,showProfileView:v,setShowProfileView:i,showProfileEdit:p,setShowProfileEdit:s})=>{const[w,x]=G.useState(4),[h,R]=G.useState(!1),[N,E]=G.useState(!1),y=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],[c,I]=G.useState(m?.nickname||""),[f,B]=G.useState(m?.className||"Warrior"),[g,d]=G.useState(m?.role||(m?.isAdmin?"Admin":"User")),[b,k]=G.useState(m?.color||y[Math.floor(Math.random()*y.length)]),D=m?.isAdmin===!0,T=t=>t?t.includes("ë°”ë°”ë¦¬ì•ˆ")?Ee:t.includes("ë°”ë“œ")?je:t.includes("í´ë ˆë¦­")?Te:t.includes("ë“œë£¨ì´ë“œ")?Ae:t.includes("íŒŒì´í„°")?ve:t.includes("ëª½í¬")?we:t.includes("íŒ”ë¼ë”˜")?ne:t.includes("ë ˆì¸ì €")?ke:t.includes("ë¡œê·¸")?We:t.includes("ì†Œì„œëŸ¬")?Ne:t.includes("ì›Œë½")?oe:t.includes("ìœ„ìžë“œ")?Se:$:$;G.useEffect(()=>{m&&(I(m.nickname||""),B(m.className||"Warrior"),d(m.role||(m.isAdmin?"Admin":"User")),k(m.color||y[Math.floor(Math.random()*y.length)]))},[m,p]),G.useEffect(()=>{const t=z=>{z.shiftKey&&z.altKey&&(z.key==="R"||z.key==="r")&&R(W=>!W)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const A=()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},F=async()=>{if(!c.trim())return alert("Nickname is required");try{const{updateDoc:t,doc:z}=await Oe(async()=>{const{updateDoc:M,doc:K}=await import("./vendor-D1cCnfCH.js").then(ce=>ce.am);return{updateDoc:M,doc:K}},[]),W=z(C,"users_v2",m.id),L={nickname:c,className:f,role:g,color:b};await t(W,L);const Y={...m,...L};localStorage.setItem("bg3_user_profile",JSON.stringify(Y)),alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì ìš©ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤."),window.location.reload()}catch(t){console.error(t),alert("ìˆ˜ì • ì‹¤íŒ¨: "+t.message)}},Q=["ë°”ë°”ë¦¬ì•ˆ","ë°”ë“œ","í´ë ˆë¦­","ë“œë£¨ì´ë“œ","íŒŒì´í„°","ëª½í¬","íŒ”ë¼ë”˜","ë ˆì¸ì €","ë¡œê·¸","ì†Œì„œëŸ¬","ì›Œë½","ìœ„ìžë“œ"],re=[{id:"home",label:"í™ˆ",icon:Ze},{id:"chat",label:"ì±„íŒ…",icon:Xe},{id:"calendar",label:"ì¼ì •",icon:ze},{id:"tactics",label:"ì „ìˆ íŒ",icon:et},{id:"save",label:"ì„¸ì´ë¸Œ",icon:tt},{id:"profile",label:"í”„ë¡œí•„",icon:$}];D&&re.push({id:"admin",label:"ì•¼ì˜ì§€ ê´€ë¦¬",icon:at});const le=re.filter(t=>t.id!=="profile"),de=()=>e.jsxs(e.Fragment,{children:[N&&ye.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),style:{alignItems:"center"},children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),style:{maxWidth:"350px",padding:"30px",textAlign:"center",margin:"auto"},children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"10px",marginTop:"10px"},children:"ë¡œê·¸ì•„ì›ƒ"}),e.jsxs("p",{style:{opacity:.8,marginBottom:"30px",lineHeight:"1.5"},children:["ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ëª¨ë“  ë¡œê·¸ì¸ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤)"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>E(!1),style:{flex:1,padding:"14px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"transparent",color:"white",cursor:"pointer",fontWeight:"bold"},children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:A,style:{flex:1,padding:"14px",borderRadius:"12px",border:"none",background:"linear-gradient(45deg, #ef4444, #dc2626)",color:"white",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 15px rgba(239,68,68,0.3)"},children:"í™•ì¸"})]})]})}),document.body),v&&ye.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>i(!1),style:{alignItems:"center"},children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),style:{width:"90%",maxWidth:"400px",padding:"25px",textAlign:"center",margin:"auto",maxHeight:"90vh",overflowY:"auto"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 0 20px rgba(212, 160, 23, 0.4)"},children:e.jsx($,{size:40,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.6rem",marginBottom:"5px",fontWeight:"bold"},children:m?.nickname||"ëª¨í—˜ê°€"}),e.jsxs("p",{style:{color:"var(--accent-color)",marginBottom:"20px",fontSize:"0.9rem",fontWeight:"bold"},children:[m?.className||"Classless"," ",e.jsx("span",{style:{opacity:.5},children:"|"})," ",m?.role==="Admin"||m?.isAdmin?"ëŒ€ìž¥":"ëŒ€ì›"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"25px",textAlign:"left"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì§ì—…"}),e.jsx("p",{style:{fontWeight:"bold"},children:m?.className||"-"})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginBottom:"4px"},children:"ì‹ ë¶„"}),e.jsx("p",{style:{fontWeight:"bold"},children:m?.role==="Admin"||m?.isAdmin?"ê´€ë¦¬ìž":"ì¼ë°˜ ëŒ€ì›"})]})]}),e.jsxs("button",{onClick:()=>{i(!1),s(!0)},style:{width:"100%",padding:"14px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s"},onMouseEnter:t=>t.currentTarget.style.background="rgba(255,255,255,0.2)",onMouseLeave:t=>t.currentTarget.style.background="rgba(255,255,255,0.1)",children:[e.jsx(dt,{size:18}),"í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°"]})]})}),document.body),p&&ye.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>s(!1),style:{alignItems:"center"},children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),style:{width:"90%",maxWidth:"400px",padding:"25px",margin:"auto",maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx($,{size:24,color:"var(--accent-color)"}),"í”„ë¡œí•„ ìˆ˜ì •"]}),e.jsx("button",{onClick:()=>s(!1),style:{background:"transparent",color:"rgba(255,255,255,0.5)"},children:"x"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ë‹‰ë„¤ìž„"}),e.jsx("input",{type:"text",value:c,onChange:t=>I(t.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"6px"},children:"ì§ì—… (Class)"}),e.jsx("select",{value:f,onChange:t=>B(t.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",outline:"none"},children:Q.map(t=>e.jsx("option",{value:t,style:{background:"#1a1a2e"},children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:y.map(t=>e.jsx("div",{onClick:()=>k(t),style:{width:"28px",height:"28px",borderRadius:"50%",background:t,cursor:"pointer",border:b===t?"3px solid white":"1px solid transparent",boxShadow:b===t?"0 0 10px "+t:"none",transform:b===t?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},t))})]}),e.jsx("button",{onClick:F,style:{marginTop:"10px",padding:"14px",borderRadius:"10px",background:"var(--accent-color)",color:"white",border:"none",fontWeight:"bold",fontSize:"1rem",cursor:"pointer"},children:"ì €ìž¥í•˜ê¸°"})]})]})}),document.body)]});if(l){const t=[{id:"home",icon:Ze,label:"í™ˆ"},{id:"calendar",icon:ze,label:"ì¼ì •"},{id:"tactics",icon:et,label:"ì „ìˆ "},{id:"chat",icon:Xe,label:"ì±„íŒ…"},...D?[{id:"admin",icon:at,label:"ê´€ë¦¬"}]:[],{id:"save",icon:tt,label:"ì„¸ì´ë¸Œ"}];return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"glass",style:{position:"fixed",bottom:"20px",left:"20px",right:"20px",margin:"0 auto",maxWidth:"500px",height:"70px",zIndex:1e3,display:"flex",justifyContent:"space-around",alignItems:"center",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.15)",borderTop:"1px solid rgba(255,255,255,0.25)",backdropFilter:"blur(20px) saturate(180%)",background:"rgba(20, 20, 30, 0.85)",boxShadow:"0 10px 30px rgba(0,0,0,0.5)",padding:"0 10px"},children:t.map(z=>{const W=z.icon,L=n===z.id;return e.jsxs("button",{onClick:()=>o(z.id),style:{background:L?"rgba(255,255,255,0.1)":"transparent",borderRadius:"16px",width:"50px",height:"50px",border:"none",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:L?"var(--accent-color)":"rgba(255,255,255,0.5)",transition:"all 0.2s",gap:"4px"},children:[e.jsx(W,{size:22,strokeWidth:L?2.5:2}),L&&e.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"var(--accent-color)"}})]},z.id)})}),de()]})}const ue=T(m?.className);return e.jsxs("aside",{className:"glass",style:{width:"280px",height:"100vh",margin:0,padding:"25px",display:"flex",flexDirection:"column",borderRadius:0,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(20, 20, 30, 0.4)",position:"sticky",top:0},children:[e.jsxs("div",{style:{padding:"0 0 25px",textAlign:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[h&&e.jsx("button",{id:"db-reset-btn",onClick:async()=>{if(confirm("âš ï¸ ê²½ê³ : ì •ë§ë¡œ DBë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëŒì´í‚¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")){const{collection:t,getDocs:z,deleteDoc:W}=await Oe(async()=>{const{collection:M,getDocs:K,deleteDoc:ce}=await import("./vendor-D1cCnfCH.js").then(me=>me.am);return{collection:M,getDocs:K,deleteDoc:ce}},[]);(await z(t(C,"users_v2"))).forEach(M=>W(M.ref)),(await z(t(C,"camps"))).forEach(M=>W(M.ref)),alert("ì´ˆê¸°í™” ì™„ë£Œ. ìž¬ì ‘ì†í•©ë‹ˆë‹¤."),A()}},style:{background:"red",color:"white",border:"none",padding:"5px",marginBottom:"10px",fontSize:"0.7rem",cursor:"pointer",width:"100%"},children:"[ADMIN] DB ì´ˆê¸°í™”"}),e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"100%",marginBottom:"10px",cursor:"pointer"},onClick:()=>window.location.reload(),children:[e.jsx("img",{src:te,alt:"BG3",style:{width:"100%",height:"auto",display:"block"},onError:t=>t.target.style.display="none"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${te})`,maskImage:`url(${te})`}})]}),e.jsxs("div",{onClick:()=>j&&j(!0),style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",background:"rgba(0,0,0,0.3)",borderRadius:"12px",fontSize:"0.75rem",border:"1px solid rgba(255,255,255,0.1)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:t=>t.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:t=>t.currentTarget.style.background="rgba(0,0,0,0.3)",children:[e.jsx($,{size:12,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80"},children:[u,"/",w,"ëª… ì ‘ì† ì¤‘"]})]})]}),e.jsx("nav",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"20px",flex:1},children:le.map(t=>{const z=t.icon;return e.jsxs("button",{onClick:()=>o(t.id),style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:n===t.id?"rgba(255,255,255,0.15)":"transparent",color:n===t.id?"white":"rgba(255,255,255,0.7)",borderRadius:"12px",transition:"all 0.2s",border:"none",cursor:"pointer",fontSize:"0.95rem",fontWeight:n===t.id?"bold":"normal"},children:[e.jsx(z,{size:20,color:n===t.id?"var(--accent-color)":"currentColor"}),t.label]},t.id)})}),e.jsxs("div",{onClick:()=>i(!0),style:{marginTop:"auto",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s",padding:"8px 8px 8px 12px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",height:"60px"},onMouseEnter:t=>{t.currentTarget.style.background="rgba(255, 255, 255, 0.08)",t.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:t=>{t.currentTarget.style.background="rgba(20, 20, 35, 0.6)",t.currentTarget.style.borderColor="rgba(255, 255, 255, 0.1)"},title:"í”„ë¡œí•„ ë³´ê¸°",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:m.color||"var(--accent-color)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 2px 10px ${m.color||"#f59e0b"}66`},children:e.jsx(ue,{size:20,color:"white"})}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.95rem",color:"white"},children:m.nickname})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),E(!0)},style:{width:"40px",height:"40px",background:"rgba(248, 113, 113, 0.15)",border:"1px solid rgba(248, 113, 113, 0.3)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fca5a5",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:t=>t.currentTarget.style.background="rgba(248, 113, 113, 0.25)",onMouseLeave:t=>t.currentTarget.style.background="rgba(248, 113, 113, 0.15)",children:e.jsx(lt,{size:16})})]}),de()]})},st=({user:n,setActiveTab:o,isMobile:l,onlineUsersCount:m,setShowSurvivors:u,openTactic:j,openProfile:v})=>{const[i,p]=a.useState([]),[s,w]=a.useState(!0),[x,h]=a.useState(()=>{const y=localStorage.getItem("bg3_daily_goals");return y?JSON.parse(y):[{id:1,text:"ê¸´ íœ´ì‹ ì·¨í•˜ê¸° (ì£¼ë¬¸ ìŠ¬ë¡¯ ë³µêµ¬)",checked:!1},{id:2,text:"ì•¼ì˜ì§€ ë¬¼ìž í™•ì¸",checked:!1},{id:3,text:"ìƒì¸ì—ê²Œ ìž¡ë™ì‚¬ë‹ˆ íŒë§¤",checked:!1},{id:4,text:"ë™ë£Œ í˜¸ê°ë„ ëŒ€í™”",checked:!1}]});a.useEffect(()=>{localStorage.setItem("bg3_daily_goals",JSON.stringify(x))},[x]);const[R,N]=a.useState([]);a.useEffect(()=>{(async()=>{try{const c=q(O(C,"schedules"),pt("date"),Je(3)),I=await Me(c);if(p(I.docs.map(f=>({id:f.id,...f.data()}))),n?.campId){const f=q(O(C,"tactics"),H("campId","==",n.campId)),g=(await Me(f)).docs.map(d=>({id:d.id,...d.data()}));g.sort((d,b)=>(b.createdAt?.seconds||0)-(d.createdAt?.seconds||0)),N(g.slice(0,3))}}catch(c){console.error(c)}finally{w(!1)}})()},[n?.campId]);const E=({icon:y,title:c,desc:I,onClick:f,color:B})=>e.jsxs("div",{onClick:f,className:"glass-panel",style:{padding:"20px",cursor:"pointer",transition:"transform 0.2s",display:"flex",flexDirection:"column",gap:"10px"},onMouseEnter:g=>g.currentTarget.style.transform="translateY(-5px)",onMouseLeave:g=>g.currentTarget.style.transform="translateY(0)",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{padding:"10px",borderRadius:"12px",background:`rgba(${B}, 0.2)`},children:e.jsx(y,{color:`rgb(${B})`,size:24})}),e.jsx(yt,{size:16,style:{opacity:.5}})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"5px 0",fontSize:"1.1rem"},children:c}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:I})]})]});return e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"flex",flexDirection:"column",gap:l?"15px":"30px"},children:[l&&e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",width:"180px",margin:"0 auto 10px"},children:[e.jsx("img",{src:te,alt:"BG3",style:{width:"100%"},onClick:()=>window.location.reload()}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${te})`,maskImage:`url(${te})`}})]}),l&&e.jsxs("div",{onClick:()=>u&&u(!0),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",background:"rgba(20, 20, 30, 0.6)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"15px",padding:"5px 12px",margin:"0 auto 15px",maxWidth:"fit-content",cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,0.2)"},children:[e.jsx($,{size:12,color:"#4ade80"}),e.jsxs("span",{style:{color:"#4ade80",fontSize:"0.75rem",fontWeight:"bold"},children:[m||0,"/4ëª… ì ‘ì† ì¤‘"]})]}),e.jsxs("div",{onClick:()=>!l&&v(),style:{width:"100%",minHeight:"90px",borderRadius:"50px",background:"rgba(20, 20, 35, 0.6)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 10px 30px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"space-between",padding:l?"20px 25px":"0 40px",textAlign:"left",cursor:l?"default":"pointer",transition:"transform 0.2s"},onMouseOver:y=>l?null:y.currentTarget.style.transform="scale(1.01)",onMouseOut:y=>l?null:y.currentTarget.style.transform="scale(1)",children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,fontSize:l?"1.2rem":"1.6rem",fontWeight:"bold"},children:["ì–´ì„œì˜¤ì„¸ìš”, ",e.jsx("span",{style:{color:n?.color||"#ffd700"},children:n.nickname}),"ë‹˜"]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"0.85rem",opacity:.6},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ ì›ì •ëŒ€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤."})]}),e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:n?.color||"#ffd700",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 20px ${n?.color||"#ffd700"}66`,flexShrink:0,marginLeft:"15px"},children:(()=>{const y=n?.className||"";let c=$;return y.includes("ë°”ë°”ë¦¬ì•ˆ")?c=Ee:y.includes("ë°”ë“œ")?c=je:y.includes("í´ë ˆë¦­")?c=Te:y.includes("ë“œë£¨ì´ë“œ")?c=Ae:y.includes("íŒŒì´í„°")?c=ve:y.includes("ëª½í¬")?c=we:y.includes("íŒ”ë¼ë”˜")?c=ne:y.includes("ë ˆì¸ì €")?c=ke:y.includes("ë¡œê·¸")?c=We:y.includes("ì†Œì„œëŸ¬")?c=Ne:y.includes("ì›Œë½")?c=oe:y.includes("ìœ„ìžë“œ")&&(c=Se),e.jsx(c,{size:28,color:"white",strokeWidth:2.5})})()})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:l?"10px":"20px"},children:[e.jsx(E,{icon:ze,title:"ë ˆì´ë“œ ì¼ì •",desc:"ë‹¤ê°€ì˜¤ëŠ” ëª¨í—˜ í™•ì¸í•˜ê¸°",onClick:()=>o("calendar"),color:"248, 113, 113"}),e.jsx(E,{icon:ct,title:"ì„¸ì´ë¸Œ ë¶„ì„",desc:"ë‚´ ìºë¦­í„° ìŠ¤íŽ™ í™•ì¸",onClick:()=>o("save"),color:"167, 139, 250"}),e.jsx(E,{icon:Xe,title:"ìž‘ì „ íšŒì˜ì‹¤",desc:"íŒŒí‹°ì›ë“¤ê³¼ ëŒ€í™”í•˜ê¸°",onClick:()=>o("chat"),color:"52, 211, 153"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":"1fr 1fr",gap:l?"10px":"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"20px",minHeight:"300px",display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px",fontSize:"1.2rem"},children:[e.jsx(ze,{size:20,className:"text-accent"})," ë‹¤ê°€ì˜¤ëŠ” ì¼ì •"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:1},children:s?e.jsx("p",{style:{opacity:.5},children:"ë¡œë”© ì¤‘..."}):i.length===0?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.5},children:"ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."}):i.map(y=>e.jsxs("div",{onClick:()=>o("calendar"),style:{padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",display:"flex",alignItems:"center",gap:"15px",cursor:"pointer",transition:"background 0.2s",border:"1px solid rgba(255,255,255,0.05)"},onMouseEnter:c=>c.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:c=>c.currentTarget.style.background="rgba(255,255,255,0.05)",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"50px"},children:[e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.7},children:[y.date?.split("-")[1],"ì›”"]}),e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:y.date?.split("-")[2]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"1rem"},children:y.title}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6,marginTop:"2px"},children:[y.time," â€¢ ",y.type==="raid"?"âš”ï¸ ë ˆì´ë“œ":"ðŸ“œ ìŠ¤í† ë¦¬"]})]})]},y.id))}),e.jsx("button",{onClick:()=>o("calendar"),style:{marginTop:"15px",padding:"10px",width:"100%",background:"rgba(255,255,255,0.05)",border:"none",color:"rgba(255,255,255,0.7)",borderRadius:"8px",cursor:"pointer"},children:"ì „ì²´ ì¼ì • ë³´ê¸°"})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"20px",minHeight:"300px",display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px",fontSize:"1.2rem"},children:[e.jsx(Le,{size:20,className:"text-secondary",style:{color:"#60a5fa"}})," ìµœê·¼ ì „ìˆ "]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:1},children:s?e.jsx("p",{style:{opacity:.5},children:"ë¡œë”© ì¤‘..."}):R.length===0?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.5},children:"ìˆ˜ë¦½ëœ ìž‘ì „ì´ ì—†ìŠµë‹ˆë‹¤."}):R.map(y=>e.jsxs("div",{onClick:()=>j?j(y.id):o("tactics"),style:{padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",display:"flex",alignItems:"center",gap:"15px",cursor:"pointer",transition:"background 0.2s",border:"1px solid rgba(255,255,255,0.05)"},onMouseEnter:c=>c.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:c=>c.currentTarget.style.background="rgba(255,255,255,0.05)",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"10px",background:"rgba(96, 165, 250, 0.2)",borderRadius:"10px"},children:e.jsx(Le,{size:20,color:"#60a5fa"})}),e.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"1rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:y.title}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6,marginTop:"2px"},children:["ìž‘ì„±ìž: ",y.authorName]})]})]},y.id))}),e.jsx("button",{onClick:()=>o("tactics"),style:{marginTop:"15px",padding:"10px",width:"100%",background:"rgba(255,255,255,0.05)",border:"none",color:"rgba(255,255,255,0.7)",borderRadius:"8px",cursor:"pointer"},children:"ì „ìˆ  ìž‘ì „ì‹¤ ì´ë™"})]})]})]})},Kt=({user:n,isMobile:o,setActiveTab:l})=>{const[m,u]=a.useState([]),[j,v]=a.useState(""),[i,p]=a.useState(null),[s,w]=a.useState(!0),[x,h]=a.useState([]),R=a.useRef(null),N=a.useRef(null),E=a.useRef(0),y=g=>g?g.includes("ë°”ë°”ë¦¬ì•ˆ")?Ee:g.includes("ë°”ë“œ")?je:g.includes("í´ë ˆë¦­")?Te:g.includes("ë“œë£¨ì´ë“œ")?Ae:g.includes("íŒŒì´í„°")?ve:g.includes("ëª½í¬")?we:g.includes("íŒ”ë¼ë”˜")?ne:g.includes("ë ˆì¸ì €")?ke:g.includes("ë¡œê·¸")?We:g.includes("ì†Œì„œëŸ¬")?Ne:g.includes("ì›Œë½")?oe:g.includes("ìœ„ìžë“œ")?Se:se:se;a.useEffect(()=>{if(!n?.campId)return;const g=q(O(C,"chats"),H("campId","==",n.campId),Je(50)),d=X(g,b=>{const k=b.docs.map(D=>({id:D.id,...D.data(),timestamp:D.data().timestamp?.toDate().toISOString()||new Date().toISOString()}));k.sort((D,T)=>new Date(D.timestamp)-new Date(T.timestamp)),u(k),w(!1)});return()=>d()},[n?.campId]),a.useEffect(()=>{if(!n?.campId)return;const g=q(O(C,"camps",n.campId,"typing")),d=X(g,k=>{const D=Date.now(),T=k.docs.map(A=>({id:A.id,...A.data()})).filter(A=>A.id!==n.id&&A.timestamp&&D-A.timestamp.toMillis()<4e3);h(T)}),b=setInterval(()=>{h(k=>{const D=Date.now();return k.filter(T=>T.timestamp?.toMillis&&D-T.timestamp.toMillis()<4e3)})},1e3);return()=>{d(),clearInterval(b)}},[n?.campId,n?.id]);const c=a.useRef(!1);a.useEffect(()=>{!s&&m.length>0&&!c.current&&(R.current?.scrollIntoView({behavior:"auto"}),c.current=!0)},[m,s]);const I=g=>{const d=g.target.files[0];if(d){if(d.size>500*1024){alert("ì´ë¯¸ì§€ í¬ê¸°ëŠ” 500KB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");return}const b=new FileReader;b.onloadend=()=>{p(b.result)},b.readAsDataURL(d)}},f=async g=>{const d=g.target.value;v(d);const b=Date.now();if(d.trim()&&b-E.current>2e3&&n?.campId){E.current=b;try{await Re(P(C,"camps",n.campId,"typing",n.id),{nickname:n.nickname,timestamp:ge()})}catch(k){console.error("Typing status error",k)}}},B=async g=>{if(g.preventDefault(),!j.trim()&&!i||!n?.campId)return;const d=j,b=i;v(""),p(null);try{await Be(O(C,"chats"),{text:d,image:b,sender:n.nickname,uid:n.id,userClass:n.className||"Unknown",userColor:n.color||"#a78bfa",campId:n.campId,timestamp:ge()})}catch(k){console.error("Error sending message: ",k),alert("ì „ì†¡ ì‹¤íŒ¨!")}};return n?.campId?e.jsxs("div",{style:{display:"flex",flexDirection:"column",padding:0,position:o?"fixed":"relative",top:0,left:0,right:0,bottom:0,height:o?"100dvh":"100%",background:o?"#0f0f13":"rgba(0,0,0,0.2)",zIndex:2e3},children:[e.jsxs("div",{style:{padding:"15px 20px",borderBottom:"1px solid rgba(255,255,255,0.1)",background:o?"rgba(20,20,30,0.95)":"transparent",display:"flex",alignItems:"center",gap:"15px"},children:[o&&e.jsx("button",{onClick:()=>l("home"),style:{background:"none",border:"none",color:"white",padding:"5px",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(xt,{size:24})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("h2",{style:{fontSize:"1.2rem",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(jt,{color:"#4fd1c5",size:20})," íŒŒí‹° ìž‘ì „ íšŒì˜ì‹¤"]}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.6,display:"block",marginTop:"2px"},children:["ðŸ”’ ",n.campId," ì•¼ì˜ì§€"]})]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"15px"},children:[s&&e.jsx("div",{style:{textAlign:"center",opacity:.5},children:"ì±„íŒ…ë°© ì—°ê²° ì¤‘..."}),m.length===0&&!s&&e.jsxs("div",{style:{textAlign:"center",opacity:.3,marginTop:"20px"},children:[e.jsx("p",{children:"ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{children:"ìž‘ì „ì„ ì‹œìž‘í•´ë³´ì„¸ìš”!"})]}),m.map(g=>{const d=g.uid===n.id,b=y(g.userClass),k=g.userColor||"#a78bfa";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:d?"flex-end":"flex-start",marginBottom:"10px"},children:[!d&&e.jsx("div",{style:{fontSize:"0.8rem",marginLeft:"46px",marginBottom:"4px",opacity:.7},children:g.sender}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexDirection:d?"row-reverse":"row",maxWidth:"85%"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",background:k,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 2px 8px ${k}66`,flexShrink:0},children:e.jsx(b,{size:20,color:"white"})}),e.jsxs("div",{style:{background:d?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:d?"16px 4px 16px 16px":"4px 16px 16px 16px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.1)",wordBreak:"break-word",color:"white"},children:[g.image&&e.jsx("img",{src:g.image,alt:"attached",style:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain",borderRadius:"8px",marginBottom:g.text?"10px":"0"}}),g.text]})]}),e.jsx("span",{style:{fontSize:"0.65rem",opacity:.4,marginTop:"4px",marginRight:d?"46px":"0",marginLeft:d?"0":"46px"},children:new Date(g.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},g.id)}),x.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",marginTop:"10px",paddingLeft:"4px"},children:x.slice(0,3).map(g=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"8px",opacity:.9},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #a78bfa, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:"bold",color:"white",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},children:g.nickname?g.nickname.charAt(0):e.jsx(se,{size:14})}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"16px 16px 16px 2px",padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",height:"32px",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"})]}),e.jsxs("span",{style:{fontSize:"0.7rem",opacity:.5,marginBottom:"4px"},children:[g.nickname," ìž…ë ¥ ì¤‘..."]})]},g.id))}),e.jsx("div",{ref:R})]}),e.jsxs("form",{onSubmit:B,style:{padding:"20px",background:"rgba(0,0,0,0.2)",display:"flex",flexDirection:"column",gap:"10px",borderRadius:"0 0 16px 16px"},children:[i&&e.jsxs("div",{style:{position:"relative",width:"fit-content"},children:[e.jsx("img",{src:i,alt:"Preview",style:{height:"80px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.2)"}}),e.jsx("button",{type:"button",onClick:()=>p(null),style:{position:"absolute",top:-5,right:-5,background:"red",borderRadius:"50%",border:"none",color:"white",padding:"2px",cursor:"pointer"},children:e.jsx(Ve,{size:12})})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("input",{type:"file",accept:"image/*",ref:N,style:{display:"none"},onChange:I}),e.jsx("button",{type:"button",onClick:()=>N.current.click(),style:{padding:"12px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:e.jsx(vt,{size:20})}),e.jsx("input",{type:"text",value:j,onChange:f,placeholder:"ìž‘ì „ì„ ì „ë‹¬í•˜ì„¸ìš”...",style:{flex:1,padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.05)",color:"white",outline:"none"}}),e.jsx("button",{type:"submit",style:{padding:"12px",borderRadius:"12px",background:"var(--accent-color)",color:"white",border:"none",cursor:"pointer"},children:e.jsx(wt,{size:20})})]})]})]}):e.jsx("div",{className:"glass-panel",style:{padding:"40px",textAlign:"center"},children:"ì•¼ì˜ì§€ì— ì†Œì†ë˜ì–´ ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤."})},Jt=({user:n,isMobile:o})=>{const[l,m]=a.useState(new Date),[u,j]=a.useState([]),[v,i]=a.useState([]),[p,s]=a.useState(!0),[w,x]=a.useState(0),h=l.toLocaleDateString("en-CA");a.useEffect(()=>{if(!n?.campId){s(!1);return}console.log("Fetching raid data...");const d=q(O(C,"availabilities"),H("campId","==",n.campId)),b=q(O(C,"schedules"),H("campId","==",n.campId),H("type","==","fixed")),k=X(d,T=>{const A=T.docs.map(F=>({id:F.id,...F.data()}));j(A)}),D=X(b,T=>{const A=T.docs.map(F=>({id:F.id,...F.data()}));i(A),s(!1)});return()=>{k(),D()}},[n?.campId,w]);const N=u.find(d=>d.userId===n.id&&d.date===h)?.possibleTimes||[],E=a.useMemo(()=>{const d={};return u.filter(k=>k.date===h).forEach(k=>{k.possibleTimes?.forEach(D=>{d[D]||(d[D]=[]),d[D].push(k.nickname)})}),d},[u,h]),y=v.find(d=>d.date===h),c=async d=>{if(!n.campId)return;const b=N.includes(d)?N.filter(T=>T!==d):[...N,d].sort(),k=`${n.campId}_${n.id}_${h}`,D=P(C,"availabilities",k);await Re(D,{campId:n.campId,userId:n.id,nickname:n.nickname,date:h,possibleTimes:b})},I=async d=>{if(window.confirm(`${l.toLocaleDateString()} ${d}ì— ë ˆì´ë“œë¥¼ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await Be(O(C,"schedules"),{campId:n.campId,title:"ì •ê¸° ë ˆì´ë“œ",date:h,fixedTime:d,type:"fixed",creator:n.nickname,createdAt:new Date().toISOString()}),alert("ë ˆì´ë“œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤! íŒŒí‹°ì›ë“¤ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤."),s(!0),x(b=>b+1)}catch(b){console.error(b),alert("ì˜¤ë¥˜ ë°œìƒ: "+b.message)}},f=async d=>{window.confirm("ì •ë§ ì´ ë ˆì´ë“œ ì¼ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await Fe(P(C,"schedules",d))},B=["18:00","19:00","20:00","21:00","22:00","23:00","00:00","01:00","02:00"],g=({date:d,view:b})=>{if(b==="month"){const k=d.toLocaleDateString("en-CA");if(v.some(A=>A.date===k))return e.jsx("div",{style:{height:"6px",width:"6px",background:"#f87171",borderRadius:"50%",margin:"2px auto"}});if(u.some(A=>A.date===k))return e.jsx("div",{style:{height:"4px",width:"4px",background:"rgba(255,255,255,0.3)",borderRadius:"50%",margin:"2px auto"}})}};return e.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:o?"15px":"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",color:"white",margin:0,fontSize:o?"1.2rem":"1.5rem"},children:[e.jsx(ze,{className:"text-accent"})," ë ˆì´ë“œ ì¼ì • (Raid Scheduler)"]}),e.jsx("button",{onClick:()=>{s(!0),x(d=>d+1)},style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",padding:"8px",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"ìƒˆë¡œê³ ì¹¨",children:e.jsx(De,{size:18})})]}),e.jsx("style",{children:`
                    .react-calendar { background: transparent !important; border: none !important; width: 100% !important; color: white !important; font-family: inherit; }
                    .react-calendar__navigation button { color: white; min-width: 44px; background: none; font-size: ${o?"1rem":"1.2rem"}; }
                    .react-calendar__navigation button:enabled:hover, .react-calendar__navigation button:enabled:focus { background-color: rgba(255,255,255,0.1); }
                    .react-calendar__month-view__weekdays { text-align: center; text-transform: uppercase; font-weight: bold; font-size: 0.8em; opacity: 0.7; color: var(--accent-color); }
                    .react-calendar__month-view__days__day { color: white; padding: ${o?"10px":"15px"}; background: transparent; border: none; }
                    .react-calendar__tile:enabled:hover, .react-calendar__tile:enabled:focus { background-color: rgba(255,255,255,0.1); border-radius: 12px; }
                    .react-calendar__tile--now { background: rgba(255,255,255,0.1) !important; border-radius: 12px; }
                    .react-calendar__tile--active { background: var(--accent-color) !important; color: white !important; border-radius: 12px; }
                `}),e.jsx(kt,{onChange:m,value:l,tileContent:g,formatDay:(d,b)=>b.getDate()})]}),y?e.jsxs("div",{className:"glass-panel",style:{padding:"25px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05))",border:"1px solid rgba(239, 68, 68, 0.3)",textAlign:"center"},children:[e.jsxs("h3",{style:{fontSize:"1.4rem",color:"#fca5a5",marginBottom:"10px",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(St,{})," ë ˆì´ë“œ í™•ì •ë¨"]}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold",margin:"10px 0"},children:y.fixedTime}),e.jsx("p",{style:{opacity:.8},children:"ëª¨ë“  ëŒ€ì›ì€ í•´ë‹¹ ì‹œê°„ì— ì•¼ì˜ì§€ë¡œ ì§‘ê²°í•˜ì‹­ì‹œì˜¤."}),(n.isAdmin||n.role==="Admin")&&e.jsx("button",{onClick:()=>f(y.id),style:{marginTop:"20px",padding:"10px 20px",borderRadius:"8px",background:"rgba(0,0,0,0.3)",color:"#fca5a5",border:"1px solid rgba(239,68,68,0.5)",cursor:"pointer"},children:"ì¼ì • ì·¨ì†Œí•˜ê¸°"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-panel",style:{padding:o?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx(Ct,{size:18,color:"var(--accent-color)"}),"ë‚˜ì˜ ê°€ëŠ¥ ì‹œê°„ (",l.toLocaleDateString(),")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:B.map(d=>{const b=N.includes(d);return e.jsx("button",{onClick:()=>c(d),style:{padding:"10px 16px",borderRadius:"12px",border:"none",cursor:"pointer",background:b?"var(--accent-color)":"rgba(255,255,255,0.05)",color:b?"white":"rgba(255,255,255,0.6)",fontWeight:b?"bold":"normal",transition:"all 0.2s",flexGrow:o?1:0},children:d},d)})})]}),e.jsxs("div",{className:"glass-panel",style:{padding:o?"15px":"20px"},children:[e.jsxs("h3",{style:{margin:"0 0 15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[e.jsx($,{size:18,color:"#a78bfa"}),"íŒŒí‹° í˜„í™© (Team Status)"]}),Object.keys(E).length===0?e.jsx("p",{style:{opacity:.5,textAlign:"center",padding:"20px"},children:"ì•„ì§ ë“±ë¡ëœ ê°€ëŠ¥ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Object.entries(E).sort((d,b)=>b[1].length-d[1].length||d[0].localeCompare(b[0])).map(([d,b])=>{const k=b.length,D=k>=3;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderRadius:"12px",background:D?"rgba(167, 139, 250, 0.15)":"rgba(255,255,255,0.03)",border:D?"1px solid rgba(167, 139, 250, 0.3)":"1px solid transparent"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:D?"#a78bfa":"white"},children:d}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx($,{size:14,style:{opacity:.7}}),e.jsxs("span",{style:{fontSize:"0.9rem",opacity:.9},children:[k,"ëª… ê°€ëŠ¥"]}),e.jsxs("span",{style:{fontSize:"0.75rem",opacity:.5},children:["(",b.join(", "),")"]})]})]}),(n.isAdmin||n.role==="Admin")&&e.jsxs("button",{onClick:()=>I(d),style:{padding:"6px 12px",borderRadius:"8px",border:"none",background:"linear-gradient(45deg, #f87171, #ef4444)",color:"white",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.8rem"},children:[e.jsx(Pe,{size:12,fill:"white"})," í™•ì •"]})]},d)})})]})]})]})},Vt=({user:n})=>{const[o,l]=a.useState([]),[m,u]=a.useState(!0);a.useEffect(()=>{if(!n?.campId)return;const p=q(O(C,"save_reports_v2"),H("campId","==",n.campId),pt("createdAt","desc"),Je(10)),s=X(p,w=>{const x=w.docs.map(h=>({id:h.id,...h.data()}));l(x),u(!1)});return()=>s()},[n?.campId]);const j=async p=>{confirm("ì´ ë¶„ì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await Fe(P(C,"save_reports_v2",p))},v=({label:p,value:s,color:w})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[e.jsx("span",{style:{width:"40px",fontWeight:"bold",fontSize:"0.8rem",color:"rgba(255,255,255,0.7)"},children:p}),e.jsx("div",{style:{flex:1,height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${s/20*100}%`,height:"100%",background:w,transition:"width 0.5s"}})}),e.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:s})]}),i=p=>{const s=p.target.files[0];s&&(u(!0),setTimeout(async()=>{const w={STR:Math.floor(Math.random()*10)+10,DEX:Math.floor(Math.random()*10)+10,CON:Math.floor(Math.random()*10)+10,INT:Math.floor(Math.random()*10)+10,WIS:Math.floor(Math.random()*10)+10,CHA:Math.floor(Math.random()*10)+10},x={filename:s.name,stats:w,meta:{mode:"Honour Mode (Detected)",version:"4.1.1.4",size:(s.size/1024/1024).toFixed(2)+" MB"},companions:[{name:"Shadowheart",img:"ðŸŒ™"},{name:"Astarion",img:"ðŸ§›"}],logs:["[Client] File loaded locally","[Parser] Header verified (LSOF v4)","[Analysis] Stats extracted successfully"],uploader:n.nickname,campId:n.campId,createdAt:ge()};try{await Be(O(C,"save_reports_v2"),x),alert("ë¶„ì„ ì™„ë£Œ!")}catch(h){console.error(h),alert("ì—…ë¡œë“œ ì‹¤íŒ¨")}finally{u(!1)}},1500))};return e.jsxs("div",{style:{padding:"0 0 80px"},children:[e.jsxs("div",{className:"glass-panel",style:{marginBottom:"20px",textAlign:"center",border:"1px solid var(--accent-color)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(It,{color:"#a78bfa"})," ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ê¸°"]}),e.jsx("p",{style:{opacity:.8,fontSize:"0.9rem",maxWidth:"600px",margin:"0 auto 20px"},children:"ì„¸ì´ë¸Œ íŒŒì¼(.lsv)ì„ ì—…ë¡œë“œí•˜ì—¬ ìºë¦­í„° ëŠ¥ë ¥ì¹˜ì™€ ì§„í–‰ ìƒí™©ì„ ë¶„ì„í•˜ì„¸ìš”."}),e.jsxs("div",{style:{position:"relative",overflow:"hidden",display:"inline-block"},children:[e.jsxs("button",{style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx($e,{size:18})," íŒŒì¼ ì„ íƒ ë° ë¶„ì„"]}),e.jsx("input",{type:"file",accept:".lsv,.save",onChange:i,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"}})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:m?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx(De,{size:32,className:"spin",style:{marginBottom:"15px",color:"var(--accent-color)"}}),e.jsx("p",{children:"ì„¸ì´ë¸Œ íŒŒì¼ ë¶„ì„ ì¤‘..."})]}):o.length===0?e.jsxs("div",{className:"glass-panel",style:{textAlign:"center",padding:"40px"},children:[e.jsx($e,{size:48,style:{opacity:.3,marginBottom:"20px"}}),e.jsx("p",{children:"ë¶„ì„ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})]}):o.map(p=>e.jsxs("div",{className:"glass-panel",style:{position:"relative",animation:"fadeIn 0.5s"},children:[e.jsx("button",{onClick:()=>j(p.id),style:{position:"absolute",top:"15px",right:"15px",background:"transparent",border:"none",color:"#f87171",cursor:"pointer"},children:e.jsx(gt,{size:16})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"10px"},children:[e.jsx($e,{size:20,color:"var(--accent-color)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem"},children:p.filename}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.5},children:[new Date(p.createdAt?.toDate?p.createdAt.toDate():p.createdAt).toLocaleString()," â€¢ ",p.uploader]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px"},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(ct,{size:14})," ëŠ¥ë ¥ì¹˜ (Stats)"]}),p.stats?e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"STR",value:p.stats.STR,color:"#fca5a5"}),e.jsx(v,{label:"DEX",value:p.stats.DEX,color:"#86efac"}),e.jsx(v,{label:"CON",value:p.stats.CON,color:"#fbbf24"}),e.jsx(v,{label:"INT",value:p.stats.INT,color:"#93c5fd"}),e.jsx(v,{label:"WIS",value:p.stats.WIS,color:"#d8b4fe"}),e.jsx(v,{label:"CHA",value:p.stats.CHA,color:"#f472b6"})]}):e.jsx("p",{style:{fontSize:"0.8rem",opacity:.5},children:"ë°ì´í„° ì—†ìŒ"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"12px",flex:1},children:[e.jsxs("h4",{style:{margin:"0 0 10px",display:"flex",alignItems:"center",gap:"5px",fontSize:"0.9rem"},children:[e.jsx(ne,{size:14})," ë©”íƒ€ ì •ë³´"]}),e.jsxs("div",{style:{fontSize:"0.8rem",display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("p",{style:{margin:0},children:["ðŸ“‚ ëª¨ë“œ: ",p.meta?.mode||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ðŸ’¾ ë²„ì „: ",p.meta?.version||"Unknown"]}),e.jsxs("p",{style:{margin:0},children:["ðŸ“¦ í¬ê¸°: ",p.meta?.size||"Unknown"]})]})]}),p.companions&&e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"12px"},children:[e.jsx("h4",{style:{margin:"0 0 5px",fontSize:"0.8rem",opacity:.8},children:"í•¨ê»˜í•˜ëŠ” ë™ë£Œ"}),e.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"},children:p.companions.map((s,w)=>e.jsxs("span",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem"},children:[s.img," ",s.name]},w))})]})]})]})]},p.id))})]})},Ke=[{id:"barbarian",name:"ë°”ë°”ë¦¬ì•ˆ",icon:ve,color:"#fca5a5"},{id:"bard",name:"ë°”ë“œ",icon:je,color:"#f9a8d4"},{id:"cleric",name:"í´ë ˆë¦­",icon:Rt,color:"#d1d5db"},{id:"druid",name:"ë“œë£¨ì´ë“œ",icon:zt,color:"#bef264"},{id:"fighter",name:"íŒŒì´í„°",icon:ne,color:"#93c5fd"},{id:"monk",name:"ëª½í¬",icon:Dt,color:"#7dd3fc"},{id:"paladin",name:"íŒ”ë¼ë”˜",icon:ne,color:"#fbbf24"},{id:"ranger",name:"ë ˆì¸ì €",icon:ke,color:"#86efac"},{id:"rogue",name:"ë¡œê·¸",icon:oe,color:"#cbd5e1"},{id:"sorcerer",name:"ì†Œì„œëŸ¬",icon:we,color:"#c084fc"},{id:"warlock",name:"ì›Œë½",icon:Se,color:"#e879f9"},{id:"wizard",name:"ìœ„ìžë“œ",icon:Et,color:"#818cf8"}],be=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#6366f1","#8b5cf6","#ec4899","#f43f5e"],V={width:"100%",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.2)",color:"white",marginBottom:"12px",fontSize:"1rem",transition:"border-color 0.2s, background 0.2s"},ae={width:"100%",padding:"16px",borderRadius:"12px",border:"none",fontWeight:"bold",fontSize:"1.05rem",marginTop:"0",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},Ye=({selected:n,onSelect:o})=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"10px",maxHeight:"200px",overflowY:"auto",margin:"20px 0",padding:"5px"},children:Ke.map(l=>e.jsxs("button",{onClick:()=>o(l),type:"button",style:{padding:"12px 8px",borderRadius:"12px",border:n?.id===l.id?`2px solid ${l.color}`:"1px solid rgba(255,255,255,0.05)",background:n?.id===l.id?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.2)",color:"white",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",transition:"all 0.2s",cursor:"pointer",transform:n?.id===l.id?"scale(1.05)":"scale(1)"},children:[e.jsx(l.icon,{size:24,color:l.color}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:n?.id===l.id?"bold":"normal"},children:l.name})]},l.id))}),He=({selected:n,onSelect:o})=>e.jsxs("div",{style:{margin:"15px 0"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"white",opacity:.8,display:"block",marginBottom:"8px"},children:"ëŒ€í‘œ ìƒ‰ìƒ"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:be.map(l=>e.jsx("div",{onClick:()=>o(l),style:{width:"28px",height:"28px",borderRadius:"50%",background:l,cursor:"pointer",border:n===l?"3px solid white":"1px solid transparent",boxShadow:n===l?"0 0 10px "+l:"none",transform:n===l?"scale(1.1)":"scale(1)",transition:"all 0.2s"}},l))})]}),qe=({children:n,title:o,sub:l,onClose:m,error:u})=>e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsxs("div",{className:"modal-content",onClick:j=>j.stopPropagation(),children:[e.jsx("button",{onClick:m,style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:"pointer",zIndex:10},children:e.jsx(Ve,{size:18})}),e.jsxs("div",{style:{padding:"30px 20px",textAlign:"center"},children:[o&&e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"8px",fontWeight:"800",background:"linear-gradient(to right, #fff, #aaa)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:o}),l&&e.jsx("p",{style:{opacity:.7,fontSize:"0.95rem",marginBottom:"30px"},children:l}),n,u&&e.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",padding:"12px",borderRadius:"10px",marginTop:"20px",fontSize:"0.9rem",border:"1px solid rgba(239, 68, 68, 0.3)"},children:["âš ï¸ ",u]})]})]})}),ot=({onComplete:n,initialData:o,user:l,isMobile:m})=>{const u=o||l,[j,v]=a.useState(u?"profile_view":"landing"),[i,p]=a.useState(u?.nickname||""),[s,w]=a.useState(""),[x,h]=a.useState(u?Ke.find(t=>t.name===u.className):null),[R,N]=a.useState(u?.color||be[Math.floor(Math.random()*be.length)]),[E,y]=a.useState(""),[c,I]=a.useState(""),[f,B]=a.useState([]),[g,d]=a.useState(null),[b,k]=a.useState(!1),[D,T]=a.useState("");a.useEffect(()=>{u&&v("profile_view")},[u]);const A=()=>{p(""),w(""),h(null),y(""),I(""),d(null),T(""),B([]),N(be[Math.floor(Math.random()*be.length)])},F=()=>{T(""),v("landing")};a.useEffect(()=>{j==="join_camp"&&Q()},[j]);const Q=async()=>{k(!0);try{console.log("[Profile] Fetching active camps...");const z=(await Me(O(C,"camps"))).docs.map(W=>({id:W.id,...W.data()}));B(z),console.log("[Profile] Camps found:",z.length)}catch(t){console.error("[Profile] Error fetching camps:",t),T("ì˜ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{k(!1)}},re=async t=>{t.preventDefault(),k(!0),T("");try{console.log("[Auth] Attempting login for:",i);const z=await Ie(P(C,"users_v2",i));if(!z.exists())throw new Error("ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ëª¨í—˜ê°€ìž…ë‹ˆë‹¤.");const W=z.data();if(W.password!==s)throw new Error("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");if(console.log("[Auth] Login successful:",W),W.campId)try{await xe(P(C,"camps",W.campId),{members:nt(i)})}catch(L){console.error("[Auth] Failed to update camp member list:",L)}localStorage.setItem("bg3_user_profile",JSON.stringify(W)),n(W)}catch(z){console.error("[Auth] Login failed:",z),T(z.message)}finally{k(!1)}},le=async()=>{if(!i||!s||!x||!E||!c){T("ëª¨ë“  ì •ë³´ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}k(!0);try{console.log("[Camp] Creating new camp:",E);const t=P(C,"users_v2",i);if((await Ie(t)).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ë‹‰ë„¤ìž„ìž…ë‹ˆë‹¤.");const W=E.trim(),L=P(C,"camps",W);if((await Ie(L)).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ì˜ì§€ ì´ë¦„ìž…ë‹ˆë‹¤.");const M={id:i,nickname:i,password:s,className:x.name,classId:x.id,color:R,isAdmin:!0,campId:W,createdAt:new Date().toISOString()},K={id:W,name:E,password:c,leaderId:i,members:[i],createdAt:new Date().toISOString()};await Re(t,M),await Re(L,K),console.log("[Camp] Camp and Admin created successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify(M)),n(M)}catch(t){console.error("[Camp] Creation failed:",t),T(t.message)}finally{k(!1)}},de=async()=>{if(!i||!s||!x||!g||!c){T("ëª¨ë“  ì •ë³´ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}k(!0);try{console.log("[Camp] Joining camp:",g);const t=P(C,"users_v2",i);if((await Ie(t)).exists())throw new Error("ì´ë¯¸ ì¡´ìž¬í•˜ëŠ” ë‹‰ë„¤ìž„ìž…ë‹ˆë‹¤. (ë¡œê·¸ì¸ í•˜ì„¸ìš”)");const W=P(C,"camps",g),L=await Ie(W);if(!L.exists())throw new Error("ì˜ì§€ê°€ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");const Y=L.data();if(Y.password!==c)throw new Error("ì˜ì§€ ìž…ìž¥ ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");if(Y.members&&Y.members.length>=4)throw new Error("ì˜ì§€ ì •ì›ì´ ê½‰ ì°¼ìŠµë‹ˆë‹¤. (ìµœëŒ€ 4ëª…)");const M={id:i,nickname:i,password:s,className:x.name,classId:x.id,color:R,isAdmin:!1,campId:g,createdAt:new Date().toISOString()};await Re(t,M),await xe(W,{members:nt(i)}),console.log("[Camp] Joined successfully"),localStorage.setItem("bg3_user_profile",JSON.stringify(M)),n(M)}catch(t){console.error("[Camp] Join failed:",t),T(t.message)}finally{k(!1)}},ue=()=>{confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(localStorage.removeItem("bg3_user_profile"),n(null),v("landing"),A())};if(j==="profile_view"&&u){const[t,z]=a.useState(!1),[W,L]=a.useState(u.nickname),[Y,M]=a.useState(Ke.find(J=>J.name===u.className)),[K,ce]=a.useState(u.color||be[0]),[me,_e]=a.useState(!1),Ue=async()=>{if(!W.trim())return alert("ë‹‰ë„¤ìž„ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.");_e(!0);try{const J=P(C,"users_v2",u.id),he={nickname:W,className:Y?.name||u.className,classId:Y?.id||u.classId,color:K};await xe(J,he);const pe={...u,...he};localStorage.setItem("bg3_user_profile",JSON.stringify(pe)),alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (ìƒˆë¡œê³ ì¹¨ ê¶Œìž¥)"),window.location.reload()}catch(J){console.error(J),alert("ìˆ˜ì • ì‹¤íŒ¨: "+J.message)}finally{_e(!1)}};return t?e.jsxs("div",{className:"glass-panel",style:{maxWidth:"500px",width:"100%",margin:m?"20px auto":"40px auto",padding:"30px",textAlign:"center",position:"relative"},children:[e.jsx("h3",{style:{fontSize:"1.5rem",marginBottom:"25px",color:"white"},children:"í”„ë¡œí•„ ìˆ˜ì •"}),e.jsxs("div",{style:{textAlign:"left",display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.9rem",opacity:.7,marginLeft:"5px",marginBottom:"5px",display:"block"},children:"ë‹‰ë„¤ìž„"}),e.jsx("input",{value:W,onChange:J=>L(J.target.value),style:V})]}),e.jsx(He,{selected:K,onSelect:ce}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.9rem",opacity:.7,marginLeft:"5px",marginBottom:"5px",display:"block"},children:"ì§ì—…"}),e.jsx(Ye,{selected:Y,onSelect:M})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"30px"},children:[e.jsx("button",{onClick:()=>z(!1),style:{flex:1,padding:"15px",borderRadius:"12px",background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer"},children:"å–æ¶ˆ"}),e.jsx("button",{onClick:Ue,style:{flex:2,padding:"15px",borderRadius:"12px",background:"var(--accent-color)",border:"none",color:"white",fontWeight:"bold",cursor:"pointer"},disabled:me,children:me?"ì €ìž¥ ì¤‘...":"ì €ìž¥í•˜ê¸°"})]})]}):e.jsxs("div",{className:"glass-panel",style:{maxWidth:"450px",width:"100%",margin:m?"20px auto 80px":"40px auto",padding:"40px",textAlign:"center"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"30px"},children:[e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",background:u.color||x?.color||"gray",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 30px ${u.color||x?.color||"gray"}`},children:x&&e.jsx(x.icon,{size:50,color:"white"})}),e.jsx("h3",{style:{fontSize:"1.8rem",margin:"0 0 8px",fontWeight:"bold"},children:u.nickname}),e.jsx("span",{style:{fontSize:"0.95rem",opacity:.8,background:"rgba(255,255,255,0.1)",padding:"6px 12px",borderRadius:"20px"},children:u.className})]}),e.jsxs("div",{style:{textAlign:"left",background:"rgba(0,0,0,0.2)",padding:"25px",borderRadius:"16px"},children:[e.jsxs("p",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"15px",marginBottom:"15px"},children:[e.jsx("span",{style:{opacity:.6},children:"ì†Œì† ì•¼ì˜ì§€"}),e.jsx("b",{style:{fontSize:"1.1rem"},children:u.campId})]}),e.jsxs("p",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{opacity:.6},children:"ì§ì±…"}),e.jsx("b",{style:{color:u.isAdmin?"#f87171":"#4ade80"},children:u.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),e.jsxs("button",{onClick:()=>z(!0),style:{...ae,background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white",marginTop:"30px"},children:[e.jsx(De,{size:18})," ì •ë³´ ìˆ˜ì •"]}),e.jsxs("button",{onClick:ue,style:{...ae,background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",marginTop:"10px"},children:[e.jsx(lt,{size:18}),"ë¡œê·¸ì•„ì›ƒ"]})]})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsx("div",{className:"glass-panel",style:{maxWidth:"1000px",width:"100%",padding:m?"30px 20px":"60px 60px",textAlign:"center",minHeight:m?"auto":"550px",display:"flex",alignItems:"center",justifyContent:"center",margin:0},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:m?"20px":"60px",width:"100%"},children:[e.jsx("div",{style:{flex:"1 1 300px",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:e.jsxs("div",{className:"logo-wrapper",style:{position:"relative",maxWidth:m?"240px":"420px",width:"100%"},children:[e.jsx("img",{src:te,alt:"Logo",onClick:()=>window.location.reload(),title:"ìƒˆë¡œê³ ì¹¨",style:{width:"100%",cursor:"pointer",transition:"transform 0.3s ease",display:"block"},onMouseOver:t=>t.currentTarget.style.transform="scale(1.03)",onMouseOut:t=>t.currentTarget.style.transform="scale(1)"}),e.jsx("div",{className:"logo-shine",style:{WebkitMaskImage:`url(${te})`,maskImage:`url(${te})`}})]})}),e.jsxs("div",{style:{flex:"1 1 300px",display:"flex",flexDirection:"column",gap:"20px",maxWidth:"350px",width:"100%"},children:[e.jsxs("button",{onClick:()=>{A(),v("login")},style:{...ae,background:"rgba(255,255,255,0.08)",color:"white",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(Tt,{size:20}),"ê¸°ì¡´ ëª¨í—˜ê°€ ë¡œê·¸ì¸"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",opacity:.3,fontSize:"0.8rem"},children:[e.jsx("div",{style:{flex:1,height:"1px",background:"white"}}),e.jsx("span",{children:"OR"}),e.jsx("div",{style:{flex:1,height:"1px",background:"white"}})]}),e.jsxs("button",{onClick:()=>{A(),v("join_camp")},style:{...ae,background:"linear-gradient(45deg, #7c3aed, #db2777)",color:"white",boxShadow:"0 4px 15px rgba(124, 58, 237, 0.3)"},children:[e.jsx($,{size:20}),"ì•¼ì˜ì§€ í•©ë¥˜í•˜ê¸° (ì¼ë°˜)"]}),e.jsxs("button",{onClick:()=>{A(),v("create_camp")},style:{...ae,background:"linear-gradient(45deg, #ef4444, #f97316)",color:"white",boxShadow:"0 4px 15px rgba(239, 68, 68, 0.3)"},children:[e.jsx(Pe,{size:20}),"ìƒˆ ì•¼ì˜ì§€ ê±´ì„¤ (ê´€ë¦¬ìž)"]}),e.jsxs("p",{style:{marginTop:"10px",opacity:.8,fontSize:m?"0.75rem":"0.9rem",lineHeight:"1.5",fontWeight:"400",textAlign:"center",color:"rgba(255,255,255,0.7)"},children:["ë™ë£Œë“¤ê³¼ í•¨ê»˜ ë‚˜ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.",e.jsx("br",{}),e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:"ë°œë”ìŠ¤ ê²Œì´íŠ¸ 3 ì›ì •ëŒ€"}),"ë¥¼ ìœ„í•œ",e.jsx("br",{}),"í•„ìˆ˜ ì»´íŒ¨ë‹ˆì–¸ ì•±"]})]})]})})}),j==="login"&&e.jsx(qe,{title:"ë¡œê·¸ì¸",sub:"ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”, ëª¨í—˜ê°€ë‹˜.",onClose:F,error:D,children:e.jsxs("form",{onSubmit:re,children:[e.jsx("input",{type:"text",placeholder:"ë‹‰ë„¤ìž„",value:i,onChange:t=>p(t.target.value),style:V}),e.jsx("input",{type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸",value:s,onChange:t=>w(t.target.value),style:V}),e.jsx("button",{type:"submit",style:{...ae,background:"white",color:"black",marginTop:"20px"},disabled:b,children:b?"ì¸ì¦ í™•ì¸ ì¤‘...":"ì•¼ì˜ì§€ ìž…ìž¥"})]})}),j==="create_camp"&&e.jsxs(qe,{title:"ì•¼ì˜ì§€ ê±´ì„¤",sub:"ë‹¹ì‹ ë§Œì˜ íŒŒí‹°ë¥¼ ì´ëŒì–´ë³´ì„¸ìš”.",onClose:F,error:D,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#fca5a5",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ê´€ë¦¬ìž(ì˜ì£¼) ì •ë³´"}),e.jsx("input",{type:"text",placeholder:"ì˜ì£¼ ë‹‰ë„¤ìž„",value:i,onChange:t=>p(t.target.value),style:V}),e.jsx("input",{type:"password",placeholder:"ê°œì¸ ë¹„ë°€ë²ˆí˜¸",value:s,onChange:t=>w(t.target.value),style:{...V,marginBottom:0}})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"10px",marginBottom:"15px"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#c4b5fd",fontWeight:"bold",display:"block",marginBottom:"8px"},children:"ì˜ì§€(Room) ì„¤ì •"}),e.jsx("input",{type:"text",placeholder:"ì•¼ì˜ì§€ ì´ë¦„ (IDë¡œ ì‚¬ìš©ë¨)",value:E,onChange:t=>y(t.target.value),style:V}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ìž…ìž¥ ì•”í˜¸ (íŒ€ì› ê³µìœ ìš©)",value:c,onChange:t=>I(t.target.value),style:{...V,borderColor:"#818cf8",color:"#818cf8",marginBottom:0}})]}),e.jsx(He,{selected:R,onSelect:N}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"5px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(Ye,{selected:x,onSelect:h})]}),e.jsx("button",{onClick:le,style:{...ae,background:"#ef4444",color:"white"},disabled:b,children:b?"ì˜í†  ì„ í¬ ì¤‘...":"ê±´ì„¤ ì™„ë£Œ ë° ìž…ìž¥"})]}),j==="join_camp"&&e.jsxs(qe,{title:"ì•¼ì˜ì§€ í•©ë¥˜",sub:"ë™ë£Œë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤.",onClose:F,error:D,children:[e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px"},children:[!g&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("span",{style:{opacity:.7,fontSize:"0.9rem"},children:"ì°¸ì—¬ ê°€ëŠ¥í•œ ì˜ì§€"}),e.jsxs("button",{onClick:Q,style:{background:"none",border:"none",color:"var(--accent-color)",cursor:"pointer",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(De,{size:12})," ëª©ë¡ ê°±ì‹ "]})]}),e.jsx("div",{style:{maxHeight:"250px",overflowY:"auto",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"10px",background:"rgba(0,0,0,0.2)"},children:b&&f.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"íƒìƒ‰ ì¤‘..."}):f.length===0?e.jsx("p",{style:{textAlign:"center",opacity:.5,padding:"20px"},children:"í™œì„±í™”ëœ ì˜ì§€ê°€ ì—†ìŠµë‹ˆë‹¤."}):f.map(t=>e.jsxs("div",{onClick:()=>d(t.id),style:{padding:"16px",marginBottom:"8px",borderRadius:"10px",cursor:"pointer",background:"rgba(255,255,255,0.05)",border:"1px solid transparent",transition:"all 0.2s",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseOver:z=>{z.currentTarget.style.background="rgba(255,255,255,0.1)",z.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseOut:z=>{z.currentTarget.style.background="rgba(255,255,255,0.05)",z.currentTarget.style.borderColor="transparent"},children:[e.jsxs("span",{style:{fontWeight:"bold"},children:["ðŸ° ",t.name]}),e.jsxs("span",{style:{fontSize:"0.8rem",opacity:.7,background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"4px"},children:[t.members?.length||0,"/4ëª…"]})]},t.id))})]}),g&&e.jsxs("div",{style:{animation:"fadeIn 0.3s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("button",{onClick:()=>d(null),style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"â†"}),e.jsx("h3",{style:{margin:0,fontSize:"1.2rem"},children:f.find(t=>t.id===g)?.name})]}),e.jsx("input",{type:"text",placeholder:"ì˜ì§€ ìž…ìž¥ ì•”í˜¸",value:c,onChange:t=>I(t.target.value),style:{...V,borderColor:"#818cf8",color:"#818cf8"}}),e.jsx("div",{style:{height:"10px"}}),e.jsx("input",{type:"text",placeholder:"ë‚´ ë‹‰ë„¤ìž„",value:i,onChange:t=>p(t.target.value),style:V}),e.jsx("input",{type:"password",placeholder:"ë‚´ ë¹„ë°€ë²ˆí˜¸",value:s,onChange:t=>w(t.target.value),style:V}),e.jsx(He,{selected:R,onSelect:N}),e.jsx("label",{style:{fontSize:"0.9rem",color:"white",opacity:.8,marginTop:"15px",display:"block"},children:"ë‚˜ì˜ ì§ì—… ì„ íƒ"}),e.jsx(Ye,{selected:x,onSelect:h})]})]}),g&&e.jsx("button",{onClick:de,style:{...ae,background:"var(--accent-color)",color:"white"},disabled:b,children:b?"ìž…ìž¥ ì¤‘...":"í•©ë¥˜í•˜ê¸°"})]})]})},Gt=({user:n})=>{const[o,l]=a.useState([]),[m,u]=a.useState(!0);a.useEffect(()=>{if(!n?.campId)return;const i=q(O(C,"users_v2"),H("campId","==",n.campId)),p=X(i,s=>{const w=s.docs.map(x=>({id:x.id,...x.data()}));l(w),u(!1)});return()=>p()},[n?.campId]);const j=async i=>{if(window.confirm(`ì •ë§ '${i.nickname}' ë‹˜ì„ ì˜ì§€ì—ì„œ ì¶”ë°©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await Fe(P(C,"users_v2",i.id));const p=P(C,"camps",n.campId);await xe(p,{members:Nt(i.nickname)}),alert("ì¶”ë°©ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(p){console.error("Kick failed:",p),alert("ì¶”ë°© ì‹¤íŒ¨: "+p.message)}},v=async()=>{if(!window.confirm(`âš ï¸ ê²½ê³ : ì˜ì§€ë¥¼ í­íŒŒí•˜ë©´ ëª¨ë“  ë°ì´í„°ì™€ ë©¤ë²„ê°€ ì‚­ì œë©ë‹ˆë‹¤.
ì •ë§ ì´ ì•¼ì˜ì§€ë¥¼ í•´ì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;if(prompt("ì˜ì§€ë¥¼ ì‚­ì œí•˜ë ¤ë©´ 'ì˜ì§€ í­íŒŒ'ë¼ê³  ìž…ë ¥í•˜ì„¸ìš”.")!=="ì˜ì§€ í­íŒŒ")return alert("ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");try{u(!0);const s=Bt(C),w=P(C,"camps",n.campId);s.delete(w),o.forEach(R=>{const N=P(C,"users_v2",R.id);s.delete(N)});const x=q(O(C,"chats"),H("campId","==",n.campId));(await Me(x)).forEach(R=>{s.delete(R.ref)}),await s.commit(),alert("ì•¼ì˜ì§€ê°€ ì—­ì‚¬ ì†ìœ¼ë¡œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤."),window.location.reload()}catch(s){console.error("Destroy failed:",s),alert("ì‚­ì œ ì‹¤íŒ¨: "+s.message)}finally{u(!1)}};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[e.jsxs("div",{className:"glass-panel",style:{padding:"30px",marginBottom:"30px",border:"1px solid var(--accent-color)",background:"rgba(50, 0, 0, 0.3)"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 10px",color:"#fca5a5"},children:[e.jsx(ne,{})," ì˜ì£¼ ê´€ë¦¬ì‹¤ (Admin)"]}),e.jsxs("p",{style:{opacity:.8,fontSize:"0.9rem"},children:["í˜„ìž¬ ì•¼ì˜ì§€: ",e.jsx("b",{children:n.campId})," ",e.jsx("br",{}),"ê¶Œí•œ: ",e.jsx("span",{style:{color:"var(--accent-color)"},children:"Master"})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs("h3",{style:{margin:0,fontSize:"1.1rem"},children:["ëŒ€ì› ëª©ë¡ (",o.length,"/4)"]})}),o.map(i=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"50%",background:i.isAdmin?"var(--accent-color)":"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.isAdmin?e.jsx(Pe,{size:22,color:"white"}):e.jsx(se,{size:22})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:[i.nickname,e.jsx("span",{style:{fontSize:"0.7rem",padding:"3px 8px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",opacity:.8},children:i.className||"ëª¨í—˜ê°€"})]}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.5,marginTop:"4px"},children:i.isAdmin?"ì˜ì£¼ (Leader)":"ëŒ€ì› (Member)"})]})]}),!i.isAdmin&&e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:async()=>{if(window.confirm(`'${i.nickname}' ë‹˜ì„ ê´€ë¦¬ìžë¡œ ìž„ëª…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{const{updateDoc:p,doc:s}=await Oe(async()=>{const{updateDoc:w,doc:x}=await import("./vendor-D1cCnfCH.js").then(h=>h.am);return{updateDoc:w,doc:x}},[]);await p(s(C,"users_v2",i.id),{isAdmin:!0,role:"Admin"}),alert(`${i.nickname} ë‹˜ì´ ê´€ë¦¬ìžê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(p){console.error(p),alert("ê¶Œí•œ ë¶€ì—¬ ì‹¤íŒ¨: "+p.message)}},style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(74, 222, 128, 0.1)",border:"1px solid rgba(74, 222, 128, 0.3)",color:"#4ade80",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Pe,{size:16})," ìž„ëª…"]}),e.jsxs("button",{onClick:()=>j(i),style:{padding:"10px 15px",borderRadius:"8px",background:"rgba(248, 113, 113, 0.1)",border:"1px solid rgba(248, 113, 113, 0.3)",color:"#f87171",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(At,{size:16})," ì¶”ë°©"]})]})]},i.id)),o.length===0&&!m&&e.jsx("div",{style:{padding:"40px",textAlign:"center",opacity:.5},children:"ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤."})]}),e.jsxs("div",{style:{marginTop:"50px",borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"30px"},children:[e.jsxs("h3",{style:{color:"#ef4444",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(Wt,{})," ìœ„í—˜ êµ¬ì—­"]}),e.jsxs("div",{className:"glass-panel",style:{borderColor:"#ef4444",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 5px"},children:"ì˜ì§€ í­íŒŒ"}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:"ì´ ì•¼ì˜ì§€ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤."})]}),e.jsx("button",{onClick:v,style:{background:"#ef4444",color:"white",border:"none",padding:"12px 20px",borderRadius:"8px",fontWeight:"bold",cursor:"pointer"},children:"í­íŒŒ ì‹¤í–‰"})]})]})]})},ut=({user:n,tacticId:o,initialData:l,onBack:m,isMobile:u,isStandalone:j,isModal:v})=>{const[i,p]=a.useState(l?.elements||[]),[s,w]=a.useState(l?.viewState||{x:0,y:0,scale:1}),[x,h]=a.useState(null),[R,N]=a.useState("select"),[E,y]=a.useState(null),[c,I]=a.useState(""),[f,B]=a.useState(!1),[g,d]=a.useState(!1),[b,k]=a.useState({x:0,y:0}),[D,T]=a.useState({x:0,y:0}),[A,F]=a.useState("saved"),Q=a.useRef(null),re=a.useRef(null),le=a.useRef(!1),de=a.useRef(g),ue=a.useRef(f),t=a.useRef(E);a.useEffect(()=>{de.current=g},[g]),a.useEffect(()=>{ue.current=f},[f]),a.useEffect(()=>{t.current=E},[E]),a.useEffect(()=>{if(!o)return;const r=X(P(C,"tactics",o),S=>{if(S.exists()){const _=S.data();!de.current&&!ue.current&&!t.current&&(le.current=!0,p(_.elements||[]))}});return()=>r()},[o]);const z=a.useCallback(r=>{F("saving"),re.current&&clearTimeout(re.current),re.current=setTimeout(async()=>{if(!(!o||!n?.nickname))try{const S=P(C,"tactics",o);await xe(S,{elements:r,lastModified:ge(),lastModifiedBy:n.nickname}),F("saved")}catch(S){console.error("Save failed",S),F("error")}},1e3)},[o,n.nickname]);a.useEffect(()=>{if(le.current){le.current=!1;return}z(i)},[i,z]);const W=r=>{R==="select"&&r.target===Q.current&&(r.target.setPointerCapture(r.pointerId),B(!0),k({x:r.clientX,y:r.clientY}),h(null),y(null))},L=(r,S)=>{if(r.stopPropagation(),R!=="select")return;r.currentTarget.setPointerCapture(r.pointerId),h(S.id),d(!0);const _=Q.current.getBoundingClientRect(),U=r.clientX-_.left,Z=r.clientY-_.top,ee=(U-s.x)/s.scale,ie=(Z-s.y)/s.scale;T({x:ee-S.x,y:ie-S.y}),k({x:r.clientX,y:r.clientY})},Y=r=>r?r.includes("ë°”ë°”ë¦¬ì•ˆ")?Ee:r.includes("ë°”ë“œ")?je:r.includes("í´ë ˆë¦­")?Te:r.includes("ë“œë£¨ì´ë“œ")?Ae:r.includes("íŒŒì´í„°")?ve:r.includes("ëª½í¬")?we:r.includes("íŒ”ë¼ë”˜")?ne:r.includes("ë ˆì¸ì €")?ke:r.includes("ë¡œê·¸")?We:r.includes("ì†Œì„œëŸ¬")?Ne:r.includes("ì›Œë½")?oe:r.includes("ìœ„ìžë“œ")?Se:se:se,M=r=>{if(r.type==="text")y(r.id),I(r.content);else if(r.type==="video"){const S=r.content.startsWith("http")?r.content:"",_=prompt("ìœ íŠœë¸Œ ì˜ìƒ URLì„ ìž…ë ¥í•˜ì„¸ìš”:",S);_&&he(r.id,{content:_})}else if(r.type==="member"){const _=prompt(`ì§ì—…ì„ ìž…ë ¥í•˜ì„¸ìš”:
(${["ë°”ë°”ë¦¬ì•ˆ","ë°”ë“œ","í´ë ˆë¦­","ë“œë£¨ì´ë“œ","íŒŒì´í„°","ëª½í¬","íŒ”ë¼ë”˜","ë ˆì¸ì €","ë¡œê·¸","ì†Œì„œëŸ¬","ì›Œë½","ìœ„ìžë“œ"].join(", ")})`,r.content==="íŒŒí‹°ì›"?"":r.content);_&&he(r.id,{content:_})}},K=(r,S)=>{r.stopPropagation(),M(S)},ce=()=>{const r=i.find(S=>S.id===x);r&&M(r)},me=r=>{if(f){const S=r.clientX-b.x,_=r.clientY-b.y;w(U=>({...U,x:U.x+S,y:U.y+_})),k({x:r.clientX,y:r.clientY})}if(g&&x){const S=Q.current.getBoundingClientRect(),_=r.clientX-S.left,U=r.clientY-S.top,Z=(_-s.x)/s.scale,ee=(U-s.y)/s.scale;p(ie=>ie.map(Ce=>Ce.id===x?{...Ce,x:Z-D.x,y:ee-D.y}:Ce)),k({x:r.clientX,y:r.clientY})}},_e=r=>{B(!1),d(!1)},Ue=()=>{x&&(p(r=>r.filter(S=>S.id!==x)),h(null),y(null))},J=r=>{if(r.ctrlKey||r.metaKey){r.preventDefault();const _=-r.deltaY*.001,U=Math.min(Math.max(s.scale+_,.1),5);w(Z=>({...Z,scale:U}))}else w(S=>({...S,x:S.x-r.deltaX,y:S.y-r.deltaY}))},he=(r,S)=>{p(_=>_.map(U=>U.id===r?{...U,...S}:U))},pe=r=>{const S=Date.now().toString(),_=(-s.x+window.innerWidth/2)/s.scale,U=(-s.y+window.innerHeight/2)/s.scale;let Z="",ee=100,ie=100;r==="text"&&(Z="ë”ë¸”í´ë¦­ íŽ¸ì§‘",ee=200),r==="video"&&(ee=300,ie=200),r==="member"&&(Z="íŒŒí‹°ì›",ee=60,ie=80);const Ce={id:S,type:r,x:_-ee/2,y:U-ie/2,content:Z,width:ee,height:ie,color:"#ffffff"};p(mt=>[...mt,Ce]),N("select")},Ge=()=>{E&&(he(E,{content:c}),y(null))},Qe=r=>{if(!r)return null;const S=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,_=r.match(S);return _&&_[2]?.length===11?_[2]:null};return e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden",background:"#111116",position:"relative"},children:[e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,zIndex:100,padding:"15px 25px",background:"linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%)",display:"flex",alignItems:"center",justifyContent:"space-between",pointerEvents:"none"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",pointerEvents:"auto"},children:[!j&&e.jsx("button",{onClick:m,style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white",cursor:"pointer",padding:"10px",borderRadius:"50%",backdropFilter:"blur(5px)"},children:v?e.jsx(Ve,{size:20}):e.jsx(xt,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.1rem",fontWeight:"bold",color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:l.title||"ì „ìˆ  íŽ¸ì§‘"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:A==="saved"?"#4ade80":A==="saving"?"#facc15":"#ef4444",boxShadow:A==="saving"?"0 0 10px #facc15":"none"}}),e.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:A==="saved"?"ì €ìž¥ë¨":A==="saving"?"ì €ìž¥ ì¤‘...":"ì €ìž¥ ì‹¤íŒ¨"})]})]})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8,display:"flex",gap:"10px",alignItems:"center",pointerEvents:"auto"},children:[e.jsxs("button",{onClick:()=>window.open(`?tacticId=${o}`,"_blank"),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"8px",padding:"8px 14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",backdropFilter:"blur(5px)"},title:"ìƒˆ íƒ­ì—ì„œ ê½‰ ì°¬ í™”ë©´ìœ¼ë¡œ ì—´ê¸°",children:[e.jsx(_t,{size:14})," ",u?"":"ìƒˆ ì°½"]}),x&&e.jsxs(e.Fragment,{children:[(i.find(r=>r.id===x)?.type==="text"||i.find(r=>r.id===x)?.type==="video")&&e.jsxs("button",{onClick:ce,style:{background:"#3b82f6",border:"none",color:"white",borderRadius:"8px",padding:"8px 14px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px",boxShadow:"0 4px 10px rgba(59, 130, 246, 0.3)"},children:[e.jsx(Lt,{size:14})," íŽ¸ì§‘"]}),e.jsx("button",{onClick:Ue,style:{background:"#ef4444",border:"none",color:"white",borderRadius:"8px",padding:"8px 14px",cursor:"pointer",boxShadow:"0 4px 10px rgba(239, 68, 68, 0.3)"},children:"ì‚­ì œ"})]})]})]}),e.jsx("div",{ref:Q,style:{flex:1,cursor:f?"grabbing":"grab",touchAction:"none"},onPointerDown:W,onPointerMove:me,onPointerUp:_e,onWheel:J,children:e.jsxs("div",{style:{transform:`translate(${s.x}px, ${s.y}px) scale(${s.scale})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:-5e3,left:-5e3,width:1e4,height:1e4,backgroundImage:"radial-gradient(rgba(255,255,255,0.08) 1px, transparent 1px)",backgroundSize:"40px 40px",pointerEvents:"none"}}),i.map(r=>e.jsxs("div",{onPointerDown:S=>L(S,r),onDoubleClick:S=>K(S,r),style:{position:"absolute",left:r.x,top:r.y,width:r.width||"auto",height:r.height||"auto",padding:"10px",border:x===r.id?"2px solid var(--accent-color)":"1px solid transparent",borderRadius:"12px",userSelect:"none",cursor:"move",transform:x===r.id?"scale(1.02)":"scale(1)",transition:g&&x===r.id?"none":"transform 0.1s",background:r.type==="text"?"transparent":"rgba(30, 30, 40, 0.6)",backdropFilter:r.type!=="text"?"blur(8px)":"none",boxShadow:r.type!=="text"?"0 4px 20px rgba(0,0,0,0.3)":"none"},children:[r.type==="text"&&(E===r.id?e.jsx("input",{autoFocus:!0,value:c,onChange:S=>I(S.target.value),onBlur:Ge,onKeyDown:S=>S.key==="Enter"&&Ge(),onPointerDown:S=>S.stopPropagation(),style:{background:"rgba(0,0,0,0.5)",border:"1px solid var(--accent-color)",color:"white",fontSize:"1.2rem",padding:"8px",width:"200px",borderRadius:"8px",outline:"none"}}):e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.8)",padding:"5px"},children:r.content})),(r.type==="npc"||r.type==="mob")&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:r.type==="npc"?"linear-gradient(135deg, #4ade80, #22c55e)":"linear-gradient(135deg, #ef4444, #dc2626)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 10px rgba(0,0,0,0.4)",border:"2px solid rgba(255,255,255,0.2)"},children:r.type==="npc"?e.jsx(se,{size:28,color:"white"}):e.jsx(oe,{size:28,color:"white"})}),e.jsx("span",{style:{fontSize:"0.75rem",marginTop:"6px",background:"rgba(0,0,0,0.8)",color:"white",padding:"2px 8px",borderRadius:"10px",fontWeight:"bold"},children:r.type==="npc"?"ì „ìš°":"ì êµ°"})]}),r.type==="member"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #2563eb)",border:"2px solid rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 15px rgba(59, 130, 246, 0.4)"},children:(()=>{const S=Y(r.content);return e.jsx(S,{size:26,color:"white"})})()}),e.jsx("span",{style:{fontSize:"0.75rem",marginTop:"6px",background:"rgba(0,0,0,0.8)",color:"white",padding:"2px 8px",borderRadius:"10px",fontWeight:"bold"},children:r.content})]}),r.type==="video"&&e.jsxs("div",{style:{width:"300px",height:"180px",background:"black",borderRadius:"8px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(255,255,255,0.2)"},children:[Qe(r.content)?e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${Qe(r.content)}`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{pointerEvents:R==="select"?"none":"auto"}}):e.jsxs("div",{style:{color:"rgba(255,255,255,0.5)",textAlign:"center",padding:"20px"},children:[e.jsx(rt,{size:40,style:{marginBottom:"10px"}}),e.jsxs("p",{style:{fontSize:"0.9rem"},children:["ë”ë¸” í´ë¦­í•˜ì—¬",e.jsx("br",{}),"ìœ íŠœë¸Œ ë§í¬ ìž…ë ¥"]})]}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:"20px",background:"rgba(255,255,255,0.1)",cursor:"move"}})]})]},r.id))]})}),e.jsxs("div",{style:{position:"absolute",bottom:"30px",left:"50%",transform:"translateX(-50%)",background:"rgba(20,20,30,0.7)",backdropFilter:"blur(20px) saturate(180%)",padding:"8px 12px",borderRadius:"24px",display:"flex",gap:"8px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 20px 40px rgba(0,0,0,0.4)",zIndex:101,overflowX:"auto",maxWidth:"90vw"},children:[e.jsx(fe,{icon:Mt,active:R==="select",onClick:()=>N("select"),label:"ì„ íƒ"}),e.jsx("div",{style:{width:"1px",background:"rgba(255,255,255,0.1)",margin:"0 5px"}}),e.jsx(fe,{icon:Pt,active:R==="text",onClick:()=>pe("text"),label:"í…ìŠ¤íŠ¸"}),e.jsx(fe,{icon:$,active:R==="member",onClick:()=>pe("member"),label:"íŒŒí‹°ì›"}),e.jsx(fe,{icon:se,active:R==="npc",onClick:()=>pe("npc"),label:"NPC"}),e.jsx(fe,{icon:oe,active:R==="mob",onClick:()=>pe("mob"),label:"ì "}),e.jsx(fe,{icon:rt,active:R==="video",onClick:()=>pe("video"),label:"ì˜ìƒ"})]})]})},fe=({icon:n,active:o,onClick:l,label:m})=>e.jsx("button",{onClick:l,style:{background:o?"var(--accent-color)":"transparent",border:"none",color:o?"white":"rgba(255,255,255,0.6)",padding:"10px",borderRadius:"50%",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",minWidth:"50px",transition:"all 0.2s"},title:m,children:e.jsx(n,{size:24})}),Qt=({user:n,initialTacticId:o,clearInitialTactic:l})=>{const[m,u]=a.useState([]),[j,v]=a.useState(!0),[i,p]=a.useState(!1),[s,w]=a.useState(null),[x,h]=a.useState(""),[R,N]=a.useState("");a.useEffect(()=>{if(!n?.campId){v(!1);return}const c=q(O(C,"tactics"),H("campId","==",n.campId)),I=X(c,f=>{const B=f.docs.map(g=>({id:g.id,...g.data()}));B.sort((g,d)=>{const b=g.createdAt?.seconds||0;return(d.createdAt?.seconds||0)-b}),u(B),v(!1)},f=>{console.error("Error fetching tactics:",f),v(!1)});return()=>I()},[n?.campId]),a.useEffect(()=>{if(o&&m.length>0){const c=m.find(I=>I.id===o);c&&(w(c),l&&l())}},[o,m,l]);const E=async c=>{if(c.preventDefault(),!!x.trim()){if(!n.campId){alert("ì†Œì†ëœ ì˜ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");return}try{const I={campId:n.campId,authorId:n.id||n.nickname,authorName:n.nickname,title:x,description:R,createdAt:ge(),elements:[]},f=await Be(O(C,"tactics"),I);p(!1),h(""),N(""),w({id:f.id,...I})}catch(I){console.error("Error creating tactic:",I),alert("ì „ìˆ íŒ ìƒì„± ì‹¤íŒ¨: "+I.message)}}},y=async(c,I)=>{if(c.stopPropagation(),!!confirm("ì •ë§ë¡œ ì´ ì „ìˆ íŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await Fe(P(C,"tactics",I))}catch(f){console.error("Delete failed",f)}};return e.jsxs("div",{style:{paddingBottom:"80px",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px",padding:"0 10px"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"2rem",fontWeight:"bold",margin:0,display:"flex",alignItems:"center",gap:"12px",background:"linear-gradient(to right, #fff, #aaa)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:[e.jsx(Le,{className:"text-accent",style:{stroke:"var(--accent-color)"}}),"ì „ìˆ  ìž‘ì „ì‹¤"]}),e.jsx("p",{style:{opacity:.6,fontSize:"0.95rem",marginTop:"5px"},children:"íŒ€ì›ë“¤ê³¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì „ìˆ ì„ ê³µìœ í•˜ì„¸ìš”."})]}),e.jsxs("button",{onClick:()=>p(!0),className:"glass-button",style:{background:"var(--accent-color)",color:"white",border:"none",padding:"12px 24px",borderRadius:"16px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 20px rgba(245, 158, 11, 0.3)",transition:"all 0.2s",fontSize:"1rem"},onMouseEnter:c=>c.currentTarget.style.transform="translateY(-2px)",onMouseLeave:c=>c.currentTarget.style.transform="translateY(0)",children:[e.jsx(Ot,{size:20}),"ìƒˆ ìž‘ì „"]})]}),j?e.jsxs("div",{style:{textAlign:"center",padding:"60px",opacity:.5},children:[e.jsx(De,{className:"spin",size:30,style:{marginBottom:"10px"}}),e.jsx("p",{children:"ì „ìˆ  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]}):m.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"80px 20px",background:"rgba(255,255,255,0.02)",borderRadius:"24px",border:"1px dashed rgba(255,255,255,0.1)"},children:[e.jsx(Le,{size:60,style:{opacity:.2,marginBottom:"20px"}}),e.jsx("p",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"10px"},children:"ì•„ì§ ìˆ˜ë¦½ëœ ìž‘ì „ì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("button",{onClick:()=>p(!0),style:{color:"var(--accent-color)",background:"transparent",border:"none",cursor:"pointer",fontSize:"1rem",textDecoration:"underline"},children:"ìƒˆ ìž‘ì „ ìˆ˜ë¦½í•˜ê¸°"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"25px",padding:"10px"},children:m.map(c=>e.jsx("div",{onClick:()=>w(c),className:"glass",style:{cursor:"pointer",overflow:"hidden",display:"flex",flexDirection:"column",height:"200px",transition:"all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)",position:"relative",borderRadius:"20px",border:"1px solid rgba(255,255,255,0.08)",background:"linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.2) 100%)"},onMouseEnter:I=>{I.currentTarget.style.transform="translateY(-8px)",I.currentTarget.style.boxShadow="0 15px 30px rgba(0,0,0,0.3)",I.currentTarget.style.borderColor="rgba(255,255,255,0.2)"},onMouseLeave:I=>{I.currentTarget.style.transform="translateY(0)",I.currentTarget.style.boxShadow="0 8px 32px 0 rgba(0, 0, 0, 0.3)",I.currentTarget.style.borderColor="rgba(255,255,255,0.08)"},children:e.jsxs("div",{style:{padding:"25px",flex:1,display:"flex",flexDirection:"column",background:"radial-gradient(circle at top right, rgba(212, 160, 23, 0.05), transparent 70%)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"10px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",fontWeight:"bold",color:"white",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3},children:c.title}),(n.isAdmin||n.id===c.authorId)&&e.jsx("button",{onClick:I=>y(I,c.id),style:{background:"rgba(239, 68, 68, 0.1)",border:"none",color:"#ef4444",borderRadius:"8px",padding:"6px",cursor:"pointer",marginLeft:"10px"},children:e.jsx(gt,{size:16})})]}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",flex:1},children:c.description||"ì¶”ê°€ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsxs("div",{style:{marginTop:"auto",paddingTop:"15px",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.8rem",opacity:.5,borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"var(--accent-color)"}}),c.authorName]}),e.jsx("span",{children:c.createdAt?.toDate?.()?c.createdAt.toDate().toLocaleDateString():".."})]})]})},c.id))}),i&&ye.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),style:{alignItems:"flex-start",paddingTop:"100px"},children:e.jsxs("div",{className:"modal-content",onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{style:{fontSize:"1.4rem",marginBottom:"20px"},children:"ìƒˆ ìž‘ì „ ìˆ˜ë¦½"}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ìž‘ì „ëª…"}),e.jsx("input",{type:"text",value:x,onChange:c=>h(c.target.value),placeholder:"ì˜ˆ: 3ë§‰ ë³´ìŠ¤ ê³µëžµ",style:{width:"100%",padding:"14px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"12px",fontSize:"1rem"},autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"25px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",opacity:.7},children:"ì„¤ëª…"}),e.jsx("textarea",{value:R,onChange:c=>N(c.target.value),placeholder:"ìž‘ì „ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ìž…ë ¥í•˜ì„¸ìš”.",style:{width:"100%",padding:"14px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white",borderRadius:"12px",minHeight:"100px",resize:"vertical"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx("button",{type:"button",onClick:()=>p(!1),style:{padding:"12px 24px",borderRadius:"12px",background:"transparent",border:"1px solid rgba(255,255,255,0.2)",color:"white",cursor:"pointer"},children:"ì·¨ì†Œ"}),e.jsx("button",{type:"submit",style:{padding:"12px 24px",borderRadius:"12px",background:"var(--accent-color)",border:"none",color:"white",fontWeight:"bold",cursor:"pointer"},children:"ìƒì„±í•˜ê¸°"})]})]})]})}),document.body),s&&ye.createPortal(e.jsx("div",{className:"modal-overlay",onClick:()=>{},style:{alignItems:"center",background:"rgba(0,0,0,0.85)"},children:e.jsx("div",{className:"modal-content",onClick:c=>c.stopPropagation(),style:{width:"95%",height:"85vh",maxWidth:"1400px",maxHeight:"1000px",padding:0,overflow:"hidden",display:"flex",flexDirection:"column",background:"#111116",border:"1px solid rgba(255,255,255,0.15)",boxShadow:"0 50px 100px -20px rgba(0,0,0,0.8)"},children:e.jsx(ut,{user:n,tacticId:s.id,initialData:s,onBack:()=>w(null),isMobile:!1,isModal:!0})})}),document.body)]})},Zt=({user:n,isMobile:o,initialTacticId:l,clearInitialTactic:m})=>e.jsx(Qt,{user:n,isMobile:o,initialTacticId:l,clearInitialTactic:m}),en=({user:n,onClose:o})=>{const[l,m]=a.useState([]),[u,j]=a.useState(!0);a.useEffect(()=>{if(!n?.campId)return;const i=q(O(C,"users_v2"),H("campId","==",n.campId)),p=X(i,s=>{const w=Date.now(),x=s.docs.map(h=>{const R=h.data(),N=R.lastSeen?.toMillis?R.lastSeen.toMillis():0,E=w-N<120*1e3;return{id:h.id,...R,isOnline:E,lastSeenAgo:Math.floor((w-N)/6e4)}});x.sort((h,R)=>h.isOnline===R.isOnline?h.nickname.localeCompare(R.nickname):R.isOnline?1:-1),m(x),j(!1)});return()=>p()},[n?.campId]);const v=async i=>{if(window.confirm(`${i.nickname}ë‹˜ì„ ì •ë§ ê¹¨ìš°ì‹œê² ìŠµë‹ˆê¹Œ? (ì•Œë¦¼ ë°œì†¡)`))try{await Be(O(C,"camps",n.campId,"notifications"),{type:"WAKE_UP",targetUid:i.id,sender:n.nickname,read:!1,timestamp:ge()}),alert("â° ê¸°ìƒ ë‚˜íŒ”ì„ ë¶ˆì—ˆìŠµë‹ˆë‹¤!")}catch(p){console.error(p),alert("ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨")}};return ye.createPortal(e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs("div",{className:"modal-content",onClick:i=>i.stopPropagation(),style:{maxWidth:"400px",padding:"0",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"20px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx($,{className:"text-accent"})," ìƒì¡´ìž ëª©ë¡ (",l.filter(i=>i.isOnline).length,"ëª… ì ‘ì†)"]}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"white",opacity:.5,cursor:"pointer"},children:"âœ•"})]}),e.jsx("div",{style:{padding:"20px",maxHeight:"400px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px"},children:u?e.jsx("p",{style:{textAlign:"center",opacity:.5},children:"ëª…ë‹¨ í™•ì¸ ì¤‘..."}):l.map(i=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",borderRadius:"12px",background:i.isOnline?"rgba(74, 222, 128, 0.1)":"rgba(255, 255, 255, 0.03)",border:i.isOnline?"1px solid rgba(74, 222, 128, 0.3)":"1px solid rgba(255, 255, 255, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:i.isOnline?"#4ade80":"#94a3b8",boxShadow:i.isOnline?"0 0 10px #4ade80":"none"}}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[i.nickname," ",i.id===n.id&&e.jsx("span",{style:{fontSize:"0.8rem",opacity:.5},children:"(ë‚˜)"})]}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.6},children:[i.className," â€¢ ",i.isOnline?"ì˜¨ë¼ì¸":`${i.lastSeenAgo}ë¶„ ì „ ì ‘ì†`]})]})]}),!i.isOnline&&i.id!==n.id&&e.jsxs("button",{onClick:()=>v(i),style:{padding:"6px 12px",borderRadius:"20px",border:"none",background:"rgba(255,255,255,0.1)",color:"white",fontSize:"0.8rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(Ft,{size:12})," ê¹¨ìš°ê¸°"]})]},i.id))})]})}),document.body)},tn=()=>{const[n,o]=a.useState("home"),[l,m]=a.useState(window.innerWidth<768),[u,j]=a.useState(0),[v,i]=a.useState(!1),[p,s]=a.useState(!1),[w,x]=a.useState(!1),[h,R]=a.useState(()=>{try{return JSON.parse(localStorage.getItem("bg3_user_profile"))}catch{return null}});if(a.useEffect(()=>{const f=()=>m(window.innerWidth<768);return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),a.useEffect(()=>{},[h]),a.useEffect(()=>{if(!h?.id)return;const f=async()=>{try{await xe(P(C,"users_v2",h.id),{lastSeen:ge()})}catch(g){console.error("Heartbeat fail",g)}};f();const B=setInterval(f,6e4);return()=>clearInterval(B)},[h?.id]),a.useEffect(()=>{if(!h?.campId)return;const f=q(O(C,"users_v2"),H("campId","==",h.campId)),B=X(f,g=>{const d=Date.now(),b=120*1e3,k=g.docs.filter(D=>{const T=D.data();if(!T.lastSeen)return!1;try{const A=T.lastSeen?.toDate?T.lastSeen.toDate().getTime():new Date(T.lastSeen).getTime();return d-A<b}catch{return!1}}).length;j(k)});return()=>B()},[h?.campId]),a.useEffect(()=>{if(!h?.campId||!h?.id)return;const f=q(O(C,"camps",h.campId,"notifications"),H("targetUid","==",h.id),H("read","==",!1)),B=X(f,g=>{g.docChanges().forEach(d=>{if(d.type==="added"){const b=d.doc.data();b.type==="WAKE_UP"&&(new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3").play().catch(D=>console.log("Audio play failed",D)),alert(`â° ${b.sender}ë‹˜ì´ ë‹¹ì‹ ì„ ê¹¨ìš°ê³  ìžˆìŠµë‹ˆë‹¤! ì–¼ë¥¸ ì¼ì–´ë‚˜ì„¸ìš”!`),xe(d.doc.ref,{read:!0}))}})});return()=>B()},[h?.campId,h?.id]),!h)return e.jsx(ot,{onComplete:()=>window.location.reload(),isMobile:l});const[N,E]=a.useState(null),y=f=>{E(f),o("tactics")},c=()=>{const f={user:h,isMobile:l,onlineUsersCount:u,setShowSurvivors:i};switch(n){case"home":return e.jsx(st,{...f,setActiveTab:o,openTactic:y,openProfile:()=>s(!0)});case"chat":return e.jsx(Kt,{...f,setActiveTab:o});case"calendar":return e.jsx(Jt,{...f});case"save":return e.jsx(Vt,{...f});case"admin":return e.jsx(Gt,{...f});case"tactics":return e.jsx(Zt,{...f,initialTacticId:N,clearInitialTactic:()=>E(null)});case"profile":return e.jsx(ot,{user:h,onComplete:()=>window.location.reload(),isMobile:l});default:return e.jsx(st,{...f,setActiveTab:o,openProfile:()=>s(!0)})}},I=n==="chat"||n==="tactics";return e.jsxs("div",{className:"layout-container",style:{display:"flex",minHeight:"100vh",color:"#e2e8f0",fontFamily:"Pretendard, sans-serif"},children:[e.jsx(Xt,{activeTab:n,setActiveTab:o,isMobile:l,user:h,onlineUsersCount:u,setShowSurvivors:i,showProfileView:p,setShowProfileView:s,showProfileEdit:w,setShowProfileEdit:x}),e.jsx("main",{style:{flex:1,padding:l?n==="chat"?"0 0 80px":"15px 15px 110px":I?"0":"40px",overflowY:"auto",position:"relative"},children:e.jsx("div",{style:{maxWidth:I?"100%":"1400px",margin:"0 auto",width:"100%",height:"100%"},children:c()})}),l&&e.jsx("div",{onClick:()=>s(!0),style:{position:"fixed",top:"15px",right:"15px",zIndex:2500,width:"42px",height:"42px",borderRadius:"50%",background:h?.color||"#a78bfa",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 15px rgba(0,0,0,0.4)",border:"2px solid rgba(255,255,255,0.3)",cursor:"pointer"},children:(()=>{const f=h?.className||"";return f.includes("ë°”ë°”ë¦¬ì•ˆ")?e.jsx(Ee,{size:20,color:"white"}):f.includes("ë°”ë“œ")?e.jsx(je,{size:20,color:"white"}):f.includes("í´ë ˆë¦­")?e.jsx(Te,{size:20,color:"white"}):f.includes("ë“œë£¨ì´ë“œ")?e.jsx(Ae,{size:20,color:"white"}):f.includes("íŒŒì´í„°")?e.jsx(ve,{size:20,color:"white"}):f.includes("ëª½í¬")?e.jsx(we,{size:20,color:"white"}):f.includes("íŒ”ë¼ë”˜")?e.jsx(ne,{size:20,color:"white"}):f.includes("ë ˆì¸ì €")?e.jsx(ke,{size:20,color:"white"}):f.includes("ë¡œê·¸")?e.jsx(We,{size:20,color:"white"}):f.includes("ì†Œì„œëŸ¬")?e.jsx(Ne,{size:20,color:"white"}):f.includes("ì›Œë½")?e.jsx(oe,{size:20,color:"white"}):f.includes("ìœ„ìžë“œ")?e.jsx(Se,{size:20,color:"white"}):e.jsx($,{size:20,color:"white"})})()}),v&&e.jsx(en,{user:h,onClose:()=>i(!1)})]})};function nn(){const o=new URLSearchParams(window.location.search).get("tacticId"),l=JSON.parse(localStorage.getItem("bg3_user_profile")||"null");return o&&l?e.jsx(ut,{user:l,tacticId:o,initialData:{title:"Loading...",elements:[]},onBack:()=>window.close(),isMobile:window.innerWidth<768,isStandalone:!0}):e.jsx(tn,{})}class rn extends G.Component{constructor(o){super(o),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(o){return{hasError:!0}}componentDidCatch(o,l){this.setState({error:o,errorInfo:l}),console.error("Uncaught error:",o,l)}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",color:"white",background:"#333"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px"},children:"Reload"})]}):this.props.children}}function an(n={}){const{immediate:o=!1,onNeedRefresh:l,onOfflineReady:m,onRegistered:u,onRegisteredSW:j,onRegisterError:v}=n;let i,p;const s=async(x=!0)=>{await p};async function w(){if("serviceWorker"in navigator){if(i=await Oe(async()=>{const{Workbox:x}=await import("./vendor-D1cCnfCH.js").then(h=>h.an);return{Workbox:x}},[]).then(({Workbox:x})=>new x("/bg3-raid-manager/sw.js",{scope:"/bg3-raid-manager/",type:"classic"})).catch(x=>{v?.(x)}),!i)return;i.addEventListener("activated",x=>{(x.isUpdate||x.isExternal)&&window.location.reload()}),i.addEventListener("installed",x=>{x.isUpdate||m?.()}),i.register({immediate:o}).then(x=>{j?j("/bg3-raid-manager/sw.js",x):u?.(x)}).catch(x=>{v?.(x)})}}return p=w(),s}an();Ut.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(rn,{children:e.jsx(nn,{})})}));
